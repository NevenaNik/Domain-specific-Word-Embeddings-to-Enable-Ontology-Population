Generally speaking, the terms of “powertrain” and “drivetrain” (see Fig. 1.1) refer
both to the vehicle components which produce and deliver the power and torque.
The term “powertrain” sometimes emphasizes the engine and the transmission,
while “drivetrain” (or driveline) stresses the clutch (torque converter), transmission,
driveshaft, differential gear box, axle shaft and wheels. The drivetrain delivers en-
gine torque to the tires, and makes it possible for the vehicle to accelerate or climb
a gradient. Figure 1.2 shows the function of a step-ratio transmission, where the
engine torque characteristics are re-distributed, through different gear ratios, to ap-
proach a desired pattern of wheel torque.
Internal combustion engine generates power by converting chemical energy con-
tained in the fuel into heat, and the heat produces then mechanical work. The engine
torque Te is determined by the ﬂow rate of intake air and fuel, and inﬂuenced by
combustion efﬁciency and friction losses. In modern vehicular powertrains, high-
speed CAN (Controller Area Network) bus connects the control units of the engine
and the transmission, and the shared information includes throttle angle, engine
torque and engine speed, etc. On the other hand, the transmission sends torque re-
quest to the engine through CAN bus. Here, the detailed engine model will not be
considered in the context of this book.

The dynamic equation of engine speed is described by

Ie ˙ωe + Ceωe = Te − Tc,

where Ie is the inertia moment of the engine crank shaft, Ce is the damping coefﬁ-
cient, ωe is the engine rotational speed, Te is the engine torque and Tc denotes the
clutch torque. The most simple engine model is the static torque map, which is a
lookup table with the inputs of the throttle angle and the engine speed, and denoted
as

Te = Te(ωe, θth),

where θth is the engine throttle angle. Various maps in vehicle engineering are ob-
tained from large numbers of experiments in the steady state. As an example, the
torque map of a 2000 cc gasoline engine is shown in Fig. 1.3.

A dry clutch, shown in Fig. 1.4 [61], consists of a housing, pressure plates, fric-
tion plates, a clutch disc with torsion damper and a release mechanism. In manual

transmissions, when the vehicle is starting off from standstill, the clutch slips to
compensate for the speed difference between the engine and the drivetrain. More-
over, when a gear shift operation takes place, the clutch disengages the engine from
the transmission, and then engages them after gear shifting is over.

When the clutch is slipping, the torque delivered through the clutch Tc is deter-

mined by the clamping force Fc implemented on the friction disc:

Tc = Fcμd Rc sign((cid:4)ω),

where Fc is the clamping force, μd is the dynamic friction coefﬁcient, Rc is the ef-
fective radius, and (cid:4)ω is the speed difference between the engine and the drivetrain.

It is worth noting that μd is not time-invariant, but varying with slip speed and the
temperature.

Considering the damp spring embedded in the clutch, the torque of the clutch

friction plate Tc is also a nonlinear function of the twist angle θc as follows:

Tc = Tc(θc, ˙θc),

and the equation is applicable for both slipping and locked-up state of the clutch.

The static characteristics of the torsion spring of a 4-ton truck clutch is shown in

On hydraulic automatic transmissions, the torque converter, as shown in Fig. 1.6,
assumes the functions of the clutch. When the turbine is driven forward, the dynam-
ics of the torque converter are often characterized as [145]

and

where Tp is the pump torque and Ttb is the turbine torque, λ is the speed ratio
deﬁned as

Tp = C(λ)ω2
e

Ttb = t (λ)Tp,

λ = ωtb
ωe

,

with ωtb being the turbine speed.

An example of the capacity factor C(λ) and the torque ratio t (λ) in a mid-size

passenger car are given in Fig. 1.7.

There are many different types of transmissions which will be described in detail
in the following sections. The function of the transmission is to modify the engine
torque and engine speed with the ith gear ratio Ri , so that the momentary traction
requirement could be satisﬁed. Neglecting the friction and the inertia torques, the
transmission could be modeled as

Tt = TcRi,
ωt = ωc
Ri

,

where Tt is the transmission output torque, Tc is the clutch output torque (transmis-
sion input torque), ωt is the transmission output speed, ωc is the clutch output speed
(transmission input speed).

In FF (Front Engine, Front Wheel Drive) vehicles, the differential box is always
combined with the transmission directly, while in FR (Front Engine, Rear Wheel
Drive) vehicles, a propeller shaft connects the transmission and the differential box.
The stiffness of the propeller shaft is comparatively larger, compared with that of
the axle shaft and the clutch torsion spring. However, the clearance in the drivetrain
shafts is an important element when modeling the propeller shaft precisely.

The differential unit compensates for the speed difference between the inside
and the outside wheels when the vehicle is cornering. Generally speaking, the two

output torques of the differential box are equivalent, while the two rotational speeds
do not necessarily equal each other. If the twist deﬂection of the propeller shaft is
ignored, we have

Tl = Tr ,
ωl + ωr = 2ωt
Rdf

,

where Rdf is the gear ratio of the differential box, the subscripts l and r denote the
left side and the right side.

At the same time, the rotational dynamic equation from the transmission to the

differential is

Ip ˙ωt + Cpωt = Tt − 2Tl,r
Rdf

,

where Ip and Cp are the inertia and the damping of the propeller shaft, respectively.

The two drive shafts between the differential gear and the driven wheels are repre-
sented as a torsion spring with stiffness coefﬁcient Ks and a damping with coefﬁ-
cient Cs as follows:

Ts = 2Tl,r ,
Ts = Ksθs + Cs

˙θs,
where Ts is the axle shaft torque and θs is the twist angle of the axle shaft satisfying
˙θs = ωl,r − ωw,

with ωw being the wheel speed.

The longitudinal tire force Fx , which is usually simpliﬁed as a function of the lon-
gitudinal slip ratio Sx , rises fast when Sx increases under a threshold and declines
slowly after that [55], see Fig. 1.8. The force Fz is vertical load of the tire, and the
longitudinal slip is calculated as

Sx = Rwωw − V
Rwωw
Sx = V − Rwωw

V

when driving,

and

when braking,
where Rw is the tire radius, ωw is the wheel rotary velocity and V is the car body
velocity.

The road load consists of three parts: the grade force FG, the rolling resistant
moment Tw of tires and the aerodynamics drag FA. The resistant moment Tw of
tires is regarded as constant here. The grade force is calculated as

where m is the vehicle mass, θg is the grade angle of the road. The aerodynamic
drag is described as

FG = mg sin θg,

FA = 1
2

ρCDAAV 2,

where CD is the aerodynamic drag coefﬁcient, AA is the front area of the vehicle
and ρ is the air density.

Automatic transmission, which relieves the driver from shift operation, changes the
speed ratio of a drivetrain automatically according to the driver intent, current engine
state and road surface condition, so that optimal drivability or fuel economy could be
obtained. As mentioned before, many types of transmissions have been developed,
and Fig. 1.9 shows the history of automotive transmissions. Different transmission
has its own unique features and thereby its own control tasks.

The predominant form of a hydraulic Automatic Transmission (AT) [1] uses a torque
converter, and a set of planetary gearsets to provide a range of gear ratios. The torque
converter consists of three rotating elements with curved blades: pump, turbine and
stator. The pump and turbine hydraulically connect the engine to the transmission
and the stator is used to enhance torque multiplication. The torque converter is fol-
lowed by a set of planetary gearsets, usually including 2–4 planetary gearsets. Each
planetary gearset contains a sun gear, a planetary carrier and a ring gear. These rota-
tional members are connected with hydraulic clutches or brakes, which make partic-
ular members of the planetary gearset motionless, while allowing other members to
rotate. Thereby different gear ratios could be achieved. The merits of an AT include
smooth shifting and comfort driving. However, the dynamic response is relatively
slow, compared to manual transmissions, and because of the hydraulic loss of the
torque converter, traditional ATs have low transmission efﬁciency. In addition, the
structure of traditional ATs is somehow complex and the maintenance cost is high.
As shown in Fig. 1.9, one of the development trends of ATs is to increase the
number of gear ratios, from 4-speed to 5-speed, 6-speed, and at present 8-speed or
9-speed ATs have been developed. The 8-speed AT of ZF, a transmission supplier,
is shown in Fig. 1.10. A higher number of transmission ratios is preferred because
the more the gear ratios, the better the fuel economy. However, the effectiveness
becomes very weak when the number of gears reaches 10.

Another trend of ATs is the introduction of electronic control. For example, the
slip control of the lock-up clutch in the torque converter [62] greatly improves the
transmission efﬁciency while preserving the merit of shock absorbing; independent
clutch control [104] uses a proportional solenoid valve to control each clutch (or
brake), which greatly simpliﬁes the mechanical content of the AT.

As implied by the name, an Automated Manual Transmission (AMT) [95] can be
regarded as a robotized manual transmission where the operations of the clutch and

shift lever are carried out by electro-mechanical or electro-hydraulic actuators. The
actuators are driven by a Transmission Control Unit (TCU). Figure 1.11 shows the
AMT and its diagram chart. AMTs offer the advantages of lower weight, lower cost
and higher fuel economy. However, one of the limitations of AMTs should be the
driving comfort reduction, caused by the lack of traction during gear shift actuation,
which is shown in Fig. 1.12.

Because of its inherent characteristics, an AMT is a suitable choice for micro
cars, sport cars and heavy duty trucks. In vehicles with AMTs, the integrated control
of the engine and clutch becomes an important control issue in order to reduce the
affection of the traction interruption.

An AMT is also suitable for a pure electric vehicle which needs a multi-speed
transmission to improve the launch performance and to extend the cruising speed.
Examples of 2-speed transmissions include a novel seamless transmission proposed
in [130] and the I-AMT (Inverse Automated Manual Transmission) proposed by the

authors [91], which have similar architectures and the traction interruption could be
eliminated. As shown in Fig. 1.13, the name of “I-AMT” derives from the fact that
the dry clutch, which is at the front of a traditional AMT, is put to the end of the
transmission.

A Dual Clutch Transmission (DCT) [56], also referred to as a twin clutch transmis-
sion or a double clutch transmission, uses two separate clutches for odd and even
gear sets, respectively, as shown in Fig. 1.14. It can be fundamentally described
as two separate manual transmissions. When the vehicle is operating with one sub-
drive, the control unit is already selecting the next gear in the other sub-drive. There-
fore, the shift process takes place through the torque delivery from one clutch to the
other, namely we have a clutch-to-clutch shift. Hence, a DCT not only preserves
the advantage of an AMT in high efﬁciency and fast response, it also eliminates the
traction interruption of an AMT.

There are two fundamental types of clutches in DCTs: one is the wet multi-plate
clutch and the other is the dry single-plate clutch, as shown in Fig. 1.15. Because
there is less pumping and friction loss, a DCT with a dry clutch has better efﬁciency.
However, a DCT with a wet clutch can handle higher torque input. The 7-speed DCT
with a dry clutch produced by LUK is designed to transmit torque up to 250 Nm,

while the 6-speed DCT with a wet clutch supplied by Borgwarner is used for engines
which can generate a torque of 350 Nm.

Because there is no torque converter to absorb the shift shock and the process
of the clutch-to-clutch shift is usually ﬁnished within hundreds of milliseconds, the
two clutches must be controlled precisely enough so that large torque interruption
or clutch tie-up can be prevented.

Different from the above step-ratio transmissions with a few different distinct gear
ratios to be selected, a Continuously Variable Transmission (CVT) [1], see Fig. 1.16,
can create a continuously-variable ratio between the higher engine speed and the
lower wheel speed. The ﬂexibility of CVTs allows the engine to maintain a constant
angular velocity over a range of vehicle speeds, which makes the engine operate in
a high-efﬁciency area. However, a CVT transmits torque through friction or traction
drive, its efﬁciency is worse than that of gear transmissions, and ﬁnally, the advan-
tage of fuel economy may not be so signiﬁcant. A CVT is usually utilized for low-
power or mid-power vehicles due to the trade-off of efﬁciency and power density.

The most widely used two types of CVTs are Belt-CVT and Toroidal-CVT [45].
Normally, a Belt-CVT has less torque transmission capability than a Toroidal-CVT.

Finally, the characteristics of each type of transmission are summarized in Fig. 1.17.
For passenger cars, according to the prediction of the market share which is
shown in Fig. 1.18, ATs will still occupy the largest share in the near future and
DCTs will have the fastest increase. In both ATs and DCTs, the change of speed
ratios can be regarded as a process of one clutch being engaged while another being
disengaged, namely, clutch-to-clutch shift. A clutch-to-clutch shift greatly simpliﬁes
the transmission mechanical content and increases the control ﬂexibility, however,
it is quite a challenge to obtain robust shift performance because if the shift process
is not controlled exactly, clutch tie-up, engine ﬂare-up or traction interruption will
be caused.

In the case of commercial vehicles, the AMT is the most popular automatic trans-
mission used because of its low cost and high efﬁciency. In AMT vehicles, control
effort is necessary to weaken the traction loss during the shift process. The reduction
of shift time and shift shock should be taken into account, where clutch control plays
an important role. Moreover, the driveline of commercial vehicles has a relatively
larger torsional vibration compared to passenger cars. When the accelerator pedal
is pressed or released, driveline resonances have a larger impact on the driver, and
thereby active engine control is always adopted to damp the unintentional driveline
jerking. Generally speaking, the precise control of the engine and clutch is crucial
to improve the longitudinal dynamical behavior of AMT vehicles.

A CVT has a basically different mechanical topology, and there is no problem of
shift shock anymore. The major control challenge is to maintain an optimal clamp-
ing force to prevent slipping. At the same time, the speed ration should be con-
trolled fast enough to maximize the fuel economy beneﬁt. If, by combining a CVT
with a planetary gear, an inﬁnite gear ratio range including zero ratio can be ob-
tained, which is called an Inﬁnitely Variable Transmission (IVT), at the geared neu-
tral point, the speed ratio control becomes inadequate and the output torque control
is necessary [132].
Global warming and other environmental concerns require automotive industry to
produce automobiles with more efﬁciency and less emission. On the other hand,
the customer’s requirement for driving comfort and fuel economy is more and more
demanding. The drivetrain propelled by an engine (together with motors in the case
of hybrid powertrains), as shown in Fig. 1.1, plays an important role in these tasks.
In order to meet the above challenges, a lot of new devices and innovative tech-
nologies are proposed and applied in the area of automotive powertrain. In the en-
gines, there are several different ways to improve the performance of fuel economy
and emission, including using a turbocharged gasoline engine with variable valve
timing (VVT) and exhaust gas recirculation (EGR); direct injection stratiﬁed charge
(DISC) gasoline engine with lean NOx trap (LNT) aftertreatment system; and a
diesel engine with variable geometry turbocharger (VGT), higher common-rail pres-
sure (up to 200 MPa) and EGR [37, 79]. In addition, homogeneous charge compres-
sion ignition (HCCI) has the characteristics of both the gasoline and diesel engine,
and provides higher fuel efﬁciency and almost negligible NOx emission [131]. The
implementation of all these technologies depends on the development of electronic
control systems. Along with the increasing complexity of engines, interactions be-
tween different devices become more and more substantiated. For example, lean

burn of spark ignition gasoline engine brings about worse emission; in diesel en-
gines the actuator of EGR affects the characteristics of VGT. In other words, a newly
introduced control input has an inﬂuence on different system outputs [60, p. 11].

On the other hand, the transmission box delivers and adapts engine torque to
the following jointed drive shafts and tires. To improve efﬁciency and drivability,
different kinds of automatic transmission have been introduced, such as automatic
transmission (AT) with torque converter, automated manual transmission (AMT),
dual clutch transmission (DCT), continuously variable transmission (CVT), elec-
trical variable transmission (EVT) [132], and some variants of traditional AMTs,
including “Power-Shift AMT” [106], seamless transmission proposed in [130] and
I-AMT [91]. These transmissions greatly improve the drivetrain performance, and
yet require higher-performance actuator hardware and control software. For in-
stance, as aforementioned, DCTs improve the drivability of AMTs by eliminating
the torque interruption during the shift process. The two clutches, however, have to
be controlled precisely during the clutch-to-clutch shift to avoid tie-up or traction
interruption [56].

In addition, the hybridization of the vehicle propulsion system shows signiﬁ-
cant potential in reducing fuel consumption and exhaust emissions. Hybrid electric
vehicles (HEV), ﬁrstly released en masse into market by Japanese makers Toyota
and Honda, can provide fuel efﬁciency improvement and CO2 reduction of about
one third [25]. Plug-in hybrid electric vehicle (PHEV) [22], a hybrid vehicle with
rechargeable batteries that can be connected to an external electric power source,
further reduces the well-to-wheel CO2 emission signiﬁcantly if the car is driven in
an urban area. Introducing electric motors into the propulsion system brings about
many new control issues. Besides the optimization of the energy management, there
are also some highly transient dynamic control problems, such as mode-switching
control and active damping of drivetrain oscillations [8, 63, 87].

Some other drivetrain control systems include a 4-wheel-drive (4WD) with elec-
tronic torque control [43], and brake systems, such as anti-lock brake system (ABS)
and electronic stability program (ESP) [1], which are more likely to belong to the
area of vehicle safety control [2].

In other words, new functions and legislations are forcing automotive control
systems to become more and more complex. Although automotive control systems
had been developed separately in the past, at present, these systems have to be
designed by considering the interactions and communications between them. One
of the most important interactions in ground vehicles happens between steering and
brake systems [21] because the characteristics of the tire force (or moment) in one
direction is not independent from the others. In the drivetrain system, on the other
hand, perfect drivability will never be achieved without a close cooperation of the
engine and transmission.

Along with the increment of functions, the proportion of electronic components
used in ground vehicles has been increasing steeply in recent years. In a 2007-model
car, electronic components amounted to 20–30 % of the total production cost, and
this ﬁgure is expected to reach 40 % or so by 2015 [70]. Moreover, the software
development occupies a high percentage of the total expenses of automotive elec-
tronics. Figure 1.19 shows the increase of the size of automotive software, and it is

pointed out that, at present, the software accounts for 80 % of the total development
cost of an electronic control unit (ECU) [70].

Model-based control is introduced and developed rapidly under such a tech-
nical background. With the growing intricacy of drivetrain systems, the conven-
tional methodology of developing control systems, normally based on event-driven
(rule-based) control or feedforward control, needs a large amount of cost- and time-
consuming calibrations in order to obtain reasonable over-all control performance.
It is unfavorable for automotive makers because the competition of this industry is
becoming increasingly intense.

“Model-based design” [11, 16, 89, 110, 123] is a methodology applied in designing
embedded software which provides an efﬁcient approach for establishing a common
framework for communication throughout the design process while supporting the
development cycle (such as “V” diagram) [71, 122]. Model based design answers
the requirement of developing automotive control systems which should satisfy the
following attributes:

• Safety;
• Low cost;
• Fuel economy & Emission;
• Drivability;
• Time to market.

Graphical modeling tools, such as MATLAB/Simulink, AMESim, Dymola and
Easy5, etc., provide generic and uniﬁed graphical modeling environment, and there
are many different levels of test tools, including MIL (Model In the Loop), RCP
(Rapid Controller Prototyping), SIL (Software In the Loop), PIL (Processor In the
Loop) and HIL (Hardware In the Loop). Although there are numerous test tools, the
models can be approximately classiﬁed into 3 categories: simulation model, control-
oriented model, and controller model.

Simulation Model

The term simulation model refers to the model required to be as accurate as possible
to represent the real system dynamics, which makes it possible to test the control
software before the hardware prototype is available. Of course, real time simulation
models, which are used in HILS, also belong to this category. In some large-size
real time simulation models, however, some relatively “high-frequency” dynamics,
such as the oil compressibility in hydraulic actuators, may be ignored to assure the
successful implementation of real time computation. Figure 1.20 gives an example
of a drivetrain simulation model established in AMESim.

In this example, the rotational motion of the driveline, including the parts from
the clutch to wheels, is modeled by dynamic and kinematic disciplines. For example,
the dynamics of the drive shaft is described as

Ts = Ksθs + Ds

˙θs,

where Ts denotes the shaft torque, θs is the twist angle, Ks is the stiffness of the
drive shaft, and Ds the damping coefﬁcient. The user needs to give the value of
Ks and Ds in a graphical interface, and AMESim will generate the dynamic equa-
tions automatically, which are based on the power ﬂow analysis of the Bond Graph
technique [77].

The engine torque characteristics, on the other hand, are modeled based on exper-
imental identiﬁcation, which is shown in Fig. 1.3. The torque is identiﬁed as a static

map with the inputs of the engine throttle and the engine speed. This is the simplest
engine model [4, 148]; some other engine models with different time-scales are the
mean-value model (MVM) [60], 1D engine model and CFD (Computational Fluid
Dynamics) model [3, 80]. Another identiﬁed part is the tire model, where the Magic
Formula model [108] and UniTire model [59] are always adopted.

HILS is always introduced when a system or a part of it is too difﬁcult to be
modeled accurately, where the real physical hardware is integrated with mathemat-
ical models through a real time interface. One of the most popular HILSs is the
driving simulator, where the “real part” of the system is the driver, which is also
called a human-in-the-loop simulation. Some other HILSs are always relevant to
electro-hydraulic actuators, the characteristics of which are highly nonlinear and
time-varying.

Control-Oriented Model

The term control-oriented model refers to the model based on which controllers
are synthesised. A control-oriented model must be simple enough to guarantee easy
implementation of the derived controller. On the other hand, it should also be able
to capture the dominant system dynamics. For example, in an automotive driveline
with a dry clutch, see Fig. 1.1, there are distributed compliances including the damp-
ing spring of the clutch, the stiffness of the propeller shaft and the stiffness of the
drive shaft/axle half shaft, etc. However, in a control-oriented model for the problem
of active damping control [109], these rotational freedoms are not all included, but
only the compliance of the drive half-shaft is considered because it dominates the
fundamental vibration of the driveline. In other words, the drive half-shaft has the
“softest” twist characteristics compared to those of the others. A control-oriented
model can be given in the form of state-space equations. For example, the follow-
ing set of differential equations

˙ωc = 1
Ii
˙ωw = 1
Iv

˙Ts = Ks

(cid:2)
Te − 1

(cid:3)

Ts

,

RiRdf

(Ts − Tv),
(cid:2)

1
RiRdf

(cid:3)

ωc − ωw

(1.17a)

(1.17b)

(1.17c)

is used to describe the driveline dynamics for anti-jerk control, where the rotational
damping is ignored. In model (1.17a), (1.17c), ωc is the output speed of the clutch;
ωw is the wheel speed; Ts is the axle shaft torque; Ii denotes the equivalent inertia
moment from the engine to the axle shaft, at the ith gear position, i = 1, 2, . . . , 6;
Iv is the equivalent inertia of the vehicle; Te is the engine torque, and Tv is the
driving resistance torque; Ri denotes the gear ratio of the ith gear position, and Rdf
is the ratio of the differential gear box; Ks is the stiffness of the axle shaft.

1.3 Why Consider Model-Based Control?

19

Examples of a transfer function model could be found in [120], where the dy-
namics of the proportional pressure control valve is identiﬁed as a ﬁrst-order lag,
and the transfer function from the valve current u to the brake speed ω is given as

G0(s) = Ω(s)
U (s)

= − μRNA
I s + Cd

Krva
s + a

,

(1.18)

where μ is the friction coefﬁcient, R is the effective radius of the brake plate, N is
the number of friction plates, A is the piston area, Cd is the coefﬁcient of viscous
friction, Krv is the gain of the proportional reducing valve and a is the identiﬁed
parameter of the ﬁrst-order lag.

Controller Model

A controller model represents the control algorithm which is designed to achieve
the desired performance of the control system. It is singled out especially because in
recent years a controller model established by MATLAB/Simulink can be converted
to embedded code very conveniently using tools of automatic code generation.

Traditionally, when developing embedded control systems, text-based program-
ming was used and it was time-consuming and prone to error. This problem was
overcome by introducing graphical modeling tools, such as MATLAB/Simulink. If
the controller algorithm is represented by a graphical model, the designers of differ-
ent departments can grasp the entire controller construction quickly, and it is easy to
transport the model from one stage to another in the whole design process. Some ex-
amples of code generation software are dSPACE/TargetLink, Real-Time Workshop,
Embedded Coder.

1.3.3 Application Examples of Model-Based Control

Until now, simulation and automatic code generation have been widely applied in
control system development of automotive drivetrains. There are, however, rela-
tively fewer published reports about successful applications of model-based con-
troller design in production drivetrain systems (in this book, the model-based con-
troller design refers to synthesizing a controller based on a control-oriented model).
Actually, at present the widely used control algorithms are still based on event-
driven (rule-based) or feedforward control. One of the reasons may be the relevance
of various uncertainties in automotive drivetrains, such as large variations of the
operating condition, part-to-part variability and long-term aging.

Although there exist many difﬁculties, the automotive and supplier compa-
nies are making strenuous attempts to a establish model-based controller synthesis
framework because of its merit of reducing parameter calibrations while achieving
higher dynamic performances. In engines, the model-based air/fuel (A/F) ratio con-
trol [60] and model-based cylinder torque estimation [26] have been tested practi-
cally. In the area of the driveline, one successful example is reported in [62], where

20

1

Introduction

a high performance and highly reliable slip control system for a torque converter
clutch is realized through the application of the H∞ control theory. It was claimed
that this is the ﬁrst case of practically applying the H∞ theory to mass-produced
automotive components. Another example is INVECS-II, a 5-speed AT (Automatic
Transmission) produced by Mitsubishi in Japan, where a model-based feedback con-
trol is adopted to control the clutch speed during the shift process [119]. Shift shock
was reduced by carefully designing the reference trajectory of the clutch speed.

1.4 Why Consider Nonlinear Control?

1.4.1 Necessity of Nonlinear Control

When applying model-based control to automotive drivetrains, the following control
methodologies have been used:
• Open-loop control, event-driven control [42];
• Linear control, PID control [148];
• Robust control, H∞, μ-synthesis [62, 120];
• Nonlinear control, sliding mode control, model predictive control, etc. [13, 98].

Among these methodologies, open-loop control and feedback control based on lin-
ear models have been applied in the mass-production of drivetrains, while the ma-
jority of nonlinear control designs are still in the stage of academic research.

Nonlinear control approaches are attracting more and more attention because of

the inherent characteristics of automotive drivetrains, namely,
• Large operation range;
• Large modeling uncertainty;
• Strong actuator nonlinearity.

First, automotive drivetrains work in a wide range of speed and torque. For a
typical mid-size passenger car, the engine speed may vary from 500 to 8000 rpm,
while its torque changes from negative (engine braking) to positive about 300 Nm.
When the operation range of a control system is large, linear controllers behave
poorly and gain scheduling is always necessary, which introduces a large amount of
calibration works. Nonlinear control can handle nonlinearities directly, and it makes
the control system work well at every operating point without laborious tuning of
parameters.

Second, automotive drivetrains work in an uncertain environment, such as al-
titude, temperature, road slope/grade, road surfacing condition and vehicle mass.
These uncertain variables yield modeling errors when a control-oriented model is
established. For example, when a fully loaded vehicle is climbing a slope, the driv-
etrain dynamics is much different from an empty vehicle driving on a ﬂat road.
In addition, long-term aging and part-to-part variability also bring about inevitable
uncertainties.

1.4 Why Consider Nonlinear Control?

21

Fig. 1.21 Pressure response
of wet clutch valve. Reprinted
from [120], copyright 1998,
with permission from Elsevier

Finally, automotive drivetrains are inherently nonlinear. Engine torque character-
istics, torque converter characteristics and air drag characteristics are all nonlinear.
Furthermore, the characteristics of drivetrain actuators are highly nonlinear. For ex-
ample, the clutch plays a crucial role in drivetrain dynamics. However, the friction
characteristics of the clutch plates and the dynamics characteristics of a clutch actu-
ator are very complex.

Figure 1.21 shows the pressure response of a clutch actuator, i.e., a hydraulic
cylinder controlled by a proportional pressure control valve. The valve current is
stepped at different levels of pressure, and it is shown that the higher the operating
pressure, the quicker the step response.

Not only the dynamic response from the valve current to the clutch pressure
is nonlinear, the response from the clutch pressure to the delivered torque is also
highly nonlinear. Figure 1.22 gives the experimental results of the torque response
of a wet clutch. The thick solid line is the delivered torque under the input of the
clutch pressure, the thin-color line. It is shown that the responses are quite different
along with the variations of the temperature and the clutch speed.

In the case of dry clutch, the delivered torque is a nonlinear function of the
throwout bearing position and the slip speed. Figure 1.23 gives an example of the
torque mapping of a dry clutch.

From above we can see that the complex friction and actuator characteristics

make drivetrain control a highly nonlinear control problem.

1.4.2 State-of-the-Art of Applied Nonlinear Control

Nonlinear control consists of a variety of powerful methods, including
• Sliding mode control;
• Feedback linearization;
• Differential ﬂatness;
• Backstepping;

22

1

Introduction

Fig. 1.22 Torque response of a wet clutch for different slip speeds and temperatures. Reprinted
from [39], copyright 2006, with permission from IEEE

Fig. 1.23 Torque map of a
dry clutch for different slip
speeds and throwout bearing
positions. Reprinted
from [138], copyright 2011,
with permission from IEEE

• Input-to-state stability (ISS);
• Model predictive control;
• Data-driven control, etc.

Each of them has its own characteristics and successful industrial applications.

1.4 Why Consider Nonlinear Control?

23

Sliding Mode Control

Sliding mode control, initiated and prompted by the works of Itkis [73], Utkin [136],
Slotine [124], Hedrick [126] and others has been extensively developed in both the-
ory and applications in the last few decades. Sliding mode control is essentially a
form of variable structure control, it accounts for nonlinearity and provides good
robustness against modeling imprecision. The control law is not a continuous func-
tion, but switches from one structure to another according to the current system
state. The multiple control structures are designed so that state trajectories always
move toward a switching condition, and ﬁnally the trajectories are forced to slide
along the preferred surface boundaries. The motion of sliding along the boundaries
is called sliding mode, and the boundaries are called sliding hypersurface.

The main advantage of sliding mode control is its robustness. If the “matching
condition” is satisﬁed, the sliding mode can be achieved in spite of disturbances and
parametric variations. This makes the variable structure control have the following
merits: fast response, insensitive to disturbances and uncertainties, no need of online
identiﬁcation, and easy implementation. The shortcoming of sliding mode control
is that, once the state trajectory arrives at the sliding surface, it is difﬁcult to make
it strictly slide along the surface. Under hard sliding-mode-control action, the state
inevitably moves across the surface repeatedly, which is called “chatter”.

Along with the recent development of sliding mode control, the control disconti-
nuities can be eliminated while the concept of “attractive” surface is retained [133].
Sliding mode control has been successfully applied to robot manipulators, under-
water vehicles, automotive transmissions and engines, high-performance electric
motors, and power systems [125]. In automotive engines, sliding mode control
has been used in EGR (Exhaust Gas Recirculation) and VGT (Variable Geome-
try Turbocharger) [136], and in the driveline area, sliding mode observer has been
designed to estimate the torque of the drive axle shaft and the pressure of the
clutch [98, 141]. There is also research on the clutch speed control using the sliding
mode method [146].

Feedback Linearization

Feedback linearization was proposed and developed in the works of Brockett [19],
Hunt et al. [69], Isidori [72], Nijmeijer and Van der Schaft [107], and others. The
approach stems from the theory of differential geometry, and the central idea is
to algebraically transform nonlinear dynamics into a linear one, which is achieved
exactly by a state transformation and a state feedback, rather than by a linear ap-
proximation [125].

Feedback linearization has been successfully used in some practical control
areas, including helicopters, high performance aircrafts, industrial robots, and
biomedical devices [125]. In other industries, the application of feedback lineariza-
tion is also extended. For example, in [94], feedback linearization is used to trans-
form the nonlinear dynamics of an active magnetic bearing into a linear one and then

24

1

Introduction

a high-performance controller for the feedback linearized plant is designed with
μ-synthesis to guarantee the compliance performance speciﬁcation of the beam.
In [20], feedback linearization is applied in an automotive suspension system where
a somehow intelligent feedback linearization controller is suggested through on-
line estimation of nonlinear parameters. Reference [18] investigates the stop-and-go
cruise control of a heavy duty truck, and an extended feedback linearization based
on the nonlinear Smith predictive method is proposed. This method not only con-
verts the nonlinear system to a linear canonical form, but also can compensate for
the variable time delay effectively. Then, a tracking control algorithm provides pre-
cise acceleration/deceleration tracking under low-speed driving.

Differential Flatness

It has been proved that the existence of dynamic exact feedback linearization is
equivalent to the property of ﬂatness. The concept of Differential Flatness was ﬁrst
proposed by M. Fliess et al. [49], and then further researched by P. Martin and
R.M. Murray [48, 137]. A dynamic system is called differentially ﬂat if the system
input and state variables can be expressed as functions of the system output and a
ﬁnite number of its time derivatives [49]. The system output is then called a ﬂat
output. For a differentially ﬂat system, if the trajectory of the ﬂat output is given,
the desired control input can then be derived directly as a function of the ﬂat output
and its derivatives, which can be served as a feedforward control for tracking prob-
lems. In other words, the use of differential ﬂatness can improve the performance
of an existing linear feedback control system by introducing a nonlinear feedfor-
ward compensator. The key issue of applying the differential ﬂatness technique is to
check if the considered system is ﬂat and to ﬁnd a reasonable ﬂat output.

The concept of differential ﬂatness is widely used for trajectory planning and
tracking control. In [34], for the solenoid valve actuator used for gas exchange in
internal combustion engines, ﬂatness is used for the motion control of the armature.
In [64], an electro-hydraulic clutch position control system of an AMT is consid-
ered, and based on the ﬂatness approach, a nonlinear feedforward control is designed
to combine with a linear feedback control.

Backstepping

In recent years, robust nonlinear control has attracted a great deal of research in-
terest. Many synthesis approaches were proposed where the controlled variable is
chosen to make the time derivative of a control Lyapunov function (CLF) [10, 127]
negative deﬁnite [133]. One important methodology is “integrated backstepping”,
and a systematic design procedure has been developed for the backstepping ap-
proach in the book by M. Krstic et al. [83].

The term backstepping refers to a technique developed by Petar V. Kokotovic and
others [81, 82] to design stabilizing controllers for a class of nonlinear dynamical

1.4 Why Consider Nonlinear Control?

25

systems in the strict-feedback form. One can start the design process from designing
a stabilizing controller for the inner subsystem by viewing the state of the upstream
subsystem as virtual control and “back out” new controllers that progressively sta-
bilize each outer subsystem. The process terminates when the real external control
is ﬁnally reached. In this sense, the process is called backstepping. In each recursive
step, one constructs an augmented CLF and renders its derivative negative to obtain
the virtual control, therefore, the control law obtained by backstepping is asymptot-
ically stabilizing.

The backstepping technique has wide-area application, such as in the control of
an electric motor [67] and an electro-hydraulic system [6, 76]. It has been demon-
strated that backstepping is a suitable method to deal with the nonlinearity intro-
duced by hydraulic actuators, such as the nonlinear oriﬁce ﬂow characteristics [135].

Input-to-State Stability (ISS)

For a linear time-invariant system, the zero-input response decays to the origin expo-
nentially, while the zero-state response is bounded for every bounded input, namely
is a bounded-input bounded-state property. For a general nonlinear system, however,
it should not be surprising that these properties may not hold [78]. The concept of
input-to-state stability (ISS) extends the notion of the global asymptotical stability
(GAS) to nonlinear systems, and provides a natural framework in which stability is
formulated with respect to the input.

The notion of input-to-state stability (ISS) was originally introduced by E.D.
Sontag [128, 129], and it has been proved that ISS can be stated in several equiv-
alent manners using, e.g., dissipation, robustness margins, and classical Lyapunov-
like deﬁnitions. This indicates that ISS is a mathematically natural concept. The
concept of ISS has been employed by several authors in deriving results on con-
trol of nonlinear systems, including discrete-time nonlinear systems [75], switched
systems [139], model predictive control [97], nonlinear observer design [5, 52] and
neural networks [121]. The industries wherein ISS has been applied include at least
automotive [53, 66] and robot [9].

Model Predictive Control

Model Predictive Control (MPC), also referred to as moving horizon control or re-
ceding horizon control, has become an attractive feedback strategy for controlling
constrained systems. The main idea of MPC is to use a mathematical model to
predict the future dynamic behavior of the to-be-controlled system over a predic-
tion horizon, and to determine then the control input over a ﬁnite control horizon
such that a predetermined open-loop performance objective function is optimized.
Hence, the MPC problem is formulated as solving online a ﬁnite horizon optimal
control problem subject to (linear or nonlinear) system dynamics and time-domain

26

1

Introduction

constraints involving states and inputs [24, 116]. At each sampling instant, the op-
timization problem is solved to obtain the optimal control sequence, and only the
ﬁrst element is applied to the system. The procedure is repeated at the next sampling
instant, updated with the new measurement.

MPC was introduced and developed at the end of the 1970s under the differ-
ent names such as Model Algorithm Control (MAC) [117, 118], Dynamic Matrix
Control (DMC) [38], Generalized Predictive Control (GPC) [35, 36] and Mov-
ing Horizon Control [84, 85], for different application areas and from different
viewpoints. Over the past few years, academic research on MPC has produced
signiﬁcant progresses on issues of both stability and robustness (see, for exam-
ple, [14, 28, 29, 31, 32, 57, 58, 86, 92, 100, 101]). For a complete survey, we refer
to, for example, [7, 12, 27, 46, 54, 93, 96, 99, 102, 103, 114, 115].

The main advantages of MPC are the functionality of performing multi-variable
optimal control, the ability to account for nonlinear dynamics and to handle time-
domain system constraints in an explicit and optimal way. With the rapid devel-
opment of computing, MPC is successfully applied not only in reﬁning and petro-
chemicals where slow dynamics are dominant [111, 112], but also in aerospace
and defense (see, for example, [17, 44, 74]). In the area of automotive powertrains,
application examples include Homogeneous Charge Compression Ignition (HCCI)
engine [15], idle speed control [23] and engagement control of a dry clutch [13].
The to-be-coordinated requirements are, for example, drivability, fuel economy and
ride comfort, while time-domain constraints could include
• Safety constraints;
• Emission regulation;
• Actuator saturation;
• Frequency response limitation of actuators;
• Trajectory constraints.

Data-Driven Control

It should be noted that automotive systems are inherently complex, highly nonlin-
ear, switching and strongly coupling. Moreover, in recent years, for catering to cus-
tomer’s requirements and stringent emission regulations, new technologies and new
actuators were introduced, which increased the degree of freedom and coupling of
the automotive control system and made automotive systems more and more com-
plex. At the same time, the system characteristics change along with the variation
of driving conditions and long-term aging. For example, the damping coefﬁcients of
rotational shafts change greatly with the environmental temperature. Long-term ag-
ing and variation of driving conditions still bring about signiﬁcant modeling errors.
Therefore, one of the direct consequences is the difﬁculty of decision making or re-
alizing the system’s control and optimization with model-based approaches, which
need mathematically building the dynamic models of the system [65, 140, 147]. For-
tunately, computer technologies, digital sensor technologies, and networking tech-
niques are widely used, which generate a great quantity of historical and real-time

1.5 Structure of the Text

27

data related to the modern industries. In this case, technologies for data management
such as data mining, data collection, and data fusion have emerged [41, 143]. All of
these have led to the development of data-driven methods which have great interest
from the system and control communities, especially in the research ﬁeld of control
techniques [134, 140, 144].

The data-driven modeling method has received considerable attention, stemming
from artiﬁcial intelligence and machine learning [68, 105]. Data-driven methods
present not only a new avenue but also new challenges both in theories and appli-
cations [88, 90, 113, 144]. The data-driven model-free control method implies that
the controller design is merely based on the input/output measurement data of the
controlled plant, without explicitly or implicitly using the plant structure or dynam-
ics information of the controlled plant, and whether the plant is linear or nonlinear.
Although the data driven approach focuses on input–output relations and avoids
derivation of differential equations, it is a consensus that a physically-based model
and a data-driven model are not necessarily mutually exclusive, and sometimes they
play complementary roles, which will be seen in the example of vehicle launch con-
trol in Chap. 8.

1.5 Structure of the Text

As stated above, the function of an automotive drivetrain is to provide the thrust
force to induce the longitudinal motion of a vehicle, and it determines the fuel econ-
omy and the longitudinal dynamic performance. Even though technical performance
of automotive vehicles has been improved, customers demand global comfort and
fuel economy more and more. To remain competitive, vibratory comfort and driv-
ability have become a main preoccupation for car manufacturers.

The deﬁnition of drivability is somehow complex because it implies subjective
perception of the driver. Vibratory discomfort means all low frequency sensations
which cause trouble to passengers. One important aspect of drivability is the ﬁrst
resonant mode of the driveline in the frequency range of 0–10 Hz, which is called
“shufﬂe”. The book will focus on this frequency range of the drivetrain vibration,
which involves the shift shock and other unintentional driveline jerks.

Because CVTs offer continuously variable gear ratios between established mini-
mum and maximum limits, the mechanism of the dynamic control is quite different
from the step-ratio transmissions. In this book, we will concentrate on the dynamic
control of step-ratio transmissions, including AT, DCT and AMT, and the outline of
the content is shown in Fig. 1.24.

First, the clutch-to-clutch shift control [33], which is the shift technique of ATs
and DCTs, will be investigated in detail. The clutch-to-clutch shift process can be
approximately divided into the torque and inertia phases. In the torque phase, the
traction torque of the engine or the turbine of the torque converter is transferred from
the off-going clutch to the on-coming clutch, where the precise timing of releasing
and applying of clutches is crucial for the prevention of the clutch tie-up and traction

28

1

Introduction

Fig. 1.24 Outline of the book

interruption. In the inertia phase, the on-coming clutch is synchronized through the
engagement slip, where the clutch speed control [40] or engine speed control [56]
can be adopted to guarantee good shift quality. The context of this part (the left
column of Fig. 1.24) is separated as Chaps. 2, 3 and 4.

In traditional ATs, a logic hydraulic circuit and a one-way clutch are used to
guarantee the smooth torque transfer between two shifting clutches, and the off-
going clutch can be disengaged automatically when the torque delivered in it reaches
zero. However, in newly developed ATs with independent clutch control, one-way
clutches are always eliminated in order to simplify the mechanical content and to im-
prove the control ﬂexibility. Therefore, for the vehicles with a hydraulic cylinder as
a clutch actuator, which is ubiquitous in the present transmissions, the cylinder pres-
sure control becomes important for good shift quality. Sensors measuring the clutch
cylinder pressure, however, are seldom used. Hence, it is required to estimate the
shaft torque or the cylinder pressure, in order to enhance control performance [142].
In Chap. 2, a reduced-order nonlinear observer is proposed for estimating the clutch
pressure in the framework of input-to-state stability [129]. Based on the pressure
estimation, a feedback control strategy is designed for the shift torque phase of the
clutch-to-clutch shift process in Chap. 3.

1.5 Structure of the Text

29

In Chap. 4, special attention will be put on the clutch speed control during the
inertia phase of the clutch-to-clutch shift. The clutch slip control during the inertia
phase greatly inﬂuences the shift shock and shift time. Because the clutch engage-
ment is expected to satisfy different and sometimes conﬂicting objectives, namely
minimizing the clutch lock-up time, minimizing the friction losses during the slip-
ping phase and ensuring a smooth acceleration of the vehicle, the integrated control
of the engine and the clutch is necessary. In this text, the control scheme is designed
to make the clutch speed track a reference trajectory. Although in the speed tracking
control scheme one does not consider the above multiple control objectives directly,
the required shift time and shift comfort can be achieved by selecting a proper refer-
ence trajectory and the friction loss can also be reduced by a suitable engine torque
coordination during the shift process [51].

Then, in the second part of the book (the right column of Fig. 1.24), driveline
torque estimation, shift control and launch control of AMTs will be addressed in
Chaps. 5, 6, 7 and 8.

As aforementioned, for commercial vehicles with an AMT, active damping of the
driveline oscillation is an important control issue. Knowing the torque information
of the driveline helps to attenuate the driveline vibration. It has been pointed out that
the drive axle shaft is the most dominant compliance of the driveline, and the torque
of the drive axle shaft can be used to evaluate the overall torque delivered in the
driveline [109]. Although the information of axle shaft torque can help restrain the
driveline oscillation, torque sensors are seldom used in production vehicles because
of the cost and durability. Hence, it is required to estimate the torque of the drive
axle shaft. The estimation of the axle shaft torque will be discussed in Chap. 5.

In Chaps. 6 and 7, the clutch disengagement and engagement control will be
respectively addressed. Based on the observer designed in Chap. 5, a clutch dis-
engagement strategy is proposed in Chap. 6 to achieve a fast and smooth clutch
disengagement process. In Chap. 7, the clutch engagement control in both power-
on upshift and downshift of an AMT will be studied. The processes of upshift and
downshift are quite different because the engine speed has to be reduced to reach the
synchronization speed for the gear upshift while it has to be increased for the gear
downshift. However, the engine speed cannot be controlled equally fast in both di-
rections [50]. In other words, in the case of the downshift, the synchronization speed
can be reached in a sufﬁciently short time, while for the upshift it is difﬁcult for the
engine to decelerate in a short time. Hence, in order to obtain a short shift time
with a small shift shock optimally, the processes of gear upshift and gear downshift
will be addressed in different control schemes. When considering the conﬂicting
requirements of small friction wear and comfort for the shift process, Model Predic-
tive Control (MPC) is adopted because of its ability to deal with multiple objectives
in an optimal sense and to handle time-domain constraints in an explicit fashion.

Besides gear shifting, starting-up is also an important control issue for vehicles
with an AMT. The characteristics of the AMT clutch during the start-up process are
fast and complex. Moreover, the system characteristics change along with the vari-
ation of the driving conditions and long-term aging. Therefore, in Chap. 8, a data-
driven predictive controller will be designed directly from the input–output data and
will not require an explicit model of the AMT clutch system.

In both DCTs and new ATs [19], the change of the speed ratio is regarded as
the process of one clutch being engaged with the other being disengaged, namely,
the clutch-to-clutch shift. Furthermore, smart proportional valves with a large ﬂow
rate are developed for direct clutch pressure control, without using the pilot duty
solenoid valve [3]. These valves can be used in new ATs to improve the ability of
adapting to different driving conditions, as well as to reduce cost and to improve
packaging. For vehicles with a hydraulic cylinder as clutch actuator, the cylinder
pressure control becomes important for good shift quality. Sensors measuring the
clutch cylinder pressure, however, are seldom used because of the cost and dura-
bility. Hence, it is required to estimate the shaft torque or the cylinder pressure, in
order to enhance control performance [22].

There have been some studies on the estimation of the transmission shaft torque
and the clutch pressure. A sliding mode observer is designed to estimate the torque
of an automotive drive shaft in [13, 14]. An adaptive sliding mode algorithm is
proposed to estimate the turbine torque of a torque converter in [23]. Furthermore,
[22] uses the sliding mode method to estimate the clutch pressure in a hydraulically
powered stepped AT. The extended algorithm in [21] is used to estimate the clutch
pressure and the transmission output shaft torque simultaneously. In [9, 17], a neural
network is suggested to estimate the turbine torque, in which the engine speed,
the turbine speed and the oil temperature are inputs. Reference [9] also designs a
driving load observer by assuming that the driving load is slowly-varying. In [20],
a recursive least squares method with multiple forgetting factors is used to estimate
the road grade and the vehicle mass. In [10], a full-order observer is proposed for the
pressure monitoring of a torque converter’s lock up clutch, where a state-dependent
term is appended in the conventional Luenberger state observer to eliminate the
effect of possible parameter variations in some sense. The question of how to design
this term is crucial for the performance and the implementation of the observer.

A new AT with clutch-to-clutch shift technology is considered in this chapter, in
which electro-hydraulic actuators are adopted to control the clutches independently.

Because of the complex nonlinearities in an automotive powertrain, such as the
speed–torque relationship of engines and the characteristics of torque converters, it
is very hard to model the whole dynamics with physical principles. Lookup tables,
which are obtained from many experiments in the steady state, are widely used to
describe the nonlinear characteristics. There inherently exist model uncertainties,
such as steady-state error and unmodeled dynamics. Moreover, the variation of the
vehicle mass and the road grade also bring uncertainties to the powertrain dynamics.
Therefore, the clutch pressure/torque estimator must be robust against the variation
of powertrain parameters and the uncertainties.1

2.2 Description and Modeling of a Powertrain System

We consider the powertrain in passenger vehicles with a two-speed AT, as schemat-
ically shown in Fig. 2.1. A planetary gear set is adopted as the shift gear. Two
clutches are used as the actuators, and two proportional pressure valves are used
to control the two clutches. When clutch A is engaged and clutch B disengaged, the

1This chapter uses the content of [4], with permission from IEEE.

2.2 Description and Modeling of a Powertrain System

39

Fig. 2.2 Engine torque map
with speed and throttle
opening

powertrain operates in the ﬁrst gear and the speed ratio is given by

(2.1)

(2.2)

i1 = 1 + 1
γ

,

i2 = 1.

where γ is the ratio of the teeth number of the sun gear to that of the ring gear.
While clutch A is disengaged and clutch B engaged, the vehicle is driven in the
second gear with a speed ratio of

The powertrain simulation model is established by the commercial simulation
software AMESim. Except for the simpliﬁed 2-speed transmission, the simulation
model represents a typical front-wheel-drive mid-size passenger car equipped with
a 2000 cc injection gasoline engine. The constructed model captures the important
transient dynamics during the vehicle shift process, such as the drive shaft oscilla-
tion and the tire slip. Moreover, the time-delays in control and time-varying param-
eters are also considered in the simulation model of the proportional valves [16],
which are neglected in the observer design.

Engine The work reported here is primarily concerned with shift transients, and
therefore a simple engine model is used. The dynamic equation of the engine speed
is represented by

Ie ˙ωe + Ceωe = Te − Tp,

(2.3)

where Te is the engine output torque and Tp is the output torque of the converter
pump. The engine output torque is simpliﬁed as a nonlinear function of the engine
rotational speed ωe and the engine throttle angle θth, i.e., Te = Te(ωe, θth). This map
is shown in Fig. 2.2.

Torque Converter The capacity factor C(λ) and the torque ratio t (λ) of the con-
sidered torque converter are given in Fig. 2.3.

40

2 Pressure Estimation of a Wet Clutch

Fig. 2.3 Capacity factor
C(λ) and torque ratio t (λ) of
the torque converter

Planetary Gear Set Using the submodel provided by commercial software, such
as AMESim, the planetary gear set can be modeled conveniently. The following
parameters are required for the modeling setting: the inertia moment of the torque
converter turbine It ; the inertia moment of the ring gear Ir ; the teeth number of the
sun gear Zs and the teeth number of the ring gear Zr .

Differential Gear Box and Drive Shaft The gear ratio of the differential gear box
is denoted as Rdf . The two drive shafts between the differential gear and the front
wheels are represented as a torsion spring with stiffness coefﬁcient Ks and a torsion
damping with damping coefﬁcient Cs .

Tires The longitudinal tire force Fx , which is usually simpliﬁed as a function of
the longitudinal slip ratio Sx , rises fast when Sx increases under a threshold dSx and
declines slowly after that [7]. Here it is represented approximately as a tanh function
of Fx = Fx max tanh( 2Sx
dSx

). The longitudinal slip Sx has been deﬁned in Sect. 1.1.

Road Loads The road load consists of three parts: the grade force FG, the rolling
resistant moment of tires Tw and the aerodynamic drag FA, which has been intro-
duced in Sect. 1.1.

Clutches and Valves The friction coefﬁcient μ is a nonlinear function of (cid:4)ω
shown in Fig. 2.5. In the design of the pressure observer in Sect. 2.3.2, we assume
the parameters (τcv, Kcv) of the proportional pressure control valve as constant, and
we also ignore the time-delay of the valve. Actually, the valve has a time-delay
and the parameters vary according to different operating points [16]. Hence, the
dynamics of the proportional valve in the powertrain simulation is given by

˜τcv ˙pcb(t) = −pcb(t) + ˜Kcvib(t − ˜Lcv).

(2.4)

Finally, the values of the parameters used in the powertrain simulation are listed
in Table 2.1. Nonlinear functions Te(ωe, θth), C(λ), t (λ), μ((cid:4)ω), ˜τcv, ˜Lcv and ˜Kcv
are given in the lookup tables.

2.3 Clutch Pressure Estimation Without Consideration of Drive Shaft Stiffness

41

Gear ratio of the differential gear box

Damping coefﬁcient of engine crane

Front area of vehicle

Inertia of crane and pump

Aerodynamic drag coefﬁcient

Return spring force of clutch B

Longitudinal slip threshold of tire

Damping coefﬁcient of drive shaft

Table 2.1 Values of
simulation model parameters AA
CD
Ce
Cl
dSx
Fs
Fx max Maximum longitudinal force of tire
idf
Ie
Ir
It
˜Kcv
Kl
˜Lcv
m
Rw
Tw
Zr
Zs
θg
ρ
˜τcv

Moment of resistance of tires

Inertia moment of ring gear

Teeth number of ring gear

Inertia moment of turbine

Teeth number of sun gear

Time constant of valve B

Stiffness of drive shaft

Time-delay of valve B

Gain of valve B

Vehicle mass

Road grade

Air density

Tire radius

2 m2
0.3

0.047 Nm/rad

10 Nm/rad

0.1

600 N

3200 N

3.0
0.17 kg m2
0.01 kg m2
0.06 kg m2
0–1.7 MPa/A

6500 Nm/rad

0–0.03 s

1500 kg

0.3 m

110 Nm

60

40

0 deg
1.2 kg/m3
0.02–0.20 s

2.3 Clutch Pressure Estimation Without Consideration of Drive

Shaft Stiffness

A reduced-order clutch pressure observer based on the concept of input-to-state sta-
bility (ISS) [12, 18] is proposed, where the rotational speeds are the measured out-
puts and the special structure of the clutch pressure system is exploited. The lookup
tables of the nonlinear characteristics of powertrain systems appear in their origi-
nal map form, and the model uncertainties are considered as additional disturbance
inputs. A systematic procedure is given to design the nonlinear clutch pressure ob-
server such that

• The error dynamics is input-to-state stable, where modeling errors are the inputs.
This means that the initial estimation error decays exponentially and the estima-
tion error is guaranteed to be bounded for the bounded modeling errors;

• The requirements on estimation performance, such as decay rate and error offset,

are easily and explicitly considered during the design process;

• The implementation of the designed observer beneﬁts from the reduced order and

the time-invariant gains of the observer;

42

2 Pressure Estimation of a Wet Clutch

Fig. 2.4 1st-to-2nd gear shift (1st gear driving—torque phase—inertia phase—2nd gear driving)

• Lower observer gains are obtained through convex optimization, which increases
the robustness against noises and reduces the estimated upper bound of the error
offset.

2.3.1 Clutch System Modeling and Problem Statement

During the shift process, the on-coming and off-going clutches are controlled by
the two valves through separate controllers, which are assumed to be well-designed.
The controllers discussed in Chap. 3 and Chap. 4 can be viewed as such controllers.
The power-on 1st-to-2nd upshift is considered here as an example of the shift pro-
cess. The gear shift process is generally divided into the torque phase, as shown in
Fig. 2.4, where the turbine torque is transferred from clutch A to clutch B and the
inertia phase where clutch B is synchronized [8].

Note that 4–8-speed ATs are extensively used in production cars, a 2-speed AT is
just adopted here as an example to exploit the design process, and it can be applied
to other ATs if the parameters of the clutch-to-clutch shift process are replaced. We
start to describe the modeling of the inertia phase and then obtain a model for the
torque phase by taking into account the general fact that there is no gear ratio change
in the torque phase.

Inertia Phase

In the inertia phase, where the two clutches are both slipping, because the planetary
gear set is a two-degree-of-freedom system, two states variables, such as the turbine
speed ωt and the speed ωr of the ring gear, can be used to describe its movement.

2.3 Clutch Pressure Estimation Without Consideration of Drive Shaft Stiffness

43

The basic kinematic equation of the planetary gear set is

where γ is the ratio of the teeth number of the sun gear to that of the ring gear, ωr is
the ring gear speed, ω0 is the planetary gear carrier speed, i.e., the output speed
of the transmission, ωt is the sun gear speed, i.e., the turbine speed of the torque
converter.

The torque of the planetary gear set should also satisfy the torque balance equa-

tions:

ωr − ω0
ωt − ω0

= γ

TSG = γ
1 + γ
TRG = 1
1 + γ

T0,

T0,

where TSG is the sun gear torque, TRG is the ring gear torque, T0 is the planetary
gear carrier torque.

With the driving traction of torque T0, the vehicle body will move according to

the equation

Ive ˙ω0 = T0 − Tve.

where Ive is the equivalent inertia of the vehicle body, Tve is the equivalent driving
resistant torque.

From Fig. 2.1, the equations of the sun gear and the ring gear are given as

It ˙ωt = Tt − Tcb − TSG,
Ir ˙ωr = Tcb + Tca − TRG,

where It is the inertia moment of the torque converter turbine, Ir is the inertia mo-
ment of the ring gear and parts connected, Tca is the torque delivered by clutch A,
Tcb is the torque delivered by clutch B.

Substituting (2.6a), (2.6b) and (2.7) into (2.8a), (2.8b), we have

It ˙ωt + 1
Rg
Rg − 1
Rg

Ive ˙ω0 = Tt − Tcb − 1
Rg
Rg − 1
Rg

Ive ˙ω0 = Tcb + Tca −

Tve,

Tve

Ir ˙ωr +

with Rg = 1 + 1
γ .

Using (2.5) and rearranging the above equations, the dynamic equations of the

transmission can be obtained as follows:

˙ωt = C11Tt + C12Tca + C13Tcb + C14Tve,
˙ωr = C21Tt + C22Tca + C23Tcb + C24Tve,

(2.10a)

(2.10b)

(2.5)

(2.6a)

(2.6b)

(2.7)

(2.8a)

(2.8b)

(2.9a)

(2.9b)

44

2 Pressure Estimation of a Wet Clutch

with the coefﬁcients

C11 =

gIr + (Rg − 1)2Ive
R2
gIt Ir + (Rg − 1)2It Ive + Ir Ive
R2
(Rg − 1)Ive
gIr + (Rg − 1)2Ive
R2
(cid:4)
(Rg − 1)Ive
gIr + (Rg − 1)2Ive
R2

+ 1

,

,

(cid:5)

,

C12 = −C11

C13 = −C11

C14 = C11

C21 = −

,

−RgIr
gIr + (Rg − 1)2Ive
R2
(Rg − 1)Ive
gIt Ir + (Rg − 1)2It Ive + Ir Ive
R2

,

C22 = −C21

C23 = −C21

,

gIt + Ive
R2
(Rg − 1)Ive
(cid:4)
gIt + Ive
R2
(Rg − 1)Ive

(cid:5)

+ 1

,

C24 = C21

RgIt
Ive

.

The turbine torque Tt is calculated from the steady-state characteristics of the

torque converter as

where C(λ) denotes the capacity factor of the torque converter, t (λ) is the torque
ratio, ωe is the engine speed and λ is the speed ratio deﬁned as

Tt = t (λ)C(λ)ω2
e ,

λ = ωt
ωe

.

(2.11)

(2.12)

On the other hand, the transferred torque Tcb during clutch slipping is determined
by the cylinder pressure. If the force of the return spring is treated as constant, the
relationship between the clutch torque and the cylinder pressure is described as

Tcb = μ((cid:4)ω)RN · (Apcb − Fs),

(2.13)

where R is the effective radius of the push force acted on the plates of clutch B,
N and A are the plate number and the piston area of clutch B, pcb is the pressure of
cylinder B, Fs is the return spring force of clutch B and μ is the friction coefﬁcient
of clutch plates depending on the speed difference. The speed difference (cid:4)ω is
deﬁned as

(cid:4)ω = ωt − ωr .

(2.14)

2.3 Clutch Pressure Estimation Without Consideration of Drive Shaft Stiffness

45

The cylinder pressure is determined by the input current of the proportional pres-
sure control valve. The dynamics of the proportional valve can be simpliﬁed as a
ﬁrst-order system [16],

τcv ˙pcb = −pcb + Kcvib,

(2.15)

where τcv is the time constant of valve B, Kcv is the gain of valve B, and ib is the
electric current of valve B.

Moreover, if the torsion dynamics of the drive shaft, the tire slip and the road
grade are ignored, the resistant torque Tve, delivered from the tire to the drive shaft,
can be calculated as

Tve = Tw
Rdf

+ CAR3
R3
df

w

ω2
0,

(2.16)

where Tw denotes the rolling resistance moment of the tire, Rw is the tire radius,
Rdf is the gear ratio of the differential gear box, ω0 is the output speed of the
transmission and CA is a constant coefﬁcient depending on air density, aerodynamic
drag coefﬁcient and the front area of the vehicle.

By selecting the turbine speed ωt , the speed difference (cid:4)ω of clutch B, and the
pressure pcb of cylinder B as state variables, denoted as x1, x2, x3, respectively, and
ignoring the pressure of clutch A because it is small enough, the inertia phase of the
1st-to-2nd gear upshift process is described in the following state space form:

˙x1 = C13μ(x2)RNAx3 + f1(ωe, x1, x2),
˙x2 = (C13 − C23)μ(x2)RNAx3 + f2(ωe, x1, x2),
˙x3 = − 1
τcv

x3 + Kcv
τcv

u,

with

f1(ωe, x1, x2) = C11Tt (ωe, x1) + C14Tve(x1, x2)

− C13μ(x2)RNFs,

f2(ωe, x1, x2) = (C11 − C21)Tt (ωe, x1) + (C14 − C24)Tve(x1, x2)

− (C13 − C23)μ(x2)RNFs,

where u = ib is the current of valve B and viewed as control input. In order to
estimate the pressure of clutch B, the rotational speeds of the transmission are used
as the measured outputs, i.e.,

y = [x1

x2]T .

(2.19)

The parameter values can be found in Table 2.2.

(2.17a)

(2.17b)

(2.17c)

(2.18a)

(2.18b)

46

2 Pressure Estimation of a Wet Clutch

Table 2.2 Parameters for
observer design

C11

C13

C14

C21

C23

C24

R

N

A
τcv
Kcv
μmin
μmax
c11

c13

c14

Effective radius of plates of clutch B

Coefﬁcient in (2.17a)–(2.17c)

Coefﬁcient in (2.17a)–(2.17c)

Coefﬁcient in (2.17a)–(2.17c)

Coefﬁcient in (2.17a)–(2.17c)

Coefﬁcient in (2.17a)–(2.17c)

Coefﬁcient in (2.17a)–(2.17c)

Plate number of clutch B

Piston area of clutch B

Time constant of valve B

Gain of valve B

Minimum friction coefﬁcient

Maximum friction coefﬁcient

Coefﬁcient in (2.21a), (2.21b)

Coefﬁcient in (2.21a), (2.21b)

Coefﬁcient in (2.21a), (2.21b)

15.52
−25.85
−0.011
−10.33

17.38
−0.10

1
kg m2
1
kg m2
1
kg m2
1
kg m2
1
kg m2
1
kg m2

0.13 m

3
0.01 m2
0.04 s

1.0 MPa/A

0.10

0.16

0.40
−0.40
−0.16

1
kg m2
1
kg m2
1
kg m2

Torque Phase

In the 1st-to-2nd upshift torque phase, there is no slip in clutch A, hence, there is no
gear ratio change of the transmission. The motion of the drive line during this phase
can be described by the following equation:

˙ωt = c11Tt + c13Tcb + c14Tve,

(2.20)

with the constant coefﬁcients

c11 =

R2
g
gIt + Ive
R2

,

c13 = −c11,
c14 = − c11
Rg

,

where ωt is the turbine speed, Tcb is the torque delivered by clutch B, Tve is the
resistant torque delivered from the tire to the drive shaft, It is the inertia moment
of the torque converter turbine, Ive is the equivalent inertia moment of the vehicle
body and Rg = 1 + 1

γ again.

The torque phase of the 1st-to-2nd gear upshift process is then described in the

following state space form:

2.3 Clutch Pressure Estimation Without Consideration of Drive Shaft Stiffness

47

˙x1 = c13μ((cid:4)ω)RNAx3 + ft1(ωe, x1, (cid:4)ω),
˙x3 = − 1
τcv

x3 + Kcv
τcv

u,

with the measured output

and

y = x1

(2.21a)

(2.21b)

(2.22)

ft1(ωe, x1, (cid:4)ω) = c11Tt (ωe, x1) + c14Tve(x1, (cid:4)ω) − c13μ((cid:4)ω)RNFs.

(2.23)

Note that cij are different coefﬁcients from Cij in (2.18a), (2.18b). Moreover,
although there is no obvious change of the clutch speed during the torque phase, the
speed difference (cid:4)ω of the clutch is different for various driving maneuvers. Hence
(cid:4)ω is also considered as an input for the torque phase model.

Estimation Problem

Due to the extreme complexity of the torque converter and the aerodynamic drag,
the nonlinear functions in (2.18a), (2.18b) and (2.23) are generally given as lookup
tables (i.e., maps), which are obtained by a series of steady-state experiments and
inherently contain errors. Other modeling uncertainties include variations of param-
eters, such as the vehicle mass, the road grade and the damping coefﬁcient of shafts.
Hence, the problem considered here is to estimate the pressure of clutch B in
the presence of model errors, given the valve electric current ib and the measured
rotational speeds of the transmission ωe, ωt and (cid:4)ω.

2.3.2 Reduced-Order Nonlinear State Observer

Reduced-Order Nonlinear Observer with ISS Property

In this section, the special structure of the clutch pressure system is considered to
derive a reduced-order pressure observer. The robustness of the designed observer
with respect to model errors is achieved in the sense of ISS property. To do this,
we denote the variable to be estimated as z, and rewrite the system dynamics for
estimating the clutch pressure as follows:

˙y = F (y, u) + G(y, u)z + w(y, u, z),
˙z = A22(u, p)z + B2(u, p),

(2.24a)

(2.24b)

where y is the measured output, u is the control input and p is the vector of param-
eters which may include t and others, w(y, u, z) summarizes model uncertainties,

48

and in particular

2 Pressure Estimation of a Wet Clutch

F (y, u) =

f1(ωe, x1, x2)
f2(ωe, x1, x2)

(cid:3)

,

(cid:2)

(cid:2)

G(y, u) =

C13μ(x2)RNA
(C13 − C23)μ(x2)RNA

(cid:3)

,

,

A22(u, p) = − 1
τcv
B2(u, p) = Kcv
τcv

u

F (y, u) = ft1(ωe, x1, (cid:4)ω),
G(y, u) = c13μ((cid:4)ω)RNA,
A22(u, p) = − 1
τcv
B2(u, p) = Kcv
τcv

u.

,

(2.25a)

(2.25b)

(2.25c)

(2.25d)

(2.26a)

(2.26b)

(2.26c)

(2.26d)

for the inertia phase. The expressions for the torque phase are

Remark 2.1 We exploit the more general form of (2.24a), (2.24b) to derive the
pressure observer such that the suggested design method might be useful if the time-
varying property of the proportional pressure valves is taken into account (where
p = t), or if other kinds of valves are used to control clutch pressures. For example,
if a PWM valve is used, the pressure dynamics can be described by [22]

(cid:6)

˙z = Cz

0.01Plu − z,

(2.27)

where Cz is a positive constant, u is the pulse duty cycle, and Pl is the main line
pressure. Then, for all given u, we may linearize (2.27) at a ﬁxed operating point of
z = Ps to approximate the pressure dynamics in the form of (2.24b) with

A22(p) = −

√

Cz

0.01Plu − Ps

,

2
(cid:6)

B2(p) = Cz

0.01Plu − Ps +

√

CzPs

2

0.01Plu − Ps

.

In this case, p = [Ps Pl]T .

Because the shaft torque affects the related shaft accelerations directly, the differ-
ence between the true accelerations ˙y and the estimated values F (y, u) + G(y, u)ˆz
is used to constitute the correction term. Hence, let the observer be designed in the

2.3 Clutch Pressure Estimation Without Consideration of Drive Shaft Stiffness

49

form of

˙ˆz = A22(u, p)ˆz + B2(u, p) + L

(cid:7)
˙y − F (y, u) − G(y, u)ˆz

(cid:8)
,

(2.28)

where L ∈ R1×2 in the inertia phase (or L ∈ R1×1 in the torque phase) is the ob-
server gain to be determined.

By deﬁning the observer error as

the error dynamics can then be described by

e = z − ˆz,

˙e = A22(u, p)z + B2(u, p)

(cid:7)
A22(u, p)ˆz + B2(u, p) + L

−
(cid:7)
(cid:8)
e − Lw.
A22(u, p) − LG(y, u)

=

(cid:7)
˙y − F (y, u) − G(y, u)ˆz

(cid:8)(cid:8)

We deﬁne V = 1

2 eT e and differentiate it along the solution of (2.30) to infer

˙V = eT ˙e
(cid:7)
(cid:8)
A22(u, p) − LG(y, u)

= eT

e − eT Lw.

(2.32)

Applying Young’s Inequality [12] (see Lemma B.1 in Appendix B) to the last term
of the above equality leads to

−eT Lw ≤ κ1eT e + 1
4κ1

wT LT Lw

with κ1 > 0. Then, (2.32) becomes

˙V ≤ eT

(cid:7)
A22(u, p) − LG(y, u) + κ1

(cid:8)
e + 1
4κ1

wT LT Lw.

(2.34)

We now choose L to satisfy the following inequality

A22(u, p) − LG(y, u) + κ1 ≤ −κ2

with κ2 > 0, then we arrive at

˙V ≤ −κ2eT e + 1
4κ1

wT LT Lw,

which implies that the error dynamics admits the input-to-state stability property
if the model error w is supposed to be bounded in amplitude (see Lemma B.2 in
Appendix B).

Moreover, it follows from (2.36) that

˙V ≤ −2κ2V + 1
4κ1

wT LT Lw.

(2.29)

(2.30)

(2.31)

(2.33)

(2.35)

(2.36)

(2.37)

50

2 Pressure Estimation of a Wet Clutch

Upon multiplication of (2.37) by e2κ2t , it becomes

(cid:7)
V e2κ2t

(cid:8)

d
dt

≤ 1
4κ1

wT LT Lwe2κ2t .

(2.38)

Integrating it over [0, t] leads to

V (t) ≤ V (0)e−2κ2t + 1
4κ1

(cid:9)

t

0

e−2κ2(t−τ )w(τ )T LT Lw(τ ) dτ.

(2.39)

Hence, the properties of the error dynamics of the designed observer (2.28) are
described as follows:

Theorem 2.1 Suppose that
• κ1 > 0, κ2 > 0;
• The observer gain L is chosen to satisfy (2.35).

Then, the error dynamics of the observer (2.28) is

(a) Input-to-state stable, if w is bounded in amplitude, i.e., w ∈ L∞;
(b) Exponentially stable with κ2 for w = 0.

λmax(LT L)(cid:6)w(cid:6)2, which
Proof It follows from (2.36) that
shows that the error dynamics admits the input-to-state stability property [12, p. 503]
(see Lemma B.2 in Appendix B) if the model error w is supposed to be bounded in
amplitude, as property (a) required.

˙V ≤ −κ2(cid:6)e(cid:6)2 + 1
4κ1

By taking w = 0, we obtain from (2.39) that |e(t)| ≤ |e(0)|e−κ2t , ∀t ≥ 0 which
(cid:2)

proves property (b).

Remark 2.2 By the equivalences of the ISS property listed in Appendix B, prop-
erty (a) implies that the error dynamics of the designed observer (2.28) is ro-
bustly stable if w is viewed as the effect of model uncertainties. This is the case
in Sect. 2.3.3.

Remark 2.3 Now we give a discussion on the parameters κ1 and κ2. From prop-
erty (b), κ2 is chosen according to the required decay rate of the error. If w is
bounded in amplitude, i.e., w ∈ L∞, then (2.39) becomes

(cid:10)
(cid:10)
(cid:10)2 ≤ 1
(cid:10)e(t)
2

1
2

(cid:10)
(cid:10)
(cid:10)2e−2κ2t +
(cid:10)e(0)

(cid:6)w(cid:6)2

∞ sup
[0,t]

λmax(LT L)

(cid:9)

4κ1

e−2κ2(t−τ ) dτ,

(2.40)

t

0

which implies that

(cid:10)
(cid:10)
(cid:10)2 ≤
(cid:10)e(∞)

(cid:6)w(cid:6)2

∞ sup(λmax(LT L))

2κ1

(cid:9)

t

0

lim
t→∞

e−2κ2(t−τ ) dτ,

(2.41)

2.3 Clutch Pressure Estimation Without Consideration of Drive Shaft Stiffness

51

and furthermore,

(cid:10)
(cid:10)
(cid:10)2 ≤
(cid:10)e(∞)

(cid:6)w(cid:6)2

∞ sup(λmax(LT L))

.

4κ1κ2

(2.42)

Hence, one may choose a larger κ1 to reduce the offset. From (2.35), however, one
should also notice that the larger the κ1, the higher the observer gain.

Remark 2.4 Inequality (2.42) gives just an upper bound on the estimation error
offset if a bound on the model error is given. The real offset could be much smaller,
due to the multiple use of inequalities in the above derivation.

Remark 2.5 Besides satisfying (2.35), we do not impose other assumptions on the
observer gain L. This implies that L can be designed theoretically to depend on
(y, u), while one may choose it as time-invariant (constant) in practice. A solution
with time-invariant L will be discussed in the next section.

Implementation Issues

In order to avoid taking derivatives of the measured variables, let

then, we can infer for a time-invariant L that

η = ˆz − Ly,

(2.43)

= A22(u, p)ˆz + B2(u, p) + L

(cid:7)
˙y − F (y, u) − G(y, u)ˆz

(cid:8)

− L ˙y,

(2.44)

˙η = ˙ˆz − L ˙y

to arrive at

(cid:7)
(cid:8)
A22(u, p) − LG(y, u)

˙η =

(η + Ly) + B2(u, p) − LF (y, u).

(2.45)

Equations (2.43) and (2.45) constitute the reduced-order observer for the nonlinear
clutch slip control system. We notice that the nonlinearities of the powertrain sys-
tem appear in their original form in the observer. Therefore, the merits arise—the
characteristics of powertrain mechanical systems, such as the characteristics of the
engine and torque converter, are represented in the form of lookup tables which are
easy to process on a computer.

According to Theorem 2.1 and Remark 2.3, a systematic procedure is given to
design the reduced-order nonlinear clutch pressure observer in the form of (2.43)
and (2.45) as follows:

Step 1 Choose parameter κ2 according to the required decay rate of the estimation

Step 2 Choose parameter κ1, where it is suggested to start from some smaller values

error;

(according to Remark 2.3);

52

2 Pressure Estimation of a Wet Clutch

Step 3 Determine the observer gain L such that (2.35) is satisﬁed;
Step 4 For a given model error bound, use (2.42) to compute the estimated upper

bound of the offset and check if the offset bound is acceptable.

Step 5 If the offset bound is acceptable, end the design procedure. If not, go

to Step 2.

It is well known that getting model error bounds is in general very difﬁcult, if
not impossible. As mentioned in Remark 2.4, for a given model error bound, (2.42)
gives just an upper bound of the estimation error offset, which might be much larger
than the real offset. Hence, the stopping rule of iterating Step 1–Step 5 is somehow
a “rule of thumb”.

We now give a solution of (2.35) for choosing L to be time-invariant, where
the requirement for low observer gains can be considered through optimization. If
A22(u, p) and G(y, u) in (2.35) vary in a polytope with r vertices, i.e.,

(cid:7)

A22(u, p) G(y, u)
∈ Co

A22,1 G1

(cid:11)(cid:7)

(cid:8)

(cid:8)

(cid:7)

(cid:8)

(cid:7)

(cid:8)(cid:12)

,

A22,2 G2

, . . . ,

A22,r Gr

,

(2.46)

where Co{·} denotes the convex hull of the polytope, then, there exist

β1 ≥ 0, β2 ≥ 0, . . . , βr ≥ 0

r(cid:13)

i=1

βi = 1

(2.47)

(2.48)

satisfying

such that

(cid:7)

A22(u, p) G(y, u)

βi

A22,i Gi

.

(2.49)

r(cid:13)

(cid:7)

(cid:8)

=

i=1

(cid:8)

Hence, the result is given as follows.

Theorem 2.2 Suppose that A22(u, p) and G(y, u) vary in a polytope as (2.46).
Then, any time-invariant L satisfying the following Linear Matrix Inequalities
(LMIs)

A22,i − LGi + κ1 + κ2 ≤ 0,

i = 1, 2, . . . , r

(2.50)

meets the observer gain condition (2.35).

Proof Since A22(u, p) and G(y, u) vary in a polytope as (2.46),
have (2.49) with (2.47) and (2.48). By the convexity of

then, we

A22(u, p) − LG(y, u) + κ1 + κ2

2.3 Clutch Pressure Estimation Without Consideration of Drive Shaft Stiffness

53

Fig. 2.5 Friction
characteristics of clutch plates

in A22 and G, and by the use of Jensen’s inequality (see Appendix E), we infer

A22(u, p) − LG(y, u) + κ1 + κ2 ≤

βi(A22,i − LGi + κ1 + κ2).

(2.51)

r(cid:13)

i=1

Hence, βi ≥ 0 and the satisfaction of (2.50) guarantees

A22(u, p) − LG(y, u) + κ1 + κ2 ≤ 0,

as required.

(2.52)

(cid:2)

In (2.50), Gi and A22,i are known and bounded, κ1 and κ2 are selected to be
bounded and r = 2m (where m is the number of time-varying parameters in G(y, u)
and A22) is bounded, too. Hence, some constant L is always found to render make it
hold. Moreover, we prefer low observer gains, due to robustness against noises and
the reduction of the upper bound of the error offset, which is estimated by (2.42).
Hence, by the use of Schur complement (see Appendix E), L is obtained through
the following LMI optimization

α subject to LMIs (2.50) and

min
α,L

(cid:2)

(cid:3)

α L
LT
I

≥ 0.

(2.53)

Given κ1 and κ2, the solution of (2.53) gives then a constant observer gain with the
lowest possible gains satisfying condition (2.35).

Observer Design for Clutch Pressure

The inertia phase is taken as an example to show the detailed design procedure. The
parameters (τcv, Kcv) are regarded as constants for simplicity, which are listed in
Table 2.2 together with the other parameters. Nonlinear functions f1, f2 and μ are
given as lookup tables for the observer. The map of μ is shown in Fig. 2.5, while
f1, f2 are given by third-order maps and examples when ωe = 500 rad/s are shown
in Fig. 2.6. These parameters are derived from the nominal setting of an AMESim
simulation model of the AT shown in Fig. 2.1.

54

2 Pressure Estimation of a Wet Clutch

Fig. 2.6 MAPs of f1, f2 when ωe = 500 rad/s

Following the procedure given in Sect. 2.3.2, κ2 is chosen to meet the require-
ment for the desired decay rate of the estimation error. It is desired that the error
converges in 0.1 s. Then, taking the settling time as 4 times the time constant [15,
p. 221] leads to 4
κ2

= 0.1 and results in κ2 = 40.

Then, κ1 is chosen with the purpose of achieving a smaller offset of the estimation
error. Start with κ1 = 1 and obtain L = (−718 −1201) and e(∞) ≤ 0.175 MPa (see
the following for the detailed calculation). The offset bound is too large for real
applications. According to Step 2 of the procedure given in the above subsection,
we enlarge the value of κ1, and ﬁnally, the value being used is κ1 = 15.

We now solve the optimization problem (2.53) to obtain the lowest possible ob-
server gain. Since A22 = − 1
is considered as constant, the polytope in (2.46) is
τcv
given by G(y, u) = Co{G1, G2}, where the two vertices are computed by (2.25b)
with μmin ≤ μ(x2) ≤ μmax. The solution reads L = (−783 −1310).

In order to check if the estimation offset is acceptable, we now roughly compute
the bound of modeling errors. Since powertrain systems admit highly nonlinear,
complex dynamics and various uncertainties, it is indeed difﬁcult, if not impossible,
to obtain a comprehensive estimate of the modeling error bound. Hence, some major
uncertainties are taken as examples to estimate the value of w. The major uncertain-
ties here are calculation errors of F (y, u) in (2.24a), (2.24b), which contains the
turbine torque Tt and the vehicle driving load Tve. The change of the vehicle mass
affects also the coefﬁcients Cij in F (y, u). From numerous simulations of different
powertrain settings, a bound on w is determined as (cid:6)w(cid:6)∞ = 1600 rad/s2. Accord-
ing to (2.42), an upper bound of the offset is obtained for the designed observer.

2.3 Clutch Pressure Estimation Without Consideration of Drive Shaft Stiffness

55

The result is e(∞) ≤ 0.05 MPa, which is less that 10 % of the variation range of the
working pressure of the valve and is acceptable.

Similarly, following the procedure given in the above subsection, the observer

gain for the torque phase is calculated, and the result is L = −5.02 × 104.

2.3.3 Simulation Results

The proposed clutch pressure observer is programmed using MATLAB/Simulink
and combined with the above complete powertrain simulation model through co-
simulations. The two clutch valves are controlled by a pre-designed clutch slip con-
troller to ensure a rapid and smooth shift process.

In this study, the major concern is put on the power-on 1st-to-2nd gear upshift
process. Figure 2.7 gives the simulation results of the shift process with the driving
condition of Table 2.1, i.e., the condition for the observer design. During the shift
process, the engine throttle angle is adjusted to cooperate with the transmission shift.
In both torque and inertia phases, the pressure of cylinder B is estimated by the
designed observers. After the inertia phase (after 8.34 s), because the clutch B has
been locked up, the pressure is computed from the simpliﬁed control valve dynam-
ics (2.17c).

During the torque phase (between 7.7 and 7.94 s), the rotational speeds do not
change much, whereas during the inertia phase (between 7.94 and 8.34 s), the ro-
tational speeds change intensively because of the clutch slip. Hence, the estimation
performance in the inertia phase is much better, although it is also acceptable in the
torque phase. The estimation error is plotted in the bottom of Fig. 2.7 as the solid
line, where the result for L = 0 is also given for comparison. The error peak is re-
duced by about 35 % and the average error is reduced by about 31 %. Note that
the shift process operates in the nominal driving condition, but the stiffness of the
drive shaft and the tire slip are considered in the simulation model, while these are
ignored in the model for designing the observer. Moreover, the time-delay in con-
trol and time-varying parameters are also considered in the simulation model of the
proportional valve.

The proposed observer is now tested under the driving conditions which deviate
from the nominal setting, where the vehicle mass, road grade, torque characteristics
of the engine and the torque converter are varied. We increase or decrease each of the
items, and carry out simulations under different combination of these changes. The
results with relatively large errors are shown in Fig. 2.8, where the driving condition
setting is as follows: the torque characteristic of the engine is enlarged by 15 %, and
subsequently the capacity of the torque converter is also enlarged; the vehicle mass
is increased from 1500 to 1725 kg, and the road grade angle is varied from 0 to 5
degrees.

Due to the large model errors, the pressure estimation error becomes larger in
the torque phase. The reason is that there is no slip in clutch A during the torque

56

2 Pressure Estimation of a Wet Clutch

Fig. 2.7 Results of the
nominal driving condition

phase, and no large change of the transmission speeds for the large vehicle inertia.
Therefore, the torsion of the drive shaft and the tire slip play important roles in
the drive line. The omission of these terms in the observer design deteriorates the
estimation performance. In the inertia phase, because of the clutch slip, the designed
observer still works well and the pressure estimation error is acceptable.

2.3.4 Design of Full-Order Sliding Mode Observer

and Comparison

As a comparison, a full-order sliding mode observer is designed according
to [13, 22]. Taking the inertia phase as an example, we rewrite system equa-

2.3 Clutch Pressure Estimation Without Consideration of Drive Shaft Stiffness

57

Fig. 2.8 Results of different
driving condition

tions (2.24a), (2.24b) as

Following [13], the sliding mode observer can be designed in the following form:

˙y1 = C13μ(y2)RNAz + f1,
˙y2 = (C13 − C23)μ(y2)RNAz + f2,
˙z = − 1
τcv

z + Kcv
τcv

u.

˙ˆy1 = C13μ( ˆy2)RNAˆz + ˆf1 + κs1 sign( ˜y1),
˙ˆy2 = (C13 − C23)μ( ˆy2)RNAz + ˆf2 + κs2 sign( ˜y2),
˙ˆz = − 1
τcv

u + κs3 sign( ˜y1) + κs4 sign( ˜y2),

ˆz + Kcv
τcv

(2.54a)

(2.54b)

(2.54c)

(2.55a)

(2.55b)

(2.55c)

˜y1 = y1 − ˆy1,
˜y2 = y2 − ˆy2.

˜f1 = f1 − ˆf1,
˜f2 = f2 − ˆf2,
˜z = z − ˆz.

κs1 = 2000,
κs2 = 3200.

κs3 = −4.2 × 106,

κs4 = −7 × 106.

58

2 Pressure Estimation of a Wet Clutch

where κs1, κs2, κs3 and κs4 are observer gains, and

Gains κs1 and κs2 should satisfy the following sliding condition:

κs1 > (cid:6) ˜f1(cid:6) + (cid:6)C13μRNA˜z(cid:6) ≈ 1920,
(cid:10)
(cid:10)
(cid:10) ≈ 3180
(cid:10)(C13 − C23)μRNA˜z
κs2 > (cid:6) ˜f2(cid:6) +

(2.56a)

(2.56b)

with

Thus, κs1 and κs2 are selected as

According to the desired estimation offset and error decay rate, gains κs3 and κs4
can be calculated as

Similarly, the sliding mode observer for the torque phase can be designed in the

following form

˙ˆy1 = c13μ((cid:4)ω)RNAˆz1 + ˆft1 + κst1 sign( ˜y1),
˙ˆz1 = − 1
τcv

ˆz1 + Kcv
τcv

u + κst2sign( ˜y1),

and the gains are calculated as

κst1 = 100,

κst2 = −7.5 × 106.

The sampling frequency of the sliding mode observer is chosen to be 100 Hz, in
order to test the feasibility of the resulting observer for real applications [9]. In the
discrete implementation, the observer gains have to be reduced in order to restrain
oscillations resulting from sampling and two sets of the tuned values are given in

(2.57a)

(2.57b)

(2.58a)

(2.58b)

(2.59a)

(2.59b)

(2.60a)

(2.60b)

2.3 Clutch Pressure Estimation Without Consideration of Drive Shaft Stiffness

59

Table 2.3 Gains of discrete
observers

ISS

Torque phase
L = −1.8 × 104

Inertia phase
L = (−320 − 540)

Sliding 1
(large gains)

κst1 = 80
κst2 = −1.5 × 106

Sliding 2
(small gains)

κst1 = 80
κst2 = −3.5 × 105

κs1 = 1000
κs2 = 1600
κs3 = −8 × 105
κs4 = −1.2 × 106

κs1 = 1000
κs2 = 1600
κs3 = −4 × 105
κs4 = −7 × 105

Fig. 2.9 Comparison
between ISS observer and
sliding mode observer (torque
converter capacity is enlarged
by 15 %; m = 1725 kg;
θg = 5◦)

Table 2.3. Hence, the proposed ISS observer is also discretized by the same sampling
frequency and the tuned gains are also listed in Table 2.3.

The comparison results of these three observers are shown in Fig. 2.9, where the
driving condition is the same as that of Fig. 2.8. In Fig. 2.9, the solid line represents
the error of the reduced-order observer, while the dotted and dashed lines represent
the error of the full-order sliding mode observers with the large and small gains,
respectively. It is seen that the proposed reduced-order observer works well in the
inertia phase. The sliding mode observer with large gains (Sliding 1) tracks true
values without large errors but with chatters, while the other sliding mode observer
(Sliding 2) achieves few chatters at the cost of the large estimation errors. As for
robustness, the proposed observer achieves robustness in the sense of input-to-state
stability, where the model errors are represented as external inputs.

60

2 Pressure Estimation of a Wet Clutch

2.4 Clutch Pressure Estimation when Considering Drive Shaft

Stiffness

In the above, a reduced-order clutch pressure observer was proposed when consid-
ering the concept of input-to-state stability (ISS). However, it is pointed out that
during the torque phase, the estimation error becomes somehow unacceptable.

During the torque phase, the engine torque is transferred from the off-going
clutch to the on-coming clutch. If the clutch pressure can be estimated accurately,
the precise timing of releasing and applying clutches can be guaranteed to prevent
the clutches from tying-up and the traction interruption. Hence, in order to improve
the estimation precision of the clutch pressure during the shift torque phase, the
methodology proposed in the above section is extended to design an observer when
considering the driveline stiffness. Because the drive axle shafts are the main com-
ponents of the whole driveline, the rotational freedom of the drive shaft is introduced
into the model-based design. The newly designed observer can simultaneously es-
timate the drive shaft torque as well as improve the accuracy of the clutch pressure
estimation [6].

2.4.1 Clutch System Modeling when Considering the Drive Shaft

The power-on 1st-to-2nd upshift is still considered as the example, and the pressure
observer is designed to estimate the clutch pressure during the shift process. When
considering the drive shaft compliance, the system models can be constructed as
follows.

Torque Phase

In the 1st-to-2nd upshift torque phase, it is assumed that there is no slip in clutch A,
and the motion of the drive line during this phase is represented by the following
equations:

˙ωt = c11Tt + c13μ((cid:4)ω)RN(Apcb − Fs) + c14

Ts
idf

,

˙ωw = c34Ts + c35Tl,
˙Ts = Ks
idf i1
˙pcb = − 1
τcv

pcb + Kcv
τcv

ωt − Ksωw,

u,

(2.61a)

(2.61b)

(2.61c)

(2.61d)

where ωt is the turbine speed, ωw is the speed of the driving wheel (front wheel),
Ts is the drive shaft torque, pcb is pressure of cylinder B, Tt is the turbine torque,

2.4 Clutch Pressure Estimation when Considering Drive Shaft Stiffness

61

Table 2.4 Parameters for
observer design

c13

c14

c34

C13

C14

C23

C24

C34

γ

R

N

Coefﬁcient of clutch torque in (2.69c)

Coefﬁcient of clutch torque in (2.69c)

−11.90
−4.76

0.0074
Coefﬁcient of clutch torque in (2.69c)
Coefﬁcient of clutch torque in (2.70b) −24.51
Coefﬁcient of clutch torque in (2.70b) −0.98

29.41
Coefﬁcient of clutch torque in (2.70b)
Coefﬁcient of clutch torque in (2.70b) −8.82

Coefﬁcient of clutch torque in (2.70b)

0.0074

1
kg m2
1
kg m2
1
kg m2
1
kg m2
1
kg m2
1
kg m2
1
kg m2
1
kg m2

Gear ratio of sun gear to ring gear

Effective radius of plates of clutch B

Plate number of clutch B

Gear ratio of the differential box

Gain of valve B

Piston area of clutch B

Time constant of valve B

A
τcv
Kcv
μmin Minimum friction coefﬁcient
μmax Maximum friction coefﬁcient
idf
Ks
¯ωt
¯ωw
(cid:4) ¯ω
¯Ts
¯pcb

Stiffness of drive shaft
Normalization of ωt
Normalization of ωw
Normalization of (cid:4)ω
Normalization of Ts
Normalization of pcb

0.667

0.13 m

3
0.01 m2
0.04 s

1.0 MPa/A

0.10

0.16

3

100 rad/s

10 rad/s

100 rad/s

1000 Nm
105 Pa

13000 Nm/rad

Tl is the resistant torque delivered from the tires, Fs denotes the return spring force
of clutch B and μ is the friction coefﬁcient of clutch B depending on the speed
difference (cid:4)ω. The deﬁnition of the other parameters can be found in Table 2.4.

The turbine torque Tt and resistance torque Tl in (2.61a)–(2.61d) are calculated

as follows [7]:

Tt = t (λ)C(λ)ω2
e ,
wω2
Tl = Tw + CAR3
w,

(2.62a)

(2.62b)

where C(λ) denotes the capacity factor of the torque converter, t (λ) is the torque
ratio, ωe is the engine speed and λ is the speed ratio deﬁned as λ = ωt
, Tw denotes
ωe
the rolling resistance moment of tires, Rw is the tire radius, and CA is a constant
coefﬁcient depending on air density, aerodynamic drag coefﬁcient and the front area
of the vehicle.

62

Inertia Phase

2 Pressure Estimation of a Wet Clutch

In the inertia phase, the pressure of cylinder A is greatly reduced, and the pressure
of cylinder B increases so that the speed difference between ring gear and turbine
can be reduced to zero, i.e., we have the engagement of clutch B. The dynamic
motion of this phase can be described by the following equations if the drive axle
shaft compliance is considered:

˙ωt = C11Tt + C13μ((cid:4)ω)RN(Apcb − Fs) + C14

Ts
idf

,

(cid:4) ˙ω = (C11 − C21)Tt + (C13 − C23)μ((cid:4)ω)RN(Apcb − Fs) + (C14 − C24)

˙ωw = C34Ts + C35Tl,
(cid:2)
˙Ts = Ks
ωt − 1
1 + γ
idf
pcb + Kcv
˙pcb = − 1
τcv
τcv

u,

(cid:3)

(cid:4)ω

− Ksωw,

where (cid:4)ω is the slip speed of clutch B, i.e., the speed difference between the turbine
and the ring gear, Cij are constant coefﬁcients determined by inertia moments of
the vehicle and transmission shafts; note that Cij are different from cij of (2.61a)–
(2.61d).

The models in consideration of the drive shaft stiffness are constructed for the

observer design. State variables are selected as

x1 = ωt
¯ωt

,

x2 = (cid:4)ω
(cid:4) ¯ω

,

x3 = ωw
¯ωw

,

x4 = Ts
¯Ts

,

x5 = pcb
¯pcb

,

so that the variables are normalized to have the same level of magnitude. The drive-
line motion of the upshift torque phase is then expressed in the following state space
form:

x4 + c13μ( ¯ωt x1)RNA ¯pcb

x5 + 1
¯ωt

ft1(ωe, x1),

(2.64a)

(2.63a)

,

Ts
idf
(2.63b)

(2.63c)

(2.63d)

(2.63e)

(2.64b)

(2.64c)

(2.64d)

¯Ts
˙x1 = c14
¯ωt idf
¯Ts
˙x3 = c34
x4 + 1
¯ωw
¯ωw
˙x4 = Ks ¯ωt
x1 − Ks ¯ωw
¯Ts
¯Ts
idf i1
x5 + Kcv
˙x5 = − 1
τcv ¯pcb
τcv

u,

¯ωt

x3,

ft2(x3),

(2.65a)

(2.65b)

(2.66a)

(2.66c)

(2.66d)

(2.66e)

(2.67a)

(2.67b)

(2.67c)

2.4 Clutch Pressure Estimation when Considering Drive Shaft Stiffness

63

where u = ib is the control input and

ft1(ωe, x1) = c11Tt − c13μ((cid:4)ω)RN Fs,

ft2(x3) = c35Tl.

Similarly, the inertia phase can also be described in the following state space

x5 + 1
¯ωt

f1(ωe, x1),

x4 + C13 − C23μ(x2)RNA ¯pcb

(cid:4) ¯ω

x5 + 1
(cid:4) ¯ω

f2(ωe, x1), (2.66b)

form with state variables of x1 to x5:
x4 + C13μ(x2)RNA ¯pcb

¯ωt

¯Ts
˙x1 = C14
¯ωt idf
˙x2 = (C14 − C24) ¯Ts
(cid:4) ¯ωidf
¯Ts
˙x3 = C34
¯ωw
˙x4 = Ks ¯ωt
¯Ts
idf
˙x5 = − 1
τcv

x4 + 1
¯ωw

x1 −

x5 + Kcv
τcv ¯pcb

u,

f3(x3),

with the nonlinear functions

Ks(cid:4) ¯ω
idf (1 + γ ) ¯Ts

x2 − Ks ¯ωw
¯Ts

x3,

f1(ωe, x1) = C11Tt − C13μ((cid:4)ω)RNFs,
f2(ωe, x1) = (C11 − C21)Tt − (C13 − C23)μ((cid:4)ω)RNFs,

f3(x3) = C35Tl.

The problem considered here is to estimate the pressure of clutch B x4 (drive
shaft torque x5, too) both in the torque and inertia phases, in the presence of model
errors, given the measured rotational speeds of transmission x1, x2, x3, ωe and valve
electric current u.

2.4.2 Design of Reduced-Order Nonlinear State Observer

Reduced-Order Nonlinear Observer

Denote the variable to be estimated as z, and rewrite the dynamics of the system for
estimating the clutch pressure as follows:

˙y = F (y, u) + G(y, u)z + H w(y, u, z),
˙z = A21y + A22z + B2(u),

(2.68a)

(2.68b)

64

2 Pressure Estimation of a Wet Clutch

where y is the measured outputs, w(y, u, z) summarizes model uncertainties which
is normalized by H as (cid:6)w(cid:6)∞ ≈ 1, and in particular

y = [x1, x3]T ,

z = [x4, x5]T ,
(cid:15)

u = ib,

(2.69a)

for the torque phase.

(2.69e) are replaced by

For the inertia phase, y = [x1, x2, x3]T is the measurement. Hence, (2.69b)–

(cid:14)

⎛

⎝

(cid:14)

(cid:2)

(cid:2)

F (y, u) =

G(y, u) =

A21 =

A22 =

B2(u) =

,

1
¯ωt

ft1(ωe, y1)
1
ft2(y2)
¯ωw
¯Ts
c14
¯ωt Rdf
¯Ts
c34
¯ωw

c13μ(x2)RN A ¯pcb
¯ωt
0

⎞

⎠ ,

Ks ¯ωt
Rdf R1
0

¯Ts

− Ks ¯ωw
¯Ts
0

(cid:15)

,

(cid:3)

,

0
0
0 − 1
τcv
(cid:3)

0
Kcv
τcv ¯pcb

u.

F (y, u) =

G(y, u) =

⎞

⎟
⎠ ,

1
f1(ωe, y1)
¯ωt
1
(cid:4) ¯ω f2(ωe, y1)
f3(y3)

1
¯ωw

¯Ts
C14
¯ωt Rdf
(C14−C24) ¯Ts
(cid:4) ¯ωRdf
¯Ts
C34
¯ωw

C13μ(y2)RN A ¯pcb
¯ωt
C13−C23μ(y2)RN A ¯pcb
(cid:4) ¯ω
0

⎞

⎟
⎟
⎠ ,

Ks ¯ωt
¯Ts
Rdf
0

− Ks (cid:4) ¯ω

Rdf (1+γ ) ¯Ts
0

− Ks ¯ωw
¯Ts
0

(cid:15)

,

⎛

⎜
⎝

⎛

⎜
⎜
⎝

(cid:14)

(cid:2)

A21 =

A22 =

(cid:3)

.

0
0
0 − 1
τcv

(2.69b)

(2.69c)

(2.69d)

(2.69e)

(2.69f)

(2.70a)

(2.70b)

(2.70c)

(2.70d)

The observer is then designed in the form of

˙ˆz = A21y + A22 ˆz + B2(u) + L

(cid:7)
˙y − F (y, u) − G(y, u)ˆz

(cid:8)
,

(2.71)

where L ∈ R2×2 (L ∈ R2×3 for the inertia phase) is the constant observer gain to be
determined [4].

2.4 Clutch Pressure Estimation when Considering Drive Shaft Stiffness

65

In order to avoid taking derivatives of the measurements y, the following trans-

formation is made. Let

η = ˆz − Ly,

(2.72)

then, we can infer for a time-invariant L that

(cid:7)

(cid:8)
A22 − LG(y, u)

˙η =

(η + Ly) + A21y + B2(u) − LF (y, u).

(2.73)

Equations (2.72) and (2.73) constitute then the reduced-order observer of the
clutch pressure for the nonlinear driveline system. Obviously, the nonlinearities of
the powertrain system appear in the observer in their original form. Therefore, the
characteristics of powertrain mechanical systems, such as characteristics of the en-
gine and the aerodynamic drag, are represented in the form of lookup tables, which
is easily processed in computer control.

Then the error dynamics of the designed shaft torque observer is analyzed using
the concept of ISS (input-to-state stability) [11, 12, 18]. By deﬁning the observer
error as

e = z − ˆz,

the error dynamics can then be described by

(cid:7)
(cid:8)
e − LH w.
A22 − LG(y, u)

˙e =

We deﬁne V (e) = 1

2 eT e and differentiate it along the solution of (2.75) to obtain
˙V = eT

(cid:7)
(cid:8)
A22 − LG(y, u)

e − eT LH w,

(2.76)

and then

˙V ≤ eT

(cid:7)
A22 − LG(y, u) + κ1I

(cid:8)
e + 1
4κ1

wT H T LT LH w,

(2.77)

where κ1 > 0. We now choose L to satisfy the following matrix inequality:

with κ2 > 0, then we arrive at

A22 − LG(y, u) ≤ −(κ1 + κ2)I

˙V ≤ −κ2eT e + 1
4κ1

wT H T LT LH w,

which implies that the error dynamics admits the input-to-state stability property if
the model error w is supposed to be bounded in amplitude.

It follows from (2.79) that

(cid:10)
(cid:10)
(cid:10)2 ≤
(cid:10)e(t)

(cid:10)
(cid:10)
(cid:10)2e−2κ2t +
(cid:10)e(0)

(cid:6)w(cid:6)2

∞ sup
[0,t]

λmax(H T LT LH )

(cid:9)

2κ1

e−2κ2(t−τ ) dτ,

t

0

(2.80)

(2.74)

(2.75)

(2.78)

(2.79)

66

2 Pressure Estimation of a Wet Clutch

which implies that

(cid:10)
(cid:10)
(cid:10)2 →
(cid:10)e(t)

(cid:6)w(cid:6)2

∞ sup(λmax(H T LT LH ))

as t → ∞.

(2.81)

4κ1κ2

For a more detailed deduction, please refer to Sect. 2.3.

Gain Determination

Now we discuss how to choose parameters κ1, κ2, and ﬁnally, the observer gain L.

κ1 and κ2
It follows from (2.79) that κ2 can be chosen according to the required
decay rate of the error. If it is desired that the error converges in 0.05 s, then
4
2κ2

= 0.05, which results in κ2 = 40.
According to (2.81), one may choose a larger κ1 to reduce the offset. From (2.78),

however, one should notice that the larger the κ1, the higher the observer gain.

Optimization of L We now give a solution of (2.78) for constant L through solv-
ing a set of linear matrix inequalities (LMIs). If A22(u) and G(y, u) in (2.78) vary
in a polytope with r vertices, i.e.,

(cid:7)

(cid:8)

A22 G(y, u)
(cid:11)(cid:7)
∈ Co

(cid:8)

(cid:7)

(cid:8)

(cid:7)

(cid:8)(cid:12)

A22,1 G1

,

A22,2 G2

, . . . ,

A22,r Gr

,

(2.82)

where Co{·} denotes the convex hull of the polytope. Then, a constant observer gain
L satisfying the following Linear Matrix Inequalities (LMIs):

A22,i − LGi ≤ −(κ1 + κ2)I ,

i = 1, 2, . . . , r,

(2.83)

meets the observer gain condition (2.78).

Moreover, we prefer low observer gains, due to robustness against noises and
also the reduction of the estimation error offset estimated as (2.81). Hence, L can
be obtained through the following optimization:

trace(α)

subject to LMIs (2.83) and

min
α,L

(cid:2)

(cid:3)

α
H T LT

LH
I

≥ 0,

(2.84)

where α is a 2 × 2 positive diagonal matrix for both the torque and inertia phase.
Given κ1 and κ2, the solution of (2.84) gives then the lowest possible gains.

Solution and Evaluation To calculate the observer gain and the error offset, the
bound of the modeling error should be calculated ﬁrst. It is indeed difﬁcult, if not
impossible, to obtain a comprehensive estimate of the modeling error bound. Hence
some major uncertainties are taken into consideration to estimate the value of the
modeling errors. If the estimation error of the turbine torque Tt is bounded within

(2.85)

(2.86)

(2.87)

(2.88)

2.4 Clutch Pressure Estimation when Considering Drive Shaft Stiffness

67

15 %, the variation of vehicle mass is ±500 kg and the variation of road slope is
±5◦, the modeling error for the torque phase can be calculated as

with the normalization matrix

(cid:6)w(cid:6) =

(cid:2)

(cid:3)

1
1

(cid:2)

H =

2.38
0

0
0.13

(cid:3)

.

Given the above modeling error bound and the system parameters (shown in
Table 2.4), (2.84) and (2.81) can be used to calculate L and then check the error
offset under the calculated gain. The ﬁnal tuned results for the torque phase are
κ1 = 15 and

(cid:2)

L =

−2.08
−6.46 −152.48

30.49

(cid:3)

,

and the calculated error offset is e(∞) ≤ 0.51, which means that the error offset of
the clutch pressure pcb is not larger than 0.051 MPa, which is considered accept-
able [4].

Similarly, following the procedure given above, the observer gain for the inertia

phase can also be calculated, and the result reads

(cid:2)

L =

0.023
56.9
0.22
−1.74 −0.23 1.73

(cid:3)

.

2.4.3 Simulation Results

Besides the continuous simulation, discrete implementations are carried out as well
to get an in-vehicle assessment of the proposed observer. The sampling rate is cho-
sen to be 100 Hz in order to test the feasibility of implementing the resulting ob-
server for real applications [9]. The discrete characteristics and random noise of the
speed sensor are included as well.

The major concern is put on the power-on 1st-to-2nd gear upshift process. Fig-
ure 2.10 gives the simulation results of the shift process with the nominal driving
condition, i.e., the condition for the observer design. The continuous and discrete
results are listed simultaneously. During the shift process, the engine throttle an-
gle is adjusted to cooperate with the transmission shift. It can be seen that during
the torque phase (between 7.74 and 7.94 s) the rotational speeds of the shafts do
not change much, whereas during the inertia phase (between 7.94 and 8.24 s), the
rotational speeds change extensively because of the clutch slip.

In the torque and inertia phase, the pressure of cylinder B is estimated by the
designed observers. After the inertia phase, i.e., after 8.24 s, because of the engage-
ment of the clutch, the observer is not valid any more, and the pressure is estimated

68

2 Pressure Estimation of a Wet Clutch

Fig. 2.10 Simulation results of nominal condition (torque characteristics of engine and torque
converter: nominal, m = 1500 kg, θg = 0◦, Ks = 220 Nm/deg, It = 0.06 kg m2). (Left) Continuous
implementation; (Right) Discrete implementation

by the simpliﬁed control valve dynamics (2.61a)–(2.61d), i.e., the estimation with
observer gains being zero. In order to show the effectiveness of the newly designed
observers, the error of estimation with the observer gains being zero during all time
periods e2_L=0, and the error of the observer of [4] in which the drive shaft stiffness
is not considered during the design procedure e2_no_T s are given as well. It can be
seen that the result of the observer designed in this section, e2, has the best perfor-
mance. It is also shown that the estimated drive shaft torque ˆTs can track the true
values without large errors.

It should be noted that in the discrete implementation, the observer gains have to
be reduced in order to restrain oscillations resulting from sampling, and the tuned

2.4 Clutch Pressure Estimation when Considering Drive Shaft Stiffness

69

Fig. 2.11 Simulation results of different driving condition (torque characteristics of engine and
torque converter are enlarged by 15 %, m = 1725 kg, θg = 5◦, Ks = 242 Nm/deg, It = 0.09 kg m2).
(Left) Continuous implementation; (Right) Discrete implementation

values are given as

for the torque phase, and

(cid:2)

L =

(cid:3)

−2.0
15.0
−6.0 −20.0

(cid:2)

(cid:3)

L =

0.02
0.2
15
−1.7 −0.2 1.7

(2.89)

(2.90)

for the inertia phase.

Then the proposed observer is tested under driving conditions that deviate from
the nominal driving setting. The following items are changed, and the variation
bounds are also given as follows:

70

2 Pressure Estimation of a Wet Clutch

Fig. 2.12 Simulation results of different driving condition (torque characteristics of engine and
torque converter are reduced by 15 %, m = 1250 kg, θg = 0◦, Ks = 198 Nm/deg, It = 0.03 kg m2).
(Left) Continuous implementation; (Right) Discrete implementation

(a) Torque characteristics of engine and torque converter, ±15 %;
(b) Vehicle mass m, ±16 %;
(c) Road grade θg, 0–5◦;
(d) Drive shaft stiffness Ks , ±10 %;
(e) Turbine shaft inertia It , ±50 %.

The results with relatively large estimation errors are shown in Figs. 2.11
and 2.12. It should be noted that because the engine simulation model is based on
the torque and friction maps, only a relatively large (±15 %) variation of steady state
characteristics of the engine torque is represented. In other words, the steady map
of the engine torque is increased or decreased by 15 %, and it is assumed that the
bound covers the transient estimation error and the torque variation due to long-term

2.5 Notes and References

71

aging. Then the map of the capacity factor of the torque converter C(λ) (see (2.62a))
is adjusted accordingly, to make the turbine torque Tt increase or decrease by 15 %.
It can be seen from Fig. 2.11 that, due to large model errors, the pressure estima-
tion error using the observer of the last section, e2_no_T s , becomes larger than that
in Fig. 2.10, especially in the torque phase. The observer designed in this section,
however, can still work with acceptable performance, and the maximum estimation
error e2 is 0.05 MPa, which is about 10 % of the maximum working pressure of the
clutch. In the results of Fig. 2.12, although the proposed observer does not outper-
form the observer of the last section during the inertia phase, it does perform better
during the torque phase. At the end of the torque phase, the error of the proposed
observer e2 is less than 0.035 MPa while the error of the observer of the last section,
e2_no_T s , is 0.07 MPa. Reducing the estimation error at the end of the torque phase is
critical because it determines the smoothness of the torque transferring between the
two clutches if the estimated pressure is used for closed-loop control of the torque
phase.

2.5 Notes and References

In the discrete implementation, the observer gains have to be reduced in order to
restrain oscillations resulting from sampling. This is because the inter-sample be-
havior of the real system is not captured, which may be critical in a number of
applications.

The analysis incorporating full time information leads to challenging control
problems with a rich mathematical structure, and could be done in the framework of
the sampled-data system theory, which is out of the scope of this book. Please refer
to [1, 2, 5] for some theoretic discussions.

It is well known that the dynamic behavior of the engine and clutch greatly affect
the torque oscillation of the driveline, and even the steering system [5, 10]. Hence a
smooth and fast clutch-to-clutch shift is necessary. As aforementioned, the clutch-
to-clutch shift is usually divided into two phases, the torque phase and the inertia
phase, and during the torque phase, the precise timing of releasing and applying of
clutches is crucial for the prevention of clutch tie-up and traction interruption.

In the torque phase, the rotational speeds of clutch shafts do not change much.
In order to achieve a smooth torque transfer between the two clutches, the off-going
clutch is required to mimic the operation of a one-way clutch so that it can be disen-
gaged at the moment when the direction of transmitted torque switches over. In [3],
a clutch slip control scheme is suggested to accomplish the function of a one-way
clutch, i.e., the off-going clutch is controlled to track a small reference speed (such
as 5 rad/s). This control objective can effectively prevent clutch tie-up. However,
if the pressure of the off-going clutch is not manipulated well, the stick-slip phe-
nomenon [1] is apt to be caused and results in some powertrain vibration.

As mentioned above, a smooth torque transfer can be assured if the off-going
clutch is disengaged when the transmitted torque is reduced to zero. If the knowl-
edge of the transmitted torque of the clutch is available, the pressure of the off-going
clutch can be controlled using the torque information. Therefore, this text proposes
another control scheme which is based on a clutch pressure/torque observer. The
observer designed in Chap. 2 is used, and a closed loop control scheme is proposed
for the shift torque phase. The vehicle of interest is still the medium-size passenger
car of the last chapter.1

During a clutch-to-clutch shift process, if the torque transfer between the two
clutches is not well controlled, clutch tie-up or torque interruption may be caused.

Figure 3.1 gives the simulation results of a typical power-on upshift process.
During the torque phase, the pressure of the on-coming clutch is ramped up, and
the off-going clutch is controlled by three patterns in order to show the effects of
the disengagement timing of the off-going clutch. Pattern (b) gives the best result
because the off-going clutch is disengaged just when its transmitted torque is re-
duced to zero at 7.93 s. Pattern (a) releases the off-going clutch 0.1 s earlier than the
optimal release time, and pattern (c) gives a postponed disengagement timing. It is
shown that an earlier releasing will cause traction interruption, and the engine speed
and the turbine speed will ﬂare up. On the other hand, a postponed timing will lead
to clutch tie-up, and consequently, the shift shock will be enlarged and the friction
loss will be increased.

From the results of Fig. 3.1, one sees that the precise timing of releasing the
clutch is crucial for the shift quality during the shift torque phase. Therefore, a
strategy of clutch timing control is proposed, and the block diagram of the proposed
system is described in Fig. 3.2.

As shown in Fig. 3.2, during the torque phase, the pressure pcb of clutch B is
ramped up to undertake the traction torque Tt of the torque converter. At the same
time, the torque Ta delivered to clutch A reduces accordingly. The output torque
T0 of the transmission is determined by the turbine torque Tt and the torque Tb
of clutch B, and, in order to make the control strategy easy to be implemented, Tt
and Tb are controlled feed-forwardly. The pressure pcb of clutch B is ramped up
according to a pre-determined pattern, while the torque Ta delivered to clutch A is
estimated by the “Clutch Torque Observer”. For a given Ta, there exist threshold
values of the clamp force, pressure pca, and consequently, valve current ia, which
are just big enough to prevent clutch A from slipping. Thus the block of the “Off-
going Clutch Control” is designed to calculate these threshold values, and ﬁnally
gives the command of the valve current ia, which assures that clutch A does not
slip before Ta reaches zero, and after that, the clamp force of clutch A is totally
withdrawn to avoid tie-up with clutch B.

76

3 Torque Phase Control of the Clutch-to-Clutch Shift Process

3.3 Clutch Control Strategy

Using the estimation results of the pressure of clutch B ˆpcb and the drive shaft torque
ˆTs shown in Chap. 2, the transmitted torque of clutch A can be calculated according
to the following relationship of the planetary gear set:

Tt − Tb = γ
1 + γ

T0 = γ (Ta + Tb),

where Ta and Tb are the transmitted torque of clutch A and clutch B, respectively,
T0 is the transmission output torque, γ is the ratio of the teeth number of the sun
gear to that of the ring gear. The transformation of the above equation yields

Then the estimated torque of clutch A can be given as

Ta = T0 − Tt ,

Ta = 1
γ

Tt − γ + 1

Tb.

γ

ˆTa = 1
Rdf

ˆTs − ˆTt ,

or

or

ˆTa = 1
γ

ˆTt − γ + 1

γ
where ˆTt is the estimated turbine torque

μRN(A ˆpcb − Fs),

ˆTt = t (λ)C(λ)ω2
e .

In the results, Eq. (3.4) is used to estimate the torque of clutch A because of its

simpler form compared to Eq. (3.5).

During the torque phase, the valve current of the on-coming clutch (clutch B)
is controlled feed-forwardly to ramp up its pressure, while the off-going clutch
(clutch A) is controlled according to the estimated torque ˆTa. With the increase of
pressure of clutch B, the transmitted torque to clutch A decreases. It is desired that
the engagement force of clutch A is controlled to zero when its transmitted torque
decreases to zero.

When the clutch is sticking (locked up), the maximally transmittable torque is

limited by pca, i.e.,

Ta max = (Aapca − Fsa)μsRaNa,

(3.7)

where pca is the pressure of clutch A, Fsa is the return spring force, μs is the
static friction coefﬁcient, Aa, Ra, Na are the friction area, effective radius and plate
number, respectively.

(3.1)

(3.2)

(3.3)

(3.4)

(3.5)

(3.6)

3.4 Simulation Results

Together with the dynamics of valve A,

and using the static relationship of the current ia and the pressure pca, we can de-
termine the desired current ia as

˙pca = − 1
τcva

pca + Kcva
τcva

ia,

ia = κca

1
Kcva

1
Aa

(cid:2)

ˆTa
μsRaNa

(cid:3)

+ Fsa

,

where κca is a coefﬁcient larger than 1. If the value is small, unwanted clutch slip
may be caused before the transmitted torque reaches zero. On the other hand, if κca
is too large, the disengagement timing may be delayed. The tuned value is κca = 1.3.
It is clear that by such a clutch disengagement strategy, the off-going clutch will be
disengaged when the transmitted torque ˆTa approaches zero, and before that the
clutch is locked up.

77

(3.8)

(3.9)

3.4 Simulation Results

3.4.1 Powertrain Simulation Model

In this section, the proposed clutch control strategy (3.4) and (3.9) is evaluated
on a powertrain simulation model. The model is established by the commercial
simulation software AMESim, which supports the Simulink environment by the
S-Function. The constructed model can capture the important transient dynamics
during vehicle shift process, such as the drive shaft oscillation and tire slip. More-
over, time-delay and time-varying parameters of the proportional valves [8] are also
considered in the simulation model, which are neglected in the controller design.
The detailed description can be found in Chaps. 1 and 2.

3.4.2 Simulation Results

In order to get an in-vehicle assessment of the proposed clutch control system, the
designed observer is discretized by a sampling rate of 100 Hz [4] with zero-order
holder discretization.

Figure 3.3 shows the simulation results of a power-on 1st-to-2nd upshift. During
the torque phase, the pressure of clutch B is ramped up, and clutch A is controlled
by the proposed feedback control strategy. The driving conditions are the same as
the nominal driving conditions, i.e., the conditions for the controller design. The
observer gain used in Fig. 3.3 is

(cid:2)

L =

−2.0
15.0
−6.0 −20.0

(cid:3)

,

(3.10)

which is kept constant in all the simulations.

78

3 Torque Phase Control of the Clutch-to-Clutch Shift Process

Fig. 3.3 Simulation results
under nominal driving
conditions (torque
characteristics of engine and
torque converter are standard;
m = 1500 kg; θg = 0◦;
It = 0.06 kg m2)

Because there are inevitable errors associated with the estimated clutch torque, in
order to avoid clutch tie-up, after ˆTa reaches a small value (such as 50 Nm), clutch A
is controlled by the following on–off logic:

if ωa ≤ −5 rad/s,
if ωa > −5 rad/s,

then ia = 0.3 A;
then ia = 0,

(3.11a)

(3.11b)

where ωa is the speed difference of clutch A, i.e., the speed of the ring gear. ωa
becomes negative when clutch A is released earlier than it should be (see Fig. 3.1(a)
for reference). Note that because the transmitted torque is already reduced to a low
level, the switching control of the pressure valve will not bring about a large drive-
line oscillation. However, if the switching logic is triggered from the ﬁrst beginning
of the torque phase, it is demonstrated through simulations that the torque oscillation
will become unacceptable.

It is shown that clutch A is fully disengaged at 7.90 s when the estimated torque
of clutch A, ˆTa, approaches zero. We can see that the turbine speed does not ﬂare
up, and there is no clutch tie-up and torque interruption shown in the result of the
drive shaft torque.

3.4 Simulation Results

Fig. 3.4 Simulation results
under different driving
conditions (torque
characteristics of engine and
torque converter are
standard × 115 %;
m = 2000 kg; θg = 5◦;
It = 0.1 kg m2)

79

In order to examine the robustness of the proposed control strategy, the driv-
ing conditions and parameters are changed, and the results are shown in Figs. 3.4
and 3.5. The following items are changed:

• Torque characteristics of the engine and the torque converter;
• Vehicle mass;
• Road slope angle;
• Inertia moment of the torque converter turbine;

because they are highly correlated with the performance of the torque observer, but it
is difﬁcult to obtain the true values. We can see that, although the enlarged modeling
errors bring about a larger estimation error of ˆTa, the timing of release of clutch A
is not seriously affected (it is 7.95 s in Fig. 3.4 and 7.92 s in Fig. 3.5) and there is
no intensive ﬂuctuation of the drive shaft torque, which shows that the shift quality
is still good enough.

80

3 Torque Phase Control of the Clutch-to-Clutch Shift Process

Fig. 3.5 Simulation results
under different driving
conditions (torque
characteristics of engine and
torque converter are
standard × 85 %;
m = 1275 kg; θg = 5◦;
It = 0.04 kg m2)

3.5 Notes and References

In this chapter, a new observer-based clutch control strategy is proposed for the
torque phase of the clutch-to-clutch shift process.

The output torque T0 of the transmission is determined by the turbine torque Tt
and the torque Tb of clutch B, and in order to make the control strategy easy to
implement, Tt and Tb are controlled feed-forwardly.

Along with the increase of the pressure of the on-coming clutch, the off-going

clutch is fully disengaged when its transmitted torque approaches zero.

An AMESim powertrain simulation model is constructed to test the proposed
clutch control strategy. Simulation results show that, by using the estimated clutch
torque, the strategy can provide smooth torque transfer in the torque phase without
clutch tie-up or traction interruption.

It is also demonstrated that the control strategy is robust to the variations of driv-
ing conditions and parameters, such as a change of the engine characteristics, vehi-
cle mass, and the road grade, etc.

Although the control strategy was designed for a hydraulic Automatic Transmis-
sion, it is also applicable to the shift control of DCT (Dual Clutch Transmission)
due to its similar clutch-to-clutch shift process [3, 6, 7, 9].

As aforementioned, during the shift inertia phase [18], the applying (on-coming)
clutch slips, and the rotational speeds change intensively. The clutch slip control
during the inertia phase greatly affects the shift quality (smoothness and efﬁciency).
The clutch slip control of stepped ratio transmissions has been intensively dis-
cussed by many researchers [17]. Because the clutch engagement is expected to
satisfy different and sometimes conﬂicting objectives, e.g., minimizing clutch lock-
up time, minimizing the friction losses during the slipping phase, ensuring a smooth
acceleration of the vehicle, optimization based algorithms are a potential solution
for this problem. For example, Hybrid Model Predictive Control (HMPC) [3] and
Linear Quadratic Optimal Control (LQOC) [8, 9, 15, 16] are used to control the
engagement of a dry clutch. In [3], Model Predictive Control is used so that the
constraints on the control and state variables can be considered in an explicit and
optimal way. In [16], it is pointed out that, to overcome the problem of high on-
line computational demand, the time evolution computed off-line under different
driving conditions can be ﬁtted by polynomials for online application. Dynamic
programming-based optimal control [20] and Sequential Quadratic Programming
(SQP) [21] are also used for gear shift operations in automatic transmissions.

Different from optimal algorithms which use penalty functions to formulate mul-
tiple control objectives simultaneously, there is another kind of controller design
method for clutch slip control, in which the only control objective is to make clutch
speed track a pre-designed reference trajectory. Especially for gear shift operation
during driving, where the duration is much shorter than that of the start-up scenario,
the speed tracking control method is widely used [6, 11, 30, 36, 37]. Toward the
highly nonlinear powertrain dynamics, such as the characteristics of the engine and
torque converter, and the uncertainties, such as the parameter variation of hydraulic
systems and the perturbations of road resistance torque, sliding mode control [6, 36],
μ synthesis [30], and two-degree-of-freedom control [11, 30] are used to ensure
consistent control performance. Although during the shift operations, speed track-
ing control does not consider the multiple control objectives directly, the required

H. Chen, B. Gao, Nonlinear Estimation and Control of Automotive Drivetrains,
DOI 10.1007/978-3-642-41572-2_4,
© Science Press Beijing and Springer-Verlag Berlin Heidelberg 2014

83

84

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.1 Reference trajectory
of clutch speed difference

shift time and shift comfort can be reached by selecting proper reference trajectory;
the friction losses can also be reduced by suitable engine torque coordination during
the shift process [11].

This chapter will focus on the latter method, i.e., on carrying out speed tracking
control of the wet clutch of a stepped ratio automatic transmission during the shift
inertia phase. During the inertia phase, the pressure of clutch A (see Chaps. 2 and 3)
has already been reduced to a very low level, and the dynamics of the clutch system
can be described by the following equations:

(cid:4) ˙ω = (C13 − C23)μ((cid:4)ω)R · N · Apcb + f ((cid:4)ω, ωt , ωe),
˙pcb = − 1
τcv

pcb + Kcv
τcv

ib

(4.1a)

(4.1b)

with

f ((cid:4)ω, ωt , ωe) = (C11 − C21)Tt (ωt , ωe) + (C14 − C24)Tve((cid:4)ω, ωt )
− (C13 − C23)μ((cid:4)ω)R · N · Fs,

(4.2)

where (cid:4)ω is the speed difference of clutch B, i.e., the speed difference between
the sun gear and the ring gear; pcb is the pressure of cylinder B; ib is the current of
valve B; Tt is the turbine torque; Tve is the equivalent resistant torque delivered from
the tire to the drive shaft; Cij is the constant coefﬁcients determined by the inertia
moments of vehicle and transmission shafts; Fs denotes the return spring force of
clutch B.

In this study, the engine control, Tt , is regarded as a non-controlled input (it is
decided by an open-loop algorithm based on shift timing), and the electric current of
valve B, ib, is manipulated to make the speed difference of clutch B, (cid:4)ω, track a ref-
erence trajectory. The shift process should assure driving comfort and minimize the
dissipated friction energy. In general, if shift duration is limited to a suitably short
time, there will not be too much dissipated energy. As for the driving comfort, be-
cause the lock-up of the clutch tends to cause a sudden change of the transmission
output torque, the clutch engagement should satisfy the so-called no-lurch condi-
tion [3, 8, 20], i.e., the rotational acceleration of the clutch input shaft should be
equal to that of the output shaft at the synchronization point. Therefore, the desired
trajectory shown in Fig. 4.1 should satisfy the following requirements:
• tf − t0 does not exceed the required shift time;

4.2 Two-Degree-of-Freedom Linear Controller

85

• The change rate of the trajectory at tf is zero;
• Moreover, in order to avoid control saturation, the change rate of the clutch speed

at t0 should be a small value.

Three different control methodologies will be adopted, and the results are given
as well to show their different characteristics. The three methodologies used are the
two-degree-of-freedom linear control scheme, backstepping approach and nonlinear
feedback-feedforward control scheme, which will be respectively addressed below.1

4.2 Two-Degree-of-Freedom Linear Controller

The two-degree-of-freedom control scheme is suitable to many automotive con-
trol systems for it can show good tracking performance and robustness simultane-
ously [34]. This section, therefore, uses the two-degree-of-freedom controller design
method to carry out the clutch slip control of an Automatic Transmission with pro-
portional pressure control valves. The clutch cylinder pressure, which is necessary
for state feedback control is estimated by the reduced-order pressure observer of
Chap. 2. The feedback gain is calculated by robust pole assignment methods while
the feedforward compensator aims to improve the system response [11].

4.2.1 Controller Design

We rewrite the dynamics system for clutch slip control as follows:

˙x1 = (C13 − C23)μ(x1)RNAx2 + f (ωe, ωt , x1),
˙x2 = − 1
τcv

x2 + Kcv
τcv

u,

where x1 = (cid:4)ω, x2 = pcb, and

f (ωe, ωt , x1) = (C11 − C21)Tt (ωe, ωt ) + (C14 − C24)Tve(ωt , x1)

− (C13 − C23)μ(x1)RNFs.

The two-degree-of-freedom controller is a control system with a forward com-
pensator besides the feedback controller. Model matching controller is a type of
extensively used two-degree-of-freedom controller [29]. Its block diagram is shown
in Fig. 4.2.

According to the diagram, we have

(cid:7)
Y (s) = P (s)

P −1(s)M(s)R(s) + Kb(s)M(s)R(s) − Y (s)

(4.5)

(cid:8)
.

1This chapter uses the content of [14], with permission from IEEE.

(4.3a)

(4.3b)

(4.4)

86

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.2 Block diagram of a 2 DOF controller

If the to-be-controlled plant is modeled accurately enough, the transfer function
from input to output turns to be

Y (s)
R(s)

= M(s),

which means that the closed-loop system transfer function depends only on the dy-
namics of M(s). Therefore, the quality of the output response can be improved by
giving suitable M(s). While, on the other hand, the feedback controller Kb(s) can
be designed for stability and robustness.

Ignoring the nonlinearities of the friction coefﬁcient, and assuming it to be con-

stant μ0 = 0.13, the system equation can be rewritten in the matrix form

and the output equation is given by

˙x = Ax + Bu + Ed

y = Cx,

where

x = ((cid:4)ωpcb)T ,

y = (cid:4)ω,

(cid:2)

A =

E = (1
u = ib,

0 (C13 − C23)μ0RNA
− 1
0
τcv
C = (1
0),
d = f (ωe, ωt , x1).

0)T ,

(cid:3)

,

(cid:2)

B =

0

(cid:3)

T

,

Kcv
τcv

Based on the above linear state equations, the two-degree-of-freedom clutch slip
controller is designed. The block diagram is given in Fig. 4.3, where (cid:4)ω∗ is the
initial speed reference and (cid:4)ω∗(cid:13)

is the modiﬁed reference as

(cid:4)ω∗(cid:13)

(s) = (cid:4)ω∗(s)M(s).

The difference of (cid:4)ω and (cid:4)ω∗ depends on M(s), which can be seen from the
following results in Figs. 4.4 and 4.5.

(4.6)

(4.7)

(4.8)

(4.9a)

(4.9b)

(4.9c)

(4.9d)

(4.10)

4.2 Two-Degree-of-Freedom Linear Controller

87

Fig. 4.3 2 DOF clutch slip controller

Fig. 4.4 Simulation results
with p0 = 100 without engine
control

88

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.5 Simulation results
with p0 = 30 without engine
control

If no feedforward compensator is included, the gains F 1 and F 2 turn to be the
commonly used linear servo system for the output tracking control [29, p. 847].
The robust pole assignment method proposed by [24] is used here to calculate F 1
and F 2, which is also the algorithm of the command “place” in the control toolbox
of MATLAB.

After determining the feedback gains F 1 and F 2, the forward compensator can
be derived. First, the part circled by the dashed line is labeled as P (s). Being differ-
ent from the P (s) of Fig. 4.2, P (s) deﬁned here includes the state feedback besides
the plant to be controlled. This treatment allows for convenient design of the feed-
forward compensator, and the later simulation results show its validity. Thus, P (s)
can be calculated as

P (s) = C

(cid:7)
sI − A(cid:13)

(cid:8)−1B = Pn(s)
Pd (s)

(4.11)

4.2 Two-Degree-of-Freedom Linear Controller

89

with

A(cid:13) = A − BF 1,
where Pn(s) is a constant and Pd (s) is a second-order polynomial of the Laplace
variable s.

Because P −1(s)M(s) must be a proper transfer function, M(s) is set as a third-

(4.12)

order transfer function of the following form:

After getting P (s) and M(s), the feedforward compensator can be calculated as

M(s) =

p3
0
(s + p0)3

.

P −1(s)M(s) = Pd (s)M(s)

.

Pn(s)

(4.13)

(4.14)

4.2.2 Simulation Results

The AMESim model constructed in the previous two chapters (please, refer to
Sect. 2.2) is used to verify the designed controller. The 1st-to-2nd gear upshift is
simulated, and during the inertia phase, the designed controller works to make the
clutch slip speed track the desired trajectory shown in Fig. 4.1. The feedback gain
used here is

(cid:22)

F 1 =
−7.8 × 10
F 2 = [−0.081].

−3

1.9 × 10

−6

(cid:23)
,

(4.15a)

(4.15b)

Figure 4.4 shows the results with p0 = 100, and no engine control is involved,
i.e., the engine throttle is 90 % open, constantly during the gear shift. The gear shift
process consists of three parts: before 6.1 s, the 1st gear torque phase; after 6.5 s,
the 2nd gear torque phase, and between 6.1 and 6.5 s, the inertia phase. During the
torque phases, the rotational speeds of shafts do not change much, while during the
inertia phase, the rotational speeds change intensively because of the clutch slip.

The desired time of the inertia phase is set to be 0.4 s. The simulation results of
the speed difference are shown in Fig. 4.4(b), and (cid:4)ω∗ and (cid:4)ω∗(cid:13)
are also given. It
can be seen that the slip speed (cid:4)ω can track reference value (cid:4)ω∗(cid:13)
with little error
(refer to Fig. 4.1). The output torque of transmission T0 and the jerk of vehicle dav,
i.e., the rate of the change of vehicle longitudinal acceleration, are shown to examine
the shift shock. At the times the inertia phase begins and ends, there is an intensive
change of the output torque and it results in a large jerk of the vehicle. The jerk
during the 1st gear torque phase reached—60 m/s3, the reason can be considered to
be the large gear ratio difference between the 1st and 2nd gear.

Simulation results with p0 = 30 are given in Fig. 4.5. The response of the refer-
ence model M(s) is slow when p0 = 30. Hence, the desired time for (cid:4)ω∗ is set to

90

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.6 Simulation results
with p0 = 30 with engine
control

be of 0.2 s in order to ﬁnish the inertia phase in about 0.4 s. It can be seen that at
the times the inertia phase begins and ends, there is no sharp change in the electric
current of valve B, which results in a smoother output torque of the transmission and
thus lesser jerk of the vehicle. Especially before 6.6 s, the time clutch B is locked
up, the electric current of valve B decreases for a while, which makes the lock up of
the clutch smooth.

Finally, the integrated control of the engine and transmission is used extensively
on newly developed vehicles, for it can reduce clutch load, shorten shift time and
improve fuel economy. Figure 4.6 is the simulated gear shift with the engine con-
trol. Only the throttle angle is controlled to cooperate with the shift process of the
transmission. It can be seen that the speed difference can track reference value with
enough precision despite the ﬂuctuation of the engine throttle angle, which shows
the robustness of the designed controller. In addition, the output torque of the trans-

4.3 Nonlinear Feedback–Feedforward Controller

91

Table 4.1 Friction work of
clutch B, Wb, (in J)

Case in Fig. 4.4

Case in Fig. 4.5

Case in Fig. 4.6

27400

25400

17800

mission shows to have even less ﬂuctuation compared to Fig. 4.5, thus even lesser
jerk is obtained during the inertia phase.

Moreover, the friction work of clutch B during the gear shift is also calculated as

Wb =

Tcb(cid:4)ω dt

(cid:9)

tf

t0

(4.16)

for the simulation cases discussed above. The result is shown in Table 4.1. One can
see that the engine control greatly reduces the friction work of the clutch.

4.3 Nonlinear Feedback–Feedforward Controller

In recent years, differential ﬂatness [10] was widely used for trajectory planning
and tracking control [7, 23]. For a differentially ﬂat system, if the trajectory for
the ﬂat outputs is given, the desired states and inputs can be derived as functions
of the ﬂat outputs and their derivatives. The advantages of ﬂatness-based control
include at least computational efﬁciency and avoidance of control saturation [7, 23].
Moreover, the ﬂatness-based control can improve the performance of an existing
linear feedback control system by introducing a feedforward compensator, which is
suitable for a large amount of presently produced automotive systems.

This section will construct a nonlinear feedforward–feedback control where the
feedforward control is designed based on differential ﬂatness with the ﬂat output
being the clutch speed. In order to accommodate the model errors and the distur-
bances, a linear feedback controller is added. The feedback control is calculated
through Linear Matrix Inequalities (LMIs) and convex optimization such that the
control system is robust against the parameter uncertainties. The vehicle of inter-
est is still the mid-size passenger vehicle equipped with an automatic transmission
(AT).

The power-on 1st-to-2nd upshift and 2nd-to-1st downshift are considered here.
During the upshift, the gear shift process is divided into the torque phase where the
turbine torque is transferred from clutch A to clutch B and the inertia phase where
clutch B is synchronized [18]. In the case of the downshift, the shift process starts
from the inertia phase where clutch A is synchronized (realized through the disen-
gagement of clutch B), followed by the torque phase where the torque is transferred
from clutch B to clutch A. The downshift can be approximately regarded as a reverse
process of the upshift. The focus is put on the clutch slip control during shift inertia
phase. The reference trajectories of both maneuvers are shown in Fig. 4.7 [13].

92

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.7 Reference
trajectories of the clutch
speed in both upshift and
downshift

Table 4.2 Parameters for
controller design

C13

C23

R

N

A
τcv
Kcv
μmin
μmax

Coefﬁcient of clutch torque

Coefﬁcient of clutch torque

Effective radius of plates of clutch B

Plate number of clutch B

Piston area of clutch B

Time constant of valve B

Gain of valve B

Minimum friction coefﬁcient

Maximum friction coefﬁcient

−25.85

17.38

1
kg m2
1
kg m2

0.13 m

3
0.01 m2
0.04 s

1.0 MPa/A

0.10

0.16

4.3.1 Clutch Slip Controller

In this section we will derive a nonlinear controller for the problem stated in
Sect. 4.1. To do this, we rewrite the dynamics of the system (4.1a), (4.1b) for clutch
slip control as follows:

where x1 = (cid:4)ω; x2 = pcb2/1000 so that x1 and x2 are of the same order of magni-
tude. Moreover,

˙x1 = a1μ(x1)x2 + f2(ωe, ωt , ω0),
˙x2 = a2x2 + b22u,

a1 = (C13 − C23)RNA × 1000,
a2 = − 1
τcv

,

b22 =

Kcv
τcv × 1000

.

The electric current of valve B is chosen as system input, i.e.,

The parameter values are given in Table 4.2.

u = ib.

(4.17a)

(4.17b)

(4.18a)

(4.18b)

(4.18c)

(4.19)

4.3 Nonlinear Feedback–Feedforward Controller

93

Nonlinear Feedforward Controller

The control objective is to track a given smooth trajectory of x1, denoted as x1d . To
derive the feedforward control law,

y = x1

(4.20)

is chosen as the output. Differentiating (4.20) and inserting the state equa-
tions (4.17a), (4.17b) gives

˙y = a1μ(x1)x2 + f2(ωe, ωt , ω0),
¨y = a1 ˙μ(x1)x2 + a1μ(x1)(a2x2 + b22u) + ˙f2(ωe, ωt , ω0).

(4.21a)

(4.21b)

The relative degree of the system equals the system order, which implies that the
clutch system is ﬂat and y = x1 is a ﬂat output.

Hence, the state variables and the system input can be expressed by the following

functions of the system output y and a ﬁnite number of its time derivatives:

x1 = y,

x2 =

˙y − f2(ωe, ωt , ω0)
a1μ(y)
˙y−f2(y,ωe,ωt )
a1μ(y)

(

,

)(cid:13) − a2(
b22
Inserting the desired system output yd = x1d and its time derivatives yields the

˙y−f2(y,ωe,ωt )
a1μ(y)

(4.22c)

u =

)

.

nonlinear feedforward control

(4.22a)

(4.22b)

(4.23a)

(4.23b)

x2d =

˙yd − f2(ωe, ωt , ω0)
a1μ(yd )

,

uf =

˙x2d − a2x2d
b22

.

Since μ(yd ) and f2(ωe, ωt , ω0) are given as lookup tables, it is impossible to
obtain the explicit form of ˙x2d . Hence, we apply the input shaping technique [5],
which is occasionally named as Dynamic Surface Control (DSC) in the backstep-
ping literature [33]. The result of (4.23a) is labeled as ¯x2, and passed through a ﬁrst
order ﬁlter,

τ ˙x2d + x2d = ¯x2, x2d (0) = ¯x2(0),

(4.24)

which yields

¯x2 − x2d
τ
Together with ﬁlter (4.24), Eqs. (4.23a), (4.23b) constitute the proposed nonlin-

˙x2d =

(4.25)

.

ear feedforward control scheme for the clutch slip control problem.

94

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Linear Feedback Controller

Flatness-based control allows using simple linear feedback part in a two-degree-of-
freedom control structure. Here, a P controller is adopted and it is designed such
that the control system is robust against the parameter uncertainties.

Substituting the nonlinear feedforward control law (4.23a), (4.23b) into the state

equations (4.17a), (4.17b), and assuming that μ(x1) ≈ μ(x1d ), we have

˙e1 = a1μ(x1)e2,
˙e2 = a2e2 + b22(cid:4)u,

(4.26a)

(4.26b)

(4.27)

(4.28)

where e1 = x1 − x1d , e2 = x2 − x2d , and (cid:4)u is the linear feedback control law to be
determined.

By considering modeling errors, including the torque and pressure computation

error as additive input, we rewrite (4.26a), (4.26b) in state space form as

Matrix A =

(cid:7)

(cid:8)

0 a1μ(x1)
a2
0

˙e = A(x1)e + B(cid:4)u + w.

varies in a convex envelope of a set of LTI models

(A) = Co

(cid:11)
(cid:12)
(A1), (A2), . . . , (Ar )

.

In this study, r = 2, i.e., there are two vertices, and they are determined by μ = μmin
and μ = μmax.

The question of the simultaneous stabilization amounts to ﬁnding a state feed-
back law (cid:4)u = K pe with K p ∈ R1×2 such that the eigenvalues λ(Ai − BK p) be-
long to the left-half complex plane for both i = 1, 2. The problem has solutions if
and only if there exists a matrix Xi ∈ R2×2 such that the following matrix inequali-
ties are feasible [4]:

Xi > 0,
(Ai − BK p)T Xi + Xi(Ai − BK p) < 0.

(4.29a)

(4.29b)

Because this is not a system of linear matrix inequalities (LMIs) in the variables
Xi and K p, we assume that there exists a joint Lyapunov function X and introduce
new variables Y = X−1 and K y = K pY [4, p. 100]. Moreover, we prefer low gains
K p due to robustness against noises, hence we restrict Y to be larger than a certain
positive value and calculate a result as small as possible for K y . Moreover, for a
rapid enough response, we deﬁne A2i = Ai + p0I , where p0 = 40 for a settling
time of less than 0.1 s [29, p. 221], to make the eigenvalues λ(Ai − BK p) belong
to the left of s = −40 in the complex plane. Then (4.29a), (4.29b) reads

Y > βI ,

A2iY + Y AT
2i

− BK y − K T

y BT − 2p0Y < 0,

(4.30a)

(4.30b)

4.3 Nonlinear Feedback–Feedforward Controller

95

Fig. 4.8 Block diagram of the designed nonlinear feedforward–feedback control

with β being a small positive value. The result of K y is then obtained through the
following convex optimization

α subject to LMIs (4.30a), (4.30b) and

≥ 0.

(4.31)

min
α,K y ,Y

(cid:2)

(cid:3)

α K y
K T
I
y

Consequently, the gain of the feedback controller is obtained as

According to the parameter values shown in Table 4.2 and using β = 0.01, the

convex optimization problem (4.31) can be solved, and the ﬁnal result is

K p = K yY −1.

K p = (−0.0074, 0.0024),

(4.32)

(4.33)

which assures the stability of the controller under the variation of μ((cid:4)ω). The sta-
bility of the closed-loop system with the linear feedback can be analyzed in the
framework of input-to-state stability. Following [12], it can be easily shown that the
closed-loop system is input-to-state stable in the presence of bounded modeling and
estimation errors.

The ﬁnal control law is a combination of the feedforward and the feedback con-

trol

u = uf + (cid:4)u,

(4.34)

and the structure of the complete controller is shown in Fig. 4.8.

Note that the clutch slip controller is built assuming that the clutch pressure pcb
is available. On production vehicles, however, not all transmissions are equipped
with pressure sensors. Fortunately, a pressure observer can be constructed using the
measured speed information. Please refer to Chap. 2 for detailed discussions.

4.3.2 Simulation Results

The powertrain simulation model is established in the environment of the commer-
cial simulation software AMESim. The parameters used here represent a typical
front-wheel-drive mid-size passenger car equipped with a 2000 cc injection gaso-
line engine. Please refer to Sect. 2.2 for details.

96

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.9 Simulation results
under the driving conditions
used for controller design
(torque characteristics of the
engine and torque converter
are standard; m = 1500 kg;
θg = 0◦; It = 0.06 kg m2)

Gear Upshift

First, the major concern is put on the power-on 1st-to-2nd gear upshift process. Fig-
ure 4.9 gives the simulation results of the shift process under the driving conditions
used in controller design. During the torque phase (between 7.7 and 7.94 s), we as-
sume that the timing of releasing and applying the clutches has been well set, and
refer to Chap. 3 for this part of work. In the inertia phase (between 7.94 and 8.24 s),
clutch B is controlled by the designed controller. The parameters of the desired tra-

4.3 Nonlinear Feedback–Feedforward Controller

97

jectory are (cid:4)ω0 = 420 rad/s and (tf − t0) = 0.3 s (see the solid line of Fig. 4.7).
After the inertia phase (8.24 s), when the clutch speed difference is small enough,
the valve current is increased by a pre-determined pattern to make the clutch lock
up reliably.

The tracking error of the clutch slip speed during the inertia phase is plotted in
Fig. 4.9(b). The maximum error is 13 rad/s, which is small enough for the vehicle
clutch system. The transmission output torque Tout is given as well to examine the
shift shock. We can see that there is no sharp change of Tout, which implies a smooth
gear shift.

Then, in order to get an in-vehicle assessment of the proposed clutch slip control
system, the designed controller is discretized by a sampling rate of 100 Hz [19] with
zero-order hold discretization. The results are shown in Fig. 4.10. It should be noted
that in the discrete implementations, the gain of the controller K p has to be reduced
in order to restrain the chatters caused by the sample time of 10 ms, i.e.,

K p = (−0.0025, 0.0015).

(4.35)

It can be seen that the sampling rate causes some small-magnitude chattering of
the responses and a relatively large tracking error at the beginning of the inertia
phase. The tracking error, however, decays rapidly. Moreover, because the chattering
magnitude of the transmission output torque Tout is not large and the frequency is
high, it is reasonable to believe that it will not noticeably affect driving comfort.

Finally, the controller is tested under different driving conditions. The results are
shown in Fig. 4.11. We can see that, although there exist large modeling errors, the
maximum tracking error is still about 20 rad/s and there is no large shift shock.
The tracking error is no larger than that of Fig. 4.10 because the initial speed of the
clutch is much less than that of Fig. 4.10. The initial speeds are different because
in Fig. 4.11 the vehicle is fully loaded and is driving on a slope, which results in a
different shift point.

Gear Downshift

In contrast with the upshift process, the downshift starts with the inertia phase. The
results of the power-on 2nd-to-1st downshift are shown in Fig. 4.12, where the driv-
ing conditions are the same as those of Fig. 4.11.

During the inertia phase (from 9 to 9.3 s), the engine throttle follows the driver
command, which is ﬁxed at 90 % of the full throttle angle, and clutch B is controlled
to track the reference (see the dashed line of Fig. 4.7) trajectory by the proposed con-
troller. When clutch A is synchronized along with the disengagement of clutch B,
the inertia phase ﬁnishes and the torque phase (from 9.3 to 9.6 s) begins. During the
torque phase, it is assumed that the timing of releasing and applying the clutches
has been well set.

Although the tracking error reaches 37 rad/s, which is larger than that of the up-
shift maneuver (because of the steady, large throttle opening angle), the shift process
is ﬁnished in the required time, and there is no sharp oscillation of the output torque.
It is considered as acceptable for the maneuver of the power-on downshift.

98

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.10 Discrete
implementation under the
driving conditions used for
controller design (torque
characteristics of the engine
and torque converter are
standard; m = 1500 kg;
θg = 0◦; It = 0.06 kg m2)

4.4 Backstepping Controller

In the above two sections, the controllers were designed for the clutch slip control.
In this section, in order to improve the control performance, a backstepping non-
linear controller will be proposed, which is able to explicitly deal with the system
nonlinearities [14].

4.4 Backstepping Controller

Fig. 4.11 Discrete
implementation under
different driving conditions
(torque characteristics of the
engine and torque converter
are standard × 115 %;
m = 2000 kg; θg = 5◦;
It = 0.1 kg m2)

99

4.4.1 Nonlinear Controller with ISS Property

In this section, we will make use of the backstepping technique to derive a nonlinear
controller for the problem stated above. The robustness of the designed controller
with respect to model errors is achieved in the sense of ISS property. To do this, we

100

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.12 Discrete
implementation of power-on
downshift (torque
characteristics of the engine
and torque converter are
standard × 115 %;
m = 2000 kg; road
slope = 5◦; It = 0.1 kg m2)

rewrite the dynamical system (4.1a), (4.1b) for clutch slip control as follows:

˙x1 = a1μ(x1)x2 + f (x1, ωe, ωt ) + b11w1,
˙x2 = a2x2 + b22u + b21w2,

(4.36a)

(4.36b)

where x1 = (cid:4)ω, x2 = pcb/1000 so that x1 and x2 are of the same order of magni-
tude, w1 and w2 summarize model uncertainties and b11 and b21 are known scaling

101

(4.37a)

(4.37b)

(4.37c)

(4.38)

4.4 Backstepping Controller

factors, f (x1, ωe, ωt ) is given in (4.2). Moreover,

a1 = (C13 − C23)RNA × 1000,
a2 = − 1
τcv

,

b22 =

Kcv
τcv × 1000

.

The electric current of valve B is chosen as system input

u = ib.

The control objective is to track a given smooth trajectory of x1, denoted as x1d .
To do this, we deﬁne the tracking error as e1 = x1 − x1d . We ﬁrst consider x2 as a
virtual control input and determine a control law of x2d such that the tracking error
dynamics is input-to-state stable with respect to the disturbance w1. Since x2 (cid:14)= x2d
indeed, we deﬁne e2 = x2 − x2d and rewrite the ﬁrst equation of (4.36a), (4.36b) as
follows:

˙x1 = a1μ(x1)(e2 + x2d ) + f (x1, ωe, ωt ) + b11w1.

(4.39)

Letting V1 = 1

1 and differentiating it along (4.39), we infer

(cid:22)
a1μ(x1)(e2 + x2d ) + f + b11w1 − ˙x1d

(cid:23)
.

(4.40)

2 e2
˙V1 = e1 ˙e1 = e1

Using Young’s Inequality [25], the above equality becomes

(cid:22)

˙V1 ≤ e1

a1μ(x1)x2d + f − ˙x1d

+ |b11|κ1e2
1

+

(cid:23)

|b11|
4κ1

w2
1

+ |a1μ(x1)|κ2e2
1

+

|a1μ(x1)|
4κ2

e2
2

= e1

+

(cid:22)
a1μ(x1)x2d + f − ˙x1d + |b11|κ1e1 +
|b11|
4κ1

|a1μ(x1)|
4κ2

e2
2,

w2
1

+

(cid:24)
(cid:24)
(cid:24)κ2e1
(cid:24)a1μ(x1)

(cid:23)

where κ1 > 0 and κ2 > 0. Note that μ(x1) (cid:14)= 0 in our case and, if the clutch slip
controller is well designed, the sign of x1 does not change during one independent
shift inertia phase. Hence, we can choose

x2d =

−κ3e1 − f + ˙x1d − |b11|κ1e1 − |a1μ(x1)|κ2e1
a1μ(x1)

with κ3 > 0 to guarantee

˙V1 ≤ −κ3e2

1

+

|b11|
4κ1

w2
1

+

|a1μ(x1)|
4κ2

e2
2.

(4.41)

(4.42)

(4.43)

102

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Hence, we conclude that the control law (4.42) renders the subsystem (4.39) input-
to-state stable with respect to w1 and e2.

Since the second Eq. (4.36b) is of a linearly parametrized form, we can then use

˙e2 = a2e2 + b22v + b21w2

to design the control law, where v = u − ud with

ud =

˙x2d − a2x2d
b22

for b22 (cid:14)= 0. Because Kcv and τcv are simpliﬁed as positive constants for the con-
troller design (see Sect. 4.4.3), b22 (cid:14)= 0 is satisﬁed in our case.

Let V2 = 1

2 e2

2 and infer

˙V2 = e2 ˙e2 ≤ a2e2

+ b22e2v + |b21|κ4e2
2

2

+

= e2(a2e2 + b22v + |b21|κ4e2) +

|b21|
4κ4

w2
2

|b21|
4κ4

w2
2,

where κ4 > 0. If the control law is chosen as

v = − κ5 + a2 + |b21|κ4

e2

b22

u = ud − κ5 + a2 + |b21|κ4

e2,

b22

˙V2 ≤ −κ5e2

2

+

|b21|
4κ4

w2
2,

and hence

then (4.46) becomes

where κ5 > 0.

Finally, with the control law given by (4.42), (4.45) and (4.48), the total closed-

loop error system can be written as

˙e1 = −
˙e2 = −

(cid:24)
(cid:24)
(cid:7)
(cid:24)a1μ(x1)
(cid:24)κ2
κ3 + |b11|κ1 +
(cid:8)
(cid:7)
e2 + b21w2,
κ5 + |b21|κ4

(cid:8)
e1 + a1μ(x1)e2 + b11w1,

for which we deﬁne V = V1 + V2. Then, by exploiting (4.43) and (4.49), we have

˙V = ˙V1 + ˙V2 ≤ −κ3e2

+

1

(cid:2)

|a1μ(x1)|
4κ2

(cid:3)

− κ5

+

e2
2

|b11|
4κ1

w2
1

+

|b21|
4κ4

w2
2.

(4.51)

Hence, we conclude the following results for the property of the error dynamics of
the designed controller.

(4.44)

(4.45)

(4.46)

(4.47)

(4.48)

(4.49)

(4.50a)

(4.50b)

4.4 Backstepping Controller

Theorem 4.1 Suppose that

• κi > 0, i = 1, . . . , 5;
• |a1|μ(x1)
4κ2

− κ5 < 0.

103

(4.53)

(4.54)

Then, the tracking error dynamics of the system under controller (4.42), (4.45)
and (4.48) is input-to-state stable if w1 and w2 are bounded in amplitude, i.e.,
w1, w2 ∈ L∞.

Proof It follows from (4.51) that
(cid:25)
˙V ≤ − min
κ3, κ5 −

(cid:26)

|a1μ(x1)|
4κ2

(cid:6)e(cid:6)2
2

+ max

(cid:6)w(cid:6)2
2,

(4.52)

(cid:25)

(cid:26)

|b11|
4κ1

,

|b21|
4κ4

where e = [e1, e2]T and w = [w1, e2]T , which shows that the error dynamics admits
the input-to-state stability property [25, p. 503] if the model error w is supposed to
(cid:2)
be bounded in amplitude.

Remark 4.1 It follows from (4.49) that

Upon multiplication of (4.53) by e2κ5t , it becomes

˙V2 ≤ −2κ5V2 +

|b21|
4κ4

w2
2.

(cid:8)

(cid:7)
V2e2κ5t

≤

d
dt

|b21|
4κ4

w2

2e2κ5t .

Integrating it over [0, t] leads to

|b21|
4κ4

(cid:9)

t

0

|b21|
2κ4

(cid:9)

t

0

V2(t) ≤ V2(0)e−2κ5t +

e−2κ5(t−τ )w2(τ )2 dτ,

(4.55)

and hence

(cid:10)
(cid:10)
(cid:10)2 ≤
(cid:10)e2(t)

(cid:10)
(cid:10)
(cid:10)2e−2κ5t +
(cid:10)e2(0)

e−2κ5(t−τ )w2(τ )2 dτ.

(4.56)

If w2 is bounded in amplitude, i.e., w2 ∈ L∞, (4.55) becomes

(cid:10)
(cid:10)
(cid:10)2 ≤
(cid:10)e2(t)

(cid:10)
(cid:10)
(cid:10)2e−2κ5t +
(cid:10)e2(0)

|b21|(cid:6)w2(cid:6)2
∞
2κ4

(cid:9)

t

0

e−2κ5(t−τ ) dτ,

(4.57)

which implies that the tracking error e2 is bounded as

(cid:10)
(cid:10)e2(t)

(cid:10)
(cid:10)2 ≤

|b21|(cid:6)w2(cid:6)2
∞
4κ4κ5

as t → ∞.

(4.58)

104

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Applying a similar procedure for the tracking error e1, we have

(cid:10)
(cid:10)
(cid:10)2 ≤
(cid:10)e1(t)

|b11|
2κ1

(cid:9)

t

0

(cid:10)
(cid:10)
(cid:10)2e−2κ3t +
(cid:10)e1(0)
(cid:9)

+

|a1|
2κ2

t

0

e−2κ3(t−τ )w1(τ )2 dτ

e−2κ3(t−τ )e2(τ )2

(cid:24)
(cid:24)μ

(cid:7)
x1(τ )

(cid:8)(cid:24)
(cid:24) dτ

(4.59)

and

(cid:10)
(cid:10)2 ≤

(cid:10)
(cid:10)e1(t)

|b11|(cid:6)w1(cid:6)2
∞
4κ1κ3
since w1 is bounded in amplitude.

+

|a1μmax|(cid:6)e2(cid:6)2
∞
4κ2κ3

as t → ∞,

(4.60)

Therefore, it follows from (4.56) and (4.59) that κ3 and κ5 can be chosen accord-
ing to the required decay rate of the errors. And from (4.58) and (4.60), one may
choose larger κ1, κ2 and κ4 to reduce tracking offsets. However, one should notice
that the larger these tuning parameters, the higher the controller gain. That is, the
choice of κi, i = 1, 2, 4, requires the trade-off between the tracking offset and the
controller gain.

Remark 4.2 We stress that (4.58) and (4.60) give just upper bounds of the tracking
offsets, if the bound of the model error is given. The real offset could be much
smaller, due to the multiple use of inequalities in the above derivation. Moreover,
we note that (4.50b) is linear time-invariant. Hence, we can compute the tracking
offset for e2 by the use of the ﬁnal-value theorem [29]

e2(∞) = lim
s→0

s ·

b21
s + κ5 + |b21|κ4

w2(s),

which implies e2(∞) = 0 when w2 is an impulse signal and

e2(∞) =

b21
κ5 + |b21|κ4

¯w2

when w2 is a step signal, where ¯w2 is the step magnitude.

(4.61)

(4.62)

According to Theorem 4.1, Remarks 4.1 and 4.2, we now give the following pro-

cedure to design the clutch slip controller in the form of (4.42), (4.45) and (4.48):

Step 1: Choose tuning parameters κ3 > 0 and κ5 > 0 according to the required de-
cay rate of the tracking error for e1 (Eq. (4.56)) and e2 (Eq. (4.59)), respec-
tively;

Step 2: Assume w2 to be a step signal, determine κ4 > 0 according to (4.62) and

the required offset of e2;

Step 3: For given bounds of w1 and e2, choose κ1 > 0 and κ2 >

such that
the upper bound of the tracking offset e1(∞) computed by (4.60) is accept-
able.

|a1μ(x1)|
4κ5

4.4 Backstepping Controller

105

4.4.2 Implementation Issues

Stability Analysis Considering Pressure Observer

Until now, the clutch slip controller was built assuming that the clutch pressure
x2 was available. When the pressure observer is involved, the stability of the con-
troller should be guaranteed under the interaction between the observer and the con-
troller. With the estimated clutch pressure, denoted as ˆx2, the implemented control
law (4.48) is given by

uim = ud − κ5 + a2 + |b21|κ4

( ˆx2 − x2d ).

By deﬁning the estimated error by e3 = x2 − ˆx2, the above control law becomes

uim = ud − κ5 + a2 + |b21|κ4

(e2 − e3).

b22

b22

Consequently, the error dynamics (4.50a), (4.50b) should be rewritten as

˙e1 = −
˙e2 = −

(cid:7)
κ3 + |b11|κ1 + |a1|μ(x1)κ2
(cid:8)
(cid:7)
e2 +
κ5 + |b21|κ4

(cid:7)
κ5 + a2 + |b21|κ4

(cid:8)
e1 + a1μ(x1)e2 + b11w1,

(cid:8)
e3 + b21w2.

If we deﬁne w(cid:13)
2

= w2 + κ5+a2+|b21|κ4

b21
˙e2 = −

e3, we get
(cid:8)
e2 + b21w(cid:13)
2,

(cid:7)
κ5 + |b21|κ4

and the derivative of the Lyapunov function, i.e., Eq. (4.51), becomes
|b21|
|a1|μ(x1)
4κ4
4κ2

˙V = ˙V1 + ˙V2 ≤ −κ3e2

|b11|
4κ1

− κ5

w2
1

e2
2

+

+

+

(cid:3)

(cid:2)

1

w(cid:13)2
2 .

(4.67)

From Chap. 2, the pressure observer is designed as

η = ˆx2 − Lx1,
˙η =

(cid:7)
(cid:8)
(η + Lx1) + b22u − Lf,
a2 − La1μ(x1)

where L is the observer gain, and the estimation error is derived as
(cid:8)
(cid:7)
e3 + b21w2 − Lb11w1.
a2 − La1μ(x1)

˙e3 =

It is shown in Theorem 2.1 that e3 is bounded when w1 and w2 are bounded. Conse-
quently, w(cid:13)
2 is also bounded. Therefore, with (4.67) and (4.69), the whole system is
proved to be input-to-state stable according to Theorem B.1 in Appendix B, wherein
(cid:2)

(cid:3)

(4.63)

(4.64)

(4.65a)

(4.65b)

(4.66)

(4.68a)

(4.68b)

(4.69)

(4.70a)

(4.70b)

α(e) = −κ3e2
1

+

− κ5

e2
2,

|a1|μ(x1)
4κ2

|b21|
4κ4

w(cid:13)2
2 .

γ (w) =

|b11|
4κ1

w2
1

+

106

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Reference Trajectory

There are many methods to deﬁne the reference trajectory shown in Fig. 4.1, such
as transfer functions or polynomials. Here, the following 3rd-order polynomial

x1d (t) = 2(cid:4)ω0
(tf − t0)3

(t − t0)3 − 3(cid:4)ω0
(tf − t0)2

(t − t0)2 + (cid:4)ω0

(4.71)

is adopted to meet the requirements shown in Fig. 4.1, i.e., x1d (t0) = (cid:4)ω0,
x1d (tf − t0) = 0 and ˙x1d (t0) = ˙x1d (tf − t0) = 0. Please refer to Fig. 4.1 for the
deﬁnitions of (cid:4)ω0, t0 and tf . Then, ˙x1d can be calculated as

˙x1d (t) = 6(cid:4)ω0
(tf − t0)3

(t − t0)2 − 6(cid:4)ω0
(tf − t0)2

(t − t0).

(4.72)

Moreover, ˙x2d is needed for the implementation of (4.45). Since μ(x1) and
f (x1, ωe, ωt ) are given as maps, it is impossible to obtain the explicit form of ˙x2d
by differentiating (4.42). Hence, we apply the input shaping technique [5], which
is occasionally named as Dynamic Surface Control (DSC) in the backstepping lit-
erature [33]. The result of (4.42) is labeled as ¯x2, and passed through a ﬁrst order
ﬁlter,

τ2 ˙x2d + x2d = ¯x2,

x2d (0) = ¯x2(0),

which yields

(4.73)

(4.74)

˙x2d =

¯x2 − x2d
τ2

.

4.4.3 Controller of the Considered Clutch System

Together with (4.72) and (4.73), Eqs. (4.42), (4.45) and (4.48) constitute the pro-
posed clutch slip controller. Now we present the concrete controller with all physi-
cal and tuning parameters. It is for simplicity assumed that (τcv, Kcv) are constant,
and the scaling factors b11 and b21 are set to be 1.

Nonlinear functions f ((cid:4)ω, ωe, ωt ) and μ((cid:4)ω) are given as lookup tables in the
controller. The map of μ is shown in Fig. 4.13, while f is given by 3rd-order maps,
and examples when ωe = 200 rad/s and ωe = 500 rad/s are shown in Fig. 4.14.

Following the procedure given in Sect. 4.4.2, we ﬁrst choose κ3 and κ5 to meet
the requirement for the desired decay rate of the tracking errors e1 and e2, respec-
tively. It is desired that the error converges in 0.1 s, and we consider the settling time
4
as 4 time constants [29], which implies
κ3,5

= 0.1 and results in

κ3 = 40 and κ5 = 40.

(4.75)

4.4 Backstepping Controller

Fig. 4.13 Friction
characteristics of clutch plates

107

Fig. 4.14 Maps of f when
ωe = 300 and 500 rad/s

Then, we choose κ4 with the purpose of achieving a smaller offset of e2. When
considering the pressure observer (4.68a), (4.68b), Eq. (4.62) which is used to cal-
culate e2(∞) should be rewritten as

where ¯w(cid:13)
2 is the magnitude of w(cid:13)
e3 (see (4.66) for reference). It
is assumed here that the model error w(cid:13)
2 is mainly caused by the pressure estimation
error e3. According to Chap. 2, the maximum value of the pressure estimation error
is about 0.06 MPa. Therefore, following (4.76), we have

b21

2

e2(∞) =

¯w(cid:13)
2,

b21
κ5 + |b21|κ4
= w2 + κ5+a2+|b21|κ4

e2(∞) = 60(κ5 + a2 + κ4)

.

κ5 + |b21|κ4

(4.76)

(4.77)

108

Choosing

results in

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

κ4 = 10

(cid:10)
(cid:10)e2(∞)

(cid:10)
(cid:10) ≤ 30(×1000 Pa),

(4.78)

(4.79)

which is less than 0.06 MPa, and it is regarded as acceptable for the considered
uncertainty.

In order to choose the values of κ1 and κ2, we now roughly calculate the bound of
the modeling error w1. Since powertrain systems admit highly nonlinear, complex
dynamics and various uncertainties, it is indeed very difﬁcult, if not impossible,
to obtain a comprehensive estimate of the modeling error bound. Hence, we only
consider some major uncertainties as an example to estimate the value of w1. The
major uncertainties considered here are the estimation error of the turbine torque Tt ,
and the variations of the road grade θg and the vehicle mass m, which affect the
driving resistance Tve.

The estimation precision of turbine torque Tt relies on the torque converter mod-
eling [19, 32, 35]. Here the estimation error of the turbine torque is assumed to be
(cid:6) ˜Tt (cid:6)∞ = 20 Nm, which is about ±12 % of the maximum engine torque. Moreover,
it is assumed that the vehicle mass is increased from 1500 kg, the nominal value
used for controller design, to mfull = 2000 kg, the fully loaded mass, and the road
grade angle is increased from 0 to 5 degrees. Hence, (cid:6)w1(cid:6)∞ can be approximately
estimated as

(cid:6)w1(cid:6)∞ ≤ |C11 − C21|(cid:6) ˜Tt (cid:6)∞ + |C14 − C24|

mfullg sin(θg)Rw
Rdf

= 543,

(4.80)

where C11 − C21 = 25.85, C14 − C24 = 0.0911, and Rw is the tire radius.
Then, according to (4.60), the bound of e1(∞) can be estimated as

(cid:10)
(cid:10)e1(∞)

(cid:10)
(cid:10)2 ≤

|b11|(cid:6)w1(cid:6)2
∞
4κ1κ3

+

|a1μmax|(cid:6)e2(cid:6)2
∞
4κ2κ3

= 1816
κ1

+ 152
κ2

,

where we use the value of (cid:6)e2(∞)(cid:6) to replace (cid:6)e2(cid:6)∞, since by design the initial
error of e2 decays rapidly and exponentially.
On the other hand, κ2 should satisfy

− κ5 < 0, i.e.,

|a1|μ(x1)
4κ2

If the acceptable control offset is set to be

κ2 >

|a1μmax|
4κ5

= 0.17.

(cid:10)
(cid:10)e1(∞)

(cid:10)
(cid:10) ≤ 15 rad/s,

(4.81)

(4.82)

(4.83)

4.4 Backstepping Controller

which is precise enough for this application, κ1 and κ2 can be chosen as

κ1 = 20 and κ2 = 2,

and the resulting control offset satisﬁes
(cid:10)
(cid:10)
(cid:10) ≤ 12.9 rad/s.
(cid:10)e1(∞)

109

(4.84)

(4.85)

4.4.4 Simulation Results

Continuous Implementation

Figure 4.15 gives the simulation results of the shift process under the driving condi-
tions used for controller design. During the shift process, the engine throttle angle is
adjusted to cooperate with the transmission shift. Note that in the real world, when
the throttle is changed, the engine dynamics is much more complex. The complex
engine torque control loop is not included and it is assumed that the engine torque
is already well controlled to track the desired value. It can be seen that during the
torque phase (between 7.7 and 7.94 s) the rotational speeds of the shafts do not
change much, whereas during the inertia phase (between 7.94 and 8.34 s), the rota-
tional speeds change intensively because of the clutch slip.

During the torque phase, we assume that the timing of releasing and applying
the clutches has been well set, and this part of work is omitted here. In the inertia
phase, clutch B is controlled by the designed controller. The parameters of the de-
sired trajectory are (cid:4)ω0 = 420 rad/s and (tf − t0) = 0.4 s (see Fig. 4.1). After the
inertia phase, when the clutch speed difference is small enough, the valve current is
increased by a pre-determined pattern to make the clutch lock up reliably. In order
to examine the shift shock, the transmission output torque and vehicle acceleration
are given as well.

The tracking error of the clutch slip speed during the inertia phase is plotted in
Fig. 4.15(b), too. The maximum value of the error reads 7.5 rad/s, which is small
enough for the vehicle clutch system. It should be pointed out that the shift process
operates under the same driving conditions of controller design, but the stiffness of
the drive shaft and a tire model with longitudinal slip are considered in the simula-
tion model, while these are ignored in the model for designing the controller. More-
over, the time-delay in control and time-varying parameters are also considered in
the simulation model of the proportional valve.

Furthermore, the proposed controller is tested under different driving conditions.
The results are shown in Figs. 4.16 and 4.17, where the driving condition settings
are as follows:
• (Figure 4.16) The torque characteristic of the engine is enlarged by 15 %, and
consequently, the capacity of the torque converter is also enlarged; the vehicle
mass is increased from 1500 to 2000 kg, and the road grade angle is changed from
0 to 5 degrees; the inertia of the turbine shaft is changed from 0.06 to 0.1 kg m2;

110

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.15 Simulation results
under the driving conditions
used for controller design
(torque characteristics of
engine and torque converter
are standard; m = 1500 kg;
θg = 0◦; It = 0.06 kg m2)

4.4 Backstepping Controller

111

Fig. 4.16 Simulation results
under different driving
conditions (torque
characteristics of engine and
torque converter are
standard × 115 %;
m = 2000 kg; θg = 5◦;
It = 0.1 kg m2)

112

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.17 Simulation results
under different driving
conditions (torque
characteristics of engine and
torque converter are
standard × 85 %;
m = 1200 kg; θg = 5◦;
It = 0.03 kg m2)

4.4 Backstepping Controller

113

• (Figure 4.17) The torque characteristic of the engine is reduced by 15 %, and
consequently, the capacity of the torque converter is also reduced; the vehicle
mass is reduced from 1500 to 1200 kg, and the road grade angle is changed from
0 to 5 degrees; the inertia of the turbine shaft is changed from 0.06 to 0.03 kg m2.

Note that although the driving conditions are changed, because the shift maneuvers
are all power-on upshift when the engine load is 90 %, the engine throttle control
patterns of Figs. 4.16 and 4.17 are the same as that of Fig. 4.15. It also should
be noted that we focus here on the shift transient control and do not consider the
determination of the optimal shift point.

As a comparison, the results of the two-degree-of-freedom linear controller from
the last section are given as dashed lines of Figs. 4.16(b) and 4.17(b). In order to
give a somehow fair comparison, the solid lines in Figs. 4.16(b) and 4.17(b) show
the results of the proposed controller, where the same method as in Sect. 4.2 (a 3rd
ﬁlter) is adopted for the reference trajectory generation. Although there exist large
modeling errors, the maximum tracking error of the proposed controller is about
12 rad/s, which is still considered acceptable. Moreover, the comparison with the
linear controller veriﬁes the potential beneﬁts of the proposed nonlinear controller
in achieving smaller tracking errors.

Discrete Implementation

In order to get an in-vehicle assessment of the proposed clutch slip control system,
the designed controller is discretized by a sampling rate of 100 Hz [19] with zero-
order hold discretization. Furthermore, the discrete speed sensor models [27, 31]
are used to give the clutch speed ωc and the wheel speed ωw. The speed sensors are
assumed to have 48 teeth, and the time interval corresponding to 3 teeth is recorded
to calculate the speeds. A relative tolerance of teeth location of 0.169 % [27] and
a trigger (to convert the analog signal into the square-wave signal) randomness of
1.5 % are considered. Note that in the case of discrete implementation, which is a
sampled-data system, there are some relatively large chatters because of the system
discretization. The gains have to be adjusted to restrain the chatters, and the tuned
results are

κ1 = 12;
κ4 = 7;

κ2 = 1.2;
κ5 = 28.

κ3 = 24;

The time constant τ2 of ﬁlter (4.74) is chosen as

τ2 = 0.05 s.

(4.86)

(4.87)

The discrete implementation results are shown in Fig. 4.18, where the driving
conditions are the same as those of Fig. 4.16. The sampling rate causes some small-
magnitude chattering of the responses and a relatively large tracking error at the
beginning of the inertia phase. The tracking errors, however, decay to the bound of

114

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.18 Simulation results
of discrete implementation
(torque characteristics of the
engine and torque converter
are standard × 115 %;
m = 2000 kg; road slope is
5◦; It = 0.1 kg m2)

±12 rad/s rapidly. It can also be seen that the ﬂuctuation magnitude of the trans-
mission output torque is less than 50 Nm, which is considered acceptable for a fully
loaded mid-size car shifting on a slope.

4.5 Backstepping Controller for DCTs

115

Fig. 4.19 Schematic diagram
of a considered DCT

4.5 Backstepping Controller for DCTs

Both ATs (Automatic Transmissions) and DCTs (Dual Clutch Transmissions) adopt
the clutch-to-clutch shift technique. Originally marketed by Volkswagen as DSG
and by Audi as S-Tronic, the potential of DCT is tremendous because of its ability
to shift gears very quickly and to have the same driving characteristics of a manual
transmission with the convenience of an automatic [28]. For DCTs, the design dif-
ferences compared with ATs (such as the absence of one-way clutches and torque
converter) make achieving good shift quality in various operating conditions more
difﬁcult.

It has been shown in the last section that the methodology of backstepping is able
to provide good control performance for the shift inertia phase of ATs. In this sec-
tion, backstepping can be adopted to deal with the challenging control task during
the inertia phase of the DCT shift.

4.5.1 System Modeling and Problem Statement

Here a 6-speed wet DCT is considered, and the system diagram is shown in
Fig. 4.19. The two clutches, used as the actuators, are connected to two separate
sets of gears. The ﬁrst gear set is connected to clutch CL1 and the second gear set
to clutch CL2. The two clutches, which are controlled by two proportional pressure
valves, can operate independently.

The engine torque Te is modeled as a function of the engine speed ωe and throttle

angle θth in the form of a look-up table (map)

Te = Te(ωe, θth).

(4.88)

The two clutches are modeled as Coulomb friction elements which transfer
torque between the engine and the driving unit. If the return spring force is treated
as a constant, the torque Tc of the clutch transmitted in the slipping state depends
on the cylinder pressure pc and is described by the following equation:

Tc = μRN (Apc − Fs),

(4.89)

116

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

where μ is the friction coefﬁcient, N is the clutch disc number, A is the piston area
of the clutch, Fs is the return spring force of the clutch, R is the effective radius of
the friction disc.

The cylinder pressure is determined by the input current of the proportional pres-
sure control valve. For simplicity, the proportional pressure control valve is modeled
as a ﬁrst-order system

τcv ˙pc = −pc + Kcvi,

(4.90)

where τcv and Kcv are the time constant and the gain of the valve, and i is the
electric current of the valve.

Moreover, the vehicle road load is modeled taking the rolling resistance Fr and

aerodynamic resistance FA into account as
Fload = FA + Fr = 1
2

ρCDAAv2 + Fr ,

(4.91)

where CD is the aerodynamic drag coefﬁcient, AA is the front area of a vehicle, ρ
is the air density, v is the vehicle velocity, Fr is the rolling resistance considered as
a constant.

For instance, when the transmission is shifted from the 1st gear to the 2nd gear,
clutch CL1 is disengaged and CL2 is engaged, and before the clutch-to-clutch shift
motion is carried out, gear 2 has already been pre-engaged, which prevents traction
interruption. The following assumptions are made in the development of the inertia
phase model of the 1st-to-2nd gear shift:
• During the inertia phase, the pressure of clutch CL1 has already been reduced to

a very low level and so can be ignored;

• Gears have no backlash;
• Temperature effects of the powertrain are not taken into account.

Then the fundamental equations for the inertia phase of 1st-to-2nd gear shift can

be derived by using Newton’s second law as follows:

with

Ie ˙ωe = Te − Tc2,
It ˙ωc2 = Tc2 − bt ωc2 − Floadrw
Rt2Rdf

,

It = It2 +

bt = bt2 +

,

Idf + Iw + mr 2
w
R2
t2R2
df
bdf + bw
t2R2
R2
df

,

(4.92a)

(4.92b)

(4.93a)

(4.93b)

where Tc2 is the torque delivered at clutch CL2; ωc2 is the speed of clutch CL2;
It2, Idf , Iw are inertias of transmission, differential box and wheels, respectively;

4.5 Backstepping Controller for DCTs

117

Fig. 4.20 Reference
trajectory of the clutch speed
difference

m is the vehicle mass; rw is the wheel radius; Rt2 is the gear ratio of the 2nd gear;
Rdf is the gear ratio of the differential box; bt2, bdf , bw are the damping coefﬁcients
of transmission, differential box, and wheels, respectively.

When considering the clutch torque equation (4.89) and valve dynamic equa-

tion (4.90), the dynamics of the 1st-to-2nd upshift inertia phase is described as

(cid:2)

(cid:3)

(cid:4) ˙ω = −

1
+ 1
Ie
It
pc2 + Kcv
˙pc2 = − 1
τcv
τcv

ic2,

μRNApc2 + f (ωe, ωc2),

with

(cid:2)

(cid:3)

f (ωe, ωc) = Te
Ie

+

1
Ie

+ 1
It

μRNFs +

bt ωc2 + Floadrw
Rt2Rdf
It

,

where pc2 is the pressure of clutch CL2, ic2 is the valve current of clutch CL2, and

(cid:4)ω = ωe − ωc2.

Our goal is to design a controller to make the speed difference of clutch CL2
track a reference trajectory, where the current of valve CL2 is considered as control
input. As for the driving comfort, the clutch engagement should satisfy the no-lurch
condition, imposing a zero time derivative of the clutch sliding speed at synchro-
nization. Then a desired trajectory is programmed in Fig. 4.20, which has the same
pattern as in Fig. 4.1.

(4.94a)

(4.94b)

(4.95)

(4.96)

4.5.2 Controller Design

Choosing (cid:4)ω and pc2 as system states x1 and x2, respectively, and ic2 as control
input u, the state space equation can be given as

˙x1 = a1μ(x1)x2 + f (ωe, ωc2) + b11w1,
˙x2 = a2x2 + b22u + b21w2,

(4.97a)

(4.97b)

118

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.21 DCT simulation model

where b11 and b21 are known scaling factors, and
(cid:3)

(cid:2)

+ 1
It

RNA,

a1 = −

1
Ie
a2 = − 1
τcv
b22 = Kcv
τcv

.

,

It is clear that the dynamics equation (4.97a), (4.97b) has the same form

as (4.36a), (4.36b), the dynamics equation of AT.

Then the same manipulation used in Sect. 4.4 is applied, and the control law for

the considered DCT is obtained as follows:

x2d =

u =

−κ3e1 − f + ˙x1d − |a1μ(x1)|κ2e1
a1μ(x1)
− κ5 + a2 + |b21|κ4
b22

˙x2d − a2x2d
b22

,

e2,

with

e1 = x1 − x1d ,
e2 = x2 − x2d .

(4.98a)

(4.98b)

(4.98c)

(4.99a)

(4.99b)

(4.100a)

(4.100b)

4.5 Backstepping Controller for DCTs

119

Fig. 4.22 Simulation results of PID controller (vehicle mass is 1200 kg, road slope angle is 0◦)

It is shown using Theorem 4.1 of Sect. 4.4 that if κi, i = 1, . . . , 5 are chosen

suitably, the system dynamics will be input-to-state stable.

4.5.3 Simulation Results

The DCT simulation model is created in the environment of AMESim, which is
shown in Fig. 4.21. The model is used to verify the performance of the proposed
controller. It takes into account the important transient dynamics during the vehi-
cle shift process, such as dual-mass ﬂy-wheel, drive shaft oscillation and tire slip.
These dynamics are crucial for shift dynamic quality during the controller design;
however, they are not considered in controller design in order to obtain a practically
applicable controller. The designed controller is simulated by MATLAB/Simulink
and connected to the aforementioned AMESim simulation model through the cosim-
ulation technique.

120

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.23 Simulation results of a backstepping controller (vehicle mass is 1200 kg, road slope
angle is 0◦)

For comparison, the results of a well-tuned PID controller are given ﬁrst in
Fig. 4.22, wherein the driving conditions are as same as those used for the con-
troller design, i.e., the vehicle mass is 1200 kg and road slope angle is 0 degrees.
The graph depicts the variables including the currents proﬁles i at two clutches, the
rotational speed (cid:4)ω of clutch CL2, the tracking error e1 of clutch CL2, and the
throttle angle θth, transmission output torque Tout. In can be seen that during the
inertia phase, between 1.86 and 2.26 s, although there is no large ﬂuctuation in Tout,
the transmission output torque and the valve current ic2 vibrate frequently, which
results in some vibration of the tracking error e1.

Figure 4.23 gives the results of the designed backstepping controller. It can be
seen that the backstepping controller achieves much less vibration in valve cur-
rent ic2, tracking error e1, and output torque of the transmission Tout, when com-
pared with the PID controller (refer to Fig. 4.24 for a direct comparison). This jus-
tiﬁes the potential beneﬁt of the nonlinear design method of backstepping.

4.5 Backstepping Controller for DCTs

121

Fig. 4.24 Backstepping controller vs. PID controller

Fig. 4.25 Simulation results of a backstepping controller (vehicle mass is 1500 kg, road slope
angle is 5◦)

122

4

Inertia Phase Control of the Clutch-to-Clutch Shift Process

Fig. 4.26 Simulation results of a backstepping controller (vehicle mass is 1000 kg, road slope
angle is 5◦)

The designed clutch slip controller is then tested under driving conditions of full
load and empty load, and the results are given in Figs. 4.25 and 4.26, respectively.
It is shown that although there are large modeling errors, the output torque is still
smooth enough and the tracking error is less than 5 rad/s.

4.6 Notes and References

For ATs and DCTs, which use proportional pressure control valves to control the
clutches directly, three different control methodologies, including the linear 2 DOF
control, nonlinear feedforward–feedback control, and the backstepping technique,
are used for designing the inertia phase controller of the gear shift, wherein the
control objective is to make the clutch speed track a given reference trajectory.

In Chap. 3 and in this chapter, the torque phase and the inertia phase of clutch-to-
clutch shift are controlled. Actually, from the point of view of hybrid control theory,
the transition from the shift torque phase to the shift inertia phase is a state switching
along with the stick-slipping of the clutch, and hybrid control [1–3, 22, 26] is a
possible solution to deal with this problem under a uniform framework explicitly so
that extensive control system calibration could be avoided.

Until now, the estimation and control problems involved in ATs or DCTs were ad-
dressed. From now on, the estimation and control problems of AMT will be dis-
cussed, and at ﬁrst, in this chapter, the estimation of the axle drive shaft torque will
be analyzed because it is the basis for later chapters.

5.1 Introduction

Mechanical resonance of vehicle drivelines may occur due to the elasticity of the
driveline parts, such as clutch spring, propeller shaft and drive axle shaft. Driveline
oscillations are a kind of disturbance to the driver. They also lead to overlarge me-
chanical stress and affect the dynamic performance of the drivelines [6, 24]. The
question of how to avoid or reduce the oscillations of the driveline is an impor-
tant issue, especially for heavy duty vehicles which have relatively large driveline
torsion.

There is some literature on active damping of vehicle drivelines published in re-
cent years [3, 13]. The engine torque is controlled actively to damp the driveline
oscillations during transient maneuvers, such as when pressing and releasing the ac-
celerator pedal. Because the drive axle shaft is the main component of the driveline,
driving performance can be improved by controlling the axle shaft torsion. In order
to design the longitudinal speed controller handling the drive shaft torsion, it is often
necessary to know the angle/torque of the axle shaft [1, 22, 30].

It is also well known that the gear shift quality can be improved if an accurate
measurement of the axle shaft torque is available [17, 23, 29]. One example is the
shift process of Automated Manual Transmissions (AMTs) [16], which are widely
adopted to offer easy drive and fuel efﬁciency for trucks. At the beginning of the
gear shift of AMTs, the torque transmitted by the transmission is decreased and
then cut off by active engine control and clutch disengagement. If the timing of the
clutch disengagement is not well controlled, the potential energy of the driveline will
lead to unwanted driveline and vehicle oscillations [7, 23]. Knowing the axle shaft

H. Chen, B. Gao, Nonlinear Estimation and Control of Automotive Drivetrains,
DOI 10.1007/978-3-642-41572-2_5,
© Science Press Beijing and Springer-Verlag Berlin Heidelberg 2014

125

126

5 Torque Estimation of the Vehicle Drive Shaft

torque helps to determine the most optimal time point to disengage the clutch (or
directly engage the neutral gear). On the other hand, at the end of the shift process,
when the clutch is engaged and the engine torque level is recovered, closed-loop
shift control algorithms could greatly beneﬁt if the measurement of the axle shaft
torque is available.

Although the knowledge of the axle shaft torque is necessary for improving the
longitudinal speed control performance of vehicles, shaft torque sensors [27] or high
precision encoders [18] (the drive shaft torque could be calculated if the twist angle
measurement is available) are seldom used in production vehicles because of the
cost and durability. Hence, it is required to estimate the axle shaft torque. Luen-
berger observer [1, 31] and Kalman Filter [23, 24] have been used to estimate the
drive axle shaft torque. Although automotive powertrains contain complex nonlin-
earities, these observers are designed based on the linearized models. The sliding
mode observer [19] has also been designed to estimate the axle shaft torque in [17].
A sliding mode observer offers a way to ensure robustness to modeling errors and
parameter uncertainties if the uncertainties are limited in their assumed bounds [17].
Kalman ﬁltering [15] and recursive least squares method with multiple forgetting
factors [28] are used for simultaneous estimation of the road grade and the vehicle
mass, which helps to improve the estimation accuracy of the driving load.

In Chap. 2, a nonlinear clutch pressure observer is proposed for automatic trans-
missions, where robustness is guaranteed in the sense of input-to-state stability
(ISS). The order of the designed observer is reduced to one, nevertheless com-
plex nonlinear characteristics of powertrain systems are included and appear in their
usual form of maps. A comparison with the existing sliding mode observer veriﬁes
the potential beneﬁts of the proposed observer in eliminating chatters and in achiev-
ing satisfactory estimation performance.

In this chapter, therefore, the methodology of Chap. 2 is extended, and an axle
shaft torque observer is discussed for trucks with a stepped ratio transmission. The
observer is designed for all gear positions and the error dynamics is input-to-state
stable, where modeling errors and external disturbances are considered as input.
Compared with passenger cars, the truck mass varies greatly, hence a small road
grade seriously increases the load. These properties are taken into account by the
proposed observer, and the observer gains obtained by convex optimization are ro-
bust against large variations of driving conditions.1

5.2 Driveline Modeling and Problem Statement

5.2.1 Driveline Modeling

We consider the powertrain in a medium-duty truck with an AMT, which contains
a dry clutch and a 6-speed manual transmission. The powertrain is schematically
shown in Fig. 5.1.

1This chapter uses the content of [9], with permission from Elsevier.

5.2 Driveline Modeling and Problem Statement

127

Fig. 5.1 Schematic graph of a medium-duty truck

Fig. 5.2 Simpliﬁed driveline
model

When the vehicle runs in a certain gear position (no clutch operation), the driv-
eline is simpliﬁed as a spring–mass system shown in Fig. 5.2. The motion of the
driveline is described by the following equations:

˙ωc = 1
Ii
˙ωw = 1
Iv

˙Ts = Ks

(cid:2)

Te − 1

RiRdf

(cid:3)

Ts

,

(Ts − Tv),
(cid:2)

1
RiRdf

(cid:3)

ωc − ωw

,

(5.1a)

(5.1b)

(5.1c)

where ωc is the output speed of the clutch; ωw is the wheel speed; Ts is the axle shaft
torque; Ii denotes the equivalent inertia moment from the engine to the axle shaft
at the ith gear position, i = 1, 2, . . . , 6; Iv is the equivalent inertia of the vehicle;
Te is the engine torque, and Tv is the driving resistance torque. Ri denotes the gear
ratio of the ith gear position, and Rdf is the ratio of the differential gear box; Ks is

128

5 Torque Estimation of the Vehicle Drive Shaft

the stiffness of the axle shaft. The nominal value of the damping coefﬁcient is set
to zero in these dynamical equations, because the damping torque changes greatly
along with temperature variation and it is indeed very difﬁcult to determine a con-
stant damping coefﬁcient. It should be noted that if a nominal value of the damping
coefﬁcient is valid, the design method shown in the following is still applicable for
deriving the observer.

The engine torque Te is described by the torque map. The inputs of the map
are the engine rotational speed ωe and engine “throttle angle” θth. Because diesel
engines do not have a butterﬂy valve throttle, here θth represents the load requested
by the engine control unit. When the vehicle is driven in a certain gear position and
there is no clutch slip, we have

If the tire slip and road grade are ignored, the resistance torque from the tire to

the drive axle shaft is calculated as

Te = Te(ωe, θth) ≈ Te(ωc, θth).

Tv = Tw + CAR3

wω2
w,

where Tw denotes the rolling resistant moment of tires; Rw is the tire radius; CA is a
constant coefﬁcient depending on air density, aerodynamic drag coefﬁcient and the
front area of the vehicle.

5.2.2 Estimation Problem Statement

The state variables are selected as x1 = ωc, x2 = ωwRiRdf and x3 = Ts
, so that x1
¯Ts
and x2 are of the same order of magnitude, and x3, the variable to be estimated,
is normalized into a level of ±1 through ¯Ts , the nominal value of the drive shaft
torque Ts . Note that Ts may take negative values because of shaft vibration or engine
braking.

The driveline motion is then expressed in the following state space form:

˙x1 =

x3 + f1(x1, u),

− ¯Ts
IiRiRdf
¯Ts

˙x2 =

RiRdf
Iv
˙x3 = Ks
RiRdf

x3 + RiRdf f2(x2),

(x1 − x2),

f1(x1, u) = 1
Ii

Te(x1, u),

¯Ts
where u = θth is the throttle angle and

(5.2)

(5.3)

(5.4a)

(5.4b)

(5.4c)

(5.5a)

5.3 Reduced-Order Nonlinear Shaft Torque Observer

f2(x2) =

Tv(x2).

−1
Iv

y = [x1

x2]T .

In order to estimate the drive shaft torque x3, the rotational speeds x1, x2 are used

as the measurable outputs, i.e.,

The nonlinear functions in (5.5a), (5.5b) are in general given as lookup tables
(i.e., maps), which are obtained by a series of steady state experiments and in-
herently contain errors. Other modeling uncertainties include uncertain parameters,
such as the vehicle mass, the road grade and the damping coefﬁcient of shafts. The
approximation of (5.2) may bring about modeling error as well.

Hence, the problem considered here is to design an observer of the axle shaft
torque for all gear positions. The observer estimates the shaft torque in the presence
of model errors, given the engine throttle input and the measured rotational speeds
of the transmission.

5.3 Reduced-Order Nonlinear Shaft Torque Observer

5.3.1 Structure of the Observer

In this section, the special structure of the driveline system is exploited, and the
methodology in Chap. 2 (or [8]) is extended to derive a reduced-order observer of
the axle shaft torque. The robustness of the observer with respect to model errors
is achieved in the sense of input-to-state (ISS) property. To do this, we denote the
variable to be estimated as z, and rewrite the system dynamics as follows:

where y is the measured outputs, w(y, u, z) summarizes model uncertainties which
is normalized as (cid:6)w(cid:6)∞ ≈ 1. In particular, H is the matrix for the normalization of
w and

˙y = F (y, u) + Gz + H w(y, u, z),
˙z = Ay,

F (y, u) =

(cid:3)

,

(cid:2)

⎛

⎝

(cid:2)

f1(x1, u)
RiRdf f2(x2)

⎞

⎠ ,

− ¯Ts
Ii Ri Rdf
¯Ts
Ri Rdf
Iv

Ks
RiRdf

¯Ts

, − Ks
RiRdf

¯Ts

(cid:3)

.

G =

A =

129

(5.5b)

(5.6)

(5.7a)

(5.7b)

(5.8a)

(5.8b)

(5.8c)

130

5 Torque Estimation of the Vehicle Drive Shaft

Because the shaft torque directly affects the related shaft accelerations, the dif-
ference between the true accelerations ˙y and the estimated values F (y, u) + Gˆz is
used to constitute the correction term. The observer is then designed in the form of

˙ˆz = Ay + L

(cid:7)
˙y − F (y, u) − Gˆz

(cid:8)
,

where L ∈ R1×2 is the time-invariant (constant) observer gain to be determined.

In order to avoid taking derivatives of the measurements y, the following trans-

formation is made. Let

then, we can infer for a time-invariant L that

η = ˆz − Ly,

˙η = Ay − LG(η + Ly) − LF (y, u).

Equations (5.10) and (5.11) constitute then the reduced-order observer of the
drive axle shaft torque for the nonlinear driveline system. Obviously, the nonlineari-
ties of the powertrain system appear in the observer in their original form. Therefore,
the characteristics of powertrain mechanical systems, such as the characteristics of
the engine and the aerodynamic drag, can be represented in the form of lookup ta-
bles, which are easily processed in computer control.

5.3.2 Properties of the Error Dynamics

In this section, the error dynamics of the designed shaft torque observer is analyzed
using the concept of ISS (input-to-state stability) (Appendix B). By deﬁning the
observer error as

the error dynamics can then be described by

e = z − ˆz,

˙e = −LGe − LH w.

We deﬁne V (e) = 1

2 eT e and differentiate it along the solution of (5.13) to obtain

˙V = −eT LGe − eT LH w.

Using Young’s Inequality [12], the above equality becomes

˙V ≤ eT (−LG + κ1)e + 1
4κ1

wT H T LT LH w,

(5.15)

where κ1 > 0. We now choose L to satisfy the following inequality:

−LG + κ1 ≤ −κ2

(5.16)

(5.9)

(5.10)

(5.11)

(5.12)

(5.13)

(5.14)

5.3 Reduced-Order Nonlinear Shaft Torque Observer

with κ2 > 0, then we arrive at

and furthermore,

˙V ≤ −κ2eT e + 1
4κ1

wT H T LT LH w

˙V ≤ −κ2(cid:6)e(cid:6)2 + 1
4κ1

(cid:7)
H T LT LH

(cid:8)
(cid:6)w(cid:6)2

∞.

λmax

131

(5.17)

According to Theorem B.1 in Appendix B, this shows that the error dynamics of the
observer (5.9) is input-to-state stable, where the K∞ functions are α(x) = κ2x2 and
γ (x) = 1
4κ1

λmax(H T LT LH )x2.
Moreover, it follows from (5.17) that
˙V ≤ −2κ2V + 1
4κ1

wT H T LT LH w.

(5.18)

Upon multiplication of (5.18) by e2κ2t , it becomes
(cid:7)
V e2κ2t

(cid:8)

wT H T LT LH we2κ2t .

d
dt

≤ 1
4κ1

(5.19)

Integrating it over [0, t] leads to
(cid:9)

V (t) ≤ V (0)e−2κ2t + 1
4κ1

t

0

and furthermore,

e−2κ2(t−τ )w(τ )T H T LT LH w(τ ) dτ,

(5.20)

(cid:10)
(cid:10)
(cid:10)2 ≤
(cid:10)e(t)

(cid:10)
(cid:10)
(cid:10)2e−2κ2t +
(cid:10)e(0)

(cid:6)w(cid:6)2

∞λmax(H T LT LH )

e−2κ2(t−τ ) dτ.

(5.21)

(cid:9)

t

0

2κ1

Hence, we can interpret the ISS property of the designed observer as follows:

(a) The initial estimation error decays exponentially with κ2;
(b) If a bound of the modeling errors is given, an upper bound of the estimation

offset can be computed as

(cid:10)
(cid:10)
(cid:10)2 ≤
(cid:10)e(∞)

(cid:6)w(cid:6)2

∞λmax(H T LT LH )

.

(5.22)

4κ1κ2

Remark 5.1 We stress that (5.22) gives just an upper bound of the estimation error
offset, if a bound of the model error is given. The real offset could be much smaller,
due to the multiple use of inequalities in the above derivation. For a ﬁxed gear posi-
tion, G and H are constant matrices, which implies that the error dynamics (5.13)
is time-invariant. We denote them as Gi and H i , i = 1, 2, . . . , 6. Hence, we can
compute the estimation error offset by using the ﬁnal-value theorem [21]

e1(∞) = lim
s→0

s ·

−a1
s + LGi

w1(s),

(5.23a)

(5.23b)

(5.24a)

(5.24b)

(5.25a)

(5.25b)

132

5 Torque Estimation of the Vehicle Drive Shaft

e2(∞) = lim
s→0

s ·

−a2
s + LGi

w2(s),

which implies

when w1 and w2 are impulse signals, and

e1(∞) = 0,
e2(∞) = 0,

e1(∞) =

e2(∞) =

−a1
LGi
−a2
LGi

,

.

when w1 and w2 are step signals. In the above, aj is the j th element of LH i and ej
is the offset resulting from the j th disturbance wj , j = 1, 2.

Remark 5.2 In practice, the gear position changes among i = 1, 2, . . . , 6, which
constitutes a switching system. If a constant observer gain L is available for all the
gears, it helps to simplify the real world implementation of the designed observer.
Therefore, we solve the following LMIs for a constant L

−LGi + κ1 ≤ −κ2,

i = 1, 2, . . . , 6, with Gi =

(5.26)

⎞

⎠ .

⎛

⎝

− ¯Ts
Ii Ri Rdf
¯Ts
Ri Rdf
Iv

Then, if there exists a constant L satisfying LMIs (5.26), V (e) is a common Lya-
punov function to show the observer achieves properties (a) and (b) for any gear
position. Moreover, if the gear position were ﬁxed, the decay rate of the error dy-
namics could be given by (LGi − κ1).

5.3.3 Guideline of Choosing Tuning Parameters

The above discussion highlights that the observer gain should satisfy (5.26), in order
to guarantee the ISS property. In (5.26), κ1 ≥ 0 and κ2 ≥ 0 are the tuning parameters.
Now we give some guidelines for choosing these tuning parameters.

It follows clearly from the property (a) that κ2 should be chosen according to the
required decay rate of the estimate. According to (b), one may choose a larger κ1 to
reduce the offset. From (5.26), however, one should notice that the larger the κ1, the
higher the observer gain.

Hence, we can give the following systematic procedure to determine the tuning
parameters κ1 and κ2 of the reduced-order nonlinear drive shaft torque observer in
the forms of (5.10) and (5.11):

5.3 Reduced-Order Nonlinear Shaft Torque Observer

133

Table 5.1 Parameters for observer design

I1–I6

Inertia from engine to axle shaft

R1–R6
Iv
Rdf
Ks
¯Ts

Gear ratio

Equivalent inertia of vehicle

Ratio of differential gear

Axle shaft stiffness

Maximum value of axle shaft torque

0.6967 kg m2, 0.7021 kg m2
0.7135 kg m2, 0.7399 kg m2
0.7992kg m2, 0.9325 kg m2
7.57, 5.00, 3.38, 2.25, 1.50, 1.00
1560.6 kg m2
5

900 Nm/deg
104 Nm

Step 1: Choose the parameter κ2 according to the required decay rate of the estima-

tion error;

values;

Step 2: Choose the parameter κ1, where it is suggested to start from some smaller

Step 3: Determine the observer gain L such that (5.26) is satisﬁed;
Step 4: When w1 and w2 are step signals, use (5.25a), (5.25b) to compute the esti-
∞ is available), and

mation error offset for i = 1, 2, . . . , 6 (use (5.22) if (cid:6)w(cid:6)2
check if the offset is acceptable for each gear position;

Step 5: If the offset is acceptable, end the design procedure. If not, go to Step 2.

In order to reduce the offset and to achieve lower observer gains for robustness

against noises, L can be obtained through the following convex optimization:

min
α,L
(cid:2)

α subject to LMI (5.26) and
(cid:3)

α
i LT
H T

LH i
I

≥ 0,

i = 1, 2, . . . , 6.

(5.27a)

(5.27b)

Given κ1 and κ2, the solution of (5.27a), (5.27b) gives then a constant observer gain
with the lowest possible gains satisfying the condition (5.26).

5.3.4 Observer Design for Considered Vehicle

Now the proposed method is applied to design an axle shaft torque observer for the
considered vehicle. The parameters required for the observer are listed in Table 5.1.
The values of these parameters are derived from the nominal setting of an AMESim
simulation model of a medium-duty truck, which is shown in Fig. 5.1 and will be
discussed later in Sect. 5.4.1.

Nonlinear functions f1, f2 are given as lookup tables for the observer. The maps
of f1, f2 are shown in Fig. 5.3. These maps are also derived from the steady state
characteristics of the AMESim powertrain model described in Sect. 5.4.1.

Following the procedure given in Sect. 5.3.3, we ﬁrst choose κ2 to meet the re-
quirement for the desired decay rate of the estimation error. It is desired that the

134

5 Torque Estimation of the Vehicle Drive Shaft

Fig. 5.3 MAPs of nonlinear
functions f1, f2

error converges in 0.1 s, and we consider the settling time as 4 time constants [21],
which implies 4
κ2

= 0.1 and results in κ2 = 40.

Then κ1 is chosen with the purpose of achieving an acceptable offset of the esti-
mation error. To do this, we need ﬁrst to determine H i, i = 1, 2, . . . , 6 by the bounds
of modeling errors for different gear positions.

Since powertrain systems admit highly nonlinear complex dynamics and various
uncertainties, it is indeed very difﬁcult, if not impossible, to obtain a comprehensive
estimation of the modeling error bound. Hence, we only consider some major un-
certainties as an example to estimate the elements of H w. The major uncertainties
considered here are the estimation error of the engine torque Te, the variations of
road grade θg and vehicle mass m, which affect the driving resistance Tv and the
inertia Iv in (5.4a)–(5.4c). The estimation error of the engine torque is assumed to
be bounded within ±10 % of the true value. Hence, (cid:6)hi1w1(cid:6)∞ is estimated by

(cid:6)hi1w1(cid:6)∞ = 10 % × Te max
Ii

,

(5.28)

where Te max is the maximum value of the engine torque with Te max = 620 Nm. It is
assumed here that the error bound (±10 %) covers the transient estimation error and
the torque variation due to long-term aging. It should be noted, however, that the
error bound is somewhat conservative for the calculation of the estimation offset.

Then we change the settings of the road grade θg and vehicle mass m to calculate
(cid:6)hi2w2(cid:6)∞. The un- and full-laden masses of the truck are 4000 and 8000 kg, re-
spectively, hence the nominal mass used for the observer design is set to be 6000 kg.
When the vehicle mass is increased from 6000 to 8000 kg, and the road grade angle
is increased from 0 to 5 degrees, the modeling error (cid:6)hi2w2(cid:6)∞ under full throttle

5.3 Reduced-Order Nonlinear Shaft Torque Observer

135

operation is calculated as

(cid:2)

(cid:6)hi2w2(cid:6)∞ =

Te maxRiRdf
Iv0

−

Te maxRiRdf − m1gRw sin(5◦)
Iv1

(cid:3)

RiRdf ,

(5.29)

where Iv0 is the nominal value of the vehicle inertia, m1 is the fully loaded mass,
Iv1 is the vehicle inertia when fully loaded, Rw is the tire radius. The results for the
1st gear position read

Hence H 1 is set to be

Similarly, H i is computed for i = 2, . . . , 6, and reads

(cid:6)h11w1(cid:6)∞ = 89 rad/s2,

(cid:6)h12w2(cid:6)∞ = 205 rad/s2.

H 1 =

89
0

0
205

(cid:2)

(cid:2)

(cid:2)

(cid:2)

(cid:2)

(cid:2)

88
0

87
0

84
0

78
0

66
0

(cid:3)

(cid:3)

.

,

0
104
(cid:3)

0
57

0
31

0
18

0
11

(cid:3)

(cid:3)

(cid:3)

,

,

,

.

H 2 =

H 3 =

H 4 =

H 5 =

H 6 =

(cid:7)

(cid:8)

L =

−0.1714 0.0207

.

e1(∞) = −0.217,
e2(∞) = 0.060.

(5.30a)

(5.30b)

(5.31)

(5.32)

(5.33a)

(5.33b)

(5.34)

Iterate Step 2–Step 5 of the procedure given in Sect. 5.3.3 to determine a suit-

able κ1. The result reads κ1 = 30 with the observer gain of

According to (5.25a), (5.25b), the corresponding offset of the 1st gear is

Then the offset is bounded as
(cid:24)
(cid:24)
(cid:24) ≤
(cid:24)e(∞)

(cid:24)
(cid:24)
(cid:24)e1(∞)
(cid:24) +

(cid:24)
(cid:24)
(cid:24)e2(∞)
(cid:24) = 0.277,

which is within 12 % of the maximum shaft torque. Similarly, the offset bounds
of the 2nd–6th gears are 0.171, 0.111, 0.0724, 0.0477, and 0.0315, respectively,

136

5 Torque Estimation of the Vehicle Drive Shaft

which are all within 12 % of the maximum shaft torque of the corresponding gear
positions.

It should be noted that although the error of 12 % is relatively large for some
dynamic control applications (such as shift control), it is a conservative upper bound
of the estimation offset, and the real offset could be much smaller, because in the
above derivation

(a) The multiple use of inequalities enlarges the calculated result;
(b) Setting disturbances as step signals is also conservative.

It is also worth noting that the shaft torque error could be reduced through im-
proving the estimation accuracy of the engine torque [26]. For example, if the es-
timation error of the engine torque is assumed to be bounded within ±5 % of the
true value, the bounds of |e(∞)| become 0.131, 0.0823, 0.0543, 0.0356, 0.0235, and
0.0155, respectively, which are less than 5.6 % of the maximum shaft torque of the
corresponding gear positions.

5.4 Simulation Results

5.4.1 Powertrain Simulation Model

In this section, the proposed observer of axle shaft torque is evaluated on a pow-
ertrain simulation model. The model is established by the commercial simulation
software AMESim, which supports the Simulink environment by S-Function. The
constructed model can capture the important transient dynamics of the driveline,
such as the drive shaft oscillation and the tire slip.

Engine

Because there is no torque converter included in AMT vehicles, the engine model
used is a little more precise than that of the last chapters. The engine model based
on AMESim submodels gives the output torque, fuel consumption and emissions,
etc., according to the accelerator pedal position acted by the driver, engine speed
and water temperature.

An initial torque is read in a lookup table, i.e., a map relative to the engine speed
and the load requested by the control unit. Then the torque is corrected by con-
sidering the friction losses, which is given as a map of the friction mean effective
pressure (FMEP) relative to the engine speed and the water temperature. The maps
of the engine torque and the friction losses are shown in Fig. 5.4. The lag time from
load request to torque generation is also considered, and treated as a ﬁrst-order lag.

5.4 Simulation Results

Fig. 5.4 Engine torque map
and friction map

137

Fig. 5.5 Clutch spring
characteristics

Clutch and Transmission

Here an AMT with a 6-speed transmission is used, the speed ratios of which are
shown in Table 5.2. The dry clutch is modeled in consideration of the internal damp-
ing. The spring characteristics of the clutch are shown in Fig. 5.5.

The parameters used in the powertrain simulation model are listed in Table 5.2.
The parameters represent a typical medium-duty truck equipped with a 6.2 l diesel
engine.

Table 5.2 Nominal values of simulation model parameters

5 Torque Estimation of the Vehicle Drive Shaft

Inertia of crank and ﬂy wheel

Water temperature

0.68 kg m2
80 °C

Inertia of clutch plate

Damping of clutch twist motion

0.005 kg m2
0.2 Nm/(rad/s)

Maximum Coulomb friction torque

900 Nm

Transmission
It
Ct
R1–R6

Inertia of transmission input

Damping of transmission input

Gear ratio

0.008 kg m2
0.05 Nm/(rad/s)

7.57, 5.00, 3.38, 2.25, 1.50, 1.00

Differential gear
Rdf

Gear ratio

Drive axle shaft
Is

Equivalent inertia from transmission
output shaft to axle shaft

Damping of axle shaft input

Axle shaft stiffness

Damping of axle shaft torsion

Inertia of one tire

Tire radius

Resistant moment of tires

Longitudinal slip threshold of tire

Maximum longitudinal force of tire

Vehicle mass

Road grade

Air density

Front area of vehicle

Aerodynamic drag coefﬁcient

5.0

5.8 kg m2

0.8 Nm/(rad/s)

900 Nm/deg

200 Nm/(rad/s)

5 kg m2
0.51 m

300 Nm

0.1

18000 N

6000 kg
0◦
1.2 kg / m3
6 m2
0.7

138

Engine
Ie
Twater

Clutch
Ic
Cct
Tc max

Cs
Ks
Cst

Tire
Iw
Rw
Tw
dSx
Fx max

Vehicle

m
θg
ρ
AA
CD

Discrete Speed Sensor Model

Besides the complete powertrain simulation model of the vehicle drivetrain, a dis-
crete speed sensor model is also constructed. The precision of speed measurement
greatly inﬂuences the observer accuracy. In production vehicles with ABS (Anti-
lock Brake System), magnetic pickup sensors are available for the measurement of

5.4 Simulation Results

139

the clutch output speed and wheel speed. It is more accurate if the measurement
noise brought about by this kind of sensors is included in the simulation model.

There are generally two methods to detect the shaft speed by pick-up sensors,
one measuring the angle passed in a certain time, and the other measuring the time
needed to pass a certain angle. The ﬁrst method can be used for low speed control
systems, such as optimal gear position determination systems. For the highly tran-
sient applications, such as ABS and gear shift quality control, the second method is
necessary.

When measuring the time interval corresponding to a certain number of teeth,

the shaft speed can be calculated from

ω = 2πnin
(cid:4)tn

,

(5.35)

where n is the total number of teeth, nin is the number of teeth corresponding to the
time measurement, (cid:4)t is the counted time interval.

Measurement delay results from the time required for a new tooth to pass the
pickup. Moreover, the irregularities of the teeth position and the randomness of the
trigger, which convert the analog signal into the square-wave signal, may introduce
random sensor noises. The general method to simulate realistic sensor characteris-
tics is to construct a discrete sensor model [17, 20], where the randomness can be
taken into account by adding a random angle to the regular tooth angle.

The speed sensors of this work are assumed to have 48 teeth, and the time interval
corresponding to 3 teeth is recorded to calculate the rotational speed. A relative
tolerance of teeth location of 0.169 % [17] and a trigger randomness of 1.5 % are
considered.

Figure 5.6 shows a simulation example of the output of the speed sensor model

and the “true” value of speed.

5.4.2 Simulation Results

Figure 5.7 gives the simulation results of the 1st gear drive with the parameter set-
ting of Table 5.2, based on which the simpliﬁed model of observer design is derived.
From the speeds of ωc and ωw, it can be seen that intensive shaft oscillations are
provoked by the variation of the engine torque. The engine torque Te is shown, as
well as the estimated engine torque ˆTe = f1(ωe, θth)I1 used in the observer. From
Fig. 5.7, the maximum estimation error (during 5–6 s) of the engine torque is about
75 Nm, i.e., 12 % of the maximum engine torque. It is large enough to cover the
error bound of on-board engine torque estimations [4, 11], which means that the
simulation is able to check the performance of the designed observer when the en-
gine torque is not accurately known. On the other hand, the designed observer tracks
the shaft torque rapidly and the maximum error is about 2000 Nm, which is 8.5 %
of the largest shaft torque of the 1st gear. Note that large estimation error of drive

140

5 Torque Estimation of the Vehicle Drive Shaft

Fig. 5.6 Speed sensor output

Fig. 5.7 Simulation results
(1st gear, m = 6000 kg,
θg = 0◦)

5.4 Simulation Results

141

Table 5.3 Mean value E(|e|), percentage over corresponding maximum torque P (|e|) and stan-
dard deviation SD(|e|) of estimation error

Measure

Fig. 5.7 (1st gear)

Fig. 5.10 (3rd gear)

Fig. 5.11 (6th gear)

E(|e|) (Nm)
P (|e|)
SD(|e|) (Nm)

760.3

3.24 %

638.7

Fig. 5.8 Effectiveness of the
proposed observer

637.5

6.08 %

220.8

153.8

4.96 %

79.2

shaft torque also appears in 5–6 s, which shows that the estimation error depends
largely on the estimation accuracy of the engine torque.

Moreover the mean value and deviation of estimation error are given in Table 5.3
in order to show the overall performance of the observer. It is shown that the mean
error is less than about 6 % of the maximum shaft torque of the corresponding gear,
which is much less than 12 %, the theoretic result of (5.34) in Sect. 5.3.4.

An alternative method to estimate the drive shaft torque seems to be feasible, i.e.,
the method of subtracting the inertia torque from the estimated engine torque, which
is described by the following equation:

ˆTsen = ( ˆTe − I1 ˙ωc)R1Rdf .

(5.36)

The result is plotted in Fig. 5.8 as a dotted line, where the dashed line denotes the
result of the proposed observer and the solid line plots the “true” values. Because
of the high frequency twist of the clutch springs, serious oscillations are shown in
ˆTsen, which veriﬁes the potential beneﬁts of the proposed observer.

Then the proposed observer is tested under the driving conditions that deviate
from the nominal setting. Similarly as Sect. 5.3.4, the vehicle mass and road grade
are changed. The results are shown in Fig. 5.9. It can be seen that the variation of the
driving condition does not seriously affect the estimation error, and the maximum
error is about 2100 Nm, which is still less than 10 % of the maximum shaft torque.
The estimation results of the 3rd gear and the 6th gear are plotted in Fig. 5.10 and
Fig. 5.11, respectively. The estimation error converges rapidly, and the error offset
(about 1000 Nm in Fig. 5.10, and 200 Nm in Fig. 5.11) is within the anticipated

142

5 Torque Estimation of the Vehicle Drive Shaft

Fig. 5.9 Simulation results
(1st gear, m = 8000 kg,
θg = 5◦)

levels. Similar to the results of the 1st gear, relatively large steady state error appears
because of the large estimation error (somewhat conservative) of the engine torque.
At the same time, there is some large overshoot in the results, and the higher
the gear position, the more serious the overshoot. This may motivate to design a
switching observer for different gear positions.

Finally, in order to get an in-vehicle assessment of the proposed observer, it is dis-
cretized at the sampling frequency 100 Hz [10]. Furthermore, the discrete models of
speed sensors [17, 25] are used to give the clutch speed ωc and the wheel speed ωw.
The speed sensors of this work are assumed to have 48 teeth, and the time interval
corresponding to 3 teeth is recorded to calculate the rotational speed. A relative tol-
erance of teeth location of 0.169 % [17] and a trigger (to convert the analog signal
into the square-wave signal) randomness of 1.5 % are considered. Note that because
of the strong inﬂuence of the sampling time of 10 ms, in the discrete implementa-
tion, the observer gain has to be reduced in order to restrain oscillations resulting

5.4 Simulation Results

Fig. 5.10 Simulation results
(3rd gear, m = 6000 kg,
θg = 0◦)

143

from sampling, and the tuning result is

(cid:7)

(cid:8)

L =

−0.0343 0.0041

.

(5.37)

It is also worth noting that in the discrete implementation, the simulation time
steps of the observer model (Simulink) and the vehicle model (AMESim) are dif-
ferent, and the vehicle model is simulated under much shorter time step (less than 1
ms).

The estimation results of the discrete implementation are given in Fig. 5.12. The
vehicle is driven in the 1st gear and the driving conditions are the same as in Fig. 5.7.
Although the discretization and sensor noise (generated by the constructed speed
sensor model) result in some noises, the estimation error is still within the antici-
pated level.

144

5 Torque Estimation of the Vehicle Drive Shaft

Fig. 5.11 Simulation results
(6th gear, m = 6000 kg,
θg = 0◦)

5.5 Notes and References

Simulation results show that the proposed observer is robust to driving condition
variations, and the observer with constant gain provides satisfying estimation error
offset for all gear positions.

However, there is an overshoot that appears in the results of high gear driving.
Because the vehicle with step-ratio transmission is a class of switching system, we
can solve this problem by designing a switching observer. Concerning switched
systems [14], the question of how to design a switching observer with exponential
error convergence has been studied by many applications; please refer to [2, 5] for
detailed information.

Automated Manual Transmissions (AMTs), as shown in Fig. 6.1, are generally con-
stituted by a dry clutch and a multi-speed gearbox, both equipped with electro-
mechanical or electro-hydraulic actuators, which are driven by a Transmission
Control Unit (TCU). Compared with other topologies of automatic transmissions,
AMTs have the advantages of lower weight and higher efﬁciency [2, 13], and they
are widely adopted to offer easy drive and fuel efﬁciency for trucks. AMTs are also
suitable for parallel hybrid electric vehicles [12]. However, one limitation of AMTs
is the reduction of driving comfort, caused by the lack of traction during gear shift
actuation. The problem is even more serious in the case of heavy duty vehicles,
where the driveline torsion is relatively large. Therefore, aiming to improve the shift
quality, it is necessary to take into account the reduction of shift time and shift
shock [5] in a proper gear shift management.

At the beginning of the gear shift process of AMTs, the torque transmitted by the
transmission is decreased and then cut off by active engine control (motor as well in
the case of hybrid electric vehicles (HEVs) [11, 12]) and clutch disengagement, then
the neutral gear is engaged. Next follows the speed synchronization of the transmis-
sion shafts and the engagement of the new gear. Finally, the clutch is engaged, and
the engine torque level is recovered as demanded by the driver. Note that some of
the above operations may be omitted in some new shift techniques, such as AMTs
without synchronizer [3].

The aforementioned actions are usually lumped into 3 phases [16] to reduce shift
time. As shown in Fig. 6.2, a typical power-on upshift process, the ﬁrst phase is the
so-called torque control phase, wherein the driveline torque is reduced to zero, and
the neutral gear is engaged. Next comes the speed synchronization phase, where the
speed difference is synchronized and the new gear is engaged. Finally, during the
last phase, the torque level is recovered as demanded by the driver.

The shift shock may be caused during two actuations. First, as it is well known,
at the end of the shift, if the clutch is engaged too quickly or the engine torque is re-
covered too rapidly, driveline resonances may be produced [2, 8]. Besides the above

H. Chen, B. Gao, Nonlinear Estimation and Control of Automotive Drivetrains,
DOI 10.1007/978-3-642-41572-2_6,
© Science Press Beijing and Springer-Verlag Berlin Heidelberg 2014

147

148

6 Clutch Disengagement Timing Control of AMT Gear Shift

Fig. 6.1 Driveline scheme of
AMT

Fig. 6.2 Time sequence of
gear upshift process

operations, the clutch disengagement may bring about severe driveline oscillation
as well. If the timing of the clutch disengagement is not well controlled, in other
words, there is large elastic torsion in the driveline when the traction is interrupted,
the potential energy accumulated in the driveline will lead to unwanted driveline
and vehicle oscillations.

In order to restrain the driveline oscillation caused by traction drop, it is sug-
gested in [3] that the actuation of traction interruption (clutch disengagement)
should be carried out at the moment when the transmission torque (here the “trans-
mission torque” refers to the torque delivered to the clutch) is controlled to zero.
In [15–17], based on the general fact that the drive shaft is the main component
of the driveline, it is pointed out that the drive shaft torque (here the “drive shaft
torque” refers to the torque delivered to the drive axle shaft) can be used instead of
the transmission torque. And it is assumed that if the drive shaft torsion is small,
the transmission torque is also small. The drive shaft torque is estimated for a full-
state feedback controller of active engine control, which aims to damp the driveline
resonance as soon as possible.

6.2 Observer-Based Clutch Disengagement Timing Control

149

Fig. 6.3 Block diagram of a
clutch disengagement system
( ˆTs , estimated drive shaft
torque; Fc, clutch
engagement force; θth, engine
throttle; ωc, ωw, transmission
input speed and wheel speed)

In this chapter, for a further step, the knowledge of drive shaft torque is used
to constitute a closed-loop clutch disengagement strategy. Because we prefer short
shift time (the requirement is especially strict for heavy-duty vehicles to shift on a
slope), it is desired that the engine torque decreases rapidly at the beginning of the
shift process. For such a highly transient process, the clutch disengagement strategy
is designed so that the clutch is fully disengaged when the drive shaft torque reaches
zero for the ﬁrst time (see Fig. 6.4 for reference). It is reasonable to believe that
such a strategy is optimal for the reduction of total shift time while assuring small
shift shock because if the clutch is disengaged at an earlier time, the drive shaft
torsion may cause severe driveline oscillations, and on the other hand, if the clutch
is disengaged until the driveline ﬂuctuations are fully damped out, the total shift
time may be prolonged.1

6.2 Observer-Based Clutch Disengagement Timing Control

During the ﬁrst phase, the engine torque is withdrawn, followed by the decrease of
the axle shaft (or half shaft) torque Ts . It may take several hundreds of milliseconds
for Ts to drop to 0 Nm. During this period, the clutch disengagement and neutral-
gear engagement can be carried out simultaneously to reduce the total shift time.

The observer of axle shaft torque designed in the last chapter (Chap. 5) is used for
the suggested clutch disengagement strategy, and the block diagram of the proposed
system is described in Fig. 6.3.

The block of the “clutch disengagement strategy” controls the clutch engage-
ment force so that the clutch is fully disengaged at the moment when the estimated
drive shaft torque ˆTs reaches zero. The vehicle of interest is a medium-duty truck
with a 6.2 l diesel engine. The sensors used for rotational speed measurement are
Hall-effect pick-up sensors, which are widely used for anti-lock brake systems and
automatic transmissions. Because the precision of the proposed drive shaft torque
observer relies on the engine torque estimation, a revised observer with switched
gains is given as well, which can be activated in the case of large estimation error of
the engine torque [4].

1This chapter uses the content of [4], with permission from Taylor & Francis.

150

6 Clutch Disengagement Timing Control of AMT Gear Shift

6.3 Clutch Disengagement Strategy

The clutch engagement force Fc is regarded as the control input. Note that the clutch
engagement force is indeed not the initial control variable. In production AMTs, the
diaphragm spring of the dry clutch is actuated by electro-mechanical or electro-
hydraulic actuators. The characteristics of the hydraulic or electric actuators, how-
ever, are speciﬁc to a given transmission and implementation method. If the clutch
engagement force is assumed to be the control variable, the control strategy could
be applicable to various kinds of AMTs, where the used actuator is controlled to
deliver the desired force.

When the clutch is slipping, the torque Tc delivered through the clutch is deter-

mined by

where μd is the dynamic friction coefﬁcient, Rc is the effective radius.

If the clutch is sticking (locked up), the delivered torque is

Tc = Fcμd Rc sign((cid:4)ω),

Tc =

+ Iict ˙ωc,

ˆTs
iiidf

(6.1)

(6.2)

where Iict is the inertia from the clutch to the drive shaft, and the subscript i denotes
the ith gear position, i = 1, 2, . . . , 6. The delivered torque is no longer determined
by the clutch engagement force Fc. However, the maximally transmittable torque
for non-slip condition is limited by Fc, i.e.,

Tc max = FcμsRc sign(Tc),

(6.3)

where μs is the static friction coefﬁcient.

It is desired here that the clutch is disengaged as soon as the drive shaft torque
reaches zero, and before that the clutch should be locked up without slipping. There-
fore, we design Fc having the following form:

Fc = κc

ˆTs
iiidf μd Rc

,

(6.4)

where κc is a coefﬁcient larger than 1. If the value of κc is small, clutch slip may
be caused before the drive shaft torque reaches zero. On the other hand, if κc is too
large, the time for clutch actuation will be too short. The tuned value is κc = 1.3. It
is clear that by such a clutch disengagement strategy, the clutch will be disengaged
when the estimated drive shaft torque ˆTs is approaches zero, and before that the
clutch is locked up.

6.4 Simulation Results

Fig. 6.4 Simulation results
(no clutch operation;
m = 6000 kg, θg = 0◦,
Ie = 0.68 kg m2,
Ks = 900 Nm/deg)

151

6.4 Simulation Results

6.4.1 Simulation Results with Constant Observer Gain

The proposed clutch control strategy is tested on the AMESim powertrain simu-
lation model which has been introduced in Chap. 5. In order to get an in-vehicle
assessment of the proposed clutch disengagement control system, the designed ob-
server is discretized by a sampling rate of 100 Hz [6] with zero-order holder dis-
cretization.

Figure 6.4 gives the simulation results of the engine torque reduction at the be-
ginning of the 1st-to-2nd gear upshift process; however, without clutch operation.
The driving condition is the same as the nominal setting, based on which the sim-
pliﬁed model and its parameters for the observer design are derived. At 8.0 s, the
shift process is started and the engine throttle θth begins to decrease, followed by the
decrease of the engine torque Te. The estimated engine torque used at the observer,
ˆTe, is given as well. Note that because of the engine brake effect, there are some
negative values in Te and ˆTe when the throttle angle is small and the engine speed

152

6 Clutch Disengagement Timing Control of AMT Gear Shift

Fig. 6.5 Simulation results
(with clutch operation, clutch
disengaged at 8.22 s (using
observer); 8.12 and 8.32 s
(without observer); driving
conditions and parameters are
the same as those of Fig. 6.4)

is large. A sudden decrease of the engine torque results in severe drive shaft oscilla-
tion, which causes uncomfortable driveline shufﬂe and gear-gap shunt (clonk). The
oscillation can be clearly seen from the drive shaft torque Ts , the measured clutch
output speed ωcm and the measured wheel speed ωwm. The observer can track drive
shaft torque well when there is no large engine torque estimation error.

Then the estimated drive shaft torque is used for the clutch disengagement timing
control. The results are plotted as the solid lines in Fig. 6.5, where the clutch is fully
disengaged at 8.22 s when the estimated drive shaft torque reaches zero for the ﬁrst
time. For comparison, the results when the clutch is disengaged at 8.12 and 8.32 s are
given as well, which are 0.1 s before and after the optimal timing, respectively. The
vehicle jerk da [5], namely the change rate of the longitudinal acceleration which is
used to evaluate the shift shock, is plotted at the bottom of Fig. 6.5. It is clear that
smooth clutch disengagement can be assured if an observer is used. Meanwhile, the
disengagement based on the observer has the shortest possible shift time because
the clutch is disengaged when the shaft torque reaches zero for the ﬁrst time.

6.4 Simulation Results

153

Fig. 6.6 Simulation results under different driving conditions and parameters: (a) the same as in
Fig. 6.4 except that m = 8000 kg, θg = 5◦; (b) the same as in (a) except that Ie = 0.58 kg m2,
Ks = 990 Nm/deg; (c) the same as in (b) except that the estimation error of Te is changed

In order to examine the robustness of the proposed control strategy, the driving
conditions and parameters are changed step by step, and the results are shown in
Fig. 6.6. Figure 6.6(a) is the simulation of the fully loaded vehicle driving on a slope.
Although the vehicle mass and the resistance are greatly varied, there is no obviously
change of the control performance compared with the solid line of Fig. 6.5. This is
because, as shown in the last chapter, the observer gain L = [l1, l2] has a relatively
small value of l2, which corresponds to the output side (wheel side) of the drive
shaft. Figure 6.6(b) shows the results when the stiffness of the drive shaft Ks and
the engine inertia Ie are changed, and the shift shock becomes somewhat larger. It
should be noted that the increase of Ks and the decrease of Ie enhance the estimation
values of the drive shaft torque simultaneously. Finally, from Fig. 6.6(c), it can be
seen that when the estimation error of the engine torque Te is changed (the steady
state error changes from −40 to 80 Nm), the shift shock is greatly affected.

6.4.2 Simulation Results with Switched Observer Gains

Figure 6.6 shows that the observer error may be seriously enlarged by a large engine
torque estimation error. Because the engine simulation model in this study is based

154

6 Clutch Disengagement Timing Control of AMT Gear Shift

Fig. 6.7 Simulation results with switched observer gain (no clutch operation; driving conditions
and parameters are the same as those of Fig. 6.4)

on the torque and friction maps, only a relatively large steady state error is repre-
sented. In real engines, however, it is the transient engine torque that is difﬁcult to
estimate precisely.

At the beginning of the gear shift of AMT, the engine works in a highly transient
state, and if a large estimation error of the transient engine torque is introduced,
the shift performance may be furthermore worse than that of Fig. 6.6(c). Therefore,
for a easy and low cost implementation, it is preferred that the proposed drive shaft
observer can provide an accurate enough estimation even when there exist large
estimation errors of the engine torque.

Figure 6.7 is a drive shaft torque estimation using switched observer gains. The
simulation condition and the estimation error of the engine torque Te is the same as
those of Fig. 6.4, and the speed sensors have been compensated for teeth partition
defects [7]. After 8 s, the observer gain L is changed to be zero, in other words,
the shaft torque is estimated using the measured speeds only, without considering
a correction term. As expected, the estimation values drift out because of the accu-
mulated sensor error. Fortunately, in a short time, such as 1 s, which is sufﬁcient for
clutch disengagement, the method can provide an accurate enough estimation.

Then, the observer with switched gains is used for clutch disengagement control
with results shown in Fig. 6.8. The driving condition is set to be the same as those
of Fig. 6.6(c). It can be seen that at 8.0 s, when the shift is started, the observer with
a normal gain can provide a good enough initial value for the following estimation
with the gain of zero. The estimated shaft torque reaches zero at 8.33 s. We can see
that the clutch is also fully disengaged at about 8.33 s, and the vehicle jerk is about
50 m/s3, which is better than in Fig. 6.6(c), and we think it is an acceptable level for
a fully loaded truck shifting on a slope. Because the neutral gear is also engaged at
8.33 s, the estimated shaft torque does not track true values anymore after that.

6.5 Notes and References

As shown above, the estimation of drive shaft torque is inﬂuenced by the precision of
the engine torque values. Since it is not proﬁtable to use torque sensors in production

6.5 Notes and References

Fig. 6.8 Simulation results
with switched gain (driving
conditions and parameters are
the same as in
Fig. 6.6(c), i.e., m = 8000 kg,
θg = 5◦, Ie = 0.58 kg m2,
Ks = 990 Nm/deg)

155

engines due to cost and integration complexity, the question of how to accurately
estimate the transient engine torque becomes an important issue. If precise engine
torque information is available, an observer with a switched gain, which needs a
high-precision sensor and sensor calibration [7, 14], will no longer be necessary.

The engine torque can be estimated by mean-value engine models, which repre-
sent the engine with look-up tables [9, 10]. It takes much shorter CPU time to run
the mean value models. However, if high precision of the engine torque estimation
is required, many experiments are needed to calibrate these models; their inputs of
contain variables such as engine speed, manifold absolute pressure, injection timing
(spark advance for gasoline engines), fuel mass and water temperature.

Thermodynamics laws have also been used to estimate the engine torque [1, 9].
It is reported in [9] that using Wiebe function can give good estimation in both slow
and fast engine operation. However, it is also pointed out that when the combustion
is fast, the performance of this method may be limited.

By using complex physical models (with a characteristic timescale to the order of
every crankshaft degree), the engine torque can be estimated precisely through indi-
cated pressure estimation [20, 21]. The engine torque estimation by these methods,
however, is computationally demanding.

156

6 Clutch Disengagement Timing Control of AMT Gear Shift

Some other estimation methods using the oscillation measurement and Fourier
decomposition of ﬂywheel speed [18, 19] have also been proposed. The interested
readers are encouraged to refer to these publications.

As shown in the last chapter (Chap. 6), for a power-on gear shift sequence of
an AMT, the following actions are included: reducing engine torque, disengaging
clutch, engaging neutral gear, engaging new gear, engaging clutch, and restoring
engine torque. Shift shock may be caused by the operations of clutch disengage-
ment (together with the engine torque reduction) and clutch engagement (together
with the engine torque restoration). In Chap. 6, the clutch disengagement control
was addressed, and in this chapter, the engagement control will be discussed in de-
tail.

Both upshift and downshift will be considered. The process of downshift is quite
different from that of upshift because the engine speed has to be reduced to reach
the synchronization speed for gear upshift, while it has to be increased for gear
downshift. However, the engine speed cannot be controlled equally fast in both di-
rections [13]. In other words, in the case of downshift, the synchronization speed
may already be reached when the clutch is to be engaged, while for the upshift the
engine speed cannot be decelerated enough in a short time. Hence, gear upshift and
gear downshift have to be addressed in different control schemes.1

7.2 Power-On Upshift of AMT

In the gear upshift by engine control [13, 31], the speed synchronization of the new
gear is realized by active engine control and the gear is changed without operation of
the dry clutch. It is necessary for the engine to decelerate as fast as possible because
during the synchronization phase the traction of the wheel is totally cut off.

On the other hand, if the clutch operation is involved [19], it is easier to obtain
a short synchronization phase because when the clutch is disengaged the inertia

1This chapter uses the content of [16], with permission from Inderscience Enterprises Ltd.

H. Chen, B. Gao, Nonlinear Estimation and Control of Automotive Drivetrains,
DOI 10.1007/978-3-642-41572-2_7,
© Science Press Beijing and Springer-Verlag Berlin Heidelberg 2014

157

158

7 Clutch Engagement Control of AMT Gear Shift

Fig. 7.1 Time sequence of
the gear upshift process

moment to be synchronized is very small. Moreover, after the gear synchronization
phase, when the clutch is engaged, the friction torque can be used to compensate for
the traction interruption, which helps to reduce torque-interruption time. With such a
control scheme, a gear upshift process with the shortest possible torque-interruption
time is depicted in Fig. 7.1, which has been shown in the last chapter as Fig. 6.2.

During the ﬁrst phase, the engine torque is withdrawn, and the clutch disengage-
ment and neutral-gear engagement are carried out simultaneously to reduce the total
shift time. It has been demonstrated in the last chapter (Chap. 6) that if the clutch
is fully disengaged or the neutral gear is engaged just at the moment when Ts de-
creases to zero, the torque-reduction phase could be ﬁnished quickly while no large
driveline oscillation is stimulated [15, 31].

In the second phase, the new gear is synchronized, and then engaged, by the
synchronizer. Because the clutch has been disengaged, the inertia moment to be
synchronized (from the clutch plate to the input shaft of the synchronizer) is very
small, such as 0.05 kg m2 for heavy-duty trucks and 0.005 kg m2 for micro passen-
ger cars. Hence, the gear synchronization can be ﬁnished in a short time, such as
less than 0.1 s.

In the last phase, the clutch is engaged and the engine torque is recovered. It
is clear that if the clutch is engaged abruptly, or the engine torque is restored too
rapidly, the driveline resonances will be produced. On the contrary, if the clutch is
engaged too slowly, the torque interruption time will be enlarged. Thus, the control
objectives in this phase can be summarized as: (i) minimizing clutch engagement
time and friction losses; (ii) keeping clutch friction torque to track the request of
the driver; (iii) ensuring smooth acceleration of the vehicle. The ﬁrst and the second
requirements enforce the clutch to engage quickly and recover the traction back as
soon as possible. The third request is added to restrain the shift shock, which is
evaluated through longitudinal jerk (change rate of acceleration) [11]. During this
clutch slipping phase, the cooperation of the engine torque-down control [20, 23] is
important, and it can signiﬁcantly reduce the shift time and shift shock.

7.2 Power-On Upshift of AMT

159

It is reasonable to believe that, if done perfectly, the control strategy in Fig. 7.1
provides a shift time as short as possible. However, the different and sometimes
conﬂictive control objectives make successful clutch control a challenge. Because
gear shifting involves wide ranges of speed and torque, traditional controller de-
velopment [12, 26], which is normally based on event-driven (rule-based) control
or feedforward control, needs much calibration in order to obtain satisfying multi-
objective control performance.

Aiming to reduce the calibration requirements, the model-based control [10] is
introduced in the ﬁeld of automotive control, and among the various model-based
controller designs, Model Predictive Control (MPC) (also referred to as moving
horizon control or receding horizon control) attracts much attention [4, 6, 7, 16].
MPC became a potential feedback strategy because of its ability to handle multi-
variable systems, to take time-domain constraints into account explicitly and to deal
with multiple objectives in an optimal sense [1, 5, 29]. Although for a long time
MPC has been widely used in process industry where slow dynamics is dominant,
thanks to rapid development of computing, MPC is also adopted by fast dynamical
systems in recent years, such as in aerospace and defence [8].

In this section, therefore, after the dynamics and the control problems of gear
upshift of AMT are investigated and summarized in detail, MPC, together with the
observer techniques of the last chapter, are adopted to address these challenging
problems in a torque-based powertrain control scheme. The vehicle of interest is still
the medium-duty truck with a 6.2 l diesel engine and a 6-speed manual transmission.

7.2.1 Dynamics and Control Strategy

Torque Reduction Phase

Once a power-on upshift is initiated, as shown in Fig. 7.1, the torque transmitted
to the axle shaft Ts is reduced by the active engine torque control, followed by the
clutch disengagement and the neutral-gear engagement. If the timing of clutch dis-
engagement or neutral-gear engagement is not well controlled, the potential energy
accumulated in the driveline may lead to unwanted driveline oscillation.

In order to restrain the resonance caused by traction drop, it is suggested that the
clutch disengagement should be carried out when the driveline torque is controlled
to zero. Based on the general fact that the axle shaft is the main component of the
driveline, it is pointed out in [30–32] that if the clutch is fully disengaged or the
neutral gear is engaged when the axle shaft torque Ts reaches zero, there will be no
severe oscillations.

The control of this torque control phase has been investigated in the last chapter,

please refer to Chap. 6 for details.

160

7 Clutch Engagement Control of AMT Gear Shift

Gear Synchronization Phase

In the gear synchronization phase, the new gear is synchronized and engaged by
the synchronizer. During this phase, the traction is totally cut-off, and it is required
to ﬁnish this phase as soon as possible. The push force that can be applied on the
synchronizer is limited by the capacity of the synchronizer. Generally, the synchro-
nization can be accomplished within 0.1 s without violating the limitation of syn-
chronizer capacity.

Torque Recovery Phase

Because the deceleration rate of the engine speed is limited, after the new gear is
engaged, the engine speed is usually larger than the clutch output speed. Then during
the torque recovery phase, the clutch slips until the speed difference is synchronized,
and at the same time, the engine torque is recovered.

There are many different approaches that have been proposed for clutch slip con-
trol, such as fuzzy control [34], μ synthesis [33], map-based calibration [27], sliding
mode control [38], supervisory control [22, 25] and backstepping [14]. Because the
clutch engagement is expected to satisfy the conﬂicting requirements of minimizing
clutch wear and minimizing shift shock, an optimization-based algorithm becomes
a potential solution for this problem. For example, Hybrid Model Predictive Control
(HMPC) [4] and Linear Quadratic based optimal control [11, 18] have been used to
control the clutch engagement during start-up scenario.

Actually, when the clutch is engaged during gear shifting, the friction torque (the
inertia torque needed to pull the engine speed down) can be used as a compensa-
tion for the traction loss. Therefore, an important control objective could be added
besides the requirements of small friction losses and small shift shock, namely, re-
constructing the transmission output torque as soon as possible. This objective, as a
part of the torque-based powertrain control scheme, is critical to reducing the total
time of torque interruption, which helps to signiﬁcantly improve drivability.

Control-Oriented Modeling In order to simplify the control law, the components
of the driveline, including that of the axle shaft, are all neglected, and the driveline
is simpliﬁed as a two-mass system as shown in Fig. 7.2. The motion of the driveline
can be described by the following equations:

Tc,

˙ωe = 1
Ie
˙ωc = 1
Iv,i

Te − 1
Ie
Tc − 1
Iv,i

Tv0,

(7.1a)

(7.1b)

where ωe is the engine speed, ωc is the output speed of the clutch, Ie denotes the
inertia moment of the engine crank shaft, Iv,i denotes the equivalent inertia moment

7.2 Power-On Upshift of AMT

Fig. 7.2 Simpliﬁed driveline
model of the torque recovery
phase

from the clutch output shaft to the vehicle, at the ith gear position, Te is the engine
torque, Tc is the clutch friction torque, and Tv0 is the converted driving resistance.

Control Strategy The control objectives of the torque recovery phase can be de-
scribed in detail as

(a) The clutch slip speed is expected to decrease to zero as soon as possi-

ble, i.e., minimizing clutch engagement time;

(b) The transmission output torque is recovered back according to the demand of
the driver as soon as possible, i.e., keeping the transmission output torque track
a reference trajectory;

(c) Vehicle jerk is to be kept small, i.e., ensuring smooth vehicle acceleration.

The engine torque Te is still regulated by feedforward control, and before the clutch
is synchronized, Te is recovered back according to the demand of the driver in open
loop as an increasing ramp. On the other hand, the clutch torque Tc is controlled
to deal with the conﬂicting requirements straightforwardly. Note that the require-
ment of minimizing friction losses is not directly included because during the gear
shifting operation, the clutch engagement time is not so long as that of the start-up
maneuver, and furthermore, the friction work energy could be obviously reduced
by the cooperation of the engine torque-down control. The control of the torque re-
covery phase is regarded as a multi-objective optimization problem, which will be
solved in the framework of MPC.

To represent the control objectives quantitatively, we choose the clutch slip speed
(cid:4)ω = ωe − ωc as the system state, and the system dynamics is rewritten in the
following state-space form:

with

˙x = Acx + Bcuu + Bcd d,
y = Cx,

Ac = 0,
Bcu = − 1
Ie
(cid:27)

Bcd =

1
Ie

1
Iv,i

C = 1.

− 1
Iv,i
(cid:28)

,

,

161

(7.2)

(7.3a)

(7.3b)

(7.3c)

(7.3d)

162

7 Clutch Engagement Control of AMT Gear Shift

The control input is

and the measured (estimated) disturbance is

u = Tc,

d = (Te Tv)T .

With the above state-space form, the control requirements could be conveniently
represented by a suitably-chosen objective function, which will be seen later.

As shown in Appendix D, the model (7.2) is discretized in time with sampling

period Ts , and the discrete time model is given as

x(k + 1) = Ax(k) + Buu(k) + Bd d(k),

y(k) = Cx(k),

(7.4)

(7.5)

(7.6a)

(7.6b)

where

where

A = eAcTs ,
(cid:9)

Ts

Bu =

eAcτ dτ · Bcu,

Bd =

eAcτ dτ · Bcd .

0
(cid:9)

Ts

0

(cid:4)x(k) = x(k) − x(k − 1),
(cid:4)u(k) = u(k) − u(k − 1),
(cid:4)d(k) = d(k) − d(k − 1).

In order to introduce the integral action to reduce offset, we rewrite (7.6a), (7.6b)

in the incremental form (see Appendix D)

(cid:4)x(k + 1) = A(cid:4)x(k) + Bu(cid:4)u(k) + Bd (cid:4)d(k),

y(k) = C(cid:4)x(k) + y(k − 1),

(7.7a)

(7.7b)

The current values of the disturbances Te and Tv can be estimated, but their future
information is not predictable, hence the values of the disturbances in the control
horizon are considered constant, i.e.,

(cid:4)d(k + i) = 0 for i ≥ 1.

(7.8)

The requirement of control objective (a) concerning the engagement time can be
quantitatively represented by adding the penalty item of (cid:6)(cid:4)ω − r(cid:4)ω(cid:6)2, wherein r(cid:4)ω
may be chosen as 0 rad/s. As to the requirement (b), we can add another penalty
on (cid:6)Tc − rTc
(cid:6)2, where rTc is determined from the acceleration pedal. Finally, the

7.2 Power-On Upshift of AMT

163

request (c) could be met through introducing (cid:6)(cid:4)Tc(cid:6)2 into the objective function,
where (cid:4)Tc is the increment of Tc. Because the transmission output torque is deter-
mined by Tc, it is reasonable to believe that the vehicle jerk could be reduced if (cid:4)Tc
is restrained.

Based on the above analysis, the objective function is chosen as

J =

(cid:10)
(cid:10)γ(cid:4)ω,i

(cid:7)
(cid:4)ω(k + i|k) − r(cid:4)ω(k + i)

(cid:8)(cid:10)
(cid:10)2

Np(cid:13)

i=1

+

Nc−1(cid:13)

i=0

(cid:10)
(cid:10)γTc,i

(cid:7)
Tc(k + i|k) − rTc (k + i)

(cid:8)(cid:10)
(cid:10)2 +

Nc−1(cid:13)
(cid:10)
(cid:10)
(cid:10)2.
(cid:10)γ(cid:4)Tc,i(cid:4)Tc(k + i|k)

i=0

Along with the constructed model (7.7a), (7.7b), the objective function is rear-

ranged in the vector form as

J =

(cid:10)
(cid:10)Γy
(cid:10)
(cid:10)Γu

(cid:7)
Y (k + 1|k) − R(k + 1)
(cid:7)
U (k|k) − Ru(k)

(cid:8)(cid:10)
(cid:10)2 +

+

(cid:8)(cid:10)
(cid:10)2

(cid:10)
(cid:10)Γ(cid:4)u(cid:4)U (k)

(cid:10)
(cid:10)2,

Y (k + 1|k) =

,

R(k + 1) =

with

⎤

⎥
⎥
⎥
⎦

⎤

⎥
⎥
⎥
⎦

⎡

⎢
⎢
⎢
⎣

y(k + 1|k)
y(k + 2|k)
...
y(k + Np|k)

Np×1

⎡

⎢
⎢
⎢
⎣

⎡

⎢
⎢
⎢
⎣

u(k|k)
u(k + 1|k)
...
u(k + Nc − 1|k)

(cid:4)u(k|k)
(cid:4)u(k + 1|k)
...
(cid:4)u(k + Nc − 1|k)

Nc×1

⎤

⎥
⎥
⎥
⎦

,

Nc×1

(cid:4)U (k) =

U (k|k) =

,

Ru(k + 1) =

⎡

⎢
⎢
⎢
⎣

r(cid:4)ω(k + 1)
r(cid:4)ω(k + 2)
...
r(cid:4)ω(k + Np)

⎡

⎢
⎢
⎢
⎣

rTc (k + 1)
rTc (k + 2)
...
rTc (k + Nc)

⎤

⎥
⎥
⎥
⎦

⎤

⎥
⎥
⎥
⎦

Parameter Np is the prediction horizon and Nc is the control horizon, which satisﬁes
Nc ≤ Np.

(7.9)

(7.10)

Np×1

(7.11a)

,

,

Nc×1

(7.11b)

(7.11c)

164

7 Clutch Engagement Control of AMT Gear Shift

Matrices Γy and Γu are the weighting factors, which are shown as

⎡

⎢
⎢
⎢
⎣

⎡

⎢
⎢
⎢
⎣

γ(cid:4)ω,1
0
...
0

γTc,1
0
...
0

Γy =

Γu =

0
γ(cid:4)ω,2
...
0

. . .
. . .
. . .
. . .

⎤

⎥
⎥
⎥
⎦

0
0
...
γ(cid:4)ω,Np
⎤

Np×Np

0
γTc,2
...
0

. . .
. . .
. . .
. . .

⎥
⎥
⎥
⎦

0
0
...
γTc,Nc

Γ(cid:4)u =

⎡

⎢
⎢
⎢
⎣

γ(cid:4)Tc,1
0
...
0

0
γ(cid:4)Tc,2
...
0

. . .
. . .
. . .
. . .

Nc×Nc
⎤

0
0
...
γ(cid:4)Tc,Nc

⎥
⎥
⎥
⎦

Nc×Nc

,

(7.12a)

,

(7.12b)

.

(7.12c)

Finally, the optimization problem of the clutch engagement control during gear

shifting is described as follows:

(cid:7)
x(k), (cid:4)U (k), Np, Nc

(cid:8)

min
(cid:4)U (k)

J

subject to (7.7a), (7.7b) and

(cid:4)umin(k + i|k) ≤ (cid:4)u(k + i|k) ≤ (cid:4)umax(k + i|k),

i = 0, 1, . . . , Nc − 1.

(7.13a)

(7.13b)

The input constraint (7.13b) is included because in practice the change rate of clutch
torque, ˙Tc, is restricted.

It is clear that the weighting matrices Γy , Γu and Γ(cid:4)u will inﬂuence the dynamic
behavior of gear shifting. Matrix Γy forces the clutch to be engaged as soon as
possible, Γu keeps the transmission output torque tracking the driver’s request, and
Γ(cid:4)u means the penalty on the shift shock. Therefore, relatively higher Γy results
in a fast gear shift, and lesser Γy leads to a slow one, but with smoother dynamic
performance.

From now on, the model predictive controller will be derived. According to the
basics of MPC (see Appendix D), by iterating (7.7a), (7.7b), we can infer the se-
quences of outputs to be predicted, and present them in the form of

Y (k + 1|k) = Sx(cid:4)x(k) + Iy(k) + Sd (cid:4)d(k) + Su(cid:4)U (k),

(7.14)

7.2 Power-On Upshift of AMT

165

where
⎡

Sx =

⎤

⎥
⎥
⎥
⎥
⎦

⎢
⎢
⎢
⎢
⎣

CA
CA2 + CA
...
i=1 CAi

#Np

Su =

#Nc

⎡

⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎣

#
2

CBu
i=1 CAi−1Bu
...
i=1 CAi−1Bu
...
i=1 CAi−1Bu

#Np

⎤

⎥
⎥
⎦

⎡

⎢
⎢
⎣

1
1
...
1

,

I =

,

Sd =

Np×1

Np×1

⎡

⎢
⎢
⎢
⎣

CBd
CABd + CBd
...
i=1 CAi−1Bd

#Np

⎤

⎥
⎥
⎥
⎦

0
0
...

#Nc−1

0
CBu
...
i=1 CAi−1Bu
...
i=1 CAi−1Bu

#Np−1

0
0
...

. . .
...
. . .

. . .
. . .
. . .
. . .
. . .
. . .

CBu
...
#Np−Nc+1

i=1

CAi−1Bu

Np×Nc

,

Np×2
⎤

⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎦

.

Moreover, the control vector U (k|k) can be represented in the incremental from

U (k|k) = INc u(k − 1|k − 1) + L(cid:4)U (k),

(7.16)

where

INc

=

,

L =

.

(7.17)

⎡

⎢
⎢
⎢
⎣

⎤

⎥
⎥
⎥
⎦

1
1
...
1

Nc×1

⎡

⎢
⎢
⎢
⎣

1 0
1 1
...
...
1 1

0
0
. . .
. . .

. . .
. . .
. . .
. . .

⎤

⎥
⎥
⎥
⎦

0
0
...
1

Nc×Nc

Then, if we do not consider the inequality constraints (7.13b), we can solve
the optimality problem (7.13a), (7.13b), and get the optimal solution of (cid:4)U ∗(k) ∈
RNc×1 at time k, by calculating the gradient of the objective function over the inde-
pendent variable (cid:4)U (k) and setting it to zero. The result reads

(cid:4)U ∗(k) =

(cid:7)
y ΓySu + Γ T
S T
u Γ T
(cid:22)
u Γ T
S T

×

y ΓyEp(k + 1|k) + Γ T

u ΓuL

(cid:4)uΓ(cid:4)u + LT Γ T

(cid:8)−1

u ΓuL
(cid:7)
Ru − U (k − 1)

(cid:8)(cid:23)
,

(7.18)

with Ep(k + 1|k) being calculated by

Ep(k + 1|k) = R(k + 1) − Sx(cid:4)x(k) − Iy(k) − Sd (cid:4)d(k).

(7.19)

If the input constraint is considered, the optimization problem (7.13a), (7.13b)
subject to inequality constraints (7.13b) can be formulated as a quadratic program-
ming (QP) problem

(cid:4)U (k)T H (cid:4)U (k) − G(k + 1|k)T (cid:4)U (k)

min
(cid:4)U (k)
s.t. Cu(cid:4)U (k) ≥ b(k + 1|k),

(7.20a)

(7.20b)

166

where

7 Clutch Engagement Control of AMT Gear Shift

y ΓySu + Γ T
H = S T
u Γ T
(cid:7)
u Γ T
S T

(cid:4)uΓ(cid:4)u + LT Γ T

u ΓuL,
(cid:7)
Ru − INc u(k − 1|k − 1)

u ΓuL

(cid:8)(cid:8)
,

G(k + 1|k) = 2
(cid:22)

Cu =

y ΓyEp(k + 1|k) + Γ T
(cid:23)
T ,
⎤

b(k + 1|k) =

−Im×m Im×m
⎡
−(cid:4)umax(k + 1|k)
...
−(cid:4)umax(k + 1|k)
(cid:4)umin(k + 1|k)
...
(cid:4)umin(k + 1|k)

⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎣

⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎦

.

2Nc×1

It is clear that H ≥ 0, hence the optimal solution of the optimization problem
exists, which is denoted as (cid:4)U ∗(k). By considering above input constraints and
solving the quadratic programming (QP) problem (7.20a), (7.20b), we can get the
control sequence (cid:4)U ∗(k). Only the ﬁrst element of (cid:4)U ∗(k) is used to determine
the control signal u(k)

u(k|k) = (cid:4)u∗(k|k) + u(k − 1|k − 1).

Then, the real control command of clutch torque Tc,req is set as u(k)

and is applied to the plant. This procedure is repeated at each sampling interval.

After the desired clutch torque Tc,req is determined, the clutch engagement force

Fc is calculated by

Tc,req(k) = u(k),

Fc =

Tc,req
μd Rc

,

(7.21)

(7.22)

(7.23)

where μd is the dynamic friction coefﬁcient. Note that in practice, the torque trans-
missibility of a dry clutch could be much more complex, please refer to [35] for
details.

The control algorithm of the torque recovery phase is ﬁnally summarized in the

following steps:

Step 1: At time k, determine the desired clutch torque Tc,req(k) by the model pre-
dictive controller, namely, by the control law (7.18) or by solving the QP
problem (7.20a), (7.20b), and then by (7.21) and (7.22);

Step 2: Implement the clutch engagement force Fc(k) calculated from (7.23);
Step 3: If the clutch has been engaged to a certain level (the clutch will be locked up
soon), recover the engine torque Te by pre-determined feedforward control.

7.2 Power-On Upshift of AMT

167

Step 4: If the clutch is locked up (the speed difference reaches zero), ﬁnish the gear
shift control by ramping up the clutch force and continue to recover the
engine torque Te back to the driver’s demand; if the clutch is slipping, go
to Step 1 and repeat the optimal calculation at next sampling time k + 1.

7.2.2 Simulation Results

In this section, the proposed control scheme, including the shaft torque observer
and the model predictive controller, is programmed using MATLAB/Simulink and
combined with the complete powertrain simulation model used in the previous two
chapters through co-simulation.

The simulation results shown in Fig. 7.3 is a power-on 1st-to-2nd gear upshift
process, where the periods of 4–4.3 s, 4.3–4.42 s, and 4.42–4.8 s correspond to
the torque reduction phase, the gear synchronization phase and the torque recov-
ery phase, respectively, which can be seen clearly from the signal of the axle shaft
torque Ts .

From 4 s, the shift process is started by the reduction of engine torque Te, fol-
lowed by the decrease of the axle shaft torque Ts . During the torque reduction phase
(4–4.3 s), Ts is estimated by the observer designed in Chap. 5, and the clutch en-
gagement force is reduced according to the estimated Ts . The observer gain used
here is L = [−2000, 35]. At 4.3 s, when the axle shaft torque Ts approaches zero,
the clutch is totally disengaged and the synchronizer of the 1st gear is disengaged.
The vehicle jerk da is given to evaluate the shift shock, which is less than 15 rad/s3.
After the transmission is disconnected, the gear synchronization phase begins. It
costs the synchronizer 0.12 s, i.e., from 4.3 to 4.42 s, to synchronize and engage the
2nd gear.

Once the 2nd gear is engaged, it enters the torque recovery phase, and the model
predictive controller is used to control the clutch. The parameters of the model pre-
dictive controller are chosen as follows: the prediction horizon and the control hori-
zon are Np = 10 and Nc = 2, respectively; the weighting factors are γ(cid:4)ω,i = 25,
γTc,i = 15, γ(cid:4)Tc,i = 1; the reference values are (cid:4)ωref = 0 rad/s and Tc,ref = 200 Nm;
the input constraints are (cid:4)umin = −1200 Nm/s and (cid:4)umax = 1200 Nm/s. It can be
seen that the clutch torque tracks the desired value Tc,ref rapidly and smoothly, and
as a result, severe driveline oscillation [37] is successfully avoided after the clutch
is synchronized. Moreover, the tracking control of the clutch friction torque con-
tributes to the fast re-instatement of the vehicle traction.

At last, some important evaluation metrics [37] of shift quality are shown in

Table 7.1.

The total shift time, including the three phases, is 0.8 s, and thanks to the fast
torque reduction (by the torque observer) and fast torque re-instatement (by MPC),
the torque interruption time (deﬁned as the time when the traction torque is less than
a half of the full torque) is 0.37 s, which is very short for present AMT vehicles.

It should be noted that in the simulations there is no clutch and gear selection
delay (assuming that the clutch wear condition is known precisely, and there is no

168

7 Clutch Engagement Control of AMT Gear Shift

Fig. 7.3 Simulation results
of 1st-to-2nd upshift:
(A) torque reduction phase
with axle shaft torque
observer; (B) gear
synchronization phase;
(C) torque recovery phase
with MPC

Table 7.1 Main evaluation
metrics of shift quality of
1st-to-2nd upshift

Total shift time

Torque-interruption time

Peak jerk

Friction loss

0.8 s

0.37 s
15 m/s3
855 J

free clearance between the ﬂywheel and the clutch plate when operating the clutch;
moreover, the gear shift actuators are mounted in parallel, and the gear selection
operation is not included), and the shift time may by enlarged in practice. Even when

7.3 Power-On Downshift of AMT

169

Fig. 7.4 Shift shock of
1st-to-2nd upshift with
feedforward control

the clutch and gear selection delay is considered and the shift time is increased by
0.2 s, the shift time is still short enough for the gear shift of trucks with AMT.

On the other hand, the maximum value of the longitudinal jerk during the gear
shifting is 15 m/s3. Generally speaking, the acceptable jerk is 10–25.5 m/s3 for res-
onances with frequency of f ≤ 3 Hz, and 10–37.2 m/s3 for resonances of frequency
f > 3 Hz [17]. Hence it can be seen that the jerk level of the shift is good enough.
The friction energy of the 1st-to-2nd upshift is 855 J, which is small enough for the
shift process of a mid-size truck.

For comparison, Fig. 7.4 gives the results of the 1st-to-2nd upshift without the
torque observer and model predictive controller. It can be seen that, if the feedfor-
ward control law is not perfectly calibrated, severe shift shock and oscillations of
the shaft torque Ts may be introduced.

Power-on 3rd-to-4th gear upshift is also simulated, and the results are shown in
Fig. 7.5. The peak jerk is 15 m/s3, and the torque interruption time is 0.25 s, which
satisﬁes the drivability requirements very well.

7.3 Power-On Downshift of AMT

In the case of downshift, the engine speed must be increased (it is decreased for up-
shift) to meet the synchronization speed of the new gear. Hence the control scheme
of the downshift is much different from that of the upshift. Moreover, in order to
minimize the shift time, it is preferable to increase the engine speed as quickly as
possible. Therefore, when the clutch begins to engage, even if the synchronization
speed is met, the no-lurch condition [16] of the clutch is not satisﬁed (because the
input speed is increasing while the output speed is slightly decreasing). The question

170

7 Clutch Engagement Control of AMT Gear Shift

Fig. 7.5 Simulation results
of 3rd-to-4th upshift:
(A) torque reduction phase
with axle shaft torque
observer; (B) gear
synchronization phase;
(C) torque recovery phase
with MPC

of how to engage the clutch quickly and smoothly becomes a challenging control
task.

In this section, the dynamics and control of AMT downshift will be investigated
and summarized in detail. With the proposed control scheme, the engine speed in-
creases quickly to meet the synchronization speed of the new gear, and MPC used
in the above will be extended to control the clutch engagement under such a highly
transient condition. Because one of the control objectives of MPC is to make the
clutch friction torque track the driver’s desired value, a gear downshift process with
the shortest possible torque-interruption time could be obtained.

7.3 Power-On Downshift of AMT

171

Fig. 7.6 Time sequence of
power-on downshift process

7.3.1 Dynamic Process of Power-On Downshift

A power-on downshift sequence is shown in Fig. 7.6. The ﬁrst phase begins with the
clutch disengagement, i.e., slipping-opening of the clutch (C1), and ﬁnishes when
the neutral gear is engaged (G1). When the clutch is disengaged, the engine torque
is regulated (E1) and the engine torque does not necessarily need to be reduced at
the beginning of gear shifting because the engine speed has to be improved to reach
the synchronization speed (note that in the case of the upshift, the engine torque has
to be reduced when the clutch is disengaged). The neutral gear is engaged at the
same time when the clutch is totally disengaged.

In the second phase, the new gear is synchronized, and then engaged, by the

synchronizer (G2).

At the beginning of the last phase, the torque recovery phase, it is assumed that
the engine speed has reached a level not less than the clutch output speed. Then
the clutch slips until it is engaged (C2), and at the same time the engine torque is
temporarily reduced to reduce friction loss and shift time, i.e., the co-called “torque-
down control” (E2) is applied. Finally, when the clutch is to be locked-up, the au-
thority of the engine torque control is transmitted according to the demand of the
driver (E3).

Finally, the whole shift process of AMT downshift is summarized in the follow-

ing steps:

Step 1: Disengage the clutch, and regulate the engine speed at the same time, so
that intensive shift shock could be prevented and the engine speed could be
increased to reach the new gear synchronization speed;

Step 2: Engage the neutral gear at the end of clutch disengagement;
Step 3: Engage the new gear and continue to regulate the engine speed to be not

less than the clutch output speed;

172

7 Clutch Engagement Control of AMT Gear Shift

Step 4: Engage the clutch, and at the same time reduce the engine torque temporar-

ily by pre-determined feedforward control;

Step 5: Recover the engine torque back according to the driver’s demand before the

clutch is synchronized.

7.3.2 Control Problem Description

During the ﬁrst phase, the clutch disengagement phase, when the clutch state is
transferred from slipping to opening, the output torque of the transmission is deter-
mined by the friction torque of the clutch. Hence the clutch could be disengaged
through feedforward control to provide smooth torque reduction, and consequently,
intensive torque ﬂuctuation of the driveline could be avoided. At the same time, the
engine torque is regulated to increase the engine speed to reach the target value (not
less than the synchronization speed of the new gear). Because this control objective
is not very strict, PID control or feedforward control could be used. Here, the focus
is put on the third phase (clutch engagement control), and the engine is controlled
through feedforward control.

In the second phase, the speed synchronization phase, the new gear is engaged,
and the engine is still controlled in open loop to increase the engine speed to the
target level, namely, not less than the synchronization speed of the new gear.

With the above control scheme of the ﬁrst two phases, when the third phase, the
torque recovery phase, begins, the engine speed is increasing quickly. The clutch
has to be engaged under such a highly transient state. It is clear that if the clutch
is engaged abruptly, or the engine torque is restored too rapidly, the driveline res-
onances will be produced. On the contrary, if the clutch is engaged too slowly, the
torque interruption time will be enlarged. Thus the control objectives in this phase
can be summarized as follows:

(i) Minimizing clutch engagement time and friction losses;
(ii) Keeping clutch friction torque to track the driver’s request;
(iii) Ensuring smooth acceleration of the vehicle.

The ﬁrst and the second requirements enforce the clutch to engage quickly and re-
cover the traction back as soon as possible. The third request is added to restrain the
shift shock, which is evaluated through longitudinal jerk (change rate of accelera-
tion) [11].

As mentioned in the last section, during this clutch slipping phase, the coopera-
tion of the engine torque-down control [20, 23] is important, and it can reduce the
shift time and shift shock signiﬁcantly. In order to simplify the to-be-designed con-
troller, the engine is still controlled in open loop, and the same as in the last section,
MPC will also be adopted to address the multi-objective optimal problem of the
clutch engagement control of the AMT downshift process.

7.3 Power-On Downshift of AMT

173

7.3.3 Controller Design of Torque Recovery Phase

When the clutch slips, the motion of the driveline can be described by the same
equations as in the above upshift process:

Tc,

˙ωe = 1
Ie
˙ωc = 1
Iv,i

Te − 1
Ie
Tc − 1
Iv,i

Tv0.

(7.24a)

(7.24b)

Then based on the simpliﬁed model and the MPC design method of the above
section, the clutch control strategy of the torque recovery phase of the downshift
could be obtained, which is omitted here.

7.3.4 Simulation Results

Power-on downshift always happens under the following two driving conditions:

(A) The driver pushes the accelerator pedal suddenly to get large driving torque;
(B) The vehicle is driven under large throttle angle, but the driving resistance be-
comes large (such as entering a road with slope), and the present gear cannot
provide enough driving torque.

Simulation Results of Maneuver A

Figure 7.7 gives the simulation results of the ﬁrst maneuver. The transmission is
shifted from the 2nd gear to the 1st gear, wherein the fully loaded vehicle is driving
on a slope of 5 degrees. The periods of 13.2–13.4 s, 13.4–13.5 s, and 13.5–14 s
are respectively the torque reduction phase, the gear synchronization phase, and the
torque recovery phase.

Before 13.2 s, the vehicle is driven in the 2nd gear, and the accelerator pedal angle
is small. From 13.2 s, the driver wants to accelerate fast and presses the accelerator
pedal. Then from 13.2 s, the shift process begins, and the clutch is disengaged using
open-loop control. At the same time, the engine torque is also regulated in open-
loop to increase the engine speed. At 13.4 s, the clutch is fully disengaged, and the
neutral gear is also engaged.

Next, from 13.4 to 13.5 s follows the gear synchronization phase, and the 1st gear
is engaged. After that, the engine speed is increased to 230 rad/s, which is greater
than the clutch output speed 200 rad/s.

Finally, one has the torque recovery phase, and the designed model predictive
controller is used to control the clutch. The parameters of the model predictive con-
troller are chosen as follows: the prediction horizon and the control horizon are

174

7 Clutch Engagement Control of AMT Gear Shift

Fig. 7.7 Simulation results
of power-on 2nd-to-1st
downshift (pressing of gas
pedal)

Np = 10 and Nc = 2; the weighting factors are γ(cid:4)ω,i = 10, γTc,i = 7, γ(cid:4)Tc,i = 1;
the reference values are (cid:4)ωref = 0 rad/s and Tc,ref = 400 Nm; the input constraints
are (cid:4)umin = −1000 Nm/s and (cid:4)umax = 1000 Nm/s. It can be seen that the clutch
torque tracks the desired value Tc,ref rapidly and smoothly, and as a result, severe
driveline oscillation [37] is successfully avoided after the clutch is synchronized.
Moreover, the tracking control of clutch friction torque contributes to the fast re-
instatement of the vehicle traction.

Some important evaluation metrics [37] of shift quality are shown in Table 7.2.

7.4 Notes and References

Table 7.2 Main evaluation
metrics of shift quality of
2nd-to-1st downshift

Total shift time

Torque-interruption time

Peak jerk

Friction loss

175

0.8 s

0.35 s
17.5 m/s3
1984 J

The total shift time, including the three phases, is 0.8 s, and thanks to fast torque
re-instatement (by MPC), the torque interruption time (deﬁned as the time when the
traction torque is less than a half of the full torque) is 0.35 s, which is very short for
present AMT vehicles.

The maximum value of the longitudinal jerk during the gear shifting is 17.5 m/s3,
and the friction energy of the 1st-to-2nd upshift is 1984 J, which are acceptable for
a gear shift of mid-size trucks.

Simulation Results of Maneuver B

Figure 7.8 gives the simulation results of the second maneuver, wherein the vehicle
drives from ﬂat to grade road. At ﬁrst, the vehicle is driving in the 4th gear on a
ﬂat road, and from 13 s, it enters a slope with an angle of 5 degrees. From 15 s, it
is judged by the transmission control unit (TCU) that the 4th gear cannot provide
enough driving torque anymore, and it begins to shift to the 3rd gear.

The torque reduction phase, the gear synchronization phase and the torque re-
covery phase correspond respectively to the periods of 15–15.2 s, 15.2–15.3 s and
15.3–15.7 s.

At last, some important evaluation metrics [37] of shift quality are shown in

Table 7.3.

7.4 Notes and References

The dynamics and control of the gear shift of AMT vehicles are described and ad-
dressed under the torque-based powertrain control scheme. One of the ﬁndings is to
use the clutch friction torque as compensation for the traction interruption, which
is realized through the critical enabling technology, i.e., model predictive control
(MPC), which contributes to a shorter torque interruption time.

In the future work, multi-model MPC or Hybrid MPC [2, 3, 24] can be used
to address the clutch engagement control problem because the engagement process
from slipping to locked-up is essentially a process of state switching [4].

Another important issue of MPC in automotive drivetrain is solving the MPC
optimization problem online at each sampling time. In order to speed up the com-
putation of MPC, hardware architectures which are capable of parallel computation
are under active investigation [9]. Field programmable gate array (FPGA) [21] pro-
vides a compromise between the special-purpose application-speciﬁc integrated cir-
cuit hardware and general-purpose processors, and implementing MPC on a FPGA

176

7 Clutch Engagement Control of AMT Gear Shift

Fig. 7.8 Simulation results
of power-on 4th-to-3rd
downshift (driving into a
slope)

Table 7.3 Main evaluation
metrics of shift quality of
4th-to-3rd downshift

Total shift time

Torque-interruption time

Peak jerk

Friction loss

0.8 s

0.3 s
11 m/s3
1582 J

sounds promising. Some early attempts in this direction are reported in [28, 36],
wherein the authors explore the implementation of the MPC technology into an
FPGA chip.
As shown in Chaps. 4 and 7, clutch engagement is an important and difﬁcult control
issue. The performance requirements for the clutch engagement during the start-up
process include: minimizing clutch lockup time, minimizing friction losses during
the slipping phase and ensuring smooth acceleration of the vehicle, i.e., enhanc-
ing the driving comfort. However, these requirements are sometimes conﬂicting,
for example, the drivability enhancement results in longer clutch lockup time. Al-
though there are many different control strategies proposed for the control of dry
clutch engagement in the literatures, the control methods are model-based, which
rely heavily on the explicit process modeling. The characteristics of AMT clutch
during start-up process are complex; moreover, the system characteristics change
along with the variation of driving conditions and long-term aging. For example,
the damping coefﬁcients of rotational shafts change greatly according to environ-
mental temperature. Long-term aging and variation of driving conditions still bring
about signiﬁcant modeling errors. Due to these characteristics of the start-up pro-
cess of AMT vehicles, an explicit model of the system is hard to construct. Even
though one can be obtained, it is not easy to deal with the high order of the sys-
tem. Moreover, due to the physical constraints of the driveline system mechanism,
the maximum friction clutch torque provided from the clutch is restricted, and the
range of engine speed is limited.

With the development of computer technology, a lot of data can be obtained in
modern industries, thus, the data-driven methods present not only a new avenue
but also new challenges both in theories and applications [5, 6, 10, 12]. In [2, 4],
data-driven predictive control algorithm is proposed as an example of the efﬁcient
data-driven control methods. It elegantly combines data-driven subspace identiﬁca-
tion and predictive control. For its inherent characteristics, a data-driven predictive
controller computes the control action directly based on the input–output data only
and does not require any explicit model of the system.

In this chapter, for the control problem of the start-up process of AMT vehicles,
a data-driven predictive controller is designed. Moreover, the time-domain hard con-

H. Chen, B. Gao, Nonlinear Estimation and Control of Automotive Drivetrains,
DOI 10.1007/978-3-642-41572-2_8,
© Science Press Beijing and Springer-Verlag Berlin Heidelberg 2014

179

180

8 Data-Driven Start-Up Control of AMT Vehicle

straints of the input and the output are taken into account. The simulation results
show that AMT clutch with the data-driven predictive controller works very well,
and this process meets the control requirements, i.e., fast clutch lockup time, small
friction losses, and preservation of driving comfort.1

8.2 Control Requirements

The start-up of AMT vehicles, using a friction clutch, is a very important process
for drivability and fuel consumption. The core of the starting control is the control
of the clutch, and during the start-up process of AMT vehicles from stop, the driv-
eline performance described above heavily depends on the engagement of the dry
clutch. The considered control problem of the clutch engagement during the start-up
process of AMT vehicles is that the clutch speed ωc has to track the engine speed
ωe by the effect of the friction clutch torque Tc. Moreover, the clutch engagement is
expected to satisfy the different and sometimes conﬂicting objectives:
• Fast clutch lockup time;
• Small friction losses during the slipping phase;
• Preservation of driver comfort, i.e., smooth acceleration of the vehicle.

In addition, as for the physical constraints of the driveline system mechanism, time-
domain output constraints are represented by the restricted engine speed ωe. The
friction clutch torque Tc, considered as a control input, is bounded because of the
actuator saturation. Moreover, because the frequency response of the actuator is
limited, the control move cannot change very quickly.

The criterion for minimizing the difference between a given reference and a pre-
dicted output is usually chosen in a quadratic form, and a control move u(·) can
also be included to penalize control efforts. In order to achieve the start-up control,
we choose the friction clutch torque Tc as the control input u, the clutch slip speed
(cid:4)ω = ωe − ωc as the output y and the engine speed as the constrained output yb.
Then, the optimization problem with input and constrained output constraints of
clutch control during start-up process is described as follows:

(cid:7)
y(k), (cid:4)uf (k), Np, Nc

(cid:8)

Problem 8.1

min
(cid:4)uf (k)

J

subject to

umin(k + m) ≤ u(k + m) ≤ umax(k + m), m = 0, 1, . . . , Nc − 1,
(8.1a)
(cid:4)umin(k + m) ≤ (cid:4)u(k + m) ≤ (cid:4)umax(k + m), m = 0, 1, . . . , Nc − 1, (8.1b)
min(k + q) ≤ yb(k + q) ≤ yb
yb

q = 1, 2, . . . , Np,

max(k + q),

(8.1c)

1This chapter uses the content of [7], with permission from IEEE.

8.2 Control Requirements

181

where

J =

(cid:10)
(cid:10)Γy

(cid:7)
ˆyf (k + 1) − Re(k + 1)

(cid:8)(cid:10)
(cid:10)2 +

(cid:10)
(cid:10)Γu(cid:4)uf (k)

(cid:10)
(cid:10)2,

(8.2)
the predictive control output sequence ˆyf (k + 1), predictive constrained output se-
quence ˆyb
f (k + 1) and the future input sequence uf (k) are deﬁned as follows:
⎤

⎤

⎡

⎡

ˆyf (k + 1|k) (cid:3)

ˆyb
f (k + 1|k) (cid:3)

⎢
⎢
⎢
⎣

⎡

⎢
⎢
⎢
⎣

⎥
⎥
⎥
⎦ ,

ˆy(k + 1|k)
ˆy(k + 2|k)
...
ˆy(k + Np|k)
u(k|k)
u(k + 1|k)
...
u(k + Nc − 1|k)

⎤

⎥
⎥
⎥
⎦ .

uf (k) (cid:3)

⎢
⎢
⎢
⎣

ˆyb(k + 1|k)
ˆyb(k + 2|k)
...
ˆyb(k + Np|k)

⎥
⎥
⎥
⎦ ,

At time k, the control input sequence (cid:4)uf (k) to be optimized can be deﬁned as

(cid:4)uf (k) (cid:3)

⎡

⎢
⎢
⎢
⎣

(cid:4)u(k|k)
(cid:4)u(k + 1|k)
...
(cid:4)u(k + Nc − 1|k)

⎤

⎥
⎥
⎥
⎦ .

The reference sequence of the output is as follows:

Re(k + 1) =
⎡

(cid:22)

r(k + 1)

r(k + 2)
⎤

. . .

r(k + Np)
⎡

(cid:23)
T ,

Γy =

⎢
⎢
⎢
⎣

γy,1
0
...
0

0
γy,2
...
0

. . .
. . .
. . .
. . .

⎥
⎥
⎥
⎦,

0
0
...
γy,Np

Γu =

⎢
⎢
⎢
⎣

γu,1
0
...
0

0
γu,2
...
0

. . .
. . .
. . .
. . .

⎤

⎥
⎥
⎥
⎦.

0
0
...
γu,Nc

Np and Nc are the prediction horizon and the control horizon, respectively, satisfy-
ing Np ≥ Nc.

From the analysis of physical meanings, it is clear that

• J1 = (cid:6)Γy( ˆyf (k + 1) − Re(k + 1))(cid:6)2 forces the slip speed to converge to zero,

i.e., to minimize clutch lockup time and minimize the friction losses;

• J2 = (cid:6)Γu(cid:4)uf (k)(cid:6)2 controls the change rate of the control action, and ensures
smooth acceleration of the vehicle because Tc determines the acceleration of
the vehicle, and hence vehicle jerk can be reﬂected by ˙Tc, which corresponds
to (cid:4)uf (k);

• The constraints of control input u(k) and (cid:4)u(k) reﬂect the ability of actuator,
and the constraints of (cid:4)u(k) has the effect of keeping the clutch engagement
smooth and the jerk small; the constraints of system output yb(k) avoids stalling
the engine.

182

8 Data-Driven Start-Up Control of AMT Vehicle

Obviously, it is contradictive to minimize J1 and J2 simultaneously, so in order
to trade off the two objectives, the weighting factors Γy and Γu are given. They
are chosen to ensure small facing wear and good dynamic performance. Matrix Γy
forces the launch process to be ﬁnished, while Γu means the penalty on the shift
shock.

Therefore, based on input–output data obtained from the driveline simulation
model, which was constructed by AMESim and has been used in the last three
chapters, the data-driven predictive control method is adopted to control the start-up
process of AMT vehicles. Moreover, it takes time-domain constraints into account
explicitly and deals with multiple objectives in a somehow optimal sense.

8.3 Data-Driven Start-Up Predictive Controller of AMT Vehicle

In order to deal with the control problem arising from the start-up process of AMT
vehicles and to meet the control requirements mentioned above, a data-driven pre-
dictive controller will be designed based on the input–output data in this section.
The subspace predictor is obtained directly from the input–output data (the clutch
friction torque Tc and the clutch slip speed (cid:4)ω) without an explicit physical model
of the system, which predicts the future dynamic behavior of the system. Moreover,
the predictive output equation is derived based on predictive control methodology.
Considering the system constraints, the optimal control sequence is determined by
solving the optimization problem online. The optimal output is applied to the driv-
eline system as the feedback control signal. According to the basic principles of
predictive control, this process is repeated at each sampling time. The details of the
design process of the data-driven predictive controller will be given next.

8.3.1 Subspace Linear Predictor

A data-driven predictive control algorithm combines the results from subspace iden-
tiﬁcation methods within the ﬁeld of predictive control, an illustration of the data-
driven predictive control method is shown in Fig. 8.1. The novelty of the data-driven
predictive control algorithm over other control methods is that it does not use the
traditional, explicit parametric description of the system such as transfer function or
state-space model in the development of the controller. Instead, it uses the subspace
linear predictor to predict the future output values of the system. The derivation of
the subspace linear predictor via input–output data is presented in Appendix F.

8.3 Data-Driven Start-Up Predictive Controller of AMT Vehicle

183

Fig. 8.1 Illustration of the data-driven predictive control method

Fig. 8.2 Input and output
data for identiﬁcation

8.3.2 Data-Driven Start-Up Predictor

Design of Input–Output Identiﬁcation Data

In order to achieve the data-driven start-up predictive controller, we will design the
identiﬁcation data which can excite dynamics relevant to the control goal, such as
the vibration of clutch, drive shaft and tyre. The absolute exciting signals for the
AMT clutch are designed during the vehicle start-up and applied to the complete
AMESim powertrain model. The identiﬁcation data are obtained in conditions of
straight ﬂat road (α = 0◦), ﬁxed throttle opening (θth = 60◦), invariable gear ratio
(it1 = 7.57) and lightly loaded vehicle (m = 6000 kg). The open-loop data of the
input Tc and output (cid:4)ω for identiﬁcation are shown in Fig. 8.2.

184

8 Data-Driven Start-Up Control of AMT Vehicle

Data-Driven Predictor

The open-loop system measurements of the input, the output and the constrained
output u(k), y(k) and yb(k) for k ∈ {0, 1, 2, . . . , 2i + j − 2} are collected through
the simulation results of Fig. 8.2. The data block Hankel matrices Up, Uf , Yp and
Yf for u(k) and y(k) are constructed as follows:

⎡

⎢
⎢
⎢
⎣

⎡

⎢
⎢
⎢
⎣

Up =

Yp =

u0
u1
u1
u2
...
...
ui−1 ui

uj −1
uj
...

. . .
. . .
. . .
. . . ui+j −2

y0
y1
...
yi−1

y1
y2
...
yi

. . .
. . .
. . .
. . .

yj −1
yj
...
yi+j −2

⎤

⎥
⎥
⎥
⎦,

⎤

⎥
⎥
⎥
⎦,

Uf =

Yf =

⎡

⎢
⎢
⎢
⎣

ui
ui+1
...
u2i−1

⎡

⎢
⎢
⎢
⎣

yi
yi+1
...
y2i−1

ui+1
ui+2
...
u2i

ui+j −1
ui+j
...

. . .
. . .
. . .
. . . u2i+j −2

yi+1
yi+2
...
y2i

. . .
. . .
. . .
. . .

yi+j −1
yi+j
...
y2i+j −2

⎥
⎥
⎥
⎦,

where p and f denote the past and future block observations. The matrices above
have i-block rows and j -block columns. The constrained output Hankel matrices
p and Y b
Y b
According to the deviation of subspace linear predictor presented in Appendix F,
we will recursively develop the subspace input–output matrix equations in the ﬁeld
of subspace identiﬁcation as follows:

f for yb(k) can be formed by the same way.

⎤

⎥
⎥
⎥
⎦,

(8.3)
⎤

(8.4)

(8.5)

(8.6)

ˆYf = LwWp + LuUf ,
ˆY b
wW b
p
f

= Lb

+ Lb

uUf ,

In terms of Eqs. (F.29) and (F.30), we can obtain the subspace predictor coefﬁcients
Lw and Lu. The terms ˆY b
p and Lb
u of constrained output yb(k) can be
obtained in the way of (F.14) to (F.30). The data-driven predictor (8.5) and (8.6) is
applied to predict the output of the system by the paste input and output data as well
as the future input data.

w, W b

f , Lb

Validation Data

In order to validate the effectiveness of the predictor (8.5), that is, whether it can
reﬂect the system dynamics, a group of signal data are used to test the identiﬁed
subspace matrices, and the data are plotted in Fig. 8.3. From Fig. 8.3 it is clear that
the identiﬁed predictive outputs (cid:4)ω∗ (the dotted line) matches the true outputs (cid:4)ω
(the solid line) of the model very well. It shows that the predictor can accurately
predict the future output values of the system.

8.3 Data-Driven Start-Up Predictive Controller of AMT Vehicle

185

Fig. 8.3 Validation data

8.3.3 Predictive Output Equation

Aiming to deal with the optimization problem described in Sect. 8.2, this section
will derive the predictive output equation based on the data-driven method and the
predictive control method. To guarantee regulation with zero steady-state error for
the reference input, the subspace matrix incremental input–output expressions for
the system are

(cid:4) ˆYf = Lw(cid:4)Wp + Lu(cid:4)Uf ,
(cid:4) ˆY b
w(cid:4)W b
p
f

u(cid:4)Uf ,

= Lb

+ Lb

and

where

(cid:4) ˆyf (k) = Lw(1 : Np, :)

+ Lu(1 : Np, 1 : Nc)(cid:4)uf ,

(cid:4) ˆyb

f (k) = Lb

w(1 : Np, :)

+ Lb

u(1 : Np, 1 : Nc)(cid:4)uf (k),

(cid:5)

(cid:5)

(cid:4)

(cid:4)

(cid:4)yp
(cid:4)up

(cid:4)yb
p
(cid:4)up

(cid:4)

(cid:5)

,

(cid:4)Yp
(cid:4)Up

(cid:4)Wp =
(cid:22)

(cid:4)yp =

(cid:22)

(cid:4)y(k − i + 1) (cid:4)y(k − i + 2)

. . . (cid:4)y(k)

(cid:4)up =

(cid:4)u(k − i) (cid:4)u(k − i + 1)

. . . (cid:4)u(k − 1)

(8.7)

(8.8)

(8.9)

(cid:23)
T ,
(cid:23)
T ,

(cid:4)W b

p and (cid:4)yb
p can be obtained in the same way as Eqs. (8.7) to (8.9).
Then, the vector of the optimal prediction of the future outputs can be expressed

as follows [4]:

186

8 Data-Driven Start-Up Control of AMT Vehicle

ˆyf (k + 1) = y(k) + L(cid:4)

w (1 : Np, :)

+ SNp,Nc (cid:4)uf (k)

= F + SNp,Nc (cid:4)uf (k),

(8.10)

f (k + 1) = yb(k) + Lb(cid:4)
ˆyb

w (1 : Np, :)

+ Sb

Np,Nc

(cid:4)uf (k)

(cid:4)

(cid:5)

(cid:4)yp
(cid:4)up

(cid:4)

(cid:5)

(cid:4)yb
p
(cid:4)up

= Fb + Sb

Np,Nc

(cid:4)uf (k),

where SNp,Nc is the Npm × Ncl dynamic matrix containing the step response coef-
ﬁcients/Markov parameters and formed from Lu,

SNp,Nc

= Lu(1 : Np, 1 : Nc)

(cid:22)

y(k) =

y(k)

y(k)

. . .

⎤

⎥
⎥
⎥
⎦ ,

0
0
...
1

⎡

⎢
⎢
⎢
⎣

. . .
. . .
. . .
. . .

1 0
1 1
...
...
1 1
(cid:23)
T ,

y(k)

k(cid:13)

i=1

L(cid:4)
w (k, :) =

Lw(k, :)

1 ≤ k ≤ Np,

F = y(k) + L(cid:4)

w (1 : Np, :)

(cid:4)

(cid:5)

.

(cid:4)yp
(cid:4)up

(8.11)

(8.12)

(8.13)

(8.14)

w is constructed from Lw, and F is the free response for the case of measured

L(cid:4)
disturbances,

In the same way, yb(k), Lb(cid:4)
as Eqs. (8.11) to (8.14).

w (1 : Nph, :), Fb and Sb

Np,Nc

about ˆyb

f can be obtained

8.3.4 Data-Driven Predictive Controller Without Constraints

It is assumed that the constraints of the system are ﬁrst neglected. By differentiat-
ing (8.2) with respect to (cid:4)uf (k) and equating it to zero, the feedback plus feedfor-
ward control law becomes
(cid:4)uf (k) =

(cid:7)
Re(k + 1) − F

(cid:8)−1ST

+ Γ T

y ΓySNp,Nc

(cid:7)
ST
Np,Nc

u Γu

Np,Nc

Γ T

(cid:8)
.

Only the ﬁrst element of the (cid:4)uf (k) is implemented, and the calculation is repeated
at each time instant. Hence, at time instant k, the control law is given as follows:

(cid:4)uk = K(cid:4)

(cid:7)
Re(k + 1) − F

(cid:8)
,

(8.15)

where

(cid:22)

(cid:23)(cid:7)

K(cid:4) =

1 0 . . .

0

ST
Np,Nc

Γ T

y ΓySNp,Nc

+ Γ T

u Γu

(cid:8)−1ST

.

Np,Nc

8.3 Data-Driven Start-Up Predictive Controller of AMT Vehicle

187

8.3.5 Data-Driven Predictive Controller with Constraints

Now, it is considered that the constraints of the system take the form given in
Eqs. (8.1a) to (8.1c). When Eq. (8.10) is substituted into (8.2), the following equa-
tion is obtained:
J =

(cid:7)
Re(k + 1)

T Γ T

y Γy

(cid:7)
(cid:8)
Re(k + 1) − F − SNp,Nc (cid:4)uf (k)
(cid:8)
− F − SNp,Nc (cid:4)uf (k)

+ (cid:4)uf (k)T Γ T

u Γu(cid:4)uf (k)

= (cid:4)uf (k)T ST

Np,Nc
+ (cid:4)uf (k)T Γ T

y ΓySNp,Nc (cid:4)uf (k)
u Γu(cid:4)uf (k) + E(k + 1)T Γ T

Γ T

y ΓyE(k + 1)

− 2E(k + 1)T Γ T

y ΓySNp,Nc (cid:4)uf (k),

(8.16)

where E(k + 1) = Re(k + 1) − F . By arranging Eq. (8.16) and combining the con-
straints, the optimization problem (8.1a)–(8.1c) can be formulated as a quadratic
programming (QP) problem [8, 9]:

(cid:4)uf (k)T H (cid:4)uf (k) + G(k + 1|k)T (cid:4)uf (k),

1
2

min
(cid:4)uf (k)
s.t. Cu(cid:4)uf (k) ≥ b(k + 1|k),

where

H = 2

(cid:7)
ST
Np,Nc
G(k + 1|k) = −2ST

Γ T

y ΓySNp,Nc

+ Γ T

u Γu

(cid:8)
,

Γ T
y ΓyE(k + 1),

Np,Nc

$

Cu =

−I

(−Sb

Np,Nc

(Sb

Np,Nc

)T

%

T

,

(8.17)

(8.18a)

(8.18b)

(8.19)

b(k + 1|k) =

(8.20)

I −LT LT
⎡

⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎢
⎣

−(cid:4)umax(k)
...
−(cid:4)umax(k + m − 1)
−(cid:4)umin(k)
...
−(cid:4)umin(k + m − 1)
u(k − 1) − umax(k)
...
u(k − 1) − umax(k + m − 1)
umin(k) − u(k − 1)
...
umin(k + m − 1) − u(k − 1)

Fb − Y b
−Fb + Y b

max(k + 1)
min(k + 1)

)T
⎤

⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎥
⎦

.

188

8 Data-Driven Start-Up Control of AMT Vehicle

Moreover, L, Y b

max and Y b
⎡

min in (8.19) and (8.20) are given by

L =

⎤

⎥
⎥
⎥
⎦ ,

0
0
...
1
⎤

⎥
⎥
⎥
⎦ ,

⎢
⎢
⎢
⎣

⎡

⎢
⎢
⎢
⎣

1
1
...
1

0
1
...
1

. . .
. . .
. . .
. . .
min(k + 1)
yb
min(k + 2)
yb
...
min(k + p)
yb

Y b
min(k + 1) =

Y b
max(k + 1) =

⎡

⎢
⎢
⎢
⎣

max(k + 1)
yb
max(k + 2)
yb
...
max(k + p)
yb

⎤

⎥
⎥
⎥
⎦ .

It is clear from (8.18a), (8.18b) that H ≥ 0, hence the optimal solution of the opti-
mization problem exists, which is denoted as (cid:4)uf (k). Moreover, it is strictly con-
vex if H > 0. By considering input and output variable constraints (8.1a)–(8.1c)
and solving the quadratic programming (QP) problem (8.17), the control sequence
can be obtained. Only the ﬁrst element of (cid:4)uf (k) is used to determine the control
signal uf (k), and then, it is applied to the plant. This procedure is repeated at each
sampling interval.

8.4 Simulation Results

The designed data-driven controller is programmed using MATLAB/Simulink and
tested on the complete AMESim powertrain model used in the past three chapters.
Before the actual simulation results are presented, the choices for the simulation
settings and tuning parameters will be described ﬁrst. The parameters of data-driven
predictive controller are chosen as follows: the numbers of rows and columns of the
data block Hankel matrices in Eq. (8.3) are i = 50, j = 400; the prediction horizon
and the control horizon are Np = 50 and Nc = 10; the weighting factors (8.2) are
γy,i = 0.13, γu,i = 1. The main control requirement is to make the clutch speed ωc
track the engine speed ωe as soon as possible, i.e., to make the clutch slip speed
(cid:4)ω converge to the demanded reference value Re(k + 1). Taking the rapidity and
smoothness of the start-up process into account, r(k + i) = βiy(k), i = 1, 2, . . . , Np
are deﬁned, where β ∈ [0, 1] is an adjustable parameter. The smaller the β, the faster
the start-up.

8.4.1 Controller Test Under Nominal Conditions

The friction work Wf of clutch losses is one of the most important control objectives
during the start-up process of vehicles. The friction work Wf of the clutch under

189

Fig. 8.4

Fig. 8.5

Fig. 8.8

Fig. 8.9

Fig. 8.10

4352

8967

2211

4413

25165

8.4 Simulation Results

Table 8.1 The friction work
of clutch Wf (in J)

Fig. 8.4 Simulation results
of the nominal driving
condition with the controller
neglecting constraints (ﬁxed
throttle opening θth = 60◦;
vehicle mass m = 6000 kg;
road slope α = 0◦)

different driving conditions is calculated as follows:

Wf =

Tc(cid:4)ω dt,

(cid:9)

tf

t0

(8.21)

where t0 and tf are the start and stop time of clutch engagement, respectively. The
clutch friction work Wf of the whole simulation results based on the designed con-
troller are given in Table 8.1.

In this part, the designed data-driven predictive controllers are tested under the
nominal conditions. First, the start-up of a vehicle with the designed data-driven
predictive controller (8.15) which neglects constraints is simulated, and the results
are shown in Fig. 8.4.

190

8 Data-Driven Start-Up Control of AMT Vehicle

Fig. 8.5 Simulation results
of the nominal driving
condition with the controller
considering constraints (ﬁxed
throttle opening θth = 60◦;
vehicle mass m = 6000 kg;
road slope α = 0◦)

It can be seen that the end-time of the launch process is at about 0.8 s, which
shows that the clutch engages rapidly, and the total friction work Wf is about 4352 J
shown in Table 8.1, but the maximum jerk da (change rate of the acceleration) is up
to about 12 m/s3. It should be noted that after the clutch is engaged, at about 1.4 s,
the clutch torque Tc is increased by a pre-determined pattern to make the clutch lock
up reliably, this process is shown in the following ﬁgures after the vertical dashed
line.

At the same time, due to the vehicle physical constructive characteristics, the en-
gine speed ωe and the clutch friction torque Tc are restricted. For a typical medium-
duty truck, the maximum engine speed ωe is about 300 rad/s and the minimum is
about 55 rad/s which ensures that the engine works normally, and the maximum fric-
tion clutch torque is about 700 Nm. The control input constraints are umin = 0 Nm
and umax = 700 Nm, and the amplitudes of constrained output yb
= 55 rad/s and
= 300 rad/s. Moreover, according to the frequency bandwidth of the clutch
yb
max
actuator, the constraints of the control incremental are chosen as (cid:4)umin = −30 Nm
and (cid:4)umax = 30 Nm. Under the same driving conditions of Fig. 8.4, the start-up of
the vehicle having the designed data-driven predictive controller with constraints by
solving (8.17) is simulated, and the results are shown in Fig. 8.5.

min

8.4 Simulation Results

Fig. 8.6 (cid:4)u in case of
data-driven predictive
controller with (without)
constrains

191

Compared to Fig. 8.4, it can be seen that the clutch is engaged smoothly, and the
maximum jerk da is reduced from about 12 m/s3 to about 3 m/s3, i.e., the comfort
requirement of the driver is well satisﬁed. The reason for this is that the constraints
of (cid:4)u play a major role in these processes, the speciﬁc values of (cid:4)u in the case of
a data-driven predictive controller with (without) constrains are shown in Fig. 8.6.
From Fig. 8.6, it is clear that the maximum (cid:4)u of the data-driven constrained pre-
dictive controller is about 3 Nm, but in the case of a data-driven predictive controller
without constraints, the maximum (cid:4)u is 8 Nm.

Moreover, Table 8.1 shows that the total friction work Wf of Fig. 8.5 is 8967 J,
which is more than total friction work Wf of Fig. 8.4 because the data-driven con-
strained predictive controller aims to make the clutch engagement smooth at the
expense of some total friction work.

8.4.2 Controller Test Under Changed Conditions

The data-driven predictive controller is gained from the input–output data from the
driveline model. It is necessary to test the proposed controller under the driving
conditions that deviate from the nominal driving setting, wherein the vehicle mass,
the road grade, the engine throttle angle are varied.

Medium Throttle Opening

Compared with the nominal conditions, the engine throttle angle θth is adjusted as
shown in Fig. 8.7, and it tries to simulate the operation of a driver.

Based on the data-driven predictive controller without constraints, the simulation

results are obtained and shown in Fig. 8.8.

From Fig. 8.8, it is clear that the engine speed we is smaller than the minimum
55 rad/s, which violates the constraints and will make the engine stop, meaning a
failed launch. At the same time, the jerk of the driveline during the start-up process

192

8 Data-Driven Start-Up Control of AMT Vehicle

Fig. 8.7 Medium throttle
opening

Fig. 8.8 Simulation results
of the different driving
conditions with the controller
neglecting constraints
(medium throttle opening
θth = 45◦; vehicle mass
m = 6000 kg; road slope
α = 0◦)

is about 8 m/s3, the clutch engagement is at about 1 s and the total friction work Wf
is 2211 J.

Under the same driving conditions of Fig. 8.8 and considering the same con-
straints as in Fig. 8.5, the simulation results obtained by using the data-driven con-
strained predictive controller are shown in Fig. 8.9.

Comparing the results of Fig. 8.9 with those of Fig. 8.8, the most important result
is that the engine speed we does not touch the lower bound of 55 rad/s which ensures

8.4 Simulation Results

Fig. 8.9 Simulation results
of the different driving
conditions with the controller
considering constraints
(medium throttle opening
θth = 45◦; vehicle mass
m = 6000 kg; road slope
α = 0◦)

193

that the engine works in good operation region, and the vehicle is launched success-
fully, though the total friction work Wf is bigger than that in Fig. 8.8. Furthermore,
it shows that the maximum jerk da in Fig. 8.9 is obviously smaller than the one in
Fig. 8.8. The good results of the data-driven predictive controller mentioned above
are credited to its capacity of dealing with constraints. On the whole, the data-driven
constrained predictive controller is better than the one without constraints, due to
the proposed controller’s natural ability to handle physical constraints arising in the
actual application.

Full Throttle Opening, Fully Loaded Mass and Steep Road Slope

The variation of the vehicle mass and the road slope results in a change of the vehicle
dynamics. Hence, a simulation of a fully loaded vehicle launched on a slope is
carried out. The results are shown in Fig. 8.10, where the driving condition settings
are as follows: the engine throttle opening is adjusted the same as Fig. 8.7, but the
opening is full at 1 s, i.e., θth = 90◦; the vehicle mass is increased from 6000 to
8000 kg; the road grade angle is varied from 0◦ to 5◦.

194

8 Data-Driven Start-Up Control of AMT Vehicle

Fig. 8.10 Simulation results
of the different driving
conditions with the controller
considering constraints (full
throttle opening θth = 90◦;
fully loaded mass
m = 8000 kg; steep road
slope α = 5◦)

It should be noted that at the beginning of the start-up, because of the large
change of the vehicle mass and the road slope, the variation of the clutch speed
is not smooth. However, it is shown that the vehicle can still be launched success-
fully with acceptable driveline shock da and friction losses shown in Table 8.1. This
illustrates the potential beneﬁts of the designed data-driven predictive controller un-
der different uncertainties.

At last, from Table 8.1, it is clear that the friction work of Figs. 8.8 and 8.9 are
much less than that of Figs. 8.4 and 8.5, respectively. The reason is that in Figs. 8.4
and 8.5, the nominal setting, the engine throttle angle is set to a greater value of
60◦, which requires larger clutch torque, and consequently results in much larger
friction losses. Therefore, the friction work of Fig. 8.10 is up to 25165 J, which is
reasonable for the full-throttle opening.
Although this chapter has considered some uncertainties, such as throttle opening,
vehicle mass and road grade, and tested the robustness of the proposed controller,
much deeper investigations are needed, including data-driven controller based on
the online input–output data, which is used to deal with the uncertainties and dis-
turbances resulting from the variation of driving conditions and long-term aging.
The data-driven predictive control method is being applied to solve many industry
issues in recent years [1, 3, 11]. For more detailed information about the data-driven
predictive control method, please refer to [2, 4–6, 10, 12].
