Principles of Modeling and Simulation Processes

With the deﬁnition of system notion and the development of a mathematical
device to realize the connection between input parameters, output parameters, and
operating parameters of the system modeling process began to be increasingly used
in all areas related to human activities.

At present, generally system theory deﬁnes the concept of “system” as being a
well-ordered and structured multitude of interlinked elements well determined
within the system (but unrelated to the external environment of the system).

Connection between the external environment and the system is achieved
through use of system parameters that characterize the input/output relationship of
the entities presented (environment/system).

Expression of relations between input and output values of the systems is
achieved by using sets of values associated to input/output values or by using
mathematical functions.

The system is characterized by allocated sets of sizes that are assigned certain
attributes. Static attributes are characterized by ﬁxed values (constants) called
“system parameters.” Dynamic attributes receive different values (for different
times) and are called “descriptive variables of the system.”

Further, the association between constant and variable sizes (considered to be
inner entities of the system) is reached to a combination of a physical system with
an abstract mathematical model.

Depending on the possibility of initiating a modeling process (the award of a
model to real phenomena), systems can generally be classiﬁed according to the sets
of variable values and depending on the structure.

Classiﬁcation of the systems based on the set of values of variables is done
considering the variable types (analog or digital) and after the variation in time of
variables (continuous, discontinuous, and discrete).

Further, the concept of “model” is a representation of the essential characteristics
of a system, in order to determine its behavior and also of variation of output
parameters to the input parameters.

Modeling, as activity and as processes of developing an accurate model related

to a source system, follow the following steps (Fig. 1.1):
(cid:129) Building of basic (initial) model;
(cid:129) Model analysis;
(cid:129) Comparing results;
(cid:129) Correction of model.

The immediate and major advantages of using models to study the behavior of a

system are:
(cid:129) Availability for study and analysis are larger than of systems source;
(cid:129) Lower cost and time of implementation, testing, and experimentation;
(cid:129) Ease of changing the structure of the model (depending on the intended

purpose);

(cid:129) Provides clues about the behavior change of source system, based on the var-

iation in the variables considered in the study.

1 Principles of Modeling and Simulation Processes

3

Fig. 1.1 Basic structure of
modeling theory

Once the observations based on the source system can provide a model to
characterize its evolution, according to the variation of the variables considered, it
can proceed to the next phase, namely the simulation process.

The simulation process can be deﬁned, in general terms, as all functional and/or
operational activities on a model that representing the image of a source system
necessary to be analyzed.

Because the model attached to a source system consists of one or more math-
ematical expressions (in the form of equations that describe the relationships
between model components), simulation processes are performed using computer
simulation.

There are a total of three main activities in the realization of a simulation

process: development, testing, and operation (Fig. 1.2).

The development work refers to the integration of mathematical models that
deﬁne the system state and variables into informatics codes (lines of code, pro-
grams) that can be processed further using computers.

In the testing phase of the model is required a check of its behavior at speciﬁed
the initial
the model

takes into account

implementation of

conditions (if
assumptions).

The results should be analyzed carefully to achieve assessing the fairness of the
model, by analogy with the data obtained direct from source system (under certain
known conditions).

If the model is valid and the simulation process is functional then the third phase

is run, the operating activities of the model.

The operation of model may possibly impose some conditions on the source
system studied, conditions that would not have been possible through direct
experiments on the physical source system.

The results should be analyzed and used both to improve the model and to
optimize source system behavior depending on the initial objectives of the research.

4

1 Principles of Modeling and Simulation Processes

Fig. 1.2 General structure of
a simulation process

Nowadays, the concept of ‘mobility’ best characterizes human society. The
mobility of goods, people, and ideas actively participate directly in the techno-
logical, economic, social, and cultural progress of humanity (as a whole).

In the transport domain there are speciﬁc requirements relating to environmental
protection, which require vehicle manufacturers to make necessary arrangements to
ﬁnd technological solutions to integrate the transport domain in a general and
necessary structure of human society development on a sustainable basis [1].

The transportation sector is currently responsible for over 20 % of emission of
greenhouse pollutants, emissions that directly affect the climatic conditions of the
planet. Increased emissions in conjunction with achieving the maximum degree of
natural regeneration of the environment, lead to serious problems related to pol-
lution [2–4]. Naturally, the European Union (mainly) formulated policies and
actions to reduce emissions from activities associated with human society.

The major challenge in this regard, for the transport domain, is to reduce

immediately greenhouse gas emissions (GHG) discharged into the atmosphere.

Because pollutant emissions from vehicles are caused by combustion of a fuel
(generally fossil fuels), increasing the efﬁciency and effectiveness of vehicle’s
powertrain is constantly the focus of attention of researchers from the automotive
industry.

Competitiveness and competition in this ﬁeld compel the use of means and
methods of research and development that is economically viable (reduced costs
and time to market deployment of new and improved technological solutions).

Modeling various natural or artiﬁcial processes and phenomena in engineering is
achieved by applying and performance of complex mathematical models (that take

1 Principles of Modeling and Simulation Processes

5

into account multiple hypotheses and wide range of determinants factors) using
ultrafast
informatics programs on electronic processing in computerized
environments.

For this, numerical methods are applied to discretize equations that deﬁne the
condition and/or evolution of the considered technical system. Using high potential
and processing speed of information available from today’s computers (for analysis
of complex data sets), equations that offer multiple connects between different
factors of different sizes can be determined in real time.

Using this method, the solving procedures of complex problems in processing
are substantially reduced, to temporal sequences of discretized sizes, with imme-
diate beneﬁt to achieve economies of time and labor. Mathematical developed code
is implemented further as one of the appropriate programming languages.

Some of these programming languages have the advantage of object-oriented
programming capacity and accessible syntax for user. Applications developed using
programming codes allow simulation of functional systems and sub-systems that
compose the functional structure of a vehicle.

Using software tools existing in this area, simulations can be developed, con-
trolled, and coordinated (at the same time) to achieve results and solutions to
optimize and improve the performance of vehicle’s technical systems and are
analyzed in terms of performance and operating efﬁciency.

These applications allow or build linear or nonlinear models (depending on the
complexity and processing potential of software program), computer processing
lines and matrix, characterized by the boundary conditions at various points (areas),
and by the conditions of the initial state of the considered technical system.

Modeling and detailed analysis of the powertrain system has been, is, and will be
considered permanently in research worldwide. Due to complexity of the technical
structure of a powertrain, research focus is on the study of a single component, or of
the entire powertrain system, or by studying the interactions of this with the general
constructive-functional system of a vehicle [5, 6].

Walker and Zhang [7] studied the inﬂuence of engine torque harmonics, model
degrees of freedom, and dual mass ﬂywheels on the transient response of a vehicle
powertrain equipped with a dual clutch transmission for two powertrain models.
Their results by modeling and simulation process indicate that degrees of freedom,
engine model, and ﬂywheel model all contribute signiﬁcantly to variance in pow-
ertrain response under each conﬁguration.

Kouroussis et al. [8] present an effective formulation to model an automatic
transmission (based on Del’s method), to evaluate the vehicle performance in the
early development stage of a powertrain design. The efﬁciency and accuracy of
modeling process was validated taking into consideration the application of sim-
ulation results on two realistic cases (Chrysler 45RFE and Aisin Warner 55–50 SN
powertrains).

To analyze the advantages of the hybrid powertrain based on the component
characteristics and to deﬁne an optimum powertrain conﬁguration with respect
to the applied drive cycle, a combined simulation and analytical analysis of the

6

1 Principles of Modeling and Simulation Processes

energy conversion efﬁciency in parallel hybrid powertrains were performed by
Katrasnik [9].

Damiani et al. [10] show that a vehicular powertrain can be thought as an energy
conversion chain, each component being characterized by its self-efﬁciency.
Through a validated MATLAB®/Simulink™ model (designed to indicate the
powertrain energy breakdown), simulations were carried out to evaluate the fuel
saving associated to a series of powertrain management logics to minimize engine
losses, to recover the reverse power in deceleration and braking, and to eliminate
the uselessness of engine cycles.

Klein et al. [11] performed an original approach on powertrain modeling and
simulation. Their research validates an artiﬁcial wavelet neural network (or wavenet
model) combined with artiﬁcial bee colony optimization (as a swarm intelligence
paradigm), to model powertrain components of a truck engine. Simulation results
show that the artiﬁcial wavelet neural network approach can be a promising tech-
the proposed artiﬁcial bee colony
nique in powertrain components modeling;
approach allows modeling the dynamical behavior of powertrain components of a
truck engine.

From the point of view of emerging technologies for transports, a novel hybrid
genetic algorithm for modeling and simulation of the powertrain and control
parameters in plug-in hybrid electric bus (PHEB), for simultaneous optimization
with trade-off between economy and dynamic performance was proposed by Li
et al. [12].

Moreover, the study by Wang et al. [13] shows the effects of different EV
powertrain topologies on the energy efﬁciency, vehicle ownership cost, and life-
cycle greenhouse gas (GHG) emissions of EVs. Energy-based vehicle simulation
model proposed include the regenerative braking function and battery degradation
prediction method to be established ﬁrst. An optimization scheme was used to
combine the energy-based vehicle simulation model in order to minimize the
electric energy consumption under various scenarios and driving conditions.

Ryu et al. [14] focused on possibilities to use a novel fuzzy controller based on
an adaptive membership function for optimum power management of a fuel cell
hybrid electric vehicle (FCHEV). The fuzzy controller is optimized using a genetic
algorithm, and the optimization process is accomplished through simulation (for a
given driving cycle) in order to achieve the best performance in terms of minimum
fuel consumption and State of Charge (SOC) maintenance.

Xie et al. [15] studied the effects a novel fuel cell Li-ion battery hybrid pow-
ertrain using a direct parallel structure with an ultracapacitor bank on vehicle’s
efﬁciency. ADVISOR simulation tool based on the vehicle model parameters was
used to simulate the powertrain’s energy ﬂow for a speciﬁc driving cycle (UDDS
cycle).

The random examples presented above are just a few examples of the many
research studies that use speciﬁc tools for modeling and simulation processes of a
vehicle’s component (s) and/or technical systems.

It can be noted that the modeling and simulation processes of any technical
system are important tools in research work, offering a large number of data that can

1 Principles of Modeling and Simulation Processes

7

be investigated and then used further to optimize the functional and technical
parameters of the studied system.

Modeling and simulation approach of technical and functional characteristics
that inﬂuence the powertrain is widely presented in the subsequent chapters of this
book. For modeling and simulation processes the software packages CRUISE
(AVL List GmbH) and CarMaker (IPG GmbH) were used. These software pack-
ages were developed for precision applications in analysis and dynamic perfor-
mance of a vehicle’s technical systems.

Detailed methods, methodologies, and approaches to the immediate application
to analyze the vehicle’s
of modeling and simulation processes are presented,
technical systems and/or sub-systems of which it is composed, in order to provide a
powerful tool to any researcher that wants to use immediately and apply these
modeling and simulation software packages in research activities.

The structure of each chapter allows any researcher to make easy the process of
modeling and simulation of a vehicle’s technical system, according to its speciﬁc
needs and requirements. This is possible due to detailed presentation of the algo-
rithms for construction, operation, and running of the presented models.

References

1. Mariasiu F (2013) Consumers’ Attitudes Related to Biofuel Use in Transportation. Int Rev

Manage Mark 3(1):1–9

2. Mariasiu F (2012) Energy Sources Management and Future Automotive Technologies:

Environmental Impact. Int J Energy econ Policy 2(4):342–347

3. Iclodean CD, Mariasiu F (2014) Possibility to increase biofuels energy efﬁciency used for

compression ignition engines fueling, TEM J 3(1):36–41

4. Moldovanu D, Burnete N (2013) Computational ﬂuid dynamics simulation of a single cylinder

research engine working with biodiesel. Therm Sci J 17(1):195–203

5. Varga BO (2012) Energy management of electric and hybrid vehicles dependent on

powertrain conﬁguration. Central Eur J Eng 2(2):253–263
Iclodean C (2014) Numerical

6. Varga BO,

investigation of hybrid electric vehicle’s

performance. Proc Int Cong Sci Manage Automot Transp Eng SMAT 1:27–24

7. Walker PD, Zhang N (2013) Modelling of dual clutch transmission equipped powertrains for

shift transient simulations. Mech Mach Theory 60:47–59

8. Kouroussis G, Dehombreux P, Verlinden O (2015) Vehicle and powertrain dynamics analysis

with an automatic gearbox. Mech Mach Theory 83:109–124

9. Katrasnik T (2007) Hybridization of powertrain and downsizing of IC engine—A way
to reduce fuel consumption and pollutant emissions—Part 1. Energy Convers Manag
48:1411–1423

10. Damiani L, Repetto M, Prato AP (2014) Improvement of powertrain efﬁciency through energy

breakdown analysis. Appl Energy 121:252–263

11. Klein CE, Bittencourt M, dos Santos Coelho L (2015) Wavenet using artiﬁcial bee colony
applied to modeling of truck engine powertrain components. Eng Appl Artif Intell 41:41–55
12. Li L, Zhang Y, Yang C, Jiao X, Zhang L, Song J (2015) Hybrid genetic algorithm-based
optimization of powertrain and control parameters of plug-in hybrid electric bus. J Franklin
Inst 352:776–801

8

1 Principles of Modeling and Simulation Processes

13. Wang B, Xu M, Yang L (2014) Study on the economic and environmental beneﬁts of different

EV powertrain topologies. Energy Convers Manag 86:916–926

14. Ryu J, Park Y, Sunwoo M (2010) Electric powertrain modeling of a fuel cell hybrid electric
vehicle and development of a power distribution algorithm based on driving mode recognition.
J Power Sources 195:5735–5748

15. Xie C, Xu X, Bujlo P, Shen D, Zhao H, Quan S (2015) Fuel cell and lithium iron phosphate
battery hybrid powertrain with an ultra capacitor bank using direct parallel structure. J Power
Sources 279:487–494

Chapter 2
Mathematics Behind the Models

The theory that is presented in this chapter represents the
mathematical models developed by AVL CRUISE team and
points out the characteristic of each vehicle component used in
the models created in the following chapters.

2.1 Vehicle (V)

The Vehicle is one of the main objects in a model. This component contains general
data of the vehicle, such as nominal dimensions and weights. One and only one
vehicle component is needed in the model. Road resistances and dynamic wheel
loads are calculated for road and dynamometer runs based on the dimensions and
the load state. The wheel loads are calculated, taking motion into account (e.g.,
from acceleration, aerodynamic drag, rolling resistance). The aerodynamic, rolling,
climbing, acceleration, and total resistance are calculated [1].

2.1.1 Properties

Switch Variation
With this switch the vehicle can be given free for variation. For the vehicle the drag
coefﬁcient and the vehicle mass can be varied. The setup of the variation parameters
is done in the folder.

Switch Output
If this switch is activated a result output for this component is made.

Driving Resistance Switches
Activation of one or more of the following ﬁve driving resistance models. The
associated resistance model can be calculated in one or more AVL CRUISE

© Springer International Publishing Switzerland 2015
B.O. Varga et al., Electric and Plug-In Hybrid Vehicles,
Green Energy and Technology, DOI 10.1007/978-3-319-18639-9_2

9

10

2 Mathematics Behind the Models

Calculation Task when selected. Also the required data input for the activated
resistance models has to be done. In every task the selection button ‘Driving
Resistance’ determines which of the activated models will be really used in the task
calculation. Every model which is chosen in a task, has also to be activated in the
vehicle properties window, otherwise the calculation stops with an error message.

Switch Driving Resistance: Physical
The driving resistance is deﬁned by the physical values (drag coefﬁcient, rolling
resistance).

Switch Driving Resistance: Function with Reference Vehicle
The driving resistance is deﬁned by three parameters. The deﬁned values are
converted from the reference vehicle to the actual one.

Switch Driving Resistance: Characteristic with Reference Vehicle
The driving resistance is deﬁned in a characteristic as function of the vehicle
velocity. The deﬁned values are converted from the reference vehicle to the actual
one.

Switch Driving Resistance: Function without Reference Vehicle
The driving resistance is deﬁned by three parameters. The deﬁned values are used
without a reference vehicle.

Switch Driving Resistance: Characteristic without Reference Vehicle
The driving resistance is deﬁned in a characteristic as function of the vehicle
velocity. The deﬁned values are used without a reference vehicle.

Selection Button Driving Resistance Input Options

Standard
From Coasting Characteristic
From Deceleration Interval Characteristic

‘Normal’ input of the required values for Resistance Function or Resistance Table.

Selection Button Driving Resistance Input Options

Standard
From Coasting Characteristic
From Deceleration Interval Characteristic
When the switches ‘Driving Resistance: Function with Reference Vehicle’ or
‘Driving Resistance: Characteristic with Reference Vehicle’ are activated,
the
option ‘Driving Resistance from Coasting Characteristic’ can be chosen. By
the
selecting a conversion button (located at
Resistance Function/Resistance Table is calculated using the values of the Coasting
Characteristic. The Coasting Characteristic is deﬁned by vehicle velocity,
depending on the time since the coasting measurement started.

the Coasting Characteristic),

2.1 Vehicle (V)

11

Selection Button Driving Resistance Input Options

Standard
From Coasting Characteristic

From Deceleration Interval Characteristic
This option is available when the switches ‘Driving Resistance: Function with
Reference Vehicle’ or ‘Driving Resistance: Characteristic with Reference Vehicle’
are activated.

The required values are converted from the so-called ‘Deceleration Interval
Characteristic’; every input row of this characteristic deﬁnes the time for a decel-
eration (e.g., velocity interval = 10 km/h) around a speciﬁed vehicle velocity. For
example, the deﬁned time at 120 km/h corresponds to the time needed for the
vehicle to decelerate from 125 to 115 km/h. Similar to the conversion from coasting
characteristic, there are options for ‘Truncate left’ and ‘Truncate right’ to cut off
data which might have a bad inﬂuence on the conversion results. Additionally, there
is an input ﬁeld for the deﬁnition of the velocity interval.
Selection Button Aerodynamic Coefﬁcients

Drag Coefﬁcient Constant
Additional Aerodynamic Coefﬁcients—Data Bus Dependent
Drag Characteristic

The constantly deﬁned drag coefﬁcient is used for calculation.
Selection Button Aerodynamic Coefﬁcients

Drag Coefﬁcient Constant
Additional Aerodynamic Coefﬁcients—Data Bus Dependent
Drag Characteristic

Further option for modiﬁcation of aerodynamic parameters (drag coefﬁcient, lift
coefﬁcient front axle and lift coefﬁcient rear axle) which can be modiﬁed according
to any Data Bus set value:

that means opening and closing of aerodynamic spoiler as function of any Data Bus set
value (with hysteresis).

Remark: for stationary iterations the upper hysteresis values are used.
Selection Button Aerodynamic Coefﬁcients

Drag Coefﬁcient Constant
Additional Aerodynamic Coefﬁcients—Data Bus Dependent
Drag Characteristic

In this case the drag coefﬁcient
depending on the value of the Data Bus input x-axis for drag modiﬁcation.

is interpolated from the drag characteristic,

12

2 Mathematics Behind the Models

Switch Lift Effect Consideration
If this switch is activated, the wheel lift forces are considered in the calculation.
Otherwise there are no lift coefﬁcients required (lift coefﬁcient front axle/lift
coefﬁcient rear axle) and the lift forces are internally set to zero. This switch can
only be activated if the Selection Button Driving Resistance is set to physical or to
Function with reference vehicle or to Function without reference vehicle.

Switch Cornering
With this switch the cornering functionality is activated. In the tasks Cycle Run,
Full Load Acceleration, Cruising and Braking this function can also be activated
and then the Characteristic Values under the inﬂuence of the curvature radius for
cornering are computed.

Cornering can only be calculated for the vehicle. If there is a trailer or multi-axle

trailer in the model, this part of the calculation will not be started.
Switch Crosswind Inﬂuence
Depending on cornering it is possible to consider the inﬂuence of crosswind.
Switch Cold Start Correction 1–5
If one or more of these switches are activated, the cold start factor is multiplied with
the actual fuel consumption if all other selections are done in the right way.
Switch Cycle 1–5
With these switches, up to 5 cycles can be activated for deﬁnitions of temperature
characteristics.
Switch Temperature Curve 1–5
With these switches, up to 5 temperature characteristics can be activated for every
activated cycle.

For the tasks ‘Cycle Run’ and ‘Cruising,’ these temperatures can be connected
via Data Bus to different components like the engine. In all these components, the
selections have to be set properly so that the temperature from the Data Bus is used,
e.g., in the engine, Temperature has to be set to from Data Bus.

2.1.2 User-Deﬁned Variables

VN

Gas Tank Volume

m3

The Tank Volume is the gas (fuel) tank volume of the vehicle. It is used to
calculate the distance range the vehicle can reach with the actual fuel consumption.

ΔTunder-bonnet
Δpunder-bonnet

Temperature Difference Engine/Environment
Pressure Difference Engine/Environment

K
mbar

2.1 Vehicle (V)

13

The temperature and the pressure difference serve for the correction of the intake
conditions. The differences in the conditions of the environment and the engine
compartment have to be deﬁned. These values are used in the power correction on
‘Power Correction on Environment
environment conditions
Conditions’ in engine component).

(see Chapter

Nominal Dimensions

lV,vcp

Distance between Hitch and Front Axle

mm

The distance between hitch and front axle is the horizontal distance between the
coupling point for the trailer and the front axle. In the case of a Semi-trailer Truck,
this value can be smaller than the wheel base.

lV,fr

Wheel Base

mm

Wheel Base is the horizontal distance between the front and the rear axle

(Fig. 2.1).

hV,cd

Height of Support Point at Bench Test

mm

If the car is driven on a chassis dynamometer the vehicle is ﬁxed somewhere to
the wall. The height of this support point on the vehicle (vertical distance between
the ground and the support point) has to be given here. This is used for the
calculation of the wheel loads because due to this height there is a moment that
affects the wheel loads (Fig. 2.2).

h V,vcp

lV,cog

lV,fr

lV,vcp

Fig. 2.1 Vehicle nominal dimensions [2]

h V,cog

z

+M

x

14

2 Mathematics Behind the Models

z

+M

x

h V,cd

Fig. 2.2 Support point at bench test [4]

Every calculation can be run with three different load states (zV,load): empty, half,

and full
(cid:129) Empty: means that the weight of the vehicle equals the Curb weight
(cid:129) Full: means that the weight of the vehicle equals the Gross weight
(cid:129) Half: means that the weight of the vehicle equals the middle of the Curb and the

Gross weight

Load-Dependent Characteristics

lV,cog (zV,load)

hV,cog (zV,load)
hV,vcp (zV,load)
PV,front (zV,load)
PV,rear (zV,load)

Distance of Gravity Center of the Vehicle Dependent on the Load
State
Height of Gravity Center of the vehicle dependent on the Load State
Height of Hitch dependent on the Load State
Tire Inﬂation Pressure Front Axle
Tire Inﬂation Pressure Rear Axle

mm

mm
mm
bar
bar

The load state is deﬁned in the Calculation Task. In addition it is possible to
deﬁne an additional mass for the load state empty so that it is possible to deﬁne
every different weight of the vehicle.

Due to this different load states some dimensions of the vehicle are changing.
The distance of gravity center is the horizontal distance between the center of

gravity and the front axle.

center of gravity.

coupling point for the trailer.

The height of gravity center is the vertical distance between the ground and the

And the height of the hitch is the vertical distance between the ground and the

2.1 Vehicle (V)

15

If an additional mass is used the dimensions depending on the load state (dis-
tance and height of gravity center, height of hitch) will be interpolated between the
given values.

The Curb weight is the weight of the empty vehicle including a full fuel tank.

Nominal Weight

mV,min

Curb Weight

mV,zul

Gross Weight

Air Coefﬁcient

Av

Frontal Area

kg

kg

m2

The Gross weight is the maximum admissible weight of the vehicle.

of the vehicle.

cV,w

cV,a,f
cV,a,r

The Frontal Area is the cross-sectional area of the vehicle that is used for the
calculation of the air resistance. With the frontal area the inﬂuence of the size of the
vehicle is considered.

Drag Coefﬁcient

–

The Drag Coefﬁcient is the factor of the air resistance that depends on the shape

Lift Coefﬁcient Front Axle
Lift Coefﬁcient Rear Axle

–
–

The lift coefﬁcients of the front and the rear axle consider the inﬂuence of the
vehicle velocity on the wheel loads. Usually, the wheel loads are getting smaller
with higher velocity. So a positive lift coefﬁcient means that the wheel loads are
decreasing. If the lift coefﬁcients are negative then the wheel loads are increasing
with increasing velocity.

The air resistance acts in the track surface. Therewith the horizontal air resistance
has no inﬂuence on the wheel loads. To consider the effects of the different heights
of the real acting point the lift coefﬁcients of the axles have to be used.
Additional Aerodynamic Coefﬁcients—Data Bus Dependent
Further option for modiﬁcation of aerodynamic parameters (drag coefﬁcient, lift
coefﬁcient front axle, and lift coefﬁcient rear axle) which can be modiﬁed according
to the Data Bus input value ‘x-axis for drag modiﬁcation’:

that means opening and closing of aerodynamic spoiler as function of any Data Bus set
value (with hysteresis).

2 Mathematics Behind the Models

16

Threshold Values

λV,ThresholdAscending
tV,ascending
λV,a,f
tV,descending

Threshold Value Ascending
Time interval of Parameter Modiﬁcation—Ascending
Threshold Value Descending
Time interval of Parameter Modiﬁcation—Descending

–

s
–

s

These inputs deﬁne the modiﬁcation behavior of the aerodynamic coefﬁcients
during calculation. The ascending and descending hysteresis threshold values and
the modiﬁcation time interval have to be deﬁned. The threshold values are related to
the vehicle’s Data Bus input ‘x-axis for drag modiﬁcation’. The unit of the
threshold values can be deﬁned by the user.
Aerodynamic Coefﬁcients after Threshold

cV,w,dataBusDep
cV,a,f,dataBusDep
cV,a,r,dataBusDep

Drag Coefﬁcient
Lift Coefﬁcient Front Axle
Lift Coefﬁcient Rear Axle

–
–
–

In these table columns the values are deﬁned which the aerodynamic coefﬁcients

will have at the end of the modiﬁcation time interval.

Lateral Dynamics Vehicle

Chassis Data

tfront,rear
Cα-front,rear

Track Width Front/Rear
Axle Stiffness Front/Rear

mm
N/°

Dependent on curvature radius the vehicle must generate lateral forces, which
are impacted by the lateral acceleration. For calculation of the sideslip angle and
thus the steering angle the stiffness of the front and rear axle is needed. For the
calculation of the downforces of each wheel the track width is also needed.

Crosswind Force Data

Lvehicle
ALateral
l
cS
cMZ

Total Length
Vehicle Lateral Surface
Distance Vehicle Front End—Front Axle
Crosswind Force Coefﬁcient
Yaw Moment Coefﬁcient

m
m2
m
–
–

The curvature radius is not only responsible for the lateral forces. If cornering is
chosen, the inﬂuence of sidewind can be calculated. Dependent on the angle of
approach the above subscripted values are recommended.

2.1 Vehicle (V)

Drag Characteristic

17

cV,w(x)

Drag Characteristic as function of a value from the Data bus

–

Cold Start Correction—Cycle Dependent

zV,cold,1
cV,cold,1(t)
zV,cold,2
cV,cold,2(t)
zV,cold,3
cV,cold,3(t)
zV,cold,4
cV,cold,4(t)
zV,cold,5
cV,cold,5(t)

Cycle Name 1
Cold Start Factor 1
Cycle Name 2
Cold Start Factor 2
Cycle Name 3
Cold Start Factor 3
Cycle Name 4
Cold Start Factor 4
Cycle Name 5
Cold Start Factor 5

–
–
–
–
–
–
–
–
–
–

If the switch Drag Characteristic is activated, the drag coefﬁcient is interpolated
from the Drag Characteristic, depending on the value of the Data Bus input
x-axis for drag coefﬁcient. This enables the user to deﬁne a drag coefﬁcient, e.g.
temperature dependent.

In addition to the possibility of calculating the higher fuel consumption based
upon the higher friction mean pressure, while the engine is cold there is another
possibility to consider the effects of a cold start. In the vehicle the cold start factors
can be deﬁned for different cycles as a function of time. If the cold start correction
switch is activated the actual fuel consumption is always multiplied with this cold
start factor and gives the higher fuel consumption.

Temperature Curves Cycle 1

zV,temp,1
TV,temp,1,i(t)

Cycle Name for Cycle 1
Temperature Curve 1,…,5 for Cycle 1

Here the time-dependent temperature characteristics for the 1st cycle are deﬁned.

Temperature Curves Cycle 2

Cycle Name for cycle 2
Temperature Curve 1,…,5 for Cycle 2

zV,temp,2
TV,temp,2,i(t)

deﬁned.

Here the time-dependent

temperature characteristics for the 2nd cycle are

–

K

–

K

18

2 Mathematics Behind the Models

Here the time-dependent

temperature characteristics for the 3rd cycle are

Temperature Curves Cycle 3

Cycle Name for Cycle 3
Temperature Curve 1,…,5 for Cycle 3

zV,temp,3
TV,temp,3,i(t)

deﬁned.

Temperature Curves Cycle 4

zV,temp,4
TV,temp,4,i(t)

Cycle Name for Cycle 4
Temperature Curve 1,…,5 for a Cycle 4

Temperature Curves Cycle 5

zV,temp,5
TV,temp,5,i(t)

Cycle name for Cycle 5
Temperature Curve 1,…,5 for Cycle 5

–

K

–

K

–

K

Here the time-dependent temperature characteristics for the 4th cycle are deﬁned.

Here the time-dependent temperature characteristics for the 5th cycle are deﬁned.

Temperature Values—Cycle Independent

TV,temp,5,i,cycleIndep

Temperature cycle independent 1,…,5

K

If one of the ‘Temperature Curves Cycle 1–5’ is used, a cycle independent
temperature has to be deﬁned for the case that further tasks (cycle independent) are
performed or the assigned cycle is not available.

Resistance Function

Factor 1 of the Resistance Function (Constant Part)
Factor 1 of the Resistance Function (Linear Part)
Factor 1 of the Resistance Function (Quadratic Part)

N
Nh/km
Nh2/km2

In addition, the following data of the reference vehicle has to be deﬁned:

Weight of the Reference Vehicle
Frontal Area of the Reference Vehicle
Drag Coefﬁcient of the Reference Vehicle

kg
m2
–

The Resistance Function can also be converted from the Coasting Characteristic,
see “Conversion from Coasting Characteristic to Resistance Function/Resistance
Table.”

AV,res
BV,res
CV,res

mV,ref
AV,ref
cV,w,ref

2.1 Vehicle (V)

Resistance Table

19

FV,res(vV)

Driving Resistance as function of vehicle velocity

N

In addition, the following data of the reference vehicle have to be deﬁned:

mV,ref

Weight

kg

The Resistance Table can also be converted from the coasting characteristic, see
“Conversion from Coasting Characteristic to Resistance Function/Resistance Table.”

Conversion from Coasting Characteristic to Resistance Function/Resistance
Table

vV,coasting(t)
truncVcoasting,left
truncVcoasting,right

Coasting Characteristic (vehicle velocity as function of time)
Truncate left
Truncate right

m/s
%
%

When the selection switch ‘Driving Resistance’ is set

to ‘Function with
Reference Vehicle’ or ‘Characteristic with Reference Vehicle,’ the option ‘Driving
Resistance from Coasting Characteristic’ can be chosen. By selecting a conversion
button (located at the coasting characteristic), the Resistance Function/Resistance
Table is calculated using the values of the coasting characteristic.

Since the original coasting characteristic is often sensitive at the beginning of the
measurement (small t) or at its end (small v) and these points have a big and
sometimes negative inﬂuence on the resulting resistance parabola, there is a pos-
sibility to exclude the ‘disturbing points’ from certain intervals at the beginning or
at the end of the characteristics (deﬁned in the percentage of the whole domain,
usually under 5 %) from the conversion. This is done by deﬁning values for the
ﬁelds ‘Truncate left’ and ‘Truncate right’.

It is recommended to always accomplish the conversion into the Resistance
Table ﬁrst, adjust the ‘excluded’ intervals until the Resistance Table shows a sat-
isfying pattern (without ‘jumps’ at its ends) and then, if needed, make the con-
version into the parabola coefﬁcients.

Conversion from Deceleration Interval Characteristic to Resistance Function/
Resistance Table

vV(t)
truncVdeceleration,left
truncVdeceleration,right
ΔvVdeceleration(t)

Coasting Characteristic (vehicle velocity as function of time)
Truncate left
Truncate right
Velocity Interval

m/s
%
%
km/h

This feature converts the required values from the so-called ‘Deceleration
Interval Characteristic’; every input row of this characteristic deﬁnes the time for a

20

2 Mathematics Behind the Models

deceleration (e.g., velocity interval = 10 km/h) around a speciﬁed vehicle velocity.
For example, the deﬁned time at 120 km/h corresponds to the time needed for the
vehicle to decelerate from 125 to 115 km/h. Similar to the conversion from
Coasting Characteristic, there are options for ‘Truncate left’ and ‘Truncate right’ to
cut off data which might have a bad inﬂuence on the conversion results.
Additionally, there is an input ﬁeld for the deﬁnition of the velocity interval.

2.1.3 Input and Output Variables

2.1.3.1 Mechanical Connections

sV
vV
aV
FV

Distance traveled from the start of the calculation
Velocity
Acceleration
Force at the vehicle

m
m/s
m/s2
N

xV,drag

x-Axis For Drag Modiﬁcation

–

2.1.3.2 Data Input

2.1.3.3 Data Output

Acceleration
Distance
Velocity
Temperature Curve 1,…,5 for Cycle i
Power
Power Loss

2.1.4 Computation of the Module Variables

Instantaneous vehicle mass
Actual Height of Gravity Center
Actual Distance of Gravity Center
Air drag force
Relative wind velocity in vehicle direction
Inclination resistance

aV
sV
vV
TV,temp,cycle,i
PV
PV,loss

mV,act
hV,cog,act
lV,cog,act
FV,air
vU,V,rel
FV,incl

m/s2
m
m/s
K
W
W

kg
mm
mm
N
m/s
N

(continued)

2.1 Vehicle (V)

21

FV,res
FW,x,f,ax
FW,x,r,ax
NW,f,r
NW,f,l
NW,r,r
NW,r,l
FA
αU
FLateral
FWind
FS,front(rear)
αCompass
αf,r
δ
β

D

Resistance force
Front axis load
Rear axis load
Number of right front wheels
Number of left front wheels
Number of right rear wheels
Number of left rear wheels
Trailer Force
Actual Inclination αU = αU,up + αU,dn
Lateral force
Lateral force effected by crosswind
Lateral force on the axle front and rear
Actual angle
Side slip angle front, rear
Steering angle
Side slip angle vehicle
Distance vehicle front—pressure point

N
N
N
–
–
–
–

N
rad
N
N
N
rad
rad
rad
rad
m

2.1.5 Equation System

2.1.5.1 Instantaneous Vehicle Mass

For evaluating the forces, which are acting on the vehicle, the current load conditions
are important. They are speciﬁed for each calculated task in two different ways.
(a) Load conditions ﬁxed as load stage [2

The actual vehicle mass

(cid:1)

(cid:3)

mV;act ¼ mV zV;load

is determinate by interpolation between the three load stages [2]

empty: ZV;load ¼ 0 ! mV 0ð Þ ¼ mV;min
half: ZV;load ¼ 1 ! mV 1ð Þ ¼ mV;min þ mV;zul
full: ZV;load ¼ 2 ! mV 2ð Þ ¼ mV;zul

2

ð2:1:1Þ

ð2:1:2Þ

22

2 Mathematics Behind the Models

(b) If an additional mass describes the load

The instantaneous vehicle mass is evaluated as followed [2]

mV;act ¼ mV 0ð Þ ¼ mV;zul

ð2:1:3Þ

2.1.5.2 Number of Wheels

The number of wheels NW,f,r, NW,f,l, NW,r,r and NW,r,l are determined by summation
of all wheels in consideration of their wheel location LW,i.

2.1.5.3 Position of the Total Center of Gravity

The location of acting point of mass forces is necessary for the allocation of the
wheel loads.

We have to distinguish between:

(a) For driving on road [2]

hV;cog;act ¼ hV;cogðZV;loadÞ

lV;cog;act ¼ lV;cogðZV;loadÞ

ð2:1:4Þ

ð2:1:5Þ

The actual values for the height and the horizontal distance are determined by
interpolation between the three load stages.

(b) For the chassis dynamometer [2]:

hV;cog;act ¼ hV;cd

ð2:1:6Þ

For calculations on a chassis dynamometer just the vertical distance of the
actual gravity center and the support point are important.

2.1.5.4 Hitch Force

The force at the vehicle hitch is caused by the mass and resistance force of the
trailer [2]

FA ¼ mA;virt (cid:2) ½aV þ g (cid:2) sinðaUÞ(cid:3) þ FA;virt (cid:2) cosðaUÞ

ð2:1:7Þ

2.1 Vehicle (V)

23

2.1.5.5 Dynamic Wheel Loads

Front Axis
The summation of all moments around the contact point between rear wheels and
road has to be zero [2]:

X

Mr;ax ¼ 0

Out of this equation we can calculate the load of the front axis [2].
(cid:5)

(cid:6)

(cid:4)
1 (cid:4) lV;cog;act
lV;fr

Fw;x;f;ax ¼ mV;act

(cid:4) FV;lift;f

(cid:2) g (cid:2) cos aU (cid:4) hV;cog;act
lV;fr

ð

(cid:2) aV þ g (cid:2) sin au

The load on the front axis is allocated proportionate onto the single front wheels

for the right and the left side.
Right front wheel load [2]:

Left front wheel load [2]:

FW;x;f;r ¼ FW;x;f;ax
2 (cid:2) NW;f;r

FW;x;f;l ¼ FW;x;f;ax
2 (cid:2) NW;f;l

X

Mf;ax ¼ 0

Rear Axis
The summation of all moments around the contact point between front wheels and
road has to be zero [2]:

From this equation we can calculate the load of the rear axis [2].

(cid:6)

Fw;x;r;ax ¼ mV;act

lV;cog;act (cid:2) g (cid:2) cos aU
lV;fr

þ hC;cog;act
lV;fr

(cid:7)

ð

(cid:2) aV þ g (cid:2) sin aU

Þ

(cid:4) FV;lift;r

The load on the rear axis is allocated proportionate onto the single rear wheels for
the right and the left side.

ð2:1:8Þ

(cid:7)
Þ

ð2:1:9Þ

ð2:1:10Þ

ð2:1:11Þ

ð2:1:12Þ

ð2:1:13Þ

ð2:1:14Þ

ð2:1:15Þ

ð2:1:16Þ

ð2:1:17Þ

ð2:1:18Þ

ð2:1:19Þ

24

2 Mathematics Behind the Models

Right rear wheel load [2]:

Left rear wheel load [2]:

2.1.5.6 Resistance Forces

FW;x;r;r ¼ FW;x;r;ax
NW;r;r

FW;x;r;l ¼ FW;x;r;ax
NW;r;l

(a)

from physical units
The force of resistance is the addition of the air drag force and the longitudinal
force caused by the road inclination. The rolling resistance is calculated
separately for all wheels.
Air Drag [2]

vU;V;rel ¼ vV þ vU;air

FV;air ¼ (cid:4)0:5 (cid:2) cw (cid:2) Av (cid:2) qU;air

(cid:2) v2

U;V;rel

Inclination Resistance [2]

aU ¼ aU;up þ aU;dn

FV;incl ¼ mv;act (cid:2) g (cid:2) sin aU

Additional traction or pushing forces are taken into account with the relative
forces kV,add,trac and kV,add,push. They are related to the weight of the vehicle and
their size is ﬁxed by the equation solver for special Calculation Tasks (e.g., Max
Traction Force).
Summation [2]

FV;res ¼ FV;air þ FV;incl þ kv;add;trac þ kv;add;push

(cid:2) mV;act (cid:2) g

ð2:1:20Þ

(cid:1)

(cid:3)

(a)

from Resistance Function with reference vehicle
The parameters CA, CB, and CC are entered. Out of these values the driving
resistance function can be deﬁned as followed [2]:

2.1 Vehicle (V)

25

FV;res ¼ mact
mref

(cid:2) cA þ mact
mref

(cid:2) cB (cid:2) vV þ cW (cid:2) A
cW;ref (cid:2) Aref

(cid:2) cC (cid:2) v2
V

ð2:1:21Þ

(b)

from Resistance Table with reference vehicle
The driving resistance curve is deﬁned as force versus vehicle velocity. From
this table the constant and proportional part can be evaluated.
For the reference vehicle mass can be calculated [2]:

F vð Þ ¼ A þ B (cid:2) vV þ (cid:2)F vVð

Þ

for

vV ¼ 0 ! A ¼ F vV ¼ 0

ð

Þ

B ¼ F0ðvV ¼ 0Þ

ð2:1:22Þ

ð2:1:23Þ

ð2:1:24Þ

These parts are related to the actual vehicle mass and they can be handled
separately.
The function part of higher order is calculated [2]:

(cid:2)F vVð

Þ ¼ F vVð

Þ (cid:4) A (cid:4) B (cid:2) vV

ð2:1:25Þ

Now the actual resistance force can be evaluated for each time step [2]:

FV;res ¼ mact
mref
(cid:1)

ð

(cid:2) A þ B (cid:2) vV

Þ þ (cid:2)F vVð

Þ

ð2:1:26Þ

FV;res;ges ¼ FV;res þ FV;incl þ km;add;trac þ km;add;push

(cid:2) mV;act (cid:2) g

ð2:1:27Þ

(cid:3)

(c)

from Resistance Function without reference vehicle
The parameters CA, CB, and CC are entered. Out of these values the driving
resistance function can be deﬁned as followed [2]:

FV;res ¼ cA þ cB (cid:2) vV þ cC (cid:2) v2
V

ð2:1:28Þ

(d)

from Resistance Table without reference vehicle
The driving resistance curve is deﬁned as force versus vehicle velocity. From
this table the constant and proportional part can be evaluated [2].

F vð Þ ¼ A þ B (cid:2) vV þ (cid:2)F vVð

Þ

for

vV ¼ 0 ! A ¼ F vV ¼ 0

ð

Þ

B ¼ F0ðvV ¼ 0Þ

ð2:1:29Þ

ð2:1:30Þ

ð2:1:31Þ

26

2 Mathematics Behind the Models

These parts are related to the actual vehicle mass and they can be handled
separately.
The function part of higher order is calculated [2]:

(cid:2)F vVð

Þ ¼ F vVð

Þ (cid:4) A (cid:4) B (cid:2) vV

ð2:1:32Þ

Now the actual resistance force can be evaluated for each time step [2]:

ð
FV;res ¼ A þ B (cid:2) vV
(cid:1)

Þ

Þ þ (cid:2)F vVð
(cid:3)

ð2:1:33Þ

FV;res;ges ¼ FV;res þ FV;incl þ km;add;trac þ km;add;push

(cid:2) mV;act (cid:2) g

ð2:1:34Þ

2.1.5.7 Conversion from Coasting Characteristic to Resistance

Function/Resistance Table

After derivation and t-variable substitution, the coasting characteristic v ¼ f
transferred to the characteristic a ¼ f vð Þ.

tð Þ is

Multiplying the characteristic with the vehicle mass, the resistance characteristic

This characteristic is approximated with a parabola F ¼ A þ B (cid:2) v þ C (cid:2) v2 using

F = f(v) is obtained.

the least square method.

2.1.5.8 Lateral Force

For the calculation of cornering there are some restrictions:
(cid:129) Steady state cornering
(cid:129) Linearization for small angle
(cid:129) Linear approach for lateral forces
(cid:129) No changes of the gravity center
(cid:129) Wheels of the axle assembled at the axle middle
(cid:129) No inﬂuence between lateral and radial forces

With the following points the parameters of cornering are calculated:

(1) The sum of the lateral forces are [2]:

2.1 Vehicle (V)

Flateral ¼ Fs;q þ Fs;wind þ Fs;b

27

ð2:1:35Þ

The single parts of the lateral forces can be calculated by the following
formulas:
Front (rear) axle force by lateral acceleration [2]:

Ffront rear
ð

Þ;lateral;q ¼ mVehicle (cid:2) v2

Vehicle

(cid:2)

q

NfrontðrearÞ
NVehicle

ð2:1:36Þ

If required, the lateral force inﬂuence by wind can be computed by [2]:

Fs;Wind ¼ cs (cid:2) q (cid:2)

(cid:4)

(cid:5)

v2
Wind
2

(cid:1)

(cid:3)

(cid:2) AS (cid:2) sin aCompass þ bslip

ð2:1:37Þ

The angle αCompass is the angle of the vehicle since starting (which could
change). The start value can be chosen under Wind Velocity.
Lateral force inﬂuence by sideslip angle [2].

Fs;b ¼ cs (cid:2) q (cid:2)

(cid:4)

(cid:5)

v2
Vehicle
2

(cid:1)

(cid:3)

(cid:2) AS (cid:2) sin bslip

The pressure point of the crosswind is important for the splitting on the axles
of crosswind force. It is measured from the front of the vehicle [2].

ð2:1:38Þ

ð2:1:39Þ

dlateral ¼ l (cid:2) cMZ
cs

Front axle lateral force by crosswind [2]:
FS;front ¼ dlateral (cid:4) lfront;frontaxle

bwheelbase

Rear axle lateral force by crosswind [2]:

(cid:1)
(cid:2) Fs;Wind þ Fs;b

(cid:3)

ð2:1:40Þ

FS;rear ¼ bwheelbase (cid:4) dlateral þ lfront;frontaxle

bwheelbase

(cid:8)
(cid:2) Fs,Wind

(cid:9)

þ Fs;b

ð2:1:41Þ

(2) The change of downforces of each under inﬂuence of the curvature.

The summation of all moments around the contact point between right (left)
wheels and road has to be zero [2]:

X

Mf; rð Þ;ax ¼ 0

ð2:1:42Þ

Downforce wheel right (left) front [2]:

28

2 Mathematics Behind the Models

Downforce wheel right (left) rear [2]:

FD;f;rðlÞ ¼ FD;f;rðlÞ (cid:4) ðþÞ hGC
tf

(cid:2) FS;front

FD;r;rðlÞ ¼ FD;r;rðlÞ (cid:4) ðþÞ hGC
tr

(cid:2) FS;rear

(3) Sideslip angel front (rear) under the inﬂuence of the radial force [2]:

(4) Ackermann angle [2]:

(5) Steering angle [2]:

(6) Slip angle [2]:

afðrÞ ¼

FS;fðrÞ
ca
1 þ Fradial;fðrÞ

ca

aackermann ¼ bWheelbase

q

d ¼ aackermann
1 þ Fradial;f
ca

þ af (cid:4) ar

b ¼ bwheelbase (cid:2) lGC

(cid:4) ar

d

ð2:1:43Þ

ð2:1:44Þ

ð2:1:45Þ

ð2:1:46Þ

ð2:1:47Þ

ð2:1:48Þ

2.2 Clutch (C)

Stationary idle, transition to motion and interruption of the power ﬂow are all made
possible by the clutch. The clutch slips to compensate for the difference in the
rotational speeds of engine and drivetrain when the vehicle is set in motion. When a
change in operation conditions makes it necessary to change gears, the clutch
disengages the engine from the drivetrain for the duration of the procedure.

The clutch contains a model for a friction clutch as it is used in cars with manual

gearboxes. In this case the clutch is controlled by the driver via the cockpit [1].

The last possibility of using the clutch is together with a CVT gearbox. There it
is only necessary for starting. In this case the clutch is controlled by the control
module CVT control [1].

2.2 Clutch (C)

2.2.1 Properties

29

Switch Output
If this switch is activated a result output for this component is made.

Selection Button Model

simple
detailed

simple
detailed

For the simple model of the clutch the maximum transferable torque has to be
deﬁned.

Selection Button Model

At the detailed model of the clutch the transferable torque is derived from the
geometric data of the clutch as well as from the friction characteristic.

Selection Button Control Variable

Desired Clutch Release
Desired Torque

Selection Button Control Variable

Desired Clutch Release

This is the ‘usual’ selection where the clutch gets the value of the desired clutch
release. Therefore, the Data Bus input Desired Clutch Release has to be connected.

Desired Torque
This mode considers the desired torque to be transmitted. Therefore, the Data Bus
input.

Torque Demand has to be connected.

Switch Dynamic Mode
If this switch is activated the clutch calculation always stays dynamic and never
switches to a kinematic connection.
Switch Free Deﬁnable Friction Characteristic
If this switch is activated and depending on whether ‘simple’ or ‘detailed’ model
has been chosen, the characteristic ‘Maximum Transferable Torque’ overslip, or the
characteristic ‘Friction Coefﬁcient’ overslip can be deﬁned.

2 Mathematics Behind the Models

2.2.2 User-Deﬁned Variables

Inner Radius
Outer Radius

mm
mm

With these values the mean radius of the clutch is calculated.

Number of Sets of Frictional Surfaces

The number of sets of frictional surfaces is equal to the number of the clutch

disks. In the calculation every disk is set with two frictional surfaces.

From these values the friction characteristic of the clutch is determined. The
input of the two friction coefﬁcients is only necessary if the switch ‘Free deﬁnable
Friction Characteristic’ is deactivated (Fig. 2.3).

Friction Coefﬁcient sticking
Friction Coefﬁcient Ratio slipping/sticking
Form Parameter

Inertia Moment on the drive side
Inertia Moment on the power take-off side
Maximum Transferable Torque

30

rC,I
rC,o

Nc

μC,fric
κC,fric
PC,fric

θC,in
θC,out
MC,max

–

–
–

rad/s

kg m2
kg m2
Nm

The maximum transferable torque is the maximum torque the clutch can transfer
between the drive and the power take-off side. Its input is only necessary if the
switch ‘Free deﬁnable Friction Characteristic’ is deactivated.

Pressure Force

Fc(sc)

Pressure Force as a Function of the Clutch Release

N

The pressure force is the axial force the frictional surfaces are pressed together.
This pressure force depends on the clutch release. With the pressure force it is
possible to calculate the transmitted torque by considering the dimensions.

θC,in

θC,out

MC,in

MC

MC,out

Fig. 2.3 Friction clutch model [2]

2.2 Clutch (C)

(cid:1)

(cid:3)

MC;max

_uc;rel

Maximum Transferable Torque overslip

–

31

This characteristic is only required if the selection button ‘model’ is set to

‘simple’ and the switch ‘Free deﬁnable Friction Characteristic’ is activated.

(cid:1)

(cid:3)

lC

_uc;rel

Friction Coefﬁcient over slip

–

This characteristic is only required if the selection button ‘model’ is set to

‘detailed’ and the switch ‘Free deﬁnable Friction Characteristic’ is activated.

2.2.3 Input and Output Variables

2.2.3.1 Mechanical Connection

Angular velocity on the drive side

Angular acceleration on the drive side

Angular velocity on the power take-off side

Angular acceleration on the power take-off side

Torque on the drive side
Torque on the power take-off side

rad/s
rad/s2
rad/s
rad/s2
Nm
Nm

2.2.3.2 Data Input

SC,act
MC,desired

Desired Clutch Release
Desired Torque

2.2.3.3 Data Output

Actual Clutch Release
Clutch Torque
Input Speed

Output Speed

Input Power
Output Power
Power Loss

–

Nm

–

Nm
rad/s

rad/s

W
W
W

_uC;in
€uC;in
_uC;out
€uC;out
MC,in
MC,out

SC,act
MC
_uC;in
_uC;out
PC,in
PC,out
PC,loss

2.2.4 Computation Variables

2 Mathematics Behind the Models

Relative speed of the clutch
Stick Friction Coefﬁcient
Slip friction coefﬁcient
Friction gradient
Actual friction coefﬁcient
Actual clamping force
Transmitted torque

rad/s
–
–
–
–

N
Nm

32

_uC;rel
μC,st
μC,sl
CC
μc,act
FC,act
MC

2.2.5 Equation System

Friction Coefﬁcient
Friction coefﬁcient has to be evaluated for stick and slid friction. Which value is
taken in consideration depends on the circumstances that the clutch is locked or
unlocked.

They are ﬁxed in the code with the following values:

lC;st
lC;sl

¼ 0:4
¼ lC;st

(cid:2) 0:8

friction coefficient sticking
friction coefficient slipping

Mean effective radius of the clutch
The mean effective radius is the ﬁctive radius, in which the friction force is acting [2]:

rC;m ¼ MC;max
NC (cid:2) lC;st

(cid:2) FC

ð2:2:1Þ

Actual friction coefﬁcient
The relative speed between clutch in and out is determined [2].

_uC;rel

¼ _uC;in

(cid:4) _uC;out

ð2:2:2Þ

The friction gradient is also ﬁxed in the code for typical conditions:

CC ¼ 0:01

The actual friction coefﬁcient is calculated by using the following formula [2]:

lC;act

¼ lC;sl

(cid:1)
þ lC;st

(cid:3)

(cid:4) lC;sl

(cid:2) e

(cid:9)

(cid:8)

j(cid:2)CC
j
_uc;rel
lc;st (cid:4)lc;sl

(cid:4)

ð2:2:3Þ

2.2 Clutch (C)

33

Actual Clamping force
Evaluation of the actual clamping force FC,act by interpolating out of the map FC(SC)
for the actual clutch release.

Transmitted Torque MC
The transmitted torque is the torque value which goes through the clutch from the
into the outside.

For the sliding clutch it is the possible moment limited by the friction [2]:

MC ¼ (cid:4)lC;act

(cid:2) rC;m (cid:2) FC;act (cid:2) NC

ð2:2:4Þ

For the adhering clutch the clutch torque is determinate by the value which is
applied by the system [2]:

(cid:10)
(cid:10)

MC ¼ MC;in (cid:4) MC;out

(cid:10)
(cid:10)

ð2:2:5Þ

Detection of sliding and adhesion
The clutch will slide as long these conditions are fulﬁlled:

(cid:11)

(cid:10)
(cid:10)
MC;in (cid:4) MC;out

(cid:10)
(cid:10) (cid:5) MCj

j

(cid:12)

(cid:11)
_ _uC;rel

(cid:12)

(cid:11)

(cid:12)

[ 0

_ SC;art [ 0:8

ð2:2:6Þ

The clutch will adhere for the following condition
(cid:10)
(cid:12)
(cid:10)\ MCj

MC;in (cid:4) MC;out

(cid:11)
^ _uC;rel

\ 0:01

(cid:10)
(cid:10)

(cid:12)

(cid:11)

j

(cid:11)

^ SC;act \ 0:8

(cid:12)

ð2:2:7Þ

2.3 Torque Converter (T)

Torque converters employ the force represented by a moving ﬂuid to transmit engine
torque. Because these devices compensate for differences in the rotating speeds of
engine and drivetrain, they are ideal for effecting the transition from stationary to
mobile operation. The torque converter also multiplies torque. First an impeller
(pump) converts the mechanical energy emanating from the power unit into ﬂuid
energy (hydraulic ﬂuid—ATF—is the preferred medium); a second transformation,
back into mechanical energy, occurs at the blades within the turbine [1].

Among the beneﬁts offered by torque converters are the following attributes:
inﬁnitely variable, stepless variations in torque and rpm, vibration insulation,
absorption of torque peaks, and virtually wear-free power transfer [1].

These devices offer economical operation when used together with mechanical
variable-ratio transmissions; operation with nonpositive engagement (slip) is lim-
ited in the interests of efﬁciency [1].

The converter contains a model for a torque converter as it is, e.g., used in
vehicles with automatic gearboxes. For computing the output variables, the various
characteristic curves of the converter are used. The characteristic curves are usually

34

2 Mathematics Behind the Models

Drive Side

MT,in

MT,out

Power Take-off 
Side

Lock-up Clutch

MT,lc

MT,p

MT,h

Torque Converter

Fig. 2.4 Torque Converter with lock-up clutch model [2]

stationary. Normally, the deviation from dynamic characteristic curves is minor. If
dynamic characteristic curves are known, they may be used [1].

The component torque converter also contains a lock-up clutch (Fig. 2.4). This
lock-up clutch is in parallel to the torque converter and serves for lower losses in the
torque converter because the slip is suppressed. The lock-up clutch has to be
controlled by the control module clutch control [1].

2.3.1 Properties

Switch Output
If this switch is activated a result output for this component is made.

Switch Use for Reference
At the task Climbing Performance the maximum gradients are only calculated for
the coupling part (torque multiplication equals zero). If more than one torque
converter is in the model, the reference torque converter has to be determined with
this switch. This means that from this torque converter the coupling part is deter-
mined, for which the gradients are calculated.

Selection Button Lock-up Friction Model

In this case the ‘default’ model is used: the maximum transferable torque of the
lock-up clutch is calculated linearly through the clutch release value.

Selection Button Lock-up Friction Model

Linear
Simple

Linear
Simple

In this case the friction model of the clutch component is used.

2.3 Torque Converter (T)

35

2.3.2 User-Deﬁned Variables

Selection Button Input options

Torque Conversion
Cf-Curve
K-Curve

Selection Button Input options

Torque Conversion
Cf-Curve
K-Curve

Selection Button Input options

Torque Conversion
Cf-Curve
K-Curve

In this case, the pump torque has to be deﬁned as a function of the speed ratio at
reference speed.

In this case, the Cf-values have to be deﬁned as a function of the speed ratio.

In this case, the K-factors have to be deﬁned as a function of the speed ratio.

θT,p,oil
θT,h,oil

Inertia Moment of the Pump (with oil share)
Inertia Moment of the Turbine (with oil share)

kg m2
kg m2

The mass moments of inertia of the pump and the turbine side are given with the

oil share.

_uT;p;n

Reference Speed

rad/s

The reference angular velocity is the speed where the table for the torque con-
version is measured. Reference speed means that throughout the whole measuring
process the pump speed was ﬁxed at this special reference angular velocity. For
other pump speeds the corresponding values are extrapolated.

MT,lock-up,max

Maximum Torque Lock-up Clutch

Nm

The maximum lock-up torque is the maximum torque that can be transferred via

the lock-up clutch.

This torque can be transferred if the clutch is completely closed. If the clutch is
closed partly (controlled operation; refer to component Clutch Program (CP) for
more information), a correspondingly lower torque can be transferred.

Torque Conversion

iT,Tor(iT,Sp)

Torque Ratio as a function of the Speed Ratio at Reference Speed

–

36

2 Mathematics Behind the Models

Torque
Ratio

1

0

0

Fig. 2.5 Torque Ratio as function of the speed ratio [2]

1

Speed Ratio

The torque ratio is the division between the turbine torque and the pump torque.
It depends on the speed ratio which is the division between the turbine and the
pump speed. The torque ratio is nearly one throughout the whole speed ratio. Only
when the speed ratio is nearly zero the torque ratio is increasing (refer to Fig. 2.5).

Torque Curve

MT,Pump(iT,Sp)

Pump Torque as a function of the Speed Ratio at Reference Speed

Nm

These values are required when the selection button Input options is set to
torque curve. The pump torque is the transferable torque between the pump and the
turbine. It is a function of the speed ratio. At the speed ratio one, i.e., there is no
difference in speed between the pump and the turbine, the pump torque is zero. If
the speed ratio is between zero and one (the pump drives the turbine), the pump
torque is positive. If the speed ratio is above one (the turbine drives the pump), the
pump torque is negative.

In addition, there is a dependence on the ratio between the pump speed and the

reference speed. This is calculated in the following way [2]:

MT;Pump;act ¼ MT;Pump (cid:2)

ð2:3:1Þ

 

!
2

_uT;Pump
_uT;P;n

MT;Pump;act Transferable Torque at the actual pump speed
_uT;Pump

Actual Pump Speed

Cf-Curve

iT,Tor (iT)
CfT (iT)

Torque Ratio as a function of the Speed Ratio
Cf-Values as a function of the Speed Ratio

–
kp.m.106/(1/min)2

2.3 Torque Converter (T)

37

These values are required when the selection button Input options is set to
Cf-Curve. In the calculation core, the Cf-values are converted to the pump torque
assuming the reference speed as being 2000 rpm.

The relation between the Cf-values and the pump torque at reference speed is

described by the following equation [2]:

Cf T

¼ MT;Pump;act (cid:2) 106
_u2

T;Pump

ð2:3:2Þ

K-Curve

iT,Tor (iT)
KT (iT)

Torque Ratio as a function of the Speed Ratio
K-Values as a function of the Speed Ratio

–
(1/min)/Nm0.5

These values are required when the selection button Input options is set to
K-Curve. In the calculation core, the K-factors are converted to the pump torque
assuming the reference speed is 2000 rpm.

The relation between the K-factors and the pump torque at reference speed is

described by the following equation [2]:

KT ¼

p

_uT;Pump
ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
MT;Pump;act

ð2:3:3Þ

The K-values can only be positive (due to their deﬁnition). AVL CRUISE calcu-
lates pump torque for speed ratios above 1 by mirroring the pump torque around the
point (1/0) in the speed ratio—pump torque—plane.

2.3.3 Input and Output Variables

2.3.3.1 Mechanical Connection

_uT;in
€uT;in
_uT;out
€uT;out
MT,in
MT,out

Angular velocity on the drive side

Angular acceleration on the drive side

Angular velocity on the power take-off side

Angular acceleration on the power take-off side

Input torque
Output torque

rad/s
rad/s2
rad/s
rad/s2
Nm
Nm

2 Mathematics Behind the Models

Desired Clutch Release
Modiﬁcation of Torque Multiplication

–
–

2.3.3.2 Data Input

38

ZT
CT

2.3.3.3 Data Output

MT,clutch,act
_uT;Pump
MT,pump,act
_uT;turb
MT,turb,act
_uT;Mp2000
€uT;in
€uT;out
vT,act
μT,act
PT,in
PT,out
PT,loss

Clutch Torque
Pump Speed

Pump Torque
Turbine Speed

Pump Acceleration

Turbine Acceleration

Speed Conversion
Torque Conversion
Pump Power
Turbine Power
Power Loss

2.3.4 Computation Variables

Turbine Torque
Mp2000 (Pump torque at pump speed 2000)

Nm
rad/s

Nm
rad/s

Nm
Nm
rad/s2
rad/s2
–
–

W
W
W

_uT;rel
KT,scale
vT,act
μT,act
MT,pump,nom
MT,pum,actp
MT,turbin,acte
MT,clutch,act
MT,trans

Difference of angular velocities between in and off side

Scale factor
Instantaneous speed conversion
Instantaneous torque conversion
Pump torque at nominal pump speed
Actual pump torque
Actual turbine torque
Actual clutch torque (lockup)
Transmittable torque of the converter with lock-up clutch on the pump
side

rad/s
–
–
–

Nm
Nm
Nm
Nm
Nm

2.3 Torque Converter (T)

2.3.5 Equation System

2.3.5.1 Converter Torque

39

ð2:3:4Þ

ð2:3:5Þ

ð2:3:6Þ

ð2:3:7Þ

ð2:3:8Þ

ð2:3:9Þ

The torque on the converter input and output depends on the speed ratio between
pump and turbine as well on the absolute angular velocity of the pump.

Speed Ratio
This is the difference between the angular velocities of the clutch input and output
side.

The actual speed ratio is evaluated:

(1) For pump speed is zero _uT;in
\0)

( _uT;out

(a)

¼ 0 [2]:

(b)

( _uT;out

[ 0)

(c)

( _uT;out

¼ 0)

mT;act ¼ iT;Torð1Þ

mT;act ¼ iT;TorðmaxÞ

mT;act¼ 1
(cid:1)

(cid:3)

mT;act ¼

_uT;out
_uT;in

(2) With an input speed not equal zero _uT;in

6¼ 0

[2]:

Pump Torque
Now the transferable torque can be evaluated with a liner interpolation for the pump
torque map [2]:

MT;pump;nom ¼ MT;pump vT;act

(cid:1)

(cid:3)

The scale factor KT,scale is for transformation from the nominal pump to the actual
pump speed [2]:

KT;scale ¼

_uT;in
_uT;p;n

The transformation is done in the following way [2]:

40

2 Mathematics Behind the Models

MT;pump;act ¼ MT;pump;nom (cid:2) K2

T;scale

ð2:3:10Þ

Turbine Torque
With a linear interpolation in the torque ratio map we evaluate the actual torque
ratio between pump and turbine [2]:
(cid:1)

(cid:3)

(cid:3)

lT;act

¼ CT (cid:2)

(cid:1)
iT;Tor vT;act

(cid:4) 1

þ 1

ð2:3:11Þ

The actual turbine torque is determinate by the formula [2]:

MT;turb;act ¼ MT;pump;act (cid:2) lT;act

ð2:3:12Þ

Clutch Torque
The clutch torque is the transmitted torque of the lock-up clutch. If the lock-up
clutch is acting the whole transmitted torque is split into the pump-turbine part and
the clutch part. The size of the transmittable clutch torque depends linear on the
clutch release [2].

MT;clutch;act ¼ MT;clutch;max (cid:2) ZT

ð2:3:13Þ

Transmittable Torque
The transmittable torque of the converter is the summation of the actual pump and
the clutch torque [2].

MT;trans ¼ MT;pump;act þ MT;clutch;act

ð2:3:14Þ

Detection of locked or unlocked clutch
The lock-up clutch will slide as long these conditions are fulﬁlled [2]:
(cid:12)

(cid:11)

(cid:12)

(cid:12)

(cid:10)
(cid:11)
(cid:10)

MT;in (cid:4) MT;out

(cid:10)
(cid:10) (cid:5) MTj

j

(cid:11)
r _uT;rel

[ 0

_ ST;act [ 0:8

The clutch will adhere for the following condition [2]:

(cid:11)

(cid:10)
(cid:10)
MT;in (cid:4) MT;out

(cid:10)
(cid:10)\ MTj

(cid:12)
j

(cid:11)
D _uT;rel

(cid:12)

(cid:11)

(cid:12)

\0:01

^ ST;act\0:8

ð2:3:15Þ

ð2:3:16Þ

2.4 Gearbox (G)

Gear transmissions featuring several ﬁxed ratios can maintain a correspondence
between the respective performance curves for engine and vehicle. The corre-
spondence with the hyperbola for maximum engine output will be acceptable or
indeed quite good, depending upon a multiplicity of factors including the number of

2.4 GearBox (G)

41

available gears, the spacing of the individual ratios within the required conversion
range and the engine’s full load torque curve [1].

The component Gearbox contains a model for a gearbox with different gear steps.
You can deﬁne as many gears as you want. For every gear it is possible to deﬁne the
transmission ratio, the mass moments of inertia, and the moment of loss [1].

In the component for manual gearboxes, the engine torque will be turned into a
power take-off torque by considering the transmission, the mass moments of inertia,
and the moment of loss [1].

The gearbox can be used for a manual or automatic gearbox. When used as an
automatic gearbox, the gear shifting process will be controlled by the control
module gearbox control or gearbox program. The driver will do this task when used
as a manual gearbox [1].

2.4.1 Properties

Switch Variation
The gearbox can be given free for variation with this switch. For the gearbox, the
transmission ratio can be changed by multiplication with an additional factor. The
setup of the variation parameters is done in the folder.

Switch Output
If this switch is activated a result output for this component is made.

Switch Gear Shift Time
If this switch is activated, the map for the gear shift times is used during calculation.

Selection Button Losses

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Torque Loss Map
Torque Loss Map with Torque Division
Torque Loss Map with Torque and Speed Division
Torque Loss Map temperature dependent

In this case no losses are calculated in the gearbox.

Selection Button Losses

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Torque Loss Map
Torque Loss Map with Torque Division
Torque Loss Map with Torque and Speed Division
Torque Loss Map temperature dependent

42

2 Mathematics Behind the Models

In this case, the losses are calculated by a constant efﬁciency which only depends
on the gear position.

Selection Button Losses

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Torque Loss Map
Torque Loss Map with Torque Division
Torque Loss Map with Torque and Speed Division
Torque Loss Map temperature dependent

In this case, the losses are calculated by the efﬁciency which only depends on the
gear position and by a torque loss map which depends on the gear position and the
drive speed.

Selection Button Losses

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Torque Loss Map
Torque Loss Map with Torque Division
Torque Loss Map with Torque and Speed Division
Torque Loss Map temperature dependent

In this case the losses are interpolated out of a torque loss map, which depends on
the gear position, the drive speed, and the drive torque. At the torque and speed
division a special approximation of the maps is made by cutting through the map at
the deﬁned torque and speed values.

Selection Button Losses

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Torque Loss Map
Torque Loss Map with Torque Division
Torque Loss Map with Torque and Speed Division
Torque Loss Map temperature dependent

In this case, the losses are calculated with the usage of up to 5 torque loss maps
Gear Losses Temperature Dependent where each map is associated with a
user-deﬁned constant temperature value. An interpolation between these maps is
done so that for every time step a torque loss can be generated.

The temperature used in the calculation comes through the Data Bus input
Temperature of the component Gearbox. For example, it could be connected with
one of the up to 5 cycle-dependent temperature characteristics in the component
Vehicle.

Selection Button Gear Shifting Losses

2.4 GearBox (G)

Deactivated
Efﬁciency

In this case, no gear shifting losses are calculated.

Selection Button Gear Shifting Losses
Deactivated
Efﬁciency

43

When this option is activated, the efﬁciencies for upshifting and for downshifting
have to be deﬁned for every gear. With this information the losses during the
shifting processes are calculated. This is only done for Automatic Transmission
Models.

Switch Torque Loss Correction Temperature Dependent
Here a temperature-dependent torque loss map can be activated.
Switch Efﬁciency Map (for Torque Loss Maps)
When this switch is activated, the efﬁciency can be entered in a separate table
instead of the torque loss. After pushing the button Conversion Efﬁciency in Torque
Loss, the torque loss map is created automatically.
Switches Torque Loss Map 1, …, 5
With these switches, for up to 5 temperature levels the associated loss maps can be
activated. This selection is only available if the selection button Losses is set to
Torque Loss Map temperature dependent.

In this case no partition of torque or speed is done. This selection is only available if
the selection button Losses is set to Torque Loss Map temperature dependent.

Selection Button Torque Loss Partition

Deactivated
Torque Partition
Torque and Speed Partition

Selection Button Torque Loss Partition

Deactivated
Torque Partition
Torque and Speed Partition

In this case a torque partition is done. A special approximation of the maps is made
by cutting through the map at the deﬁned torque values. This selection is only
available if the selection button Losses is set to Torque Loss Map temperature
dependent.

Selection Button Torque Loss Partition

Deactivated
Torque Partition
Torque and Speed Partition

In this case a torque and speed partition is done. A special approximation of the
maps is made by cutting through the map at the deﬁned torque and speed values.

44

2 Mathematics Behind the Models

This selection is only available if the selection button Losses is set to Torque Loss
Map temperature dependent.

Table Numerical Values of the Torque Loss Partition
For the torque and the speed range the borders for activation and deactivation can
be deﬁned here. The values are deﬁned in percentage of the maximum torque and
speed values.

2.4.2 User-Deﬁned Variables

Gear Ratio Table

NG

Gear Position

–

The input stands for the gear number (1 for 1st gear, 2 for 2nd gear,…). Zero
means the neutral gear. It has always the transmission one. This neutral gear is
needed to consider the mass moments of inertia when the vehicle is only rolling.
The program determines the number of gear steps automatically.

iG[NG]

Transmission Ratios in the single gear steps

–

The transmissions can be deﬁned for the different gear positions. However the
transmission for the neutral gear (gear position 0) has to be 1. If the number of teeth
is deﬁned, the transmission ratio of each gear step is automatically determined.

HG;in NG½
(cid:3)
HG;out NG½

(cid:3)

Inertia Moment on the drive side of the gearbox
Inertia Moment on the power take-off side of the gearbox

kg m2
kg m2

The mass moments of inertia on the drive and the power take-off sides can be
deﬁned different for each single gear step. But it is also possible to deﬁne the same
mass moments of inertia for every single gear step.

gG;i NG½
(cid:3)
gG;o NG½

(cid:3)

Number of Teeth Input

Number of Teeth Output

–

–

The number of teeth can be deﬁned here. If the user puts in the transmission
ratio, AVL CRUISE detects automatically the best ﬁtting number of teeth to get the
deﬁned transmission ratio. If it is not possible to get the transmission ratio exactly a
suggestion is made for number of teeth which gives the closest possible trans-
mission ratio.

45

2.4 GearBox (G)

Gear Shift Time

tG;up NG½
(cid:3)
tG;down NG½

(cid:3)

Time Upshifting
Time Downshifting

s
s

If the switch Gear Shift Time is activated, the map of the times for upshifting
and downshifting dependent on the actual gear number is used. For gears where
times are not deﬁned, a default value of 0.1 s is assumed.
Gear Shifting Efﬁciency for AT Models

gG;upshifting NGð
Þ
gG;downshifting NGð

Þ

Efﬁciency Upshifting (depending on gear)
Efﬁciency Downshifting (depending on gear)

–

–

When the selection button Gear Shifting Losses is set to Efﬁciency, the losses

during the shifting processes are calculated.
Efﬁciency and Torque Loss Correction

gG;V;3 NGð

Þ

Efﬁciency in the single gear steps

–

The efﬁciency can be deﬁned separately for the single gear steps. This infor-
mation is used if the selection button Losses is set to Efﬁciency or Efﬁciency and
Torque Loss.

(cid:1)

_u

MG;V;3

; NG

G;in

(cid:3)

Torque Loss in the single gear steps

Nm

The additional torque loss is deﬁned dependent on the gear step and the drive
speed of the gearbox. These values are used if the selection button Losses is set to
Efﬁciency and Torque Loss.

Torque Loss Correction Temperature Dependent

Torque Loss temperature dependent

Nm

This table is used if the switch Temperature dependent Torque Loss is

If the selection button Losses is set to Efﬁciency and Torque Loss this map
replaces the general torque loss deﬁnition. If the selection button Losses is set to
Torque Loss Map a correction of the torque loss is made.

(cid:1)

(cid:3)

MG;V;4

_u

; NG;TG

G;in

activated.

46

2 Mathematics Behind the Models

Torque Loss Map

(cid:1)

(cid:3)

MG;V;2

_uG;in

; MG;in; NG

Torque Loss in the single gear steps

Nm

The torque losses are deﬁned for every single gear step also considering the

drive speed and the drive torque of the gearbox.

This map is used if the selection button Losses is set to Torque Loss Map,
Torque Loss Map with Torque Division, or Torque Loss Map with Torque and
Speed Division.

Torque Loss Map Temperature Dependent

TG,i

Temperature i = 1, …, 5

°C

For each activated, temperature dependent torque loss map, the temperature level

has to be speciﬁed.

(cid:1)
_u

MG;V;5;i

G;in;i

(cid:3)
; MG;in; NG;i

Torque loss map temperature dependent i = 1,…,5

Nm

Here for each activated temperature-dependent torque loss map and for the
speciﬁed temperature level, the losses are deﬁned depending on speed, input torque
and gear. This is only required if the selection button Losses is set to Torque Loss
Map temperature dependent.

When the switch Efﬁciency Map (for Torque Loss Maps) is activated, the
efﬁciency for gear losses and temperature-dependent gear losses can be entered in a
separate table instead of the torque loss. After pushing the button Conversion
Efﬁciency in Torque Loss, the torque loss map is created automatically.

2.4.3 Input and Output Variables

2.4.3.1 Mechanical Connections

_u
G;in
€uG;in
MG,in
€uG;out
uG;out
MG,out

Angular velocity on the drive side

Angular acceleration on the drive side

Torque on the drive side
Angular velocity on the power take-off side

Angular acceleration on the power take-off side

Torque on the power take-off side

rad/s
rad/s2
Nm
rad/s
rad/s2
Nm

2.4 GearBox (G)

2.4.3.2 Data Input

2.4.3.3 Data Output

NG,shift
TG
tG,delay

NG,act
_uG;out
MG,out
_uG;in
MG,in
iG,act
PG,in
PG,out
PG,loss

Desired Gear
Temperature
Time Delay Gear Dependent

Current Gear
Output Speed

Output Torque
Input Speed

Input Torque
Current Transmission Ratio
Input Power
Output Power
Power Loss

47

–
°C
s

–

rad/s

Nm
rad/s

Nm
–

W
W
W

2.4.4 Computation Variables

iG,act
MG,loss,nom
MG,loss
MG,loss,n
ƞG

Actual gear ratio
Nominal loss moment
Actual loss moment
Rotational speed contribution to the loss moment
Actual efﬁciency of the gearbox

–

Nm
Nm
Nm
–

2.4.5 Equation System

Actual Gear Ratio
Acquisition of the instantaneous transmission [2]:
(cid:12)

(cid:11)

iG;act ¼ iG NG;act

ð2:4:1Þ

48

2 Mathematics Behind the Models

Angular Velocity and Acceleration
Computation of the instantaneous angular velocity and the angular acceleration on
the power take-off side of the gearbox [2]:

Inertia Moments
The mass moments of inertia are also selected out of the table [2].

Torque Loss
There are four kinds to take the torque loss of the gearbox in consideration.

(1) Calculation without losses (ZG,i = 1) [2]

_uout

¼

€uout

¼

_uin
iG;act

€uin
iG;act

HG;in;act ¼ HG;in NG;act

(cid:11)

(cid:11)

(cid:12)

(cid:12)

HG;out;act ¼ HG;out NG;act

MG;loss ¼ 0

gG

¼ 1

(2) Calculation with use of the torque loss map (ZG,i = 2)

The nominal loss moment is linear interpolated in the loss map [2]:

MG;loss;nom ¼ MG;V;2 _uG;in

; MG;in; NG;act

(cid:1)

(cid:3)

Is the simulation done with temperature-dependent losses then an additional
part is added [2]:

MG;loss;nom ¼ MG;V;2

_uG;in

; MG;in; NG;act

þ MG;V;4 _uG;in

; NG; TG

ð2:4:9Þ

(cid:1)

(cid:3)

(cid:1)

(cid:3)

The efﬁciency is now calculated as follows [2]:

¼ 1 (cid:4) MG;loss;nom

gG

MG;in

ð2:4:10Þ

ð2:4:2Þ

ð2:4:3Þ

ð2:4:4Þ

ð2:4:5Þ

ð2:4:6Þ

ð2:4:7Þ

ð2:4:8Þ

2.4 GearBox (G)

(3) Calculation with use of the efﬁciency value and the torque loss (ZG,i = 3)
The rotational speed contribution to the torque loss is linear interpolated in
the loss curve [2]:

MG;loss;n ¼ MG;V;3 _uG;in

; NG;act

(cid:1)

(cid:3)

Is the simulation done with temperature-dependent losses then the torque loss
is interpolated out of the map MG,V,4 ( _uG;in

MG;loss;n ¼ MG;V;4 _uG;in

(cid:1)

; NG; TG) [2]:
(cid:3)

; NG;act; TG

Also the efﬁciency value is selected for the actual gear [2]:

49

ð2:4:11Þ

ð2:4:12Þ

ð2:4:13Þ

gG

¼ gG;V;3

ðNG;actÞ

The actual torque loss is evaluated as followed [2]:

MG;loss ¼ MG;in (cid:2) 1 (cid:4) gG

ð

Þ þ MG;loss;n

ð2:4:14Þ

(4) Calculation with use of the efﬁciency value (ZG,i = 4)
The efﬁciency value is selected for the actual gear [2]:

gG

¼ gG;V;3

ðNG;actÞ

ð2:4:15Þ

The actual torque loss is evaluated as followed [2]:

MG;loss ¼ MG;in (cid:2) 1 (cid:4) gG

ð

Þ

ð2:4:16Þ

2.5 CVT—Continuously Variable Transmission (H)

By means of this component, an inﬁnitely variable CVT gearbox can be simulated.
The Continuously Variable Transmission can convert every point on the engine’s
operating curve to an operating curve of its own, and every engine operating curve
into an operating range within the ﬁeld of potential driving conditions. Its advan-
tage over conventional ﬁxed-ratio transmissions lies in the potential for enhancing
performance and fuel economy while reducing exhaust emissions. However, full
exploitation of this theoretical capability would entail overdrive factors that are not
realizable up to now [1].

With the model of the CVT gearbox included in AVL CRUISE it is possible to
change the transmission between two user-deﬁned threshold values. The adjusting
speed between different transmissions is internal ﬁxed at a constant value.

The change in transmission is done in form of a kinematic coupling. The
advantage of this is that there is no additional degree of freedom. Thereby the

50

2 Mathematics Behind the Models

calculation time is decreasing. The disadvantage is that the transitions might be not
real harmonic and that there is the need to change the equation system for every
change in transmission [1].

Because there is no possibility to deﬁne an unlimited transmission there is a
clutch needed for starting. This clutch will be controlled by the control module
CVT control which is also controlling the CVT gearbox [1].

2.5.1 Properties

without slip
with slip

without slip
with slip

Switch Output
If this switch is activated a result output for this component is made.

Selection Button Power Transmission

The calculation of the CVT does not include chain slip. A purely kinematic cou-
pling is performed.

Selection Button Power Transmission

The calculation of the CVT includes also chain slip. A dynamic coupling between
input and output is made.
Selection Button Losses at “Without Slip”

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Efﬁciency and Torque Loss Correction Temperature Dependent
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

At this selection no losses are considered in the CVT when calculating without slip.
Selection Button Losses at “Without Slip”

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Efﬁciency and Torque Loss Correction Temperature Dependent
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

At this selection only the efﬁciency map is considered when calculating without
slip.

2.5 CVT—Continuously Variable Transmission (H)

51

Selection Button Losses at “Without Slip”

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Efﬁciency and Torque Loss Correction Temperature Dependent
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

At this selection the efﬁciency map and the torque loss map is considered when
calculating without slip.
Selection Button Losses at “Without Slip”

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Efﬁciency and Torque Loss Correction Temperature Dependent
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

At this selection the efﬁciency map and the temperature dependent torque loss map
is considered when calculating without slip.
Selection Button Losses at “Without Slip”

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Efﬁciency and Torque Loss Correction Temperature Dependent
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

At this selection only the torque loss map is considered when calculating without
slip.
Selection Button Losses at “Without Slip”

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Efﬁciency and Torque Loss Correction Temperature Dependent
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

At this selection data from the torque loss map is used, corrected by input data from
the temperature-dependent torque loss map.

52

2 Mathematics Behind the Models

Selection Button Losses at “Without Slip”

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Efﬁciency and Torque Loss Correction Temperature Dependent
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

In this case, the losses are calculated with up to 5 ‘Torque Loss Maps Temperature
Dependent’ where each map is associated with a user-deﬁned constant temperature
value. An interpolation between these maps is done so that for every time step a
torque loss can be generated. The temperature used in the calculation comes
through the Data Bus input Temperature. For example, it could be connected with
one of the 5 cycle-dependent temperature characteristics in the component Vehicle.
Selection Button Losses at “With Slip”

Deactivated
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

At this selection no losses are considered when calculating with slip.
Selection Button Losses at “With Slip”

Deactivated
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

At this selection the torque loss map is considered when calculating with slip.
Selection Button Losses at “With Slip”

Deactivated
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

At this selection the torque loss map and the temperature-dependent torque loss is
considered when calculating with slip. Both losses are added.
Selection Button Losses at “With Slip”

Deactivated
Torque Loss Map
Torque Loss Map and Torque Loss Correction Temperature Dependent
Torque Loss Map Temperature Dependent

In this case, the losses are calculated with up to 5 ‘Torque Loss Maps Temperature
Dependent’ where each map is associated with a user-deﬁned constant temperature
value. An interpolation between these maps is done so that for every time step a
torque loss can be generated. The temperature used in the calculation comes

2.5 CVT—Continuously Variable Transmission (H)

53

through the Data Bus input Temperature. For example, it could be connected with
one of the 5 cycle-dependent temperature characteristics in the component Vehicle.
Switch Efﬁciency Map (for Torque Loss Maps)
When this switch is activated, the efﬁciency can be entered in a separate table
instead of the torque loss.

After pushing the button Conversion Efﬁciency in Torque Loss, the torque loss

map is created automatically.
Switches Torque Loss Map 1, …, 5
With these switches, the associated loss maps can be activated for up to 5 tem-
perature levels. This selection is only available if the selection button Losses is set
to Torque Loss Map Temperature Dependent.

The adjustment time is the time the CVT needs to adjust from minimum to max-
imum transmission or vice versa. At this selection the adjustment time is a ﬁxed
value.

Selection Button Adjustment Time

Fixed Value
Speed Dependent
Speed Dependent from Data Bus

Selection Button Adjustment Time

Fixed Value
Speed Dependent
Speed Dependent from Data Bus

Selection Button Adjustment Time

Fixed Value
Speed Dependent
Speed Dependent from Data Bus

The adjustment time depends on the input speed of the CVT.

The adjustment time depends on the speed connectivity from the Data Bus.

2.5.2 User-Deﬁned Variables

TH

Adjustment Time

The adjustment time is the time the CVT needs to adjust from minimum to

maximum transmission or vice versa.

iH,lim

Switching Threshold

s

–

54

2 Mathematics Behind the Models

The switching threshold is the minimum difference in transmission ratio which is
needed to change the transmission ratio. This input is only needed when the CVT is
calculated without slip.

iH,min
iH,max

θH,in
θH,out

Minimum Ratio
Maximum Ratio

–
–

Here the minimum and the maximum transmission have to be deﬁned. Between
these two threshold values the transmission can change inﬁnitely, i.e., the trans-
mission can reach every possible value between the two thresholds.

Inertia Moment on the drive side
Inertia Moment on the power take-off side

kg m2
kg m2

The mass moments of inertia have to be deﬁned separately for the drive and the

power take-off side (Fig. 2.6).

Slip Description
Is active when the CVT is calculated with slip.

MH,nom
sH,nom
iH,nom
sH,diff
κH(MH/MH,nom)

Nominal Torque
Nominal Slip
Nominal Transmission Ratio
Slip Change
Relative Slip Characteristic (=sH/sH,nom)

Nm
%
–

%
–

The Slip Characteristic describes the slip behavior of the CVT as relative map

which depends on its nominal values.

MH,pd.in

iH,act

A

MH,in

Slip s

θH,in

B

MH,out

.
iH,act

θH,out

MH,pd.out

Fig. 2.6 Principle representation of a CVT gearbox [2]

2.5 CVT—Continuously Variable Transmission (H)

55

Efﬁciency and Torque Loss Correction

ƞH,V,2(iH)

Efﬁciency

–

The efﬁciency can be deﬁned as function of the transmission ratio.

MH;V;2ð _uH;in

; iHÞ

Torque loss

Nm

The additional torque loss is deﬁned as function of the transmission ratio and the

drive speed.

These data can only be used for a calculation of a CVT without slip.

Torque Loss Correction Temperature Dependent

(cid:1)

(cid:3)

MH;V;3

_uH;in

; iH; TH

Torque loss temperature dependent

Nm

Here an additional temperature-dependent torque loss can be deﬁned.

Torque Loss Map

(cid:1)

_u

MH;V;1

; MH;in; iH

H;in

(cid:3)

Torque Loss related to the drive side

Nm

The torque lost in the transmission is deﬁned in a table depending on the drive
speed, the drive torque and the actual transmission ratio. These data can only be
used for a calculation of a CVT with slip.

Torque Loss Map Temperature Dependent

TH,i

Temperature i = 1, …, 5

°C

For each activated temperature-dependent torque loss map, the temperature level

has to be speciﬁed.

(cid:1)

(cid:3)

MH;V;5;1

_uH;in;i; MH;in;i; NH;i

Torque loss map temperature dependent i = 1, …, 5

Nm

Here for each activated temperature-dependent torque loss map and for the
speciﬁed temperature level, the losses are deﬁned depending on speed, input torque
and gear. This is only required if the selection button Losses is set to Torque Loss
Map Temperature Dependent.

When the switch Efﬁciency Map (for Torque Loss Maps) is activated, the
efﬁciency for gear losses and temperature-dependent gear losses can be entered in a
separate table instead of the torque loss. After pushing the button Conversion
Efﬁciency in Torque Loss, the torque loss map is created automatically.

2 Mathematics Behind the Models

Adjustment Time Speed Dependent

Adjustment Time
Adjustment time Speed Dependent

s
s

The adjustment time is the time the CVT needs to adjust from minimum to

maximum transmission or vice versa.

2.5.3 Input and Output Variables

2.5.3.1 Mechanical Connections

Input torque
Output torque
Input speed

Output speed

Angular acceleration on the drive side

Angular acceleration on the power take-off side

Nm
Nm
rad/s
rad/s2
rad/s
rad/s2

2.5.3.2 Data Input

2.5.3.3 Data Output

Desired Transmission Ratio
Temperature
Speed External

Current Transmission Ratio
Current Gear
Input Speed

Input Torque
Output Speed

Output Torque
Input Power
Output Power
Power Loss

–
°C
rad/s

–
–

rad/s

Nm
rad/s

Nm
W
W
W

56

TH
TH _u

MH,in
MH,out
_uH;in
€uH;in
_uH;out
€uH;out

iH,rated
TH
_uH;ext

iH,act
NH,act
_uH;in
MH,in
_uH;out
MH,out
PH,in
PH,out
PH,loss

2.5 CVT—Continuously Variable Transmission (H)

57

2.5.4 Computation Variables

ΔiH,act
MH,loss

Transmission gap in gear ratio
Instantaneous total moment of loss in the gearbox

–

Nm

2.5.5 Equation System

Deviation in Gear Ratio
For the gear selection the difference between target and actual transmission is taken
[2]:

DiH;act ¼ iH;requ (cid:4) iH;act

ð2:5:1Þ

If this gear shifting step is great enough and the gear ratio limits are not reached

the gear shifting process will be done.

(a) Calculation without slip

The calculation without slip is done with kinematic equations only. The input
and output speed relation is ﬁxed. Also the input and output torque are deﬁned
by the transmission ratio.

(b) Calculation with slip

In this case also the force equations are used (dynamic simulation):
For the actual ratio the reference slip is calculated with the following formula
out of the Slip Characteristic [2]:

sH;act ¼ sH;diff
sH;ref
(cid:1)

(cid:1)

sH;ref ¼ sH;nom (cid:2) sH;diff (cid:2)

iH;act (cid:4) iH;nom

þ 1

(cid:3)

(cid:3)

ð2:5:2Þ

ð2:5:3Þ

Using the relation between actual and nominal CVT-torque the slip relation
can be evaluated.
Now the actual slip is determined for the reference slip and the slip relation [2].

q

ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
(cid:3)
2
_u2

(cid:1)
þ _uBelt
j

(cid:10)
(cid:10)
j þ D _u

break

(cid:10)
(cid:10)

_uref

¼

with _ubreak

¼ 0:1

D _u ¼ _uH;in
_uBelt

¼ _uH;out
sH ¼ D _u

(cid:4) _uBelt
(cid:2) iH;act

_u ref

ð2:5:4Þ

58

2 Mathematics Behind the Models

Torque Loss
There are three kinds to take the torque loss of the gearbox in consideration.

(1) Calculation without losses (ZH,i = 1)

[2]

MH;loss ¼ 0

gH

¼ 1

ð2:5:5Þ

ð2:5:6Þ

(2) Calculation with use of the torque loss map (ZH,i = 2)

The nominal loss moment (Fig. 2.7) is linear interpolated in the loss map [2].
(cid:1)

(cid:3)

MH;loss;nom ¼ MH;V;2

_uH;in

; MH;in; iH;act

ð2:5:7Þ

If the simulation is done with temperature-dependent losses then an additional
part is added [2]:

MH;loss;nom ¼ MH;V;2 _uH;in

; MH;in; iH;act

þ MH;V;4 _uH;in

; iH; TH

ð2:5:8Þ

(cid:1)

(cid:3)

(cid:1)

(cid:3)

¼ 1 (cid:4) MH;loss;nom

gH

MH;in

ð2:5:9Þ

The actual torque loss is determined by the following formula [2].

MH;loss ¼ MH;in (cid:2) 1 (cid:4) gH

ð

Þ (cid:4) MH;loss;nom

ð2:5:10Þ

(3) Calculation with use of the efﬁciency value and the torque loss (ZG,i = 3)

The nominal loss is linear interpolated in the loss curve [2]:

MH;loss;nom ¼ MH;V;3 _uH;in

; iH;act

(cid:1)

(cid:3)

ð2:5:11Þ

MH /MH,nom

1

0

0

1

Fig. 2.7 Nominal loss moment variation [2]

SH/sH,nom

2.5 CVT—Continuously Variable Transmission (H)

59

Is the simulation done with temperature-dependent losses then the torque loss
(cid:1)
is interpolated out of the map MH;V;4 _uH;in
(cid:1)

; NH; TH

[2]:
(cid:3)

(cid:3)

MH;loss;nom ¼ MH;V;4 _uH;in

; iH;act; TH

ð2:5:12Þ

Also the efﬁciency value is selected for the actual gear [2]:

(cid:1)

(cid:3)

gH

¼ gH;V;3 iH;act

ð2:5:13Þ

The actual torque loss is evaluated as followed [2]:

MH;loss ¼ MH;in (cid:2) 1 (cid:4) gH

ð

Þ (cid:4) MH;loss;nom

ð2:5:14Þ

4) Calculation with use of the Torque Loss Map Temperature dependent

(ZG,i = 4)
The nominal loss is linear interpolated in the loss curve [2]:

MH;loss;nom ¼ MH;V;5 TH; iH;act; _uH;in

; NH

ð2:5:15Þ

(cid:1)

(cid:3)

2.6 Single Ratio Transmission (D)

The Single Ratio Transmission is a gear step with ﬁxed ratio. It can be used, e.g., as
transmission step of the differential (ﬁnal drive unit).

A drive torque will be transferred to a power take-off torque of the transmission
step by considering the transmission, the mass moments of inertia and the moment
of loss [1].

2.6.1 Properties

Switch Variation
With this switch the single ratio transmission can be given free for variation. For the
single ratio transmission the transmission ratio can be changed by multiplication
with an additional factor. The setup of the variation parameters is done in the folder.

Switch Output
If this switch is activated a result output for this component is made.

60

2 Mathematics Behind the Models

In this case the transmission ratio is deﬁned by the number of teeth of input and
output.

In this case no losses are calculated in the single ratio transmission.

Selection Button Deﬁnition
Transmission Ratio
Number of Teeth

The transmission ratio can be deﬁned in this case.
Selection Button Deﬁnition

Transmission Ratio
Number of Teeth

Selection Button Losses

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Torque Loss Map
Torque Loss Map with Torque Division
Torque Loss Map with Torque and Speed Division
Torque Loss Map Temperature Dependent

Selection Button Losses

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Torque Loss Map
Torque Loss Map with Torque Division
Torque Loss Map with Torque and Speed Division
Torque Loss Map Temperature Dependent

Selection Button Losses

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Torque Loss Map
Torque Loss Map with Torque Division
Torque Loss Map with Torque and Speed Division
Torque Loss Map Temperature Dependent

Selection Button Losses

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Torque Loss Map

In this case, the losses are calculated by a constant efﬁciency value.

In this case, the losses are calculated by a constant efﬁciency value and by a curve
which depends on the drive speed.

2.6 Single Ratio Transmission (D)

61

Torque Loss Map with Torque Division
Torque Loss Map with Torque and Speed Division
Torque Loss Map Temperature Dependent

In this case the losses are interpolated out of a torque loss map, which depends on
the gear position, the drive speed and the drive torque. At the torque and speed
division a special approximation of the maps is made by cutting through the map at
the deﬁned torque and speed values.

Selection Button Losses

Deactivated
Efﬁciency
Efﬁciency and Torque Loss Correction
Torque Loss Map
Torque Loss Map with Torque Division
Torque Loss Map with Torque and Speed Division
Torque Loss Map Temperature Dependent

In this case, the losses are calculated with the usage of up to 5 torque loss maps
Torque Loss temperature dependent where each map is associated with a
user-deﬁned constant temperature value. An interpolation between these maps is
done so that for every time step a torque loss can be generated. The temperature
used in the calculation comes through the Data Bus input Temperature. For
example, it could be connected with one of the 5 cycle-dependent temperature
characteristics in the component Vehicle.

Switch Torque Loss Correction Temperature Dependent
Here a temperature-dependent torque loss map Torque Loss Correction tempera-
ture dependent can be activated.
Switch Efﬁciency Map (for Torque Loss Maps)
When this switch is activated, the efﬁciency can be entered in a separate table
instead of the torque loss.
Switches Torque Loss Map 1–5
With these switches, for up to 5 temperature levels the associated loss maps can be
activated. This selection is only available if the selection button Losses is set to
Torque Loss Map temperature dependent.

In this case no partition of torque or speed is done. This selection is only available if
the selection button Losses is set to Torque Loss Map temperature dependent.

Selection Button Torque Loss Partition

Deactivated
Torque Partition
Torque and Speed Partition

Selection Button Torque Loss Partition

Deactivated
Torque Partition
Torque and Speed Partition

62

2 Mathematics Behind the Models

In this case a torque partition is done. A special approximation of the maps is made by
cutting through the map at the deﬁned torque values. This selection is only available if
the selection button Losses is set to Torque Loss Map temperature dependent.

Selection Button Torque Loss Partition

Deactivated
Torque Partition
Torque and Speed Partition

In this case a torque and speed partition is done. A special approximation of the
maps is made by cutting through the map at the deﬁned torque and speed values.
This selection is only available if the selection button Losses is set to Torque Loss
Map temperature dependent.

Table Division Values for the Torque Loss
For the torque and the speed range the borders for activation and deactivation can
be deﬁned here. The values are deﬁned in percentage of the maximum speed and
torque values.

2.6.2 User-Deﬁned Variables

The overall ratio can be deﬁned if this case of input is chosen in the properties.

Transmission Ratio

Number of Teeth Input
Number of Teeth Output

–

–
–

The user can put in the transmission ratio or the number of teeth depending on

the selection in the properties (Fig. 2.8).

Inertia Moment, drive side
Inertia Moment, power take-off side

kg m2
kg m2

iD

ZD,1
ZD,2

θD,in
θD,out

Fig. 2.8 Principle
representation of a Single
Ratio Transmission [2]

MD,in

θD,in

MD,z

θD,out

MH,out

2.6 Single Ratio Transmission (D)

63

Efﬁciency and Torque Loss Correction

ƞD,V,3

Efﬁciency

–

The efﬁciency in the single ratio transmission is a ﬁxed value.

(cid:1)

(cid:3)

MD;V;3

_uD;in

Torque Loss on the drive side

Nm

The additional torque loss is deﬁned dependent on the drive speed.

Torque Loss Correction Temperature Dependent

(cid:1)

(cid:3)

MD;V;4

_uD;in

; TD

Torque Loss temperature dependent

Nm

Here an additional temperature-dependent torque loss can be deﬁned. This table
is used if the switch Torque Loss Correction temperature dependent is
activated.

If the selection button Losses is set to Efﬁciency & Torque Loss this map

replaces the general torque loss deﬁnition.

If the selection button Losses is set to Torque Loss Map a correction of the

torque loss is made.

Torque Loss Map

(cid:1)

(cid:3)

MD;V;2

_uD;in

; MD;in

Torque Loss on the drive side

Nm

Torque Loss on the drive side. The torque loss is deﬁned considering the drive

speed and the drive torque of the single ratio transmission.

Torque Loss Map Temperature Dependent

TD,i

Temperature i = 1, …, 5

°C

For each activated, temperature-dependent torque loss map, the temperature

level has to be speciﬁed.

(cid:1)

(cid:3)

MD;V;5;i

_uD;in;i

; MD;in;i

Torque loss map temperature dependent i = 1, …, 5

Nm

Here for each activated, temperature dependent torque loss map and for the
speciﬁed temperature level, the losses are deﬁned depending on speed and input
torque. This is only required if the selection button Losses is set to Torque Loss
Map temperature dependent.

When the switch Efﬁciency Map (for Torque Loss Maps) is activated, the

efﬁciency can be entered in a separate table instead of the torque loss.

_uD;in
€uD;in
MD,in
_uD;out
€uD;out
MD,out

_uD;out
MD,out
_uD;in
MD,in
PD,in
PD,out
PD,loss

64

2 Mathematics Behind the Models

2.6.3 Input and Output Variables

2.6.3.1 Mechanical Connections

Angular velocity on the drive side

Angular acceleration on the drive side

Torque on the drive side
Angular velocity on the power take-off side

Angular acceleration on the power take-off side

Torque on the power take-off side

rad/s
rad/s2
Nm
rad/s
rad/s2
Nm

2.6.3.2 Data Input

TD

Temperature

°C

2.6.3.3 Data Output

Output Speed

Output Torque
Input Speed

Input Torque
Input Power
Output Power
Power Loss

rad/s

Nm
rad/s

Nm
W
W
W

2.6.4 Computation Variables

MD,loss
MD,loss,nom
MD,loss,n
ND,act
ƞD

Loss moment
Nominal loss moment
Rotational speed contribution to the loss moment
Actual gear position
Actual efﬁciency of the transmission box

Nm
Nm
Nm
–
–

2.6 Single Ratio Transmission (D)

65

2.6.5 Equation System

2.6.5.1 Transmission ratio

If the numbers of teeth are deﬁned for the single transmission step, then the gear
ratio can be calculated: iD ¼ ZD;2
ZD;1

.

Angular Velocity and Acceleration [2]

ð2:6:1Þ

ð2:6:2Þ

ð2:6:3Þ

ð2:6:4Þ

ð2:6:5Þ

_uD;out

¼

€uD;out

¼

_uD;in
iD

€uD;in
iD

MD;loss ¼ 0

gD

¼ 1

2.6.5.2 Torque Loss

There are four kinds to take the torque loss of the gearbox in consideration.

(1) Calculation without losses (ZD,i = 1) [2]

(2) Calculation with use of the torque loss map (ZD,i = 2)

The nominal loss moment is linear interpolated in the loss map [2].

MD;loss;nom ¼ MD;V;2 _uD;in

; MD;in

(cid:1)

(cid:3)

Is the simulation done with temperature-dependent losses then an additional
part is added [2]:

MD;loss;nom ¼ MD;V;2

_uD;in

; MD;in

þ MD;V;4 _uD;in

; TD

(cid:1)

(cid:3)

(cid:1)

(cid:3)

ð2:6:6Þ

The efﬁciency is calculated as follows [2]:

¼ 1 (cid:4) MD;loss;nom

gD

MD;in

ð2:6:7Þ

66

2 Mathematics Behind the Models

(3) Calculation with use of the efﬁciency value and the torque loss (ZD,i = 3)
The rotational speed contribution to the torque loss is linear interpolated in the
loss curve [2]:

MD;loss;nom ¼ MD;V;3 _uD;in

(cid:1)

(cid:3)

ð2:6:8Þ

Is the simulation done with temperature-dependent losses then the torque loss
(cid:1)
is interpolated out of the map MD;V;4 _uD;in

[2]:

(cid:3)

; TD
(cid:1)

(cid:3)

MD;loss;nom ¼ MD;V;4 _uD;in

; TD

ð2:6:9Þ

The actual torque loss is evaluated as followed [2]:

MD;loss ¼ MD;in (cid:2) 1 (cid:4) gD;V;3

þ MD;loss;nom

ð2:6:10Þ

(cid:1)

(cid:3)

(4) Calculation with use of the efﬁciency value (ZD,i = 4)
The actual torque loss is evaluated as followed [2]:

MD;loss ¼ MD;in (cid:2) 1 (cid:4) gD;V;3

(cid:1)

(cid:3)

ð2:6:11Þ

2.7 Differential (N)

The differential unit compensates for discrepancies in the respective rotation rates of
the drive wheels: between inside and outside wheels during cornering and between
different drive axles on 4WD vehicles [1].

With rare exceptions for special applications, the differential is a bevel gear drive
unit. When the output bevel gears on the left and right sides (most common
arrangement) are of equal dimensions, the differential gears act as a balance arm to
equalize the distribution of torque to the left and right wheels [1].

When unilateral variations in road surfaces result in different coefﬁcients of
friction at the respective wheels, this balance effect limits the effective drive torque
to a level deﬁned as twice the traction force available at the wheel (tire) with the
lower coefﬁcient of friction. This wheel
then responds to the application of
excessive force by spinning. To avoid such effects a positive lock is available at the
component [1].

In the differential it is possible to deﬁne a torque split factor (Fig. 2.9).
This is required if it is used as a central differential for a four-wheel drive, as
sometimes you want to have either more torque transferred to the front or the rear
axle. This is used for preserving the driving quality of the corresponding two wheel
driven car which is either front wheel driven or rear wheel driven [1].

2.7 Differential (N)

67

Drive Side

MN,i

MN,o.1

Power
Take-off
Side 1

MN,o.2

Power
Take-off
Side 2

Fig. 2.9 Principle representation of a Differential [2]

2.7.1 Properties

Switch Output
If this switch is activated a result output for this component is made.

In this case, the calculation of losses is deactivated.

Selection Button Losses

Deactivated
Efﬁciency

Selection Button Losses

Deactivated
Efﬁciency

In this case, the losses are calculated through a user-deﬁned input of a constant
‘Stationary Efﬁciency’ value.

2.7.2 User-Deﬁned Variables

ZN,lock

Control parameter for locked/unlocked/Split Factor from Data Bus

–

This button allows the user to run the differential in a locked or an unlocked

mode or to get the torque split factor from Data Bus.

Unlocked mode means that the two power take-off torques are the same and the
speeds can be different. In the locked mode there is a rigid connection between the

68

2 Mathematics Behind the Models

unlocked

locked

Fig. 2.10 Lock modes of Differential [2]

two power take-off sides. That means that the speeds are the same and the torques
can be different (Fig. 2.10).

iN

Torque slip factor Mo,2/Mo,1

–

To have a different torque output on the power take-off side, choose the cor-
responding splitting ratio. To have the same torques on both outgoing sides, the
splitting ratio equals 1.

hN;i
hN;o;1ð2Þ

Inertia Moment on the drive side
Inertia Moment on the power take-off side

kg m2
kg m2

Stationary Efﬁciency

gN;stat

shaft.

Efﬁciency

–

The stationary efﬁciency η is the efﬁciency of the differential with ﬁxed input

If the properties switch ‘Losses’ is set to ‘Efﬁciency’, AVL CRUISE calculates

in every time step the actual losses depending on the ﬁxed efﬁciency η.

2.7 Differential (N)

69

2.7.3 Input and Output Variables

2.7.3.1 Mechanical Connections

_u

N;in
uN;in
MN,in
_u

N;out;1ð2Þ
uN;out;1ð2Þ
MN,out,1(2)

Angular velocity on the drive side

Angular acceleration on the drive side

Torque on the drive side
Angular velocity on the power take-off side 1(2)

Angular acceleration on the power take-off side 1(2)

Torque on the power take-off side 1(2)

rad/s
rad/s2
Nm
rad/s
rad/s2

Nm

iN,ext

Torque Split Factor External

–

2.7.3.2 Data Input

2.7.3.3 Data Output

_uN;in
MN,in
MN,lock
_uN;out;1ð2Þ
MN,out,1(2)
PN,in
PN,out,1(2)
PN,loss

Input Speed

Input Torque
Lock Torque
Output Speed 1(2)

Output Torque 1(2)
Input Power
Output Power 1 (2)
Power Loss

2.7.4 Computation Variables

MN,lock
iN,sum
iN,inv

Lock Moment
Summation Moment ratio
Split ratio inversion

rad/s

Nm
Nm
rad/s

Nm
W
W
W

Nm
–
–

70

2 Mathematics Behind the Models

2.7.5 Equation System

Gear Ratio

At ﬁrst the split ratio for the inversion is determined [2]:

The second ratio which is calculated is the ratio for the summation [2]:

Split Equations

Unlocked differential
For the unlocked differential the following equation for the torque is used [2]:

_uN;in

(cid:2)

ð

in þ 1

Þ ¼ _uN;out;1

þ _uN;out;2

(cid:2) iN

ð2:7:3Þ

and for the lock moment [2]:

iN;inv ¼ 1
iN

iN;sum ¼ 1 þ iN

MN;lock ¼ 0

_uN;out;1

¼ _uN;out;2

Locked differential
For the locked differential both takeoffs have the same speed [2]:

The lock moment is deﬁned as [2]:

MN;lock ¼ MN;out;1 (cid:4) MN;out;2

ð2:7:1Þ

ð2:7:2Þ

ð2:7:4Þ

ð2:7:5Þ

ð2:7:6Þ

2.8 Planetary Gearbox (PG)

The Planetary Gearbox belongs to the power split devices. It consists of three main
components: the sun gear, the planet carrier (with planets), and the ring gear. This
gearbox can be used in hybrid systems, where vehicles be driven using different
power suppliers. With the help of a planetary gear it is possible to add torque and
speed with different directions at the transmission input shafts [1].

In a planetary gear system, the speed ratio and the direction of rotation can be
changed according to which member is ﬁxed. There are three types of planetary
gear mechanisms, depending upon which member is locked (locked ring gear, or
locked planet carrier, or locked sun gear) [1].

71

Switch Output
If this switch is activated a result output for this component is made.

2.8 Planetary GearBox (PG)

2.8.1 Properties

Selection Button Input Mode

Base Ratio
Number of Teeth

Selection Button Input Mode

Base Ratio
Number of Teeth

Selection Button Losses

Deactivated
Efﬁciency

Selection Button Losses

Deactivated
Efﬁciency

In this case, the gear ratio between ring gear and sun gear, the so-called base ratio of
a planetary gearbox, are required.

In this case, the number of sun gear’s teeth and the number of ring gear’s teeth are
required.

In this case, the calculation of losses is deactivated.

In this case, the losses are calculated through a user-deﬁned input of a constant
‘Stationary Efﬁciency’ value.

2.8.2 User-Deﬁned Variables

ZPG,lock

Control parameter for locked or unlocked

–

This button allows the user to run the planetary gearbox in a locked or an

unlocked mode.

Unlocked mode means that on the three shafts (planet carrier, sun, and ring)
torques can be different and the speeds can also be different. In the locked mode
there is a rigid connection between two of them.

That means that the speeds on all shafts are the same (because of the speed’s

equation at the planetary gear) and the torques can be different.

iPG,o

Base Ratio

–

72

hPG;C
hPG;S
hPG;R
NPG,S
ZPG,R

_uPG;C
€uPG;C
MPG,C
_uPG;S
€uPG;S
MPG,S
_uPG;R
€uPG;R
MPG,R

_uPG;C
_uPG;S

Base ratio is quotient of ring gear’s teeth to the sun gear’s teeth.

2 Mathematics Behind the Models

Inertia Moment Planet Carrier
Inertia Moment Sun Gear
Inertia Moment Ring Gear
Number of teeth Sun Gear
Number of teeth Ring Gear

kg m2
kg m2
kg m2
–
–

The number of teeth for the ring gear is negative because of its internal toothing.

Stationary Efﬁciency

ƞPG,stat

Efﬁciency

–

The Stationary Efﬁciency ƞ is the efﬁciency of the so-called ‘Base Gearbox’
which is the planetary gearbox with ﬁxed planet carrier. In this case the planetary
gearbox works like a single transmission.

If the properties switch ‘Losses’ is set to ‘Efﬁciency’ AVL CRUISE calculates in
every time step the actual losses depending on the ﬁxed efﬁciency ƞ and the actual
power ﬂow direction.

2.8.3 Input and Output Variables

2.8.3.1 Mechanical Connections

Angular velocity of the Planet Carrier

Angular acceleration of the Planet Carrier

Torque on the Planet Carrier
Angular velocity of the Sun Gear

Angular acceleration of the Sun Gear

Torque on the Sun Gear
Angular velocity of the Ring Gear

Angular acceleration of the Ring Gear

Torque on the Ring Gear

rad/s
rad/s2
Nm
rad/s
rad/s2
Nm
rad/s
rad/s2
Nm

2.8.3.2 Data Output

Angular velocity of the Planet Carrier

Angular velocity of the Sun Gear

rad/s

rad/s

(continued)

2.8 Planetary GearBox (PG)

73

_uPG;R
MPG,C
MPG,S
MPG,R

PPG,C

PPG,S
PPG,R
PPG,loss

Angular velocity of the Ring Gear

Torque on the Planet Carrier
Torque on the Sun Gear
Torque on the Ring Gear
Power—Planet Carrier
Power—Sun Gear
Power—Ring Gear
Power Loss

rad/s

Nm
Nm
Nm
W
W
W
W

2.8.4 Equation System

The speed equation of the planetary gearbox [2]:

(cid:1)

(cid:3)

_uPG;S

(cid:4) 1 þ iPG;o

(cid:2) _uPG;C

þ iPG;o (cid:2) _uPG;R

¼ 0

ð2:8:1Þ

Locked Planetary Gearbox
For the locked planetary gearbox all shafts have the same speed [2]:

_uPG;S

¼ _uPG;C

¼ _uPG;R

ð2:8:2Þ

Under the balance conditions, the summation of all torques acting on planetary

gear is equal to zero by the stationary state of motion [2]:

MPG;S þ MPG;C þ MPG;R ¼ 0

ð2:8:3Þ

Two of the three torques always possess the same sign. The summation of their
absolute values is equal to the third torque. The shaft, which this summation leads
to, is deﬁned as summation shaft. The others are difference shafts.

There are two characteristic rules, which are very useful to analyze the complex

interaction on double pinion gearbox:

The summation shaft’s torque and difference shafts torques has opposite signs.
The torques of both Difference Shafts have the same sign.

2.9 Internal Combustion Engine (E)

The component engine contains a model for an internal combustion engine. As the
characteristic curves for the full load, the fuel consumption and others can be freely
deﬁned by the user. It is possible to deﬁne a gasoline engine as well as a diesel
engine [1].

74

2 Mathematics Behind the Models

In this component a temperature model is included to consider the inﬂuence of
the temperature on the fuel consumption and emissions while the engine is cold.
The engine will be modeled by a structure of characteristic curves and maps [1].

2.9.1 Properties

Switch Variation

With this switch the internal combustion engine can be given free for variation.
For the internal combustion engine the engine displacement can be varied. The
setup of the variation parameters is done in the folder.

Switch Output
A result output for this component is made if this switch is activated.

Switch Use for Reference
This switch is used to select one reference engine if more engines are used within a
model. Out from this engine the following data are calculated, which can then be
used in the Calculation Tasks:
(cid:129) Minimum speed
(cid:129) Maximum speed
(cid:129) Maximum torque
(cid:129) Speed at maximum torque
(cid:129) Maximum power
(cid:129) Speed at maximum power

Selection Button Intended for Calculation of

Performance
Performance and Consumption
Performance, Consumption, and Emission
Performance, Consumption, and CO2 Emission
Performance, Consumption, Emission, and CO2 Emission

By selecting this switch, different calculations are executed for which the corre-
sponding input data have to be deﬁned. For example, if “Performance” is selected
just the general data for the engine like displacement, the Full Load Characteristic
and the Motoring Curve have to be deﬁned.

Selection Button Temperature Model

Deactivated
Cold Start Correction
Others…

In this case no temperature calculation and no correction of the fuel consumption or
the emissions will take place.

2.9 Internal Combustion Engine (E)

75

Selection Button Temperature Model

Deactivated
Cold Start Correction
Others…

The actual fuel consumption is multiplied with the cold start factor which is deﬁned
in the component vehicle. The factor can be deﬁned for different cycles as a
function of time. In the task (Cycle Run and Cruising), the switch ‘Cold Start
Correction’ has to be activated.

Selection Button Temperature Model

Deactivated
Cold Start Correction
Others…
The temperature calculation, the correction of the fuel consumption or the

emissions as well as the friction calculation will be executed.

The temperature of the engine is taken out of a pre-deﬁned characteristic which
depends on time.

Selection Button Temperature
Pre-deﬁned Characteristic
Calculated
from Data Bus

Selection Button Temperature
Pre-deﬁned Characteristic
Calculated
from Data Bus
The temperature of the engine is calculated.
Selection Button Temperature
Pre-deﬁned Characteristic
Calculated
from Data Bus

When the engine temperature is calculated in an external component (Black Box,
®, Flowmaster) or the function component or deﬁned in the general map,
MATLAB
it can be transferred into the engine component through the Data Bus input channel
‘Temperature External’.

Task and cycle dependent temperature characteristics can be deﬁned in the
vehicle and the actual temperature values can be made available on the Data Bus.
For this option, the switch ‘Pre-deﬁned Temperature Curve’ has to be activated

in the task (Cycle Run and Cruising).

76

2 Mathematics Behind the Models

Selection Button Consumption Model

Warm-up Enrichment
Enrichment by Increasing Friction Mean Pressure
Enrichment by Mean Pressure Factor

The warm-up enrichment is done by a characteristic which is deﬁned as function of
the temperature.

Selection Button Consumption Model

Warm-up Enrichment
Enrichment by Increasing Friction Mean Pressure
Enrichment by Mean Pressure Factor

The warm-up enrichment is done by a calculation of the increasing friction mean
pressure due to a lower temperature.

Selection Button Consumption Model

Warm-up Enrichment
Enrichment by Increasing Friction Mean Pressure
Enrichment by Mean Pressure Factor

The warm-up enrichment is done by a calculation of a mean pressure factor which
depends on the mean pressure of the warm and the cold engine.

Selection Button Friction Model

The standard friction model is used in calculation. This option is only available if
the switch Temperature Model is set to Others…

Selection Button Friction Model

standard
advanced

standard
advanced

The advanced friction model is used in calculation. This option is only available if
the switch Temperature Model is set to Others…

Selection Button Consumption/Emissions at Idle

The consumption and the emissions at idle are as they are deﬁned in the ﬁxed
values.

Selection Button Consumption/Emissions at Idle

Fixed Value
From Overall Map
From Idle Map
First Line from Overall Map

Fixed Value
From Overall Map
From Idle Map
First Line from Overall Map

The consumption and the emissions at idle are calculated out of the overall maps for
the fuel consumption and the emissions.

2.9 Internal Combustion Engine (E)

77

Selection Button Consumption/Emissions at Idle

Fixed Value
From Overall Map
From Idle Map
First Line from Overall Map

The consumption and the emissions at idle are calculated out of detailed maps for
the fuel consumption and the emissions.

Selection Button Consumption/Emissions at Idle

Fixed Value
From Overall Map
From Idle Map
First Line from Overall Map

The data of the ﬁrst line of the overall map is used for the calculation of the
consumption/emission at idle.

Selection Button Motoring Curve Performance

From Motoring Curve
Synthetic
The deﬁned Motoring Curve is used.

Selection Button Motoring Curve Performance

From Motoring Curve
Synthetic
The Motoring Curve is determined with an empirical formula.

Selection Button Motoring Curve Consumption/Emission

In this case the deﬁned Motoring Curve is used.

Selection Button Motoring Curve Consumption/Emission

The Motoring Curve is determined with an empirical formula.

Selection Button Motoring Curve Consumption/Emission

From Motoring Curve
Synthetic
Determine from
Consumption Map

From Motoring Curve
Synthetic
Determine from
Consumption Map

From Motoring Curve
Synthetic
Determine from
Consumption Map

In this case the Motoring Curve is determined from the Fuel Consumption Map.

78

2 Mathematics Behind the Models

Switch Start Enrichment
When this switch is activated, an additional fuel injection takes place which can be
deﬁned as function of time.

Switch Acceleration Enrichment
When this switch is activated, an additional fuel
acceleration can be deﬁned as function of time.

injection takes place while

Switch Additional FC External (Mass Flow)
If this switch is enabled an additional fuel consumption from the Data Bus input
channel ‘Additional FC (Mass Flow)’ is added to the originally determined fuel
consumption.
Switch FC Coefﬁcient External
If this switch is enabled, the determined fuel consumption (inclusive additional
external FC) is multiplied with the FC coefﬁcient delivered by the Data Bus input
channel ‘FC Coefﬁcient External.’

In this case the idle speed is ﬁxed on a constant value.

Selection Button Idle Speed

Fixed Value
From Idle Speed Characteristic
From Data Bus

Selection Button Idle Speed

Fixed Value
From Idle Speed Characteristic
From Data Bus

Selection Button Idle Speed

Fixed Value
From Idle Speed Characteristic
From Data Bus

Selection Button Maximum Speed

Fixed Value
From Data Bus

Selection Button Maximum Speed

Fixed Value
From Data Bus

In this case the idle speed can be deﬁned as function of the engine temperature.

In this case the idle speed will be read from the Data Bus.

Switch Idle Speed Control
If this switch is enabled the idle speed is controlled to the deﬁned target idle speed.

In this case the constant input value for maximum speed is taken.

In this case the maximum speed will be read from the Data Bus.

2.9 Internal Combustion Engine (E)

79

In this case nor reduction of the full load is made.

In this case the full load reduction is made by a constant reduction factor.

Full Load Reduction

off
Factor
Characteristic

Full Load Reduction

off
Factor
Characteristic

Full Load Reduction

off
Factor
Characteristic

In this case the reduction is made by a characteristic. This characteristic can be
deﬁned as power, torque or BMEP versus speed.

In this case no delayed response behavior at the turbo charger is considered. Always
the full boost pressure is available.

Response Behavior Turbo Charger

deactivated
Constant Boost Pressure Build-up Time
Pressure Build-up Time from Characteristic
Constant BMEP Build-up Time
BMEP Build-up Time from Characteristic

Response Behavior Turbo Charger

deactivated
Constant Boost Pressure Build-up Time
Pressure Build-up Time from Characteristic
Constant BMEP Build-up Time
BMEP Build-up Time from Characteristic

Response Behavior Turbo Charger

deactivated
Constant Boost Pressure Build-up Time
Pressure Build-up Time from Characteristic
Constant BMEP Build-up Time
BMEP Build-up Time from Characteristic

In this case the delayed response behavior of the turbo charger is considered by a
constant boost pressure build-up time.

In this case the delayed response behavior of the turbo charger is considered by a
variable boost pressure build-up time. The pressure build-up time can be deﬁned as
function of the engine speed.

80

2 Mathematics Behind the Models

Response Behavior Turbo Charger

deactivated
Constant Boost Pressure Build-up Time
Pressure Build-up Time from Characteristic
Constant BMEP Build-up Time
BMEP Build-up Time from Characteristic

In this case the delayed response behavior of the turbo charger is considered by a
constant BMEP build-up time. This is the time which the engine takes between a
user-deﬁned BMEP start value (e.g., 2 bar) and a user-deﬁned end value (in per-
centages of maximum BMEP at reference speed 1000 rpm; e.g., 90 %).

Response Behavior Turbo Charger

deactivated
Constant Boost Pressure Build-up Time
Pressure Build-up Time from Characteristic
Constant BMEP Build-up Time
BMEP Build-up Time from Characteristic

In this case the delayed response behavior of the turbo charger is considered by a
variable BMEP build-up time. The BMEP build-up time can be deﬁned as a
function of the engine speed. It is the time which the engine takes between a
user-deﬁned BMEP start-value (e.g., 2 bar) and a user-deﬁned end value (in per-
centages of maximum BMEP at user-deﬁned speed; e.g., 90 %).

Turbo Charger Transfer Model

PT1-Behavior
PT2-Behavior

PTl-Behavior
PT2-Behavior

In this case the build-up behavior of the boost pressure is modeled by a PT1 ﬁlter.
Turbo Charger Transfer Model

In this case the build-up behavior of the boost pressure is modeled by a PT2 ﬁlter.

Switch Boost Pressure at Idle
When this switch is activated, the ‘Boost Pressure at Idle’ has to be deﬁned in an
input ﬁeld in the section ‘Turbo Charger/Boost Pressure.’ One condition is that the
selection button ‘Response Behavior Turbo Charger’ is set to ‘Constant Boost
Pressure Build-up Time’ or to ‘Pressure Build-up Time From Characteristic.’

Selection Button Testbed Power Correction

In this case no power correction is made.

Selection Button Testbed Power Correction

Deactivated
Standard

Deactivated
Standard

Off
Factor
From Characteristic

Off
Factor
From Characteristic

Off
Factor
From Characteristic

2.9 Internal Combustion Engine (E)

81

In this case a power correction on environment conditions is made. For this cor-
rection the standard 97/21/EG (April 1997) is used, which was originally developed
for the standardization of power measurements.
Switch Speciﬁc Consumption Map
When this switch is activated the speciﬁc Fuel Consumption Map is active.
Switch Full Load Gear Dependent 1–5
For deﬁned gear positions, extra Full Load Characteristics can be deﬁned. They are
used instead of the original ones.

Selection Button Full Load Reduction Gear Dependent

In this case the ‘Full Load Reduction Characteristics’ have no inﬂuence.

Selection Button Full Load Reduction Gear Dependent

In this case for every activated characteristic ‘Full Load Gear Dependent 1,…,5’ a
reduction factor has to be deﬁned. The values from the gear dependent character-
istic are multiplied with this factor.

Selection Button Full Load Reduction Gear Dependent

In this case for every activated characteristic ‘Full Load Gear Dependent 1,…,5’ an
additional ‘Full Load Reduction Characteristic’ has to be deﬁned. The values from
the reduction characteristic are subtracted from the gear dependent characteristic.

Switch Engine Brake Curve
This switch activates the engine brake curve. With this brake curve it is possible to
simulate a jake brake system. This works with changing of the valve opening
period, when the vehicle brakes. With the Data Bus input Jake Brake Activation the
consideration of the brake curve can be controlled during calculation (1..activated,
0..deactivated).

Switch Starter Current
When this switch is activated, up to 5 temperature-dependent starter current char-
acteristics can be used when the engine is started. Each characteristic is associated
with a user-deﬁned constant temperature value. An interpolation between these
maps is done so that for every time step a current depending on the actual tem-
perature can be determined.

82

2 Mathematics Behind the Models

Switch Load Signal Map
When this switch is activated the input throttle valve map is used. If this switch is
deactivated the throttle valve map will be interpolated linear between the Full Load
Characteristic and the Motoring Curve.

For all these settings different maps or input data are necessary. For not forcing

the user to put in all data the ones which are not needed are shaded.

In this case the engine is controlled by the load signal which is supplied via Data
Bus.

Selection Button Control Variable

Load Signal
Desired Torque

Selection Button Control Variable

Load Signal
Desired Torque

In this case the engine is controlled by the desired torque value which comes from
the Data Bus.

2.9.1.1 Selection Button Exhaust System Model

Standard Exhaust System Model

Advanced AVL Exhaust System Model

This should be selected if the engine is connected to the standard ‘Exhaust System’
component and the selection button intended for calculation of is set to selections
containing emission calculations.

Selection Button Exhaust System Model

Standard Exhaust System Model
Advanced AVL Exhaust System Model
This should be selected if the engine is connected to the ‘AVL Exhaust System’
component and the selection button intended for calculation of is set to selections
containing emission calculations.

2.9 Internal Combustion Engine (E)

83

2.9.2 User-Deﬁned Variables

Characteristic Data

ZE,type

State indicator for engine type

This selection button has two positions:

(cid:129) Gasoline
(cid:129) Diesel

ZE,charger

State indicator for charger type

This selection button has three positions:

–

–

(cid:129) Without: For the power correction on environment conditions it can be selected

that a naturally aspired engine is used.

(cid:129) Turbo Charger: For the power correction on environment conditions it can be

selected that a charged engine is used.

(cid:129) TC with Intercooler: For the power correction on environment conditions it can

be selected that a charged engine with intercooler is used.

VE,h

Engine Displacement

cm3

The engine displacement is the displacement of all cylinders together.
By choose a conversion on a different displacement can be done. In this case all
torques and the absolute consumption and emission values are multiplied with the
displacement ratio.

TE,W

Engine Working Temperature

°C

The engine working temperature is needed for a calculation with hot start. If hot
start is chosen the engine temperature at the beginning of the calculation is equal to
the engine working temperature. If cold start is chosen the engine temperature at the
beginning of the calculation is equal to the ambient temperature. This engine
working temperature means always the temperature of the equivalent mass which is
used for the calculation of the engine temperature.

NE,c
NE,stroke
ΘE

Number of Cylinders
Number of Strokes (two-stroke 2, four-stroke 4)
Inertia Moment

–
–
km2

The mass moment of inertia contains all parts of the engine like the crankshaft,

the ﬂywheel, a possible fan, the camshaft, and others.

tE,add

Response Time

s

84

_uE;max

Fuel Type

Idle

_uE;idle;base

bE,idle
eE,NOx,idle
eE,CO,idle
eE,HC,idle
eE,Soot,idle

deﬁned.

2 Mathematics Behind the Models

The response time is the time the engine needs to build up the full power.

Maximum Speed

rpm

It is possible to deﬁne a maximum speed for the engine. If the engine speed is

above this speed the fuel injection will be stopped.

zE,fuel
ρE,fuel
HE,fuel
zE,C

Type of Fuel (denomination: diesel, gasoline, hydrogen, methanol, …)
Fuel Density
Heating Value
Weight Rate Carbon

–
kg/m3
kJ/kg
–

Here the characteristic data of the fuel like the density or the heating value are

input. They are used for temperature and emission calculations of the motor.

Idle Speed

rpm

Here the ﬁxed value for the idle speed can be deﬁned. This value is used when

the selection button Idle Speed is set to Fixed Value.

Idle Fuel Consumption
Idle NOx Emission
Idle CO Emission
Idle HC Emission
Idle Soot Emission

l/h
kg/h
kg/h
kg/h
kg/h

Here the ﬁxed values for the idle consumption and the idle emissions can be

These values are used when the selection button Consumption/Emissions at

Idle is set to ﬁxed value.

Fuel Shut-Off
The fuel shut-off is used to switch off the fuel injection while the engine is in thrust
operation. With this the fuel consumption can be decreased.

Selection Button Fuel Shut-Off

Absolute Speed Limits

This activates the deﬁnition of absolute lower and upper speed values for fuel shut-off.

Relative Speed Differences
Selection of this option activates the input ﬁelds ‘Speed Difference above Idle
Speed for Lower Speed Limit’ and ‘Speed Difference above Idle Speed for Upper
Speed Limit.’

2.9 Internal Combustion Engine (E)

85

With these speed difference deﬁnitions, a deﬁnition of the speed limits relative to

the idle speed can be done.

This is useful if the idle speed is not ﬁxed to a constant value during the
calculation, e.g., when a temperature-dependent idle speed characteristic is used.

Cut-Off Signal from Data Bus

The user can create his own cut-off control and connect the cut-off signal via
Data Bus to the engine component via the new Data Bus input ‘Fuel Shut-Off
Activation.’

When the Engine is in thrust mode and the Data Bus signal is not equal to zero,
the engine is set to cut-off mode and the ‘Residual Fuel Consumption’ is taken for
the consumption calculation. In all other cases, the engine is not in cut-off mode.

_uE;SA;low
_uE;SA;high
_uE;SA;low;rel
_uE;SA;high;rel
bE,SA
zE,SA,fc

Lower Speed Border for Fuel Shut-Off

Upper Speed Border for Fuel Shut-Off

Speed Difference Above Idle Speed for Lower Speed Limit

Speed Difference Above Idle Speed for Upper Speed Limit

Residual Fuel Consumption
Consumption Increase After Deactivation (linear/sharp rise)

rpm

rpm

rpm

rpm

l/h
–

Comments
Engine-speciﬁc information can be entered, stored, and viewed in a ‘comments’
table. The table consists of the columns ‘Description | Value | Unit.’ When adding a
row to the table, the window of a global, ‘pre-deﬁned’ comments table appears.

In the ﬁrst step, deﬁnitions for the pre-deﬁned comments table have to be done in

the form ‘Attribute | Description | Data Type | Unit.’

In the second step, rows from this global table can be selected to be added as

rows in the engine-speciﬁc comments table for the actual engine.

Friction Mean Effective Pressure (FMEP)

Standard Friction Model

TE,N
mE,eq
zE,EE

pE,fric,min
pE,fric,max
cE,fric,exp
cE,fric,p
ηE,40

Nominal Temperature
Equivalent Mass
Exhaust Proportion of Waste Energy

FMEP at Minimum Engine Speed
FMEP at Maximum Engine Speed
Exponent of FMEP Characteristic
Curvature Factor
Dynamic oil Viscosity at 40 °C

°C
kg
–

bar
bar
–
–

Pa s

86

2 Mathematics Behind the Models

Advanced Friction Model

Selection Button Friction Model
PNH Model
SLM Model

With this selection button either the PNH model or the SLM model can be chosen.

CE,bore
CE,hub
rE,compress

Bore
Hub
Compression Ratio

mm
mm
–

Selection Button Engine Layout

User speciﬁed
Typical in-line
Typical 6 Cylinder V
Typical 8 Cylinder V
Engine Layout User Speciﬁed

mm
mm
–

mm
mm

–
–

mm

dE,crsft,bearing
lE,crsft,bearing
nE,crsft,bearings
dE,conRod,bearing
lE,conRod,bearing

Crankshaft Main Bearing Diameter
Crankshaft Main Bearing Length
Number of Crankshaft Main Bearings
Big End Con Rod Bearing Diameter
Big End Con Rod Bearing Length

Selection Button Type of Valve Train

No Valve Train
SOHC Finger Follower
SOHC Rocker Arm
SOHC direct acting
DOHC direct acting
OHV Push Rods

With this selection button the type of the valve train can be speciﬁed.

nE,valves,intake
nE,valves,exhaust
CE,valve,liftMax

Number of Intake Valves Per Cylinder
Number of Exhaust Valves Per Cylinder
Maximum Valve Lift

Selection Button Type of Cam Follower Flat Follower

Roller Follower

nE,cmsft,bearings

Number of camshaft bearings

–

Selection Button Used Engine Oil
SAE 10/20/30/40
SAE 0W/30/0W/40
SAE 5W/30/5W/40

2.9 Internal Combustion Engine (E)

87

SAE 10W/30/10W/40/10W/60
SAE 15W/30

Selection Button Fuel Injection Pump installed

no
yes

Pre-deﬁned Temperature Curve

TE(t)

Engine Temperature

°C

Here the temperature characteristic of the engine can be deﬁned by the user.

Cooling Characteristic

cE,v,cool(TE)

Heat Capacity

J/K

The cooling characteristic is used for the determination of the amount of heat

which is lost to the environment.

The heat capacity has to be given as a function of the actual temperature of the

engine.

Warm-up Enrichment

ΔbE,warm-up,enrich(TE)

Consumption enrichment during warm-up

l/h

The warm-up enrichment is deﬁned as function of the engine temperature.

Start Enrichment

ΔbE,start,enrich(t)

Consumption enrichment during the ﬁrst time after starting

l/h

The start enrichment is deﬁned as function of time. The start enrichment can be

switched on and off with the switch for the start enrichment.

Acceleration Enrichment

DbE;acc;enrich _athð

Þ

Consumption enrichment during acceleration

l/h

The acceleration enrichment can be deﬁned as function of the throttle valve

speed.

It is used to inject additional fuel during stepping on the acceleration pedal. The
acceleration enrichment can be switched on and off with the switch for the accel-
eration enrichment.

88

2 Mathematics Behind the Models

Idle Speed Characteristic

_u

E;idle TEð

Þ

Idle Speed

rpm

Here the idle speed can be deﬁned as function of the engine temperature. This
characteristic is only active when the selection button Idle Speed is set to From Idle
Speed Characteristic.

Boost Pressure Build-up Time

tE,ch,build-up

Constant Boost Pressure Build-up Time

s

tE,ch,build-up ( _u

E;out)

Boost Pressure Build-up Time as Function of Speed

s

This is the time the charger needs to build up the full boost pressure.

pE,ch,idle

Boost Pressure at Idle

bar

This value is required if the option ‘‘Boost Pressure at Idle” in the Properties

Boost Pressure as absolute pressure

bar

The boost pressure has to be deﬁned as absolute pressure dependent on the

or

Boost Pressure

window is activated.

(cid:1)

(cid:3)

pE;ch

_uE;out

engine speed.

BMEP Build-up Time

tE,ch,BMEP,start

BMEP at Build-up Start

bar

This is the engines BMEP at begin of BMEP build-up time.

tE,ch,BMEP,stop

BMEP after Build-up Time, as percentages of maximum BMEP

%

This is the engines BMEP at the end of BMEP build-up time. It has to be deﬁned
as percentages of maximum BMEP at a certain speed. This speed is user-deﬁned (in
case that build-up time as function of speed is chosen), otherwise (when constant
build-up time is chosen) a reference speed of 1000 rpm is considered.

tE,ch,build-upBMEP

Constant BMEP Build-up Time

s

2.9 Internal Combustion Engine (E)

89

This value has to be deﬁned if the selection button Response Behavior Turbo

Charger is set to Constant BMEP Build-up Time.

tE;ch:build(cid:4)upBMEP _uE;out

(cid:1)

(cid:3)

BMEP Build-up Time as function of speed

s

This value has to be deﬁned if the selection button Response Behavior Turbo

Charger is set to BMEP Build-up Time From Characteristic.

Charger Outlet Temperature

Temperature behind charger

°C

The temperature behind charger has to be deﬁned as function of the engine

Cooler Outlet Temperature

Temperature behind intercooler

°C

The temperature behind intercooler has to be deﬁned as function of the engine

(cid:1)
tE;ch _u

E;out

(cid:3)

speed.

(cid:1)
tE;IC _uE;out

(cid:3)

speed.

Basic Idle Maps
Idle Consumption Map

(cid:1)

_u

bE;idle

E;out

; peff

(cid:3)

Idle Emission Maps

(cid:1)

(cid:3)

_uE;out
eE;idle;NOX
(cid:1)
eE;idle;CO _uE;out
(cid:1)
eE;idle;HC _uE;out
_uE;out
eE;idle;Soot

; peff
(cid:3)
; peff
; peff
; peff

(cid:3)

(cid:1)

(cid:3)

Idle Consumption Map

l/h or kg/h

The idle consumption map is deﬁned as function of the brake mean pressure with
is only used when the selection button

the engine speed as parameter.
Consumption/Emissions at Idle is set to From Idle Map.

It

Idle Emission Map NOx

Idle Emission Map CO

Idle Emission Map HC

Idle Emission Map Soot

kg/h

kg/h

kg/h

kg/h

The idle emission maps are deﬁned as function of the brake mean pressure with
the engine speed as parameter. They are only used when the selection button
Consumption/Emissions at Idle is set to From Idle Map.

90

2 Mathematics Behind the Models

Extended Idle Maps

The following maps are only used when the selection button Consumption/
Emissions at Idle is set to From Idle Map and the selection button Exhaust
System Model is set to Advanced AVL Exhaust System Model.

(cid:1)

(cid:3)

_uE;out
eE;idle;O2
(cid:1)
eE;idle;H2O _uE;out
_uE;out
eE;idle;CO2
(cid:1)
_uE;out
eE;idle;H2

; peff
; peff
; peff
(cid:3)
; peff

(cid:1)

(cid:3)

(cid:3)

Idle Emission Map O2

Idle Emission Map H2O

Idle Emission Map CO2

Idle Emission Map H2

kg/h

kg/h

kg/h

kg/h

The idle emission maps are deﬁned as a function of the brake mean pressure with

the engine speed as parameter.

(cid:1)

eE;idle;exh

TE;idle;exh

_uE;out
(cid:1)
_uE;out

; peff
; peff

(cid:3)

(cid:3)

Idle Exhaust Mass Flow Characteristic

Idle Exhaust Temperature Characteristic

kg/h
°C

In the idle exhaust temperature characteristic the temperature is listed dependent

on the mean pressure with the engine speed as parameter.

Basic Engine Maps
Fuel Consumption Maps
Absolute Consumption Map

(cid:1)

(cid:3)

bE;h

_uE;out

; peff

Fuel Consumption Map

l/h or kg/h

At

the Fuel Consumption Map the actual fuel consumption for stationary
operation is listed depending on the brake mean pressure with the engine speed as
parameter. This kind of representation is used to make a unique relation between the
brake mean pressure and the fuel consumption for a given engine speed.

For the idle consumption there are different possibilities. By choose it can be
interpolated out of the Fuel Consumption Map or the deﬁned value is used. If the
mean pressure is out of the deﬁned range the corresponding values are extrapolated.
Speciﬁc Consumption Map

(cid:1)

(cid:3)

bE;spec

_uE;out

; peff

Speciﬁc Fuel Consumption Map

l/kWh or kg/kWh

The Fuel Consumption Map can also be deﬁned as Speciﬁc Consumption
Map. By a switch the Speciﬁc Consumption Map can be converted into the absolute
one. The Speciﬁc Consumption Map is only used when the corresponding switch is
activated.

Both maps can also be represented in iso-lines, where all three input values can

be used as parameter of the representation.

2.9 Internal Combustion Engine (E)

91

kg/h

kg/h

kg/h

kg/h

kg/h

kg/h

kg/h

kg/h

Emission Maps

(cid:1)

(cid:3)

_uE;out
eE;NOX
(cid:1)
bE;CO _uE;out
(cid:1)
bE;HC _uE;out
(cid:1)
_uE;out
bE;Soot

; peff
(cid:3)
; peff
; peff
; peff

(cid:3)

(cid:3)

NOx Emission Map

CO Emission Map

HC Emission Map

Soot Emission Map

In the emission maps the emissions for the different exhaust gases are listed

dependent on the mean pressure with the engine speed as parameter.

Extended Engine Maps

The following maps are only used when the selection button Exhaust System

Model is set to Advanced AVL Exhaust System Model.

(cid:1)

(cid:3)

_uE;out
eE;O2
(cid:1)
eE;H2O _uE;out
(cid:1)
_uE;out
eE;CO2
(cid:1)
_uE;out
eE;H2

; peff
; peff
; peff
(cid:3)
; peff

(cid:3)

(cid:3)

O2 Emission Map

H2O Emission Map

CO2 Emission Map

H2 Emission Ma

In the emission maps the emissions for the different exhaust gases are listed

dependent on the mean pressure with the engine speed as parameter.

(cid:1)

eE;exhaust

TE;exhaust

_uE;out
(cid:1)
_uE;out

; peff
; peff

(cid:3)

(cid:3)

Exhaust Mass Flow Characteristic

Exhaust Temperature Characteristic

kg/h
°C

In the exhaust temperature characteristic the temperature is listed dependent on

the mean pressure with the engine speed as parameter.

Full Load Characteristic
Test Environment

pE,env,dyno
TE,env,dyno
ρE,W,env,dyno

Air Pressure at the test bench run
Air Temperature at the test bench run
Absolute Humidity at the test bench run

bar
°C
kg/m3

The environment conditions at the test bench run are used for the power cor-

rection on environment conditions.

Full Load Characteristic optionally:

Full Load Characteristic as power

W

(cid:1)

(cid:3)

PE;vk

_uE;out

or

(cid:1)

(cid:3)

ME;vk

_uE;out

Full Load Characteristic as torque

Nm

2 Mathematics Behind the Models

Full Load Characteristic as BMEP

bar

The full load characteristic can be deﬁned either as power, as torque or as brake

mean pressure dependent on the engine speed.

Full Load Reduction
Constant Reduction Factor

Reductions Factor

–

The Full Load Characteristic is multiplied with this factor over the whole speed

Full Load Reduction Characteristic optional:

Full Load Reduction Characteristic as power

W

Full Load Reduction Characteristic as torque

Nm

92

or

(cid:1)

(cid:3)

pE;eff;vk

_uE;out

zE,red

range.

(cid:1)

(cid:3)

PE;vk;red

_uE;out

(cid:1)

(cid:3)

ME;vk;red

_uE;out

or

or

(cid:1)

(cid:3)

pE;eff;vk;red

_uE;out

Full Load Reduction Characteristic as BMEP

bar

The full load reduction characteristic is subtracted from the original Full Load

Characteristic.
Full Load Gear Dependent 1–5

NE,vk,geardep,i,
low
NE,vk,geardep,i,
high

Lowest Gear Position for which the gear dependent Full Load
Characteristic is active
Highest Gear Position for which the gear dependent Full Load
Characteristic is active

–

–

Lowest and highest gear position has to be deﬁned for every activated gear

dependent Full Load Characteristic.

Optionally:

(cid:1)

(cid:3)

PE;vk;red;i

_uE;out

or

ME;vk;red;i

(cid:3)

(cid:1)
_uE;out

Gear dependent Full load 1–5 as power

W

Gear dependent Full Load 1–5 as torque

Nm

2.9 Internal Combustion Engine (E)

93

or

(cid:1)

(cid:3)

pE;eff;vk;red;i

_uE;out

Gear dependent Full Load 1–5 as BMEP

bar

The gear dependent Full Load Characteristics can be deﬁned separately for the
single gears either as power, as torque or as brake mean pressure dependent on the
engine speed.

If one gear is associated with more than one of the ﬁve maps, then the ﬁrst

associated map is used for calculation.
Gear Dependent Full Load Reduction Characteristic 1–5
Constant gear dependent Reduction Factor 1–5:

zE;red;geardep

Reduction Factor

–

The associated gear dependent Full Load Characteristic is multiplied with this

factor over the whole speed range.

PE;vk;red;geardep

(cid:1)

(cid:3)

_uE;out

Gear dependent Full Load Reduction Characteristic 1–5

W

The gear dependent full load reduction characteristics are subtracted from the

associated gear dependent Full Load Characteristics.

Motoring Curve
Optionally:

(cid:1)

(cid:3)

PE;sk

_uE;out

(cid:1)

(cid:3)

ME;sk

_uE;out

or

or

(cid:1)

(cid:3)

pE;eff;sk

_uE;out

Motoring Curve as power

W

Motoring Curve as torque

Nm

Motoring Curve as BMEP

bar

In the Motoring Curve, the friction of the engine is described considering the idle
torque the engine can deliver at the special engine speed. The Motoring Curve can
be deﬁned similar to the Full Load Characteristic either as power, as torque or as
brake mean pressure dependent on the engine speed.

94

2 Mathematics Behind the Models

Engine Brake Curve
Optional:

(cid:11)
PE;plc xE;out

(cid:12)

(cid:11)
ME;plc xE;out

(cid:12)

or

or

(cid:11)
pE;plc xE;out

(cid:12)

Engine Brake Curve as power

W

Engine Brake Curve as torque

Nm

Engine Brake Curve as mean pressure

Pa

In the engine brake curve, the back pressure of the engine is described con-
sidering the brake torque the engine can deliver in the case of a braking. The power
loss curve can be deﬁned similar to the load characteristic either as power, as torque
or as brake mean pressure dependent on the engine speed.

With the Data Bus input Jake Brake Activation the consideration of the brake

curve can be controlled during calculation (1…activated, 0…deactivated).

Starter Current

IE;start;iðtÞ

Sequence of the Starter Current at the starting process, deﬁned for up to 5
temperature levels

A

The starter current characteristics are used for the start-stop automatic (if this

special component is used).

For each characteristic a temperature level has to speciﬁed; the current is deﬁned

depending on time.

Load Signal Map

(cid:1)

(cid:3)

aE;th

_uE;out

; peff

Load Signal Map

%

The throttle valve positions can be deﬁned dependent on the engine speed and

the brake mean pressure.

2.9 Internal Combustion Engine (E)

95

2.9.3 Input and Output Variables

2.9.3.1 Mechanical Connections

_uE;out
€uE;out
ME,out

Engine angular velocity on the power take-off side

Engine angular acceleration on the power take-off side

Engine torque on the power take-off side

rad/s
rad/s2
Nm

2.9.3.2 Input Values

αE,th
KE,start

QE,Q

TE
KE,activ
_uE;idle
KE,jake brake
ME,desired
_uE;max
bE,add
bE,coeff,ext

KE,shut-off

αE,th
bE,h,act
PE,emis
eE,NOx,act
eE,CO,act
eE,HC,act
eE,soot,act
eE;CO2
eE;H2
;act
eE;O2
;act
eE;H2O;act
TE
KE,operate

;act

2.9.3.3 Output Values

Load Signal
Start Switch
Battery Charge
Temperature external
Engine Activation
Idle Speed

Jake Brake Activation
Desired Torque
Maximum Speed

Additional FC (Mass Flow)
FC Coefﬁcient External
Fuel Shut-Off Activation

–
–

A s
K
–

rad/s
–

Nm
rad/s

kg/s
–
–

Actual Load Signal
Fuel Consumption (Volume Flow, instantaneous)
Exhaust Gas Energy
Emission NOx (instantaneous)
Emission CO (instantaneous)
Emission HC (instantaneous)
Emission Soot (instantaneous)
Emission CO2 (instantaneous)
Emission H2 (instantaneous)
Emission O2 (instantaneous)
Emission H2O (instantaneous)
Engine Temperature (instantaneous)
Operation Control

–
m3/s
W
kg/s
kg/s
kg/s
kg/s
kg/s

kg/s

kg/s

kg/s

K
–
(continued)

2.9.4 Computation Variables

96

_uE;out
ME,pre
ME,post

PE
eE,exhaust
TE,exhaust
bE,massFlow,act
pE
PE,loss

peff,vk
peff,sk
pE,env,dry,dyno
RWet
TE,inlet,dyno
pE,inlet,dyno
ηE,ch
ηE,IC
TE,Mot
pE,Mot,dry
TE,inlet,act
pE,inlet,act
pE,ch,over,dyno
pE,ch,over,act
pE,ch,act

TE,ch,act

FA
fm
αpow,corr
peff,theo

peff,theo,old
peff,max
PE,heat
PE,cool

2 Mathematics Behind the Models

Speed

Torque before Flywheel
Torque behind Flywheel
Engine Power
Exhaust Mass Flow
Exhaust Temperature
Fuel Consumption (Mass Flow, instantaneous)
BMEP
Power Loss

rad/s

Nm
Nm
W
kg/s
K
kg/s
Pa
W

Brake mean pressure at full load curve for _uE;out
Brake mean pressure at Motoring Curve for _uE;out
Dry Pressure of the environment on the test bench
Gas Constant of the wet air
Air Temperature at the inlet on the test bench
Dry pressure at the inlet on the test bench
Charger Efﬁciency
Intercooler Efﬁciency
Temperature in the power house at the actual driving conditions
Dry Pressure in the power house at the actual driving conditions
Air Temperature at the inlet at the actual driving conditions
Dry pressure at the inlet at the actual driving conditions
Dry Over Pressure of the charger at the test bench
Dry Over Pressure of the charger at the actual driving conditions
Dry Absolute Pressure behind the charger at the actual driving
conditions
Air Temperature behind the charger at the actual driving conditions
Atmospheric Correction Factor
Engine Factor
Power Correction Factor
Actual brake mean pressure out of engine map for instantaneous
throttle position
Brake mean pressure for the last time step
Maximum brake mean pressure
Heat produced by combustion
Energy ﬂow in the cooling system

Pa

Pa

Pa
J/kg K
K
Pa
–
–

K
Pa
K
Pa
Pa
Pa
Pa

K
–
–
–

Pa

Pa
Pa
W
W
(continued)

W/K
Pa
Pa.s
Pa.s
Pa
Nm
Pa

ð2:9:1Þ

ð2:9:2Þ

2.9 Internal Combustion Engine (E)

97

αA
pE,fric,ref
ηE,act
ηE,ref
pE,fric,add
ME,fric
peff,loss

Actual heat capacity
Reference friction mean pressure
Dynamic oil viscosity at actual engine temperature
Dynamic oil viscosity at ref. temperature
Additional mean pressure caused by friction
Friction torque of engine
Brake mean pressure at power loss curve for _u

2.9.5 Equation System

2.9.5.1 Conversion of the Full Load Characteristic

A given Full Load Characteristic as power results in the corresponding character-
istic of moments [2]:

or as mean effective pressure [2]:

ME;vk ¼ PE;vk
_uE;out

peff;vk ¼ PE;vk (cid:2) NE;stroke (cid:2) p

VE;h (cid:2) _uE;out

A given Full Load Characteristic as moment results in the corresponding charac-
teristic as power [2]:

PE;vk ¼ ME;vk (cid:2) _uE;out

ð2:9:3Þ

or as mean effective pressure from equation.

If the Full Load Characteristic is adopted from the throttle valve map, the
corresponding maximum values for the mean effective pressure will be iteratively
assigned to the single angular velocities. In this context, it should be noted that a
subsequent consideration by means of the editor of characteristic curves seems to be
all the more useful the less the single maps are deﬁned.

The same formula can be used for the Motoring Curve.
Inside the calculation kernel everything is calculated in mean effective pressure.

98

2 Mathematics Behind the Models

2.9.5.2 Reduced Full Load Characteristic

Constant reduction factor

The whole full load curve is multiplied with this factor [2].

peff;vk ¼ pE;eff;vk (cid:2) zE;red

ð2:9:4Þ

Reduction curve

The reduction curve is subtracted from the full load curve [2].

peff;vk ¼ pE;eff;vk (cid:4) pE;eff;vk;red

ð2:9:5Þ

Reduced full load curve

If there exists a special full load curve for the selected gear then this curve is used
instead of the original one [2].

NE;vk;red;i;high \ NG;act \ NE;vk;red;i;high

peff;vk ¼ pE;eff;vk;red;i

ð2:9:6Þ

ð2:9:7Þ

2.9.5.3 Interpolation of Full Load Characteristic and Motoring Curve

for the actual engine speed

(a)

for an engine speed lower than idle speed _uE;out

\ _uE;idle

[2]:

(cid:1)

(cid:3)

linear interpolation of pE;vk;help and pE;sk;help for _uE;idle [2]:

kE;operate ¼ (cid:4)1

Dp ¼ pE;vk;help (cid:4) pE;sk;help

peff;sk ¼ (cid:4) Dp
_uE;idle

(cid:2) fE;sk (cid:2) _uE;out

þ pE;sk;help þ Dp (cid:2) fE;sk

ð2:9:10Þ

peff;vk ¼ peff;sk þ Dp
_u3

E;idle

(cid:1)

(cid:3)

(cid:2)

fE;sk (cid:4) 1

(cid:2) _u3

E;out

(cid:4) Dp
_u2
E;idle

(cid:1)
fE;sk (cid:4) 2

(cid:3)

(cid:2)

(cid:2) _u2

E;out

ð2:9:8Þ

ð2:9:9Þ

ð2:9:11Þ

2.9 Internal Combustion Engine (E)

99

fE;sk ¼ 1ðfE;sk ¼ 4 for automatic structureÞ

ð2:9:12Þ

(b)

for an engine speed higher than maximum speed _uE;out

[ _uE;max

[2]:

(cid:1)

(cid:3)

kE;operate ¼ 1

ð2:9:13Þ

linear interpolation of pE;vk;help

and

pE;sk;help

for

_uE;max [2]:

peff;vk ¼ pE;vk;help (cid:4) _uE;max

(cid:4) _uE;out

(cid:10)
(cid:10)

(cid:10)
(cid:10)

(cid:10)
(cid:10) (cid:2) NE;stroke (cid:2) p
VE;h
(cid:10)
(cid:10) (cid:2) NE;stroke (cid:2) p
VE;h

(cid:2) fE;sk

ð2:9:14Þ

ð2:9:15Þ

peff;sk ¼ pE;sk;help (cid:4) _uE;max

(cid:4) _uE;out

(c)

for normal operating conditions

_uE;idle

\ _uE;out

\ _uE;max

[2]:

(cid:3)

fE;sk ¼ 1 ðfE;sk ¼ 0
(cid:1)

for automatic structureÞ

ð2:9:16Þ

kE;operate ¼ 0

ð2:9:17Þ

linear interpolation of peff;vk and peff;sk for _uE;out

2.9.6 Power Correction on Environment Conditions

The power correction on environment conditions serves for the correction of the
Full Load Characteristic when the environment conditions the user puts in are
different from the conditions on the test bench. In this case a correction is made at
which the standard 97/21/EG (April 1997) is used, which was originally developed
for the standardization of power measurements.

For the power correction two selection buttons are used:

Selection Button Engine Type

Gasoline
Diesel

Selection Button Charger Type

Without
Turbo Charger
TC with Intercooler

With these selection buttons the factors for the power correction are ﬁxed and the
needed input maps and characteristics are activated.

To make a power correction, the standard conditions must ﬁrst be deﬁned.

100

2 Mathematics Behind the Models

These are called environment conditions during test bench run in the page of the
Full Load Characteristic. If a charger or an intercooler is used the corresponding
characteristics for the charger pressure the temperature behind charger and the
temperature behind the intercooler have to be deﬁned too. With these values the
conditions at the inlet for the test bench run and the efﬁciencies for the charger and
the intercooler can be calculated.

With the characteristics for the charger and the intercooler efﬁciency, the actual
inlet conditions can be calculated out of the actual environment conditions by
considering the temperature and pressure differences between the environment and
the power house.

With the actual inlet conditions and the ones on the test bench the correction

factors can be calculated and the Full Load Characteristic can be corrected.

(a) Inlet Conditions on the test bench

First the dry pressure of the environment at the test bench is calculated [2]:

pE;env;dry;dyno ¼ pE;env;dyno (cid:4) RWet (cid:2) TE;env;dyno (cid:2) qE;W;env;dyno

ð2:9:18Þ

with RWet = 461,521 J/kg K
These conditions are also the inlet conditions [2]:

TE;inlet;dyno ¼ TE;env;dyno

pE;inlet;dyno ¼ pE;env;dry;dyno

(b) Inlet Conditions at the Actual Driving Conditions

First, the under the hood conditions have to be calculated [2]:

TE;Mot ¼ TU;air þ TE;diff;ub

pE;Mot;dry ¼ pU;air þ pE;diff;ub (cid:4) RWet (cid:2) TE;Mot (cid:2) qU;W

The absolute humidity at environment conditions is calculated from the rel-
ative humidity using the following formulae [2]:

qU;W

¼

0

(cid:2) pW
uU;air
RWet (cid:2) TU;air

with [2]:

(cid:8)

(cid:9)

58:73895 (cid:4) 6852:493
TU;air

(cid:4) 5:262: ln TU;air

p0
W

¼ 9:80665:e

These underhood conditions are equal to the inlet conditions [2]:

ð2:9:19Þ

ð2:9:20Þ

ð2:9:21Þ

ð2:9:22Þ

ð2:9:23Þ

ð2:9:24Þ

2.9 Internal Combustion Engine (E)

TE;inlet;act ¼ TE;Mot

pE;inlet;act ¼ pE;Mot;dry

101

ð2:9:25Þ

ð2:9:26Þ

(c) Correction Factors

With the actual inlet conditions and the ones on the test bench the correction
factors can be calculated.
(cid:129) Atmospheric Correction Factor [2]:
(cid:4)
(cid:2) TE;inlet;dyno
TE;inlet;act

pE;inlet;act
pE;inlet;dyno

fA ¼ A (cid:2)

ð2:9:27Þ

þ B

(cid:5)
X

(cid:5)

(cid:4)

Y

where the factors A, B, X, and Y depend on the engine and charger type.

(cid:129) Engine Factor:

– For gasoline engines [2]:

– For diesel engines [2]:

Correct fuel delivery parameter [2]:

fm ¼ 1

ð2:9:28Þ

qc ¼ pE;Mot
pE;inlet;act

(cid:2) 1000 (cid:2) p (cid:2) NE;stroke (cid:2) bE;h;act
VE;h (cid:2) _uE;out

ð2:9:29Þ

ð

40 (cid:6) qc (cid:6) 65

Þ ! fm ¼ 0:036 (cid:2) qc (cid:4) 1:14

ð2:9:30Þ

ð

qc\40

Þ ! fm ¼ 0:3

ð

qc [ 65

Þ ! fm ¼ 1:2

(cid:129) Power Correction Factor [2]:

apow;corr ¼ fA

fm

ð2:9:31Þ

(d) Power Correction

With this power correction factor the Full Load Characteristic of the engine is
reduced [2]:

peff;vk ¼ peff;vk (cid:2) apow;corr

ð2:9:32Þ

102

2 Mathematics Behind the Models

Evaluation of the engine torque as function of the throttle position [2]:
αE,th = 0 → Motoring Curve
αE,th = 1 → Full Load Characteristic
(cid:1)

(cid:3)

peff;theo ¼ peff;sk þ peff;vk (cid:4) peff;sk

(cid:2) aE;th

ð2:9:33Þ

(cid:8)

Response Time [2]
If peff;theo

[ peff;theo;old

þ peff;max

(cid:2) Dt
tE;add

(cid:9)

peff;theo ¼ peff;theo;old þ peff;max (cid:2) Dt
tE;add

ð2:9:34Þ

2.9.7 Charger Response Behavior

The charger response behavior works very similar to the power correction. Also a
comparison between different inlet conditions is made. These conditions are the
condition with delayed response of the turbo charger and an inﬁnite response. The
inﬁnite response means that always the full boost pressure for this speed is available.
The correction is made with the same basis as the power correction, i.e., also the

correction parameters form the standard 97/21/EG (April 1997) are used.

The calculation of the charger response behavior is done after the power

correction.

by the chassis dynamometer [2]:

For the calculation without power correction the boundary conditions are deﬁned

TE;env;dyno

defined

pE;env;dry;dyno

defined

TE;Mot ¼ TE;env;dyno

pE;Mot;dry ¼ pE;env;dry;dyno

ð2:9:35Þ

ð2:9:36Þ

ð2:9:37Þ

ð2:9:38Þ

For calculation with power correction the conditions from the engine trunk has

to be used [2]:

TE;Mot

from power correction

ð2:9:39Þ

103

ð2:9:40Þ

ð2:9:41Þ

ð2:9:42Þ

(cid:3)

ð2:9:43Þ

ð2:9:44Þ

2.9 Internal Combustion Engine (E)

pE;Mot;dry

from power correction

TE;env;dyno ¼ TE;Mot

pE;env;dry;dyno ¼ pE;Mot;dry

The boost pressure increases after a response time, which is calculated as fol-

lowed [2]:

pE;ch;over;dyno ¼ pE;inlet;dyno (cid:4) pE;env;dyno (cid:4) RWet (cid:2) TE;inlet;dyno (cid:2) qE;W;env;dyno

(cid:1)

pE;ch;over;act ¼ pE;ch;over;act þ pE;ch;over;dyno (cid:2)

Dt
tE;ch;build(cid:4)up

For the response time a constant value or the value out of the map is used.

2.9.7.1 Evaluation of the engine torque [2]

αE,th = 0 → Motoring Curve
αE,th = 1 → Full Load Characteristic

peff;theo ¼ peff;sk þ peff;vk (cid:4) peff;sk

(cid:2) aE;th

(cid:1)

(cid:3)

ð2:9:45Þ

If the requested engine torque comes from the Data Bus as ‘Desired Torque,’ this

value is directly converted into peff,theo and then limited by peff,vk.

2.9.7.2 Response Time [2]

(cid:8)

(cid:9)

If peff;theo

[ peff;theo;old

þ peff;max

(cid:2) Dt
tE;add

peff;theo

¼ peff;theo;old

þ peff;max

ð2:9:46Þ

(cid:2) Dt
tE;add

2.9.8 Temperature Models

In AVL CRUISE, there are three options to determine the actual temperature of the
engine:

104

2 Mathematics Behind the Models

(cid:129) Pre-deﬁned temperature characteristic
(cid:129) Temperature from Data Bus
(cid:129) AVL temperature model

2.9.8.1 Pre-deﬁned temperature characteristic

Here the actual engine temperature is linear interpolated out of a user-deﬁned
characteristic.

2.9.8.2 Temperature from Data Bus

When the engine temperature is calculated in an external component (Black Box,
®, Flowmaster) or the function component or deﬁned in the general map,
MATLAB
it can be transferred into the engine component through the Data Bus input channel
‘Temperature External.’

Task and cycle-dependent temperature characteristics can be deﬁned in the
Vehicle and the actual temperature values can be made available on the Data Bus.
For this option, the switch ‘Pre-deﬁned Temperature Curve’ has to be activated in
the task (Cycle Run and Cruising).

2.9.8.3 AVL Temperature Model

The heat produced by the combustion can be computed by considering the fuel
consumption. This heat is distributed among the engine block and exhaust gas by a
factor. The heating of the engine can be computed by considering the temperature
loss in the radiator. Thus, the engine temperature can be computed.

This technique has two advantages: First, the actual heat ﬂow in the engine is
represented. Second, the required data can be measured on the testbed with but little
expenditure. No transient maps to be determined in a complex way are required.
For the computation of the engine temperature, the following ideas are used:
(cid:129) The heat capacity of the injected fuel (fuel consumption of the warm engine plus
additional fuel consumption caused by the increasing friction mean pressure) is
the input to the engine system (engine + cooling system). To estimate the heat
capacity of this system, an equivalent mass of water (mE,eq) with the same heat
capacity has to be given.

(cid:129) One part of the fuel energy is given off as work. The rest is divided into two
parts: The ﬁrst part goes to the exhaust gas system (ZE,EE), the second part is the
input to the equivalent mass.

2.9 Internal Combustion Engine (E)

105

The heat produced by the combustion will be computed from this formula [2]:

PE;heat ¼ bE;h;act (cid:2) qE;fuel

(cid:2) HE;fuel

ð2:9:47Þ

The mechanical power take-off [2]:

PE;act ¼ ME;act (cid:2) _uE;out

The loss power in the exhaust emissions [2]:

(cid:1)
PE;emis ¼ ZE;EE (cid:2) PE;heat (cid:4) PE;act

(cid:3)

The rest energy has to go into the cooling system [2]:

ð2:9:48Þ

ð2:9:49Þ

PE;cool ¼ PE;heat (cid:4) PE;act (cid:4) PE;emis

ð2:9:50Þ

(cid:129) For the equivalent mass a thermal balance is made.

Input is the rest of the fuel energy. Output is the energy lost to the environment
by cooling (cooling characteristic: small cooling cycle—only a small loss of heat;
large cooling cycle—high loss of heat). With the resulting stored heat in the
equivalent mass and the speciﬁc heat of the water the temperature of the equivalent
mass can be computed.

Actual engine temperature

TE
cE,v,cool Heat capacity [J/K]

evaluated.

This value is transformed [2]:

With a linear interpolation in the cooling characteristic, the value cE,v,cool is

(cid:8)
aA ¼ cE;v;cool (cid:2) 1 þ 0:4 (cid:2) vV;act
83

(cid:9)

And the engine temperature can be calculated [2]:

TE ¼ TE þ

(cid:1)

(cid:1)
PE;cool (cid:4) aA (cid:2) TE (cid:4) TW;air

(cid:3)

(cid:3)

(cid:2) Dti

mE;eq (cid:2) cp;H2O

ð2:9:51Þ

ð2:9:52Þ

where cp;H2O ¼ 4187 J
kg(cid:2)K

106

2 Mathematics Behind the Models

2.9.9 Consumption Models

In AVL CRUISE, the following models and methods can be used for the calculation
of the higher fuel consumption while the engine is cold:
(cid:129) Warm-up Enrichment
(cid:129) Cold Start Correction
(cid:129) FC External and FC Coefﬁcient External
(cid:129) Increasing Friction Mean Pressure
(cid:129) Increase by Mean Pressure Factor

2.9.9.1 Warm-up Enrichment

Here, the additional fuel consumption during warm-up is interpolated from a
user-deﬁned characteristic depending on temperature.

2.9.9.2 Cold Start Correction (for Cycle Run and Cruising)

The actual fuel consumption is multiplied with cold start factor which is deﬁned the
in the component vehicle. The factor can be deﬁned for different cycles as a
function of time. In the task, the switch ‘Cold Start Correction’ has to be activated.

2.9.9.3 FC External and FC Coefﬁcient External

FC External
An additional fuel consumption from the Data Bus input channel ‘Additional FC
(Mass Flow)’ is added to the originally determined fuel consumption.
FC Coefﬁcient External
The determined fuel consumption (inclusive additional external FC) is multiplied
with the FC coefﬁcient delivered by the Data Bus input channel ‘FC Coefﬁcient
External.’

2.9.9.4 Increasing Friction Mean Pressure

The characteristic for the friction mean pressure is given by the friction mean
pressure at minimum (pE,min) and maximum speed (pE,max) and a curvature factor
(cE,fric,p) between them (cE,fric,p = 1 means a linear characteristic; refer to Fig. 2.11).
At ﬁrst, a reference value for the mean friction pressure is calculated [2]:

2.9 Internal Combustion Engine (E)

107

Fig. 2.11 Friction mean pressure [2]

The dependence on the temperature is done via the dynamic oil viscosity. Here,
only the oil viscosity at 40 °C (ηE,40) is needed. The oil viscosity at other tem-
peratures is calculated by means of an empirical equation [2]:

fB ¼

(cid:1)

_uE;max

(cid:3)

pE;fric;max (cid:4) pE;fric;min
(cid:3)
(cid:1)
cE;fric;p(cid:4) _uE;idle
(cid:1)

(cid:3)

cE;fric;p

fA ¼ pE;fric;min (cid:4) fB (cid:2)

cE;fric;p

_uE;idle
(cid:10)
(cid:10)cE;fric;p

_uE;out

(cid:10)
(cid:10)

pE;fric;ref ¼ fA þ fB (cid:2)

fhelp ¼ 159:56 (cid:2) ln
(cid:1)

(cid:10)
(cid:10)
(cid:10)

(cid:10)
(cid:10)
(cid:10)

gE;40
1:8 (cid:2) 10(cid:4)4
(cid:1)
(cid:3)

(cid:3)

g Tð Þ ¼ 1:8 (cid:2) 10(cid:4)4 (cid:2) e

fhelp
T(cid:4)273:15þ95

(cid:4)fhelp
887

(cid:2) e

gE;act

¼ g TEð

ÞgE;ref

(cid:1)
¼ g TE;N

(cid:3)

ð2:9:53Þ

ð2:9:54Þ

ð2:9:55Þ

ð2:9:56Þ

ð2:9:57Þ

ð2:9:58Þ

For the conversion of the oil viscosity into the friction mean pressure, the
exponent of friction mean pressure (cE,vis,exp) is needed. The equation for is as
follows:

pE;fric;add ¼ pE;fric;ref (cid:2)

ð2:9:59Þ

 

(cid:10)
(cid:10)
(cid:10)
(cid:10)

gE;act
gE;ref

!

(cid:10)
(cid:10)
cE;fric;exp
(cid:10)
(cid:10)

(cid:4)1

The friction mean pressure, the Fuel Consumption Maps, and the emission maps
are given at the nominal temperature (TE,N). For the correction of the fuel con-
sumption the working point in the engine is changed. For this the change in friction,
mean pressure between the actual temperature and the nominal temperature is

108

2 Mathematics Behind the Models

Fig. 2.12 Change of working point in the cold engine [2]

calculated and added in the Fuel Consumption Map. So the working point is
changed to a higher (actual temperature is lower than the nominal temperature) or to
a lower (actual temperature is higher than the nominal temperature) mean pressure.
the fuel consumption is also increasing or

With this other working point,

decreasing (Refer to Fig. 2.12).

2.9.9.5 Increase by Mean Pressure Factor

Similar to the consumption increase by increased friction mean pressure the
increased friction mean pressure in the cold engine is calculated. In contrast to the
other method the mean pressure of the cold engine is divided by the mean pressure
of the warm engine. The factor is then applied on the fuel consumption as well as
on the emissions.

2.9.9.6 Advanced Friction Model

Introduction

The principal factors inﬂuencing a vehicle’s fuel consumption can be determined

on the basis of this deﬁnition of consumption per distance.

They can be categorized as:

1. Contribution factors related to motor (Engine Losses),
2. Drivetrain Losses, and
3. Exterior resistance

There is continuing interest in better understanding the friction losses in internal
combustion engines. These adversely affect the maximum work output and fuel

2.9 Internal Combustion Engine (E)

109

economy characteristics of an engine, directly account for much of the difference in
fuel consumption between cold and full-warm engine operation.

The engine losses may be grouped as follows:

1. Mechanical friction,
2. Pumping losses,
3. Exhaust losses, and
4. Heat transferred to the environment, convection in the coolant circuit and

radiation in engine compartment.

An accurate friction model must account for engine design variables such as
bore, stroke, and number of valves and must consider engine operating conditions
such as speed, load, and oil temperature. The friction model must also accurately
distribute the friction within the engine, and for this application, be based on
generable scalable engine parameters.

The friction model, which best satisﬁes these criteria is the one developed by
Patton et al. [3], PNH. The treatment of the power losses using PNH model is for
fully warmed-up engine running conditions. The model brake down the friction
losses into component parts associated with the main bearings, the valve train,
piston group and auxiliary components. Each friction component is used to deﬁne
and locate appropriate heat sources for the frictional heating of the lubricating oil
ﬂow.

II. Engine Losses: PNH Model

A. Mechanical Friction

1. Crankshaft

The crankshaft means effective pressure can be expressed as follows [2]:
(cid:4)

(cid:4)

(cid:5)

(cid:4)

(cid:5)

(cid:5)

fmep ¼ ccb

ND3

bLbnb

B2snc

þ Ccs

Db
B2snc

þ ctd

bnb

N2D2
nc

ð2:9:60Þ

B
S
Db
Lb
nb
nc
N
Ccb
Ccs
Ctd

Bore
Stroke
Bearing diameter
Bearing length
No. of bearings
No. of cylinders
Engine rotational Speed
Coefﬁcient of the hydrodynamic losses in main bearings
Coefﬁcient of friction losses in main bearing seals
Coefﬁcient of friction losses due to viscous dissipation

m
m
m
m
–
–

rpm
Pa/rpm m
Pa m2
Pa s2/m2 rpm

110

2 Mathematics Behind the Models

2. Piston (Reciprocating) Group

The friction means effective pressure in the reciprocating group may be
calculated using the following equation [2]:

meppb ¼ cpb

(cid:4)

(cid:5)

ND3

bLbnb

B2Snc
(cid:4)

þ Cps

Co (cid:2) Pi
Pa

0:088rc þ 0:182r

(cid:4)
þ Cpr 1 þ 103
N
(cid:5)
Þ

1:33(cid:4)2:38(cid:7)10(cid:4)2Vp

(cid:4) (cid:5)
Vp
B
ð
c

(cid:5)

(cid:4) (cid:5)
1
B2

ð2:9:61Þ

where:

Ccb
Cps
Cpr
Co
Vp

Coefﬁcient for connecting rod bearing hydrodynamics
Coefﬁcient for skirt-cylinder wall hydrodynamics
Coefﬁcient for piston ring-cylinder wall
Coefﬁcient for gas pressure to ring friction
Mean piston speed

Pa/rpm m
Pa s
Pa m2
Pa
m/s

3. Valve Train

The friction means effective pressure in the valve train is calculated using
the following equation [2]:

Fmepcv

¼cvb

(cid:4)

(cid:5)

Nnb
B2Snc
(cid:4)
þ Cvm 1 þ 103
N

þ cvo þ Cvh
(cid:5)

Lvnv
Snc

(cid:4)

(cid:5)

v N0:5nv
L1:5
BSnc

þ Fmepcam follower

Flat Cam Follower [2]:

Fmepcam follower

(cid:5)

(cid:4)
¼ Cvf 1 þ 103
N

nv
snc

Roller Cam Follower [2]:

ð2:9:62Þ

ð2:9:63Þ

Fmepcam follower

¼ Cvr

ð2:9:64Þ

(cid:4)

(cid:5)

Nnv
snc

where:

Cvb
Cvh
Cvm
Cvo
Lv

Coefﬁcient for camshaft bearing hydrodynamic
Oscillating hydrodynamic lubrication constant
Oscillating mixed lubrication constant
Boundary lubrication constant due to the camshaft bearing seals
Maximum valve lift

Pa m3/rpm
Pa m0.5/rpm0.5
Pa
Pa
m

(continued)

2.9 Internal Combustion Engine (E)

111

nv
Cvf
Cvr

No. of valves
Flat cam follower constant
Roller cam follower constant

–

Pa m
Pa m

Both of the cam followers’ constants depend on the valve train conﬁguration.

4. Auxiliary Losses

The following equation can be used to calculate the FMEP due to the
auxiliaries [2]:

Fmepaux

¼ a þ bN þ cN2

ð2:9:65Þ

The constants α, β and γ are used to be 6.23 × 103 Pa, 5.22 Pa/rpm,
−1.79 × 10−4 Pa/rpm2, respectively.

B. Pumping Losses

The correlation used by Bohic has been used. That is [2]:

Pmep ¼ 105 Disp
0:0025
(cid:3)
(cid:1)
(cid:2) 0:0785 þ 4:02(cid:7)10(cid:4)5N þ 1:06 (cid:7) 10(cid:4)8N2 þ 4:64 (cid:7) 10(cid:4)8IMEP þ 2:17(cid:7)10(cid:4)10N(cid:7)IMEP
ð2:9:66Þ
where: IMEP, Disp are the indicated mean effective pressure and engine
displacement, respectively.

III. Engine Losses: Modiﬁed PNH Model

The rate at which the engine structure and lubricating oil warm-up inﬂuences
friction losses over the cycle, because these depend on oil viscosity, which in turn
depends upon temperature. The friction power losses drop sharply over the ﬁrst 50 s
of engine warm-up [4], after which the rate of fall is greatly reduced. Such behavior
indicates that friction level changes are likely to be inﬂuenced by the oil viscosity.
The effect of viscosity changes is taken into account by scaling the instantaneous
friction loss in proportion to values for fully warmed up [2].

FmepToil

FmepToil

¼ 90 (cid:8)C

vToil
vToil ¼ 90 (cid:8)C

(cid:4)

¼

(cid:5)

0:24

ð2:9:67Þ

IV. Engine Losses: SLM Model

Shayler et al. [5], SLM, compiled and examined the model ﬁts friction teardown
data from motored engine tests on 4 cylinder diesel engines. The original purpose of
the experimental work was to examine friction losses at low temperatures and low
engine speeds in connection with studies of cold start behavior. At low, sub-zero
temperature typically between −20 and −30 °C, engine friction take causes a
substantial increase in the time taken to complete the start-up process. The focus
had been on capturing the characteristics of the experimental data for cold, low
speed operating conditions. The bulk of the experimental data was obtained through
motoring tests carried out on engines enclosed within a compact cold cell. The test

112

2 Mathematics Behind the Models

engine was motored by a DC motor with an in-line torque transducer in the
driveline connecting the DC motor and the test engine. Friction teardown was
carried out on four engine designs.

A. Mechanical Friction

1. Crankshaft

Friction Mean Effective Pressure in the crankshaft group is calculated using
the following equation [2]:

Fmepcrankshaft

¼ ccb

(cid:4)

N0:6D3

bLbnb

B2Snc

(cid:5)

(cid:4) (cid:5)
n
l
lref

þ Ccs

(cid:4)

(cid:5)

Db
B2Snc

ð2:9:68Þ

where:

Ccb
Ccs
n
μ
μref

Coefﬁcient of the hydrodynamic losses in main bearings
Coefﬁcient of friction losses in main bearing seals
Viscosity index
Oil dynamic viscosity at the operating temperature
Oil dynamic viscosity at fully warm, reference condition

Pa/rpm m
Pa m2
–

Pa s
Pa s

2. Piston (Reciprocating) Group

Means effective pressure due to the friction in the piston group is expressed
as follows [2]:

Fmeppiston

¼ cpb

 

(cid:4)

(cid:5)

N0:6D3

bLbnb

B2Snc

 

!

 

!

!

þ Cps

þ Cpr

V 0:5
p
B

V 0:5
p
B2

n

(cid:4) (cid:5)
l
lref
ð2:9:69Þ

where:

Cpb
Cps
Cpr
n

Coefﬁcient for connecting rod bearing hydrodynamics
Coefﬁcient for skirt-cylinder wall hydrodynamics
Coefﬁcient for piston ring-cylinder wall
Viscocity index (=0.4)

kPa/rpm0.6 mm
kPa mm0.5s0.5
kPa mm1.5s0.5
–

3. Valve Train

Means effective pressure due to the friction in the piston group is expressed
as follows [2]:

Fmepvalvetrain

¼ cvb

(cid:4)

(cid:5)

N0:6nb
B2Snc

n

(cid:4) (cid:5)
l
lref
v N0:5nv
L1:5
BSnc

(cid:4)

þ Cvs þ Cvh

þ fmepcam=follower

(cid:5)

n

(cid:4) (cid:5)
l
lref

(cid:4)
þ Cvm 2 þ 10

5 þ lN

(cid:5)

Lvnv
Snc

ð2:9:70Þ

2.9 Internal Combustion Engine (E)

Flat cam follower [2]:

Fmepcam follower

(cid:4)
¼ Cvf 2 þ 10

5 þ lN

(cid:5)

nv
Snc

113

ð2:9:71Þ

Roller cam follower [2]:

where:

Fmepcam follower

¼ Cvr

ð2:9:72Þ

(cid:4)

(cid:5)

Nnv
Snc

Cvb
Cvh
Cvm
Cvs
Cvf
Cvr
n

Coefﬁcient for camshaft bearing hydrodynamic
Oscillating hydrodynamic lubrication constant
Oscillating mixed lubrication constant
Boundary lubrication constant due to the camshaft bearing seals
Flat cam follower constant
Roller cam follower constant
Viscosity index

kPa mm3/rpm0.6
Pa mm0.5/rpm0.5
Pa
Pa
Pa m
Pa m
–

4. Auxiliary Losses [2]

Fmepaux

¼ a þ bN þ cN2

(cid:1)

(cid:3)

n

(cid:4) (cid:5)
l
lref

ð2:9:73Þ

For oil pump, the constants α, β, γ & viscosity index (n) are: 1.28 kPa,
7.9 × 10−3 kPa mm3/rpm, −8.4 × 10−7 kPa mm3/rpm2, 0.3 (viscosity index),
respectively. For water pump α, β, γ & viscosity index (n) 0.13 kPa,
2 × 10−3 kPa mm3/rpm, 3 × 10−7 kPa mm3/rpm2, 0.7, respectively. They are:
1.72 kPa, 6.9 × 10−4 kPa mm3/rpm, 1.2 × 10−7 kPa mm3/rpm2, 0.5,
respectively for the oil pump.

5. Pumping Losses

The model was developed for motored engines. Therefore, the pumping
losses are zero.

2.9.9.7 Fuel Consumption

(cid:1)

The fuel consumption is linearly interpolated for the engine speed _uE;out and the
mean effective pressure peff,act out of the fuel consumption map bE,h _uE;out

; pE.

For

_uE;out

\ _uE;idle

and αth < 0, the fuel consumption can optionally be taken
out of the overall map, out of the detailed map, or can be the ﬁxed idle
consumption.

(cid:3)

114

2 Mathematics Behind the Models

2.9.10 Fuel Shut-Off

The fuel shut-off is used to cut off the fuel injection while thrust operation. This is
used in modern cars to decrease the fuel consumption

zE,SA

Switch for Fuel Shut-Off (Yes/No)

–

For the fuel cut-off, two speeds are necessary to create a hysteresis so that the

fuel shut-off is not always activated and deactivated in too short times.

_uE;SA;low

Lower Speed Border for Fuel Shut-Off

rpm

This speed is the lowest speed the shut-off can work on. If the engine speed falls

below this lower speed, the fuel shut-off is deactivated.

_uE;SA;high

Upper Speed Border for Fuel Shut-Off

rpm

This speed has to be reached once that the fuel shut-off can be activated.

_uE;SA;low;rel
_uE;SA;high;rel

Speed Difference above Idle Speed for Lower Speed Limit

Speed Difference above Idle Speed for Upper Speed Limit

rpm

rpm

If ‘Relative Speed Differences’ are chosen, the upper and lower speed borders

are calculated with these values relative to the actual idle speed.

bE,SA

active.

Residual Fuel Consumption

l/h

The residual fuel consumption is the fuel consumption while the fuel shut-off is

This is, for example, needed if you have an additional heater.

zE,SA,fc

Consumption Increase after Deactivation (linear/sharp rise)

–

The button for Consumption Increase after Deactivation is to change the way
the fuel consumption is increasing after the fuel shut-off is deactivated (refer to
Figs. 2.13 and 2.14).
(cid:1)

(cid:3)

(a)

for

_uE;act

and ZE,SA,fc = activated [2]:

(cid:6) _uE;SA;low
bE;act ¼ bE;idle (cid:4) bE;idle (cid:4) bE;SA
(cid:4) _uE;idle

_uE;SA;low

(cid:1)

(cid:2)

(cid:3)

_uE;act

(cid:4) _uE;idle

ð2:9:74Þ

2.9 Internal Combustion Engine (E)

115

Fig. 2.13 Consumption increase after deactivation linear [2]

Fig. 2.14 Consumption increase after deactivation sharp rise [2]

(cid:1)

(cid:3)

(b)

for

_uE;act

[ _uE;SA;low

[2]:

bE;act ¼ bE;SA

ð2:9:75Þ

2.9.10.1 Emissions

At ﬁrst the factor of fuel consumption is evaluated. It is the relation between the
actual and the map consumption [2]:

ffuel ¼ bE;act
bE;h

ð2:9:76Þ

The emissions are linear interpolated out of the maps for _uE;act and PE,act.

116

2 Mathematics Behind the Models

This values out of the map have to be transformed with ffuel [2]:

eE;xx;act ¼ eE;xx (cid:2) ffuel

ð2:9:77Þ

2.9.10.2 Start Enrichment

Here, the additional fuel consumption after starting the engine is interpolated out of
a user-deﬁned characteristic.

2.9.10.3 Acceleration Enrichment

Here, the additional fuel consumption while stepping on the acceleration pedal is
interpolated out of a user-deﬁned characteristic.

2.9.10.4 Starter Current

The charge of battery charge caused by the engine starter is calculated [2]:
(cid:1)

(cid:3)

QE;Q ¼ QE;Q (cid:4)

0:5 (cid:2)
(cid:1)

ð
ð
IE;start ti(cid:4)1
Þ
IE;start tið Þ (cid:4) IE;start ti(cid:4)2

Þ þ IE;start tiþ1
(cid:3)
ð

Þ

ð2:9:78Þ

2.10 Generator (L)

The generator (alternator) must provide the vehicle electrical system with a sufﬁcient
supply of current under all operating conditions in order to ensure that the State of
Charge (SOC) in the engine storage device (battery) is consistently maintained at an
adequate level. The object is to achieve balanced charging, i.e., the curves for
performance and speed–frequency response must be selected to ensure that the
amount of current generated by the alternator under actual operating conditions is at
least equal to the consumption of all electrical equipment within the same period [1].
Automotive alternators are designed to supply charge voltages of 14 V (with
28 V for heavy utility vehicles) in order to maintain an adequate charge in 12 V (or
24 V) batteries.

The alternator produces alternating current. The vehicle’s electrical system, on
the other hand, requires direct current to recharge the battery and operate the
electrical equipment; it is thus direct current that must ultimately be supplied to the
electrical system. For this case a rectiﬁer must be provided to convert the alter-
nator’s three-phase alternating current into DC.

This arrangement also provides the battery from discharging when the vehicle is
stationary. In the input data for the component generator the already into direct

2.10 Generator (L)

117

current converted characteristics have to be given. The characteristics used here are
measured behind the rectiﬁer [1].

In the component generator a simple regulator is integrated. The regulator works
in that way that a threshold voltage has to be deﬁned. If the voltage of the onboard
network is below this threshold the generator is activated.

The generator will be separated from the network if the voltage of the onboard

network reaches the threshold [1].

The current delivered by the generator results from a map dependent on the
speed and the mains voltage. By considering the internal resistance, the instanta-
neous current consumption helps to acquire the torque absorbed by the generator
with the corresponding moments of loss [1].

2.10.1 Properties

Switch Output
If this switch is activated a result output for this component is made.
Selection button Deﬁnition

Efﬁciency Map
Torque and Efﬁciency Characteristic

The description of the losses in the generator is done by the efﬁciency map.
Selection button Deﬁnition

Efﬁciency Map
Torque and Efﬁciency Characteristic

The description of the losses in the generator is done by a speed dependent torque
loss (mechanical losses) and a current dependent efﬁciency (electrical losses).

2.10.2 User-Deﬁned Variables

UG,nom

Nominal Voltage

V

The nominal voltage is the threshold voltage for the regulator of the generator. If
the voltage in the onboard network is below this threshold the generator is acti-
vated. If the voltage is above the threshold the generator is deactivated.

RG,reg,equ

Equivalent Resistance Regulator

Ohm

The equivalent resistance regulator deﬁnes the gradient of the regulator voltage

(see Fig. 2.15).

θL

Inertia Moment of the generator

kg m2

118

2 Mathematics Behind the Models

UG,reg

UG,Nom

Fig. 2.15 Regulator voltage [2]

Idle Voltage

IG

RG,equ
The equivalent resistance without regulator deﬁnes the gradient of the idle voltage.
UG;idle

Idle Voltage as a function of the generator speed

Equivalent Resistance without Regulator

(cid:3)

(cid:1)

_uL;gen

V

Ohm

The idle voltage is the voltage the generator is producing without an electrical
consumer, means that there is no ﬂow of current. This idle voltage is a function of
the speed.
Efﬁciency Map

gL;idle

_uL
ð

; IL

Þ

Efﬁciency Map

–

The efﬁciency map describes all losses of the generator (mechanical and elec-

trical). It depends on speed and current.

Torque Loss

(cid:8)

(cid:9)

ML;pd;gen

_u

L;gen

Torque Loss of the generator as a function of the generator speed

Nm

The moment of loss is the mechanical loss in the generator due to friction at the
roller bearings and at the collector ring, aerodynamic friction at the fan, and, above
all, the power required to run the fan itself, which increases dramatically at higher
speeds.

Together with the torque that is transferred into electrical energy the moment of
loss builds the absorbed torque of the whole generator. The moment of loss depends
on the generator speed.
Efﬁciency

ƞL(IL)

Efﬁciency as a function of current

–

2.10 Generator (L)

119

The efﬁciency is used to consider the copper and the iron losses. The copper
losses are produced by resistance in the rotor and stator windings. Their extent is
proportional to the power-to-weight ratio, i.e., the ratio of generated electrical
power to the mass of the effective components.

The iron losses result from the hysteresis and eddy currents produced by the
alternating magnetic ﬁelds in the iron in the stator and rotor. This efﬁciency is a
function of the delivered current.

Maximum Current

(cid:8)

(cid:9)

IL;max

_u

L;gen

Maximum Generator Current as a function of the generator speed

A

The maximum generator current is the maximum current the generator can

deliver. The characteristic depends on the kind of generator (AC, DC).

2.10.3 Input and Output Variables

2.10.3.1 Mechanical Connections

Angular velocity on the drive side

Angular acceleration on the drive side

Torque on the drive side

2.10.3.2 Electrical Connections

Actual net voltage
Instantaneous generator current

rad/s
rad/s2
Nm

V
A

2.10.3.3 Data Input

ZL

Switch

–

2.10.3.4 Data Output

_uL;in
€uL;in
ML,in

UL,net
IL

UL,net
IL
_uL;in

Net Voltage
Current
Speed

V
A
rad/s

(continued)

120

ML,in
PL,el
PL,mech
PL,loss

IL,max,act
UL,max,act
_u

L;cont
IL,max,cont
UL,max,cont
CL,cont
UL,switch

2 Mathematics Behind the Models

Generator Torque
Electric Power
Mechanical Power
Power Loss

Nm
W
W
W

2.10.4 Computation Variables

Maximum generator current
Maximum generator voltage
Generator speed at nominal voltage

Generator current at nominal voltage
Generator Voltage at nominal voltage
Controller Coefﬁcient
Voltage for current switching

A
V
rad/s

A
V
–

V

2.10.5 Equation System

2.10.5.1 Charge Controlling

(a) For the generator current conditions

The maximum values of the generator current and voltage IL,max,act, UL,max,act
for a given angular velocity is evaluated out of the maps UL;idle
and
IL;max
The minimum voltage is determined be the equation [2]:

_uL;gen

_uL;gen

(cid:1)

(cid:3)

(cid:1)

(cid:3)

UL;min;act ¼ UL;max;act (cid:4)

ð2:10:1Þ

s

ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
IL;max;act
RG;equ

(b) For the controller voltage conditions

The controller current and voltage IL,max,cont, UL,max,cont for a given angular
(cid:3)
and IL;max _uL;cont
velocity _uL;cont is evaluated out of the maps UL;idle
The controller factor is deﬁned as function of the controller current [2]:

_uL;cont

(cid:1)

(cid:1)

(cid:3)

CL;cont ¼ (cid:4)RG;equ (cid:2)

1
IL;max;cont

ð2:10:2Þ

The minimum voltage ﬁxed by the controller [2]:

2.10 Generator (L)

121

UL;min;cont ¼ UL;max;cont þ CL;cont (cid:2) Ic;max;act

ð2:10:3Þ

Now the program selects between three conditions:

(a) For the generator area higher than the controller minimum voltage:

UL;min;cont (cid:6) UL;min;act ! Controller Charatcteristic

(b) For generator voltage lower than the maximum controller voltage:

UL;max;cont (cid:6) UL;max;act ! Generator Charatcteristic
(c) For the area between: → Mixed Characteristic

2.10.5.2 Controller Characteristic

The current ﬂow depends on the net and the controller minimum and maximum
voltages as well as the controller factor [2]:
(cid:1)

(cid:3)

(cid:1)

(cid:3)

IL ¼ (cid:4)

UL;net (cid:4) UL;min;cont
(cid:1)

(cid:2) ½1 (cid:4) UL;net (cid:4) UL;max;cont

(cid:3)

(cid:3)

CL;cont (cid:2) UL;net (cid:4) UL;max;cont

ð2:10:4Þ

2.10.5.3 Generator Characteristic

In the Generator Characteristic, the current ﬂow is ﬁxed by the net and the con-
troller minimum and maximum voltages as well as the maximum available gen-
erator current [2]:

 

IL ¼ (cid:4)IL;max;act (cid:4) RG;equ (cid:2) UL;net (cid:4) UL;max;act þ

(cid:1)

(cid:11)
(cid:2) 1 (cid:4) UL;net (cid:4) UL;max;act

(cid:3)

(cid:12)

s

!2

ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
IL;max;act
RG;equ

(cid:1)
(cid:2) UL;net (cid:4) UL;min;act

(cid:3)

2.10.5.4 Mixed Characteristic

In the Mixed Characteristic,
the conditions are changing between Generator
Characteristic and Controller Characteristic. The switch voltage determines the
actual used characteristic [2]:

UL;switch ¼ (cid:4) b
2 (cid:2) a

þ

r

ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
b2 (cid:4) 4 (cid:2) a (cid:2) c
2 (cid:2) a

a ¼ (cid:4)RG;equ

ð2:10:5Þ

ð2:10:6Þ

ð2:10:7Þ

122

2 Mathematics Behind the Models

 

b ¼ (cid:4)2 (cid:2) (cid:4)UL;max;act þ

s

!

ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
IL;max;act
RG;equ

(cid:2) RG;equ (cid:4) 1

CL;cont

c ¼ IC;max;act (cid:2) RG;equ (cid:2) (cid:4)UL;max;act þ

 

s

!2

ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
IL;max;act
RG;equ

þ UL;max;cont
CL;cont

ð2:10:8Þ

ð2:10:9Þ

If the net voltage is lower than the switch voltage:
UL,net < UL,switch → Generator Characteristic
else
UL,net ≥ UL,switch → Controller Characteristic

The generator efﬁciency ƞL,act for the actual loading conditions is evaluated out of
the efﬁciency curve for the actual generator current IL.

Efﬁciency

Torque

(a) Evaluation with loss torque

For the torque calculation, the loss moment and the working moment have to be
added. The loss moment ML,pd,act is interpolated out of the loss function.
Thus, we can write the equation for the whole generator torque [2]:

ML;in ¼ ML;pt;act (cid:4) IL (cid:2) UL;net
ZL (cid:2) _uL;in

ð2:10:10Þ

(b) Evaluation with efﬁciency value

The overall efﬁciency value ƞL,act is evaluated out of the map for the actual
current ﬂow and the generator speed.
Thus, we can write the equation for the whole generator torque [2]:

ML;in ¼ (cid:4) 1
gL;act

(cid:2) IL (cid:2) UL;net
(cid:2) _uL;in
gL;el

ð2:10:11Þ

2.11 Electrical Consumer (X)

Electric consumers are represented as ohmic resistors in the onboard network. They
represent an electric current loss. The number of the resistors that can be deﬁned is
user-dependent. The resistors can be ﬁxed by a constant value or by means of

2.11 Electrical Consumer (X)

123

characteristic curves. It is possible to deﬁne resistors as a function of any external
input value. It is also possible to deﬁne an external switch that switches on and off
the resistor depending on the exceeding of an external value [1].

If this switch is activated a result output for this component is made.

2.11.1 Properties

Switch Output

Selection Button Deﬁnition

Resistance
Current (Power)

Resistance
Current (Power)

The Resistance is deﬁned depending on the value of the Data Bus input ‘Set Value X’.
Selection Button Deﬁnition

In this case, the Current or Power has to be deﬁned depending on the values of the
Data Bus inputs ‘Set Value X’ and ‘Set Value Y’.

2.11.2 User-Deﬁned Variables

Ux,nom

Nominal Voltage

V

The nominal voltage is the deﬁnition of the voltage in the onboard network.

Ux,border
Zx,dir
Zx,ref
Zx,exceed

Threshold Value
Direction (positive/negative)
Reference (absolute/relative)
Exceeding of Value Range (admissible/inadmissible)

–
–
–
–

Resistance Curve

to Resistance.

The Resistance Curve has to be deﬁned if the selection button ‘Deﬁnition’ is set

Rx(setValueX)

Resistance as function of Set Value X

Ω

As described before the electrical consumer can be described as resistance
depending on any input value. In addition it is possible to deﬁne a switch for the
resistor. To do this the electrical consumer has to be connected to the Data Bus. In
this Data Bus there are two input values:

Set value: This is the value the resistance depends on.

124

2 Mathematics Behind the Models

Switch: This is used to switch the resistor on and off depending on exceeding a
deﬁnable value of the switch. For this connected switch you can deﬁne a threshold
(Ux, border) which is the border for the on and off switching.
For on and off switching there are different possibilities:
Direction (positive/negative): Positive means that the switch is turned on when
the input of the switch is above the threshold value and it is turned off when the
input of the switch is below the threshold value. If negative is chosen it is vice
versa.

Reference (absolute/relative): The resistance is deﬁned dependent on an input
value. If absolute is chosen the resistance is switched on and off when the switch is
turned on and off. If relative is chosen the resistance starts every time the switch is
turned on at zero.

Exceeding of value range (admissible/inadmissible): Sometimes it can occur that
the switch is longer open than the resistance is deﬁned or that the set value is
outside the deﬁned range (e.g. the resistance is deﬁned as a function of the engine
speed with a maximum of 6000 rpm and the engine speed reaches 6500 rpm, i.e.,
that the resistance is outside the deﬁned value range. If the exceeding of value range
is inadmissible the switch will be turned off when the deﬁned border is reached. If
exceeding of value range is admissible the resistance will be extrapolated to get data
for the resistance.

Current (Power) Map

set to Current (Power).

The Current (Power) map has to be deﬁned if the selection button ‘Deﬁnition’ is

Ix(setValueX, setValueY) or
Px(setValueX, setValueY)

Current or Power as function of Set Value X
and Set Value Y

A or
W

The Current or Power is deﬁned depending on the values of the Data Bus Inputs

‘Set Value X’ and ‘Set Value Y’.

Additionally, the map interpolation mode can be selected between ‘Continuous’
and ‘Steplike’. For further description of these modes, please refer to the description
of component ‘Map’.

2.11.3 Input and Output Variables

2.11.3.1 Electrical Connection

UX,net

IX

Net voltage
Current absorbed by the consumer

V
A

2.11 Electrical Consumer (X)

2.11.3.2 Data Input

125

SX,act
ZX,act
ZY,act

IX
UX,net

Px

2.11.3.3 Data Output

Switch
Set Value X
Set Value Y

Current
Net voltage
Power

–
–
–

A
V
W

2.11.4 Computation Variables

RX,act

Actual internal resistance

Ω

2.11.5 Equation System

The electrical consumer is switched on or off dependent on the switch and the
regulation value.

The actual inner resistance RX,act is evaluated out of the map with consideration

of the current switch position.

With this, the instantaneous current can be calculated [2]:

IX ¼ UX;net
RX;act

ð2:11:1Þ

2.12 Electric Motor (J)

The electric motor can be used for electrically driven vehicles, cars with hybrid
drive or to operate auxiliaries such as a fan or an oil pump.

The electric motor is deﬁned by means of characteristic curves. Therefore, dif-

ferent motor type models can be constructed [1].

126

2 Mathematics Behind the Models

2.12.1 Properties

Switch Output
If this switch is activated a result output for this component is made.
Selection Button Deﬁnition

The efﬁciency is deﬁned as a constant value. In addition to the torque map, the
efﬁciency-current curves (idle current map, starting current map) have to be given.
Selection Button Deﬁnition

Here the efﬁciency map has to be deﬁned. Then the current–voltage characteristic is
calculated with the efﬁciency map and the torque-speed map.
Selection Button Deﬁnition

Efﬁciency
Efﬁciency Map
Load-dependent Efﬁciency Maps
Current Map

Efﬁciency
Efﬁciency Map
Load-dependent Efﬁciency Maps
Current Map

Efﬁciency
Efﬁciency Map
Load-dependent Efﬁciency Maps
Current Map

Selection Button Deﬁnition

Efﬁciency
Efﬁciency Map
Load-dependent Efﬁciency Maps
Current Map

In addition to the torque map and the efﬁciency–current curves, there can be up to 5
load-dependent efﬁciency maps deﬁned.

The efﬁciency value of the actual voltage is interpolated from this data.

The Motor Characteristic is deﬁned by the torque map and the current–voltage map.
5. Switches: Load-Dependent Efﬁciency Map U1, …, U5

If the selection button Deﬁnition is set to Load-dependent Efﬁciency Maps, up to

5 efﬁciency maps can be deﬁned for up to 5 voltage levels.

2.12.2 User-Deﬁned Variables

θJ

Inertia Moment of the Electric Motor

kg m2

2.12 Electric Motor (J)

127

_u

J;min

_u

J;max

UJ,nom

ηJ

The minimum speed is the minimum angular velocity the electric motor can run at.

Minimum Speed

Maximum Speed

rad/s

rad/s

The maximum speed is the maximum angular velocity the electric motor can run at.

Nominal Voltage

V

The nominal voltage is deﬁned for every electric motor. Normally it should be

the same as in the whole onboard network.

Efﬁciency

%

This input can only be provided if the selection button Deﬁnition is set to

Efﬁciency.
(cid:1)

MJ

_u

; UJ

J;out

(cid:3)

(cid:1)

_u

IJ

; UJ

J;out

(cid:3)

(cid:1)

_u

gJ

; UJ

J;out

(cid:3)

Map of the output torque dependent on the speed and the voltage.

Torque–Voltage Map of Motor

Current–Voltage Map of Motor

Nm

A

Map of the absorbed current dependent on the speed and the voltage.

Efﬁciency Map

–

Efﬁciency map is dependent on the speed and the voltage. It has to be deﬁned
when selected in the property window. In addition the starting current value has to
be given.
(cid:1)

(cid:3)

Load-dependent Efﬁciency Maps i = 1, …,5

–

_u

gJ;i

J;out;i

; PJ;i

For each voltage level selected by the Load-dependent Efﬁciency Maps switches,

efﬁciency map depending on the speed and the electrical power can be deﬁned.

Idle Current Curve

A

Curve of the absorbed current dependent on the idle speed.

(cid:3)

(cid:1)

_u

IJ

J;out

(cid:1)
IJ;A hJ;out

(cid:3)

Starting Current Curve

A

Curve of the absorbed current dependent on the starting speed.

128

2 Mathematics Behind the Models

The last 2 curves must be deﬁned if the selection button Deﬁnition is set to

Efﬁciency or Load-dependent Efﬁciency Maps.

2.12.3 Input and Output Variables

2.12.3.1 Mechanical Connections

Angular velocity of the motor

Angular acceleration of the motor

Instantaneous motor torque

rad/s
rad/s2
Nm

2.12.3.2 Electrical Connections

Net Voltage
Absorbed motor current

V
A

2.12.3.3 Data Input

2.12.3.4 Data Output

Load Signal
Switch

–
–

Operation Control
Net Voltage
Speed

Electric Motor Torque
Energy Consumption
Current
Mechanical Power
Power Loss

–

V
rad/s

Nm
As
A
W
W

_u

€u

J;out

J;out
MJ,out

UJ,net
IJ

αJ
ZJ

KJ,act
UJ,net
_uJ;out
MJ,out

QJ

IJ

PJ
PJ,loss

2.12 Electric Motor (J)

129

2.12.4 Computation Variables

MJ,act
IJ,act
ηJ,act
IJ,A
PJ,el,act
PJ,mech,act
UJ,act
αJ

Actual motor moment
Actual motor current
Actual efﬁciency value of the motor
Starting Current of the motor
Actual electrical power of the motor
Actual mechanical power of the motor
Actual voltage of the motor
Load control signal

Nm
A
–

A
W
W
V
–

2.12.5 Equation System

2.12.5.1 Mechanical Part

For the actual angular velocity nact and the actual voltage the actual values of MJ are
calculated:

n, nact... (actual) speed of the motor [2]:

MJ;act ¼ Mðnact; UactÞ (cid:2) aJ

ð2:12:1Þ

For the actual angular velocity nact and the actual net voltage, the actual value of

the mechanical power is determined from the torque map M (nact, UJ,act) [2]:

PJ;mech;act ¼ MJ;act (cid:2) nact

ð2:12:2Þ

2.12.5.2 Electrical Part

Current–Voltage Map

Calculation of the actual current by the current–voltage map [2]:

(cid:1)
IJ;act ¼ I nact; UJ;net

(cid:3)
:abs aJð

Þ

ð2:12:3Þ

Constant Efﬁciency Value

Calculation by efﬁciency value, idle current map, and starting current map. Actual
electrical power [2]:

130

2 Mathematics Behind the Models

PJ;el;act ¼ PJ;mech;act

gJ

n 6¼ 0; M 6¼ 0

ð2:12:4Þ

Actual current of the motor [2]:

IJ;act ¼ PJ;el;act
UJ;act

:

ð2:12:5Þ

Special cases:
n = 0,M = 0 → Iact = 0.
n ≠ 0, M = 0 → by the idle current curve: IJ,act = I(nact).
n = 0,M ≠ 0 → by the starting current curve: IJ,act = I(MJ,act).

Efﬁciency Map

Calculation of the actual power and the actual current by the efﬁciency map and the
starting current [2]:

with ηJ,act = η(nact,Uact) with n ≠ 0 [2]:

PJ;el;act ¼ PJ;mech;act

gJ;act

IJ;act ¼ PJ;el;ct
UJ;act

ð2:12:6Þ

ð2:12:7Þ

Special case [2]:

n ¼ 0 ! IJ;act ¼ IJ;A:

ð2:12:8Þ

Load-dependent efﬁciency maps

There are maps for certain load levels.

η = f (n, PJ,mech), each U1, …,U5 can be optionally deﬁned.
Determination of the electrical power [2]:

PJ;el;act ¼ PJ;mech;ct
gJ;act

ð2:12:9Þ

whereas ηJ,act is calculated as follows:
For those (two) voltage levels with Uj (cid:6) UJ;act (cid:6) Uk the ηj,act and ηk,act act are

calculated.

2.12 Electric Motor (J)

131

These values are used for the interpolation of ηj,act.
The current is deﬁned by [2]:

IJ;act ¼ PJ;el;act
UJ;act

ð2:12:10Þ

Special cases:
n = 0,M = 0 → IJ,act = 0.
n = 0,M ≠ 0 → by the starting current curve: IJ,act = I(MJ,act).
n ≠ 0, M = 0 → by the idle current curve: IJ,act = I(nact).

Deﬁnitions of Idle and Starting

Minimal angular velocity _umin maximal angular velocity _umax... are given by the
user; Minimal torque Mmin, maximal torque Mmax … are determined by the torque
map MJ

(cid:1)
_uJ;out

; UJ

(cid:3)

If the actual values of angular velocity/torque are beyond their 1 %-limit of their

maximum values, the engine is in starting/idle status.

Starting limit
When _uact

_u0

¼ _umax

(cid:2) 0:01

¼ _u0 we consider the motor to be in standstill, and the calculation

uses the starting current curve.
Idle limit M0 = Mmax · 0.01
When Mact < M0, we consider the motor to be in idle status, and the calculation

uses the idle current curve.

2.13 Electric Machine (EM)

The Electric Machine component can be used either as an electric motor or as a
generator. There are separate Characteristic Maps for each mode. With this com-
ponent and together with the components battery H and supercapacitor, the user can
simulate hybrid systems.

The model of the electric machine contains two components, the inverter and the
electric motor. For this kind of model a Characteristic Map for the efﬁciency is used
to calculate the loss of power [1].

The thermal model takes the warm up of the electric machine into account regarding
the occurring losses. The warm up of the environment, respectively, the cooling system
due to the electric machine is not considered in the electric machine component.

The actual temperature of the semiconductor elements in the inverter must not
(not even at starting time or at transient load cycle) exceed the upper limit, since the
consequence would be the destruction of the inverter [1].

The maximal power should be restricted to avoid a exceeding of the given limit
for the temperature due to the occurring losses. Therefore, the permissible losses are

132

2 Mathematics Behind the Models

dependent on the actual temperature of the motor and the maximal moment of
inertia is determined according to these values [1].

If this switch is activated a result output for this component is made.

The efﬁciency has to be deﬁned depending on speed and power (or torque).

2.13.1 Properties

Switch Output

Selection Button Losses

Efﬁciency
Power Loss

Selection Button Losses

Efﬁciency
Power Loss

Selection Button Temperature

Calculated
From Data Bus

Calculated
From Data Bus

In this case, the power loss has to be deﬁned depending on speed and power (or
torque).

The machine temperature is calculated by the component using a special thermal
model. Selection button Temperature

The actual value of the machine temperature is taken from the Data Bus and used
for further calculations in the component.

Selection Button Current Limit

If the button is switched on, the actual current is set to the user-deﬁned limit every
time it exceeds this limit.

Selection Button Current Limit

On
Off

On
Off

When the button is switched off, the actual current has no user-deﬁned limit.

Selection Button Control Variable

Load Signal
Desired Torque

In this case the Electric Machine is controlled by Load Signal. The Data Bus Input
‘Load Signal’ has to be connected.

2.13 Electric Machine (EM)

133

Selection Button Control Variable

Load Signal
Desired Torque

In this case the electric machine is controlled by desired torque. The Data Bus input
‘Desired Torque’ has to be connected.
4. Switches: Machine Maps U2, …, U5
When these switches are deactivated, the user can enter the characteristic maps only
for one user-deﬁned constant voltage level U1. If the user activates some of the
switches U2…U5,
the Characteristic Maps of the machine (maximum power
(torque) and efﬁciency) can be deﬁned in more detail by deﬁning every map
dependent on the corresponding voltage level U2…U5 (which could be entered in
“Characteristic Maps of Machine”). In this case the actual characteristics are
interpolated out of the deﬁned maps.

2.13.2 User-Deﬁned Variables

EEM

Type of Machine

–

The user can select between an ASM (Asynchronous Motor) and a PSM

(Permanent magnetic Synchronous Motor).

MEM

Selection switch for Characteristic Maps and Curves

–

Selection between ‘motor-related’, ‘generator-related’ and ‘overall.’
motor-related: data of the Characteristic Maps have been measured in motoric
mode and are referred to the 1st drive quadrant.
generator-related: data of the Characteristic Maps have been measured in
generatoric mode and are referred to the 4th drive quadrant.
overall: 4 Quadrants mode; data for all quadrants can be entered. At least data
for
one motoric quadrant (1st or 3rd) and for one generatoric quadrant (2nd or 4th) are
required. Quadrants with no data are calculated by reﬂection over the point (0/0).

Nominal Values

UEM,nom

Nominal Voltage

V

The Nominal Voltage should be the same as in the onboard network.

ΘEM,nom
IEM,mot,max

Inertia Moment
Maximum Current–Motor

kg m2
A

2 Mathematics Behind the Models

Maximum Speed

1/min

The maximum speed is the maximum angular velocity the electric motor can run at.

Drag Torque
Maximum Current–Generator

Nm
A

Mass of Machine

Initial Temperature

kg

°C

134

_uEM;mot;max

MEM,drag
IEM,gen,max

Thermal Model

mEM

TEM,init

αEM,th

This is the temperature which the electric machine has at calculation start.

Speciﬁc Heat Transition

W/K

The speciﬁc heat transition sums up all inﬂuences (such as material, surface state

etc.), which inﬂuence the transmission of heat.

tEM,T

Thermal Time Constant of Maximum Power

s

This is the maximum time that the machine can run with maximum power.
The thermal time constant of maximum power is the time duration where the
maximum power can be delivered. During this time, the ambient temperature must
not increase.

TEM,max
CEM,th

Maximum Temperature
Speciﬁc Heat Capacity

°C
J/kg K

The speciﬁc heat capacity deﬁnes the different heating behavior of the material.
It is the energy, which is needed in order to warm up material of 1 kg mass by 1 K
(temperature).

TEM,L

Layout Temperature

°C

The layout temperature is the temperature where the electric machine has its

highest efﬁciency.

βEM,Rem

Temperature Coefﬁcient of Remanence Induction

1/K

With this coefﬁcient, the inﬂuence of the temperature on the remanence induc-

tion is deﬁned.

2.13 Electric Machine (EM)

135

Characteristic Maps of Machine

The value of the voltage level should be entered at which the following
Characteristic Maps of the machine have been measured. In addition to the U1
level, up to 4 further levels U2…U5 could be activated in the property window. For
each activated level the corresponding voltage value must be deﬁned and the
corresponding Characteristic Maps.

UEM
PEM;UEM;max

(cid:1)

(cid:3)

_uEM;out

Voltage
Maximum Power (Torque) mechanical

V
kW

Either the maximum mechanical power or the maximum mechanical torque is

deﬁned as function of the machine’s speed.

(cid:8)

(cid:9)

gEM PEM;UEM;act;_uEM;out

.

Efﬁciency

%

The Efﬁciency of the electric machine is deﬁned dependent on speed and power
to

(or torque). This has to be deﬁned if the selection button ‘Losses’ is set
Efﬁciency.

(cid:1)

(cid:3)

PEM;loss PEM;UEM;act;_uEM;out

.

Power Loss

W

The Power Loss of the electric machine is deﬁned dependent on speed and
power (or torque). This has to be deﬁned if the selection button ‘Losses’ is set to
Power Loss.

2.13.3 Input and Output Variables

2.13.3.1 Mechanical Connections

Angular velocity
Angular acceleration
Maximum of angular velocity

Torque

rad/s
rad/s2
rad/s

Nm

2.13.3.2 Electrical Connections

Net Voltage
Current

V
A

_uEMt
€uEM
_uEM;max
MEM,dt

UEM,net
IEM

136

2 Mathematics Behind the Models

2.13.3.3 Data Input

2.13.3.4 Data Output

TEM,env
TEM,ext
αEM
MEM,desired
ZEM

UEM,net
IEM
MEMt (TEM)
_u

EM;out

TEM
MEM,max,mot
MEM,max,gen
KEM,mode
KEM
KEM,overvolt
PEM,el
αEM
PEM,mech
PEM,loss

PEM,loss,max
PEM,loss
PEM,el
MEM,max
PEM,mech

Ambient temperature
External temperature
Load signal
Desired Torque
Switch

Net Voltage
Current
Torque
Angular velocity

Temperature
Maximum torque-motor
Maximum torque-generator
Operating mode
Operating control
State-Voltage overﬂow
Electric Power
Actual Load Signal
Mechanical Power
Power Loss

Maximum loss of power
Actual loss of power
Actual electric power
Maximum torque
Actual mechanical power

2.13.4 Computation Variables

°C
°C
–

Nm
–

V
A
Nm
rad/s
°C
Nm
Nm
−
−
−

W
–

W
W

kW
kW
W
Nm
kW

2.13 Electric Machine (EM)

2.13.5 Equation System

2.13.5.1 Mechanical Part

137

The actual moment of the drivetrain is given by [2]:

MEM;dt ¼ MEM (cid:4) HEM;nom €uEM;out

ð2:13:1Þ

The following calculation is used for permanent ﬁeld machines [2]:

MEMðTEMÞ ¼ ð1 þ bEM;REm

ðTEM (cid:4) TEM;LÞÞMEMðTEM;LÞ

ð2:13:2Þ

(drivetrain turned off) [2]

MEM ¼ MEM;drag _uEM

= _uEM;max

(cid:1)

(cid:3)
2

ð2:13:3Þ

For permanent ﬁeld machines the losses of

iron have to be taken into

consideration.

If the drivetrain is turned on the following calculation is used [2].

MEM ¼ kMEM;max;mot;

if k [ 0;

ð2:13:4Þ

MEM = (−k)MEM,max,gen, otherwise.
Special Case: If the torque of the generator is very small or if it is zero, then the

drivetrain is in motor-related mode to balance friction torque, etc.

2.13.5.2 Electrical Part

The electric power is given by [2]:

PEM;el ¼ PEM;mech þ PEM;loss:

ð2:13:5Þ

The loss of power PEM,loss consists of

losses of

iron, copper, and losses

It is completely transformed into heat. The mechanical power of the drivetrain is

according to friction.

deﬁned by [2]:

PEM;mech ¼ _uEMMEM

ð2:13:6Þ

There are the following conventions of the sign:
If PEM,el > 0, then the motor-related mode is chosen, else if PEM,el < 0, then the

generator-related mode is chosen.

138

2 Mathematics Behind the Models

There are two possible cases for the loss of power and the efﬁciency in
motor-related mode. There MEM,1 and _uEM;1 are the smallest data points in the
characteristic map of the machine.

Motor-related losses [2]
If MEM;out [ MEM;1;

_u

EM;out

[ _u

EM;1

PEM;loss;act ¼ PEM;mech;act

MEM;out; _uEM;out

(cid:4) 1

ð2:13:7Þ

If MEM;out [ MEM;1;

0\ _u

(cid:6) _u

EM;1

PEM;loss;act ¼ _uEM;out;1MEM; 1=

MEM;out; _uEM;out

(cid:4) 1

ð2:13:8Þ

(cid:8)

(cid:1)

1=

EM

EM;out
(cid:8)

(cid:1)

gEM

Generator-related losses [2]
(cid:10)
(cid:10)
If MEM;1 [ MEM;drag
j (cid:9) 0;
j
If MEM

(cid:10)
(cid:10); then MEM;1 is set to MEM;drag:
(cid:9) 0

_u

EM

PEM;loss ¼ PEM;mech 1 (cid:4) gEM MEM; _uEM
ð

ð

Þ

Þ

ð2:13:9Þ

j
If MEM

j (cid:9) 0; _u

ﬃ 0

EM

(cid:10)
(cid:10)

(cid:10)
(cid:10)

(cid:3)

(cid:9)

(cid:3)

(cid:9)

(cid:10)
(cid:10)

(cid:10)
(cid:10)

PEM;loss ¼ _uEM;1MEM 1 (cid:4) gEM MEM; _uEM
ð

ð

Þ

Þ

ð2:13:10Þ

Losses due to small torque [2]
If MEM;out (cid:9) 0; _uEM;out
(cid:9) 0
(cid:8)
Þ 1=

PEM;loss ¼ _uEMMEM;1 a MEM

h

(cid:1)

ð

MEM;1; _uEM

EM

þ 1 (cid:4) a MEM

ð

ð

Þ

(cid:3)

(cid:9)
(cid:4) 1

(cid:1)
(cid:1)
Þ 1 (cid:4) gEM MEM;1; _uEM

i

(cid:3)
(cid:3)

If MEM;out (cid:9) 0; _ugEM;out
PEM;loss ¼ _uEMMEM;1 a MEM

h

ð

ﬃ 0
(cid:8)
Þ 1=gEM

(cid:1)

MEM;1; _uEM;1

þ 1 (cid:4) a MEM

ð

ð

Þ

(cid:3)

(cid:9)
(cid:4) 1

(cid:1)
(cid:1)
Þ 1 (cid:4) gEM MEM;1; _uEM;1

i

(cid:3)

(cid:3)

ð2:13:11Þ

ð2:13:12Þ

where

(cid:1)

ð
a MEM

Þ ¼ MEM (cid:4) MEM;drag _uEM

2

(cid:3)

(cid:1)
= MEM;1 (cid:4) MEM;drag _uEM

(cid:3)

2

ð2:13:13Þ

The difference between the losses in motor-related mode and the losses in
generator-related mode is given by the lowest torque in the Characteristic Map and
the drag torque. In the domain above the smallest positive torque the motor-related
mode is used and the efﬁciency is unique deﬁned. In the domain below the negative
torque and below the drag torque the generator-related mode is used. In the domain

ð2:13:15Þ

(cid:3)

ð2:13:16Þ
(cid:3)
(cid:3)
(cid:3)
(cid:3)

=Rth:
ð2:13:17Þ

ð2:13:18Þ

ð2:13:19Þ

2.13 Electric Machine (EM)

139

between the described domains again the motor-related mode is being used. There a
smooth transition in the loss of power.

Furthermore the terminal current of the drivetrain is given by [2]:

IEM ¼ PEM;el=UEM;net

ð2:13:14Þ

For the maximal torque the following is deﬁned using the loss of power and [2]:

Rth ¼ 1=aEM;th

IEM ¼ PEM;el=UEM;net

(cid:1)

(cid:1)

PEM;loss;max ¼ TEM (cid:4) TEM;env þ TEM;max (cid:4) TEM

(cid:3)

(cid:1)
(cid:1)
= 1 (cid:4) exp (cid:4)1 tEM;T= CEM;thRth

(cid:1)

(cid:1)

(cid:1)

(cid:3)

MEM;max;mot ¼ MEM;max;mot PEM;loss;max; IEM;mot;max
(cid:3)

MEM;max;gen ¼ MEM;max;gen PEM;loss;max; IEM;gen;max

(cid:1)

Here the complete Characteristic Map is being searched beginning at the max-
imal permitted torque, until the loss of power is smaller than PEM,loss,max. This value
is the maximal permitted torque. The same holds for the generator-related mode.
There the maximal torque is calculated using the maximum of all angular

velocities using [2]:

MEM;max ¼ PEM;UEM;max _uEM

ð

Þ= _uEM

ð2:13:20Þ

2.13.5.3 Thermal Part

The basic equations of the transition of heat in the electric machine are [2]:

dQ ¼ mEMCEM;th dT ¼ =PEM;Wdt

ð2:13:21Þ

PEM,W is the complete power, which is transformed into heat. It consists of the heat

power due to electric losses and due to the heat transition to the environment [2]:

PW ¼ PEM;loss þ PEM;env

ð2:13:22Þ

and [2]:

(cid:1)
PEM;env ¼ aEM;th TEM (cid:4) TEM;env

(cid:3)

ð2:13:23Þ

140

2 Mathematics Behind the Models

2.14 Battery H (QH)

Together with the components supercapacitor and electric machine, the component
battery H is used for modeling hybrid vehicles.

The basic model consists of a voltage source and a resistance. The resistance is
constructed that way that complex processes within the battery can be considered.
2 RC elements can be added optionally. They describe the concentration over-

voltage and the transition overvoltage.

Also, the resistance’s dependence on the temperature can be activated optionally.
There can be modeled single cells as well as a combination of them. Therefore,

any modules can be constructed [1].

The thermal behavior of the battery is described by a thermal model. Here, the
warming caused by the losses and the cooling caused by convection is taken under
consideration [1].

If this switch is activated a result output for this component is made.

2.14.1 Properties

Switch Output

Selection Button Temperature

Calculated
From Data Bus

Selection Button Temperature

Calculated
From Data Bus

The battery’s temperature is calculated by the component using a thermal model.

The actual value of the battery’s temperature which has been calculated externally
is taken from the Data Bus and used for further calculations in the component.

Selection Button Ohmic Resistances

Constant
Temperature Dependent
Temperature and SOC Dependent

The constant values are used for the calculation.

Selection Button Ohmic Resistances

Constant
Temperature Dependent
Temperature and SOC Dependent
In this case the temperature-dependent maps for the internal resistances are used.

2.14 Battery H (QH)

141

Selection Button Ohmic Resistances

Constant
Temperature Dependent
Temperature and SOC Dependent

In this case, up to 5 ‘Battery Characteristics—Temperature and SOC Dependent’
can be used where each is associated with a user-deﬁned constant temperature
value. During calculation in every time step an interpolation between these char-
acteristics is done to generate temperature-dependent values.
Switch Coulombic Efﬁciency
This switch can only be activated if the selection button Ohmic Resistances is set
to temperature and SOC dependent.

If this switch is selected, the coulombic efﬁciency in charge mode can be deﬁned
dependent on the State of Charge. This can be deﬁned for up to 5 temperature
levels.

Switch Resistances RC Concentration Overvoltage
By activating this switch, the RC concentration overvoltage resistances are taken
into consideration during the calculation.

Switch Resistances RC Transfer Overvoltage
By activating this switch, the RC transfer overvoltage resistances are taken into
consideration during the calculation.
Switch Characteristics T1–T5
the associated ‘Battery Characteristics—Temperature and
With these switches,
SOC Dependent’ can be activated for up to 5 temperature levels. This selection is
only available if the selection button Ohmic Resistances is set to Temperature and
SOC Dependent.

2.14.2 User-Deﬁned Variables

Nominal Values of Cell

QQH,max
QQH,init

Maximum Charge
Initial Charge

The initial charge is the charge the cell has at the beginning of the calculation. It

is deﬁned as percentage of the maximum charge.

UQH,nom

Nominal Voltage

A s
%

V

142

2 Mathematics Behind the Models

The nominal voltage of the cell depends on the used material.

UQH,max

Maximum Voltage

The actual voltage of the cell should not exceed the deﬁned value of the

maximum voltage.

UQH,min

Minimum Voltage

The actual voltage of the cell should not be lower than the deﬁned value of the

V

V

minimum voltage.

Number of Cells

NQH,cells_in_row
NQH,cell_rows

Number of Cells per Cell-Row
Number of Cell-Rows

–
–

The battery’s cell structure is kind of a matrix with a constant number of rows

and a constant number of cells in each row.

Thermal Model

TQH,op

Operating Temperature

K

This is the temperature where the battery has its highest efﬁciency.

mQH,cell
αQH,th,trans

Mass of a Cell
Speciﬁc Heat Transition

kg
W/K

The speciﬁc heat transition summarizes all inﬂuences (such as material, surface

state, conductivity) which inﬂuence the transmission of heat.

CQH,th

Speciﬁc Heat Capacity

J/kg K

The speciﬁc heat capacity deﬁnes the different heating behaviors of the
material. It is the energy which is needed in order to warm up material of 1 kg mass
by 1 K.

Characteristic Maps of Machine

UQH,idle,charge(QQH,act)

Idle Voltage—Charge

V

The idle voltage—charger is the idle voltage of one cell in charge mode. There is

no electrical consumer. It is a function of the SOC.

2.14 Battery H (QH)

143

UQH,idle,discharge(QQH,act)

Idle Voltage—Discharge

V

The idle voltage—discharge of one cell is the voltage without an electrical
consumer that means there is no ﬂow of the current. It is a function of the SOC.

RQH,charge(TQH,act)

Ohmic Resistance—Charge

Ohm

The ohmic resistance—charge is the internal resistance of one cell in charge
mode. It is a function of the temperature of the battery. If the switch resistances
temperature dependent is switched off, then only a ﬁxed value is needed.

RQH,discharge(TQH,act)

Ohmic Resistance—Discharge

Ohm

The ohmic resistance—discharge is the internal resistance of one cell in dis-
charge mode. It is a dependent on the temperature of the battery. If the switch
resistances temperature dependent is switched off, then only a ﬁxed value is needed.

CQH,conc,charge

Capacity of RC Concentration Overvoltage—Charge

A s/V

The capacity of RC concentration—charge is the nominal capacity of the RC

concentration overvoltage in charge mode.

This input is only needed if the switch resistances RC concentration overvoltage

is activated.

RQH,conc,charge(TQH,act)

Resistance of RC Concentration Overvoltage—Charge

Ohm

The resistance RC concentration overvoltage—charge is the internal resistance
of the RC concentration overvoltage in charge mode. It is deﬁned as a function of
the temperature of the battery. This input is only needed if the switch resistances
RC concentration overvoltage is activated. Additionally, only a ﬁxed value is
needed, if the switch resistances temperature dependent is switched off.

CQH,conc,discharge

Capacity of RC Concentration Overvoltage—Discharge

A s/V

The capacity of RC concentration—discharge is the nominal capacity of the RC
concentration overvoltage in discharge mode. This input is only needed if the
switch resistances RC concentration overvoltage is activated.

RQH,conc,discharge(TQH,
act)

Resistance of RC Concentration Overvoltage—Discharge

Ohm

The resistance RC concentration overvoltage—discharge is the internal resis-
tance of the RC concentration overvoltage in discharge mode. It is deﬁned as a
function of the temperature of the battery. This input is only needed if the switch

144

2 Mathematics Behind the Models

resistances RC concentration overvoltage is activated. Additionally, only a ﬁxed
value is needed, if the switch resistances temperature dependent is switched off.

CQH,trans,charge

Capacity of RC Transfer Overvoltage—Charge

A s/V

The capacity of RC transfer—charge is the nominal capacity of the RC transfer
overvoltage in charge mode. This input is only needed if the switch resistances RC
concentration overvoltage is activated.

RQH,trans,charge(TQH,act)

Resistance of RC Transfer Overvoltage—Charge

Ohm

The resistance RC transfer overvoltage—charge is the internal resistance of the
RC transfer overvoltage in charge mode. It is deﬁned as a function of the tem-
perature of the battery. This input is only needed if the switch resistances RC
transfer overvoltage is activated. Additionally, only a ﬁxed value is needed, if the
switch resistances temperature dependent is switched off.

CQH,trans,discharge

Capacity of RC Transfer Overvoltage—Discharge

A s/V

The capacity of RC transfer—discharge is the nominal capacity of the RC
transfer overvoltage in discharge mode. This input is only needed if the switch
resistances RC concentration overvoltage is activated.

RQH,trans,discharge(TQH,act)

Resistance of RC Transfer Overvoltage—Discharge

Ohm

The resistance RC transfer overvoltage—discharge is the internal resistance of
the RC transfer overvoltage in discharge mode. It is deﬁned as a function of the
temperature of the battery. This input is only needed if the switch resistances RC
transfer overvoltage is activated. Additionally, only a ﬁxed value is needed, if the
switch resistances temperature dependent is switched off.
Battery Characteristics—Temperature and SOC Dependent
The following input is only required if the selection button Ohmic Resistances is
set to Temperature and SOC Dependent.

TG,i

Temperature i = 1, …, 5

°C

For each activated, temperature depending ‘battery characteristics—temperature

and SOC dependent’, the temperature level has to be speciﬁed.

UQH,idle,charge,i(QQH,act)
UQH,idle,discharge,i(QQH,act)

Idle Voltage—Charge i = 1, …, 5
Idle Voltage—Discharge i = 1, …, 5

V
V

For each activated, temperature depending ‘battery characteristics—temperature
and SOC dependent’, the idle voltage has to be deﬁned depending on the State of
Charge.

2.14 Battery H (QH)

145

RQH,charge,i(QQH,act)
RQH,discharge,i(QQH,act)

Ohmic Resistance—Charge i =, …, 5
Ohmic Resistance—Discharge i =, …, 5

Ohm
Ohm

For each activated, temperature depending ‘battery characteristics—temperature
and SOC dependent’, the ohmic resistance has to be deﬁned depending on the State
of Charge.

ηQH,charge,i(QQH,act)

Coulombic Efﬁciency—Charge i = 1, …, 5

%

For each activated, temperature depending ‘battery characteristics—temperature
and SOC dependent’, the coulombic efﬁciency in charge mode has to be deﬁned
depending on the State of Charge.

RQH,conc,charge,i(QQH,act)

RQH,conc,discharge,i(QQH,act)

Resistance of RC Concentration Overvoltage—Charge
i = , …, 5
Resistance of RC Concentration Overvoltage—
Discharge i = , …, 5

Ohm

Ohm

For each activated, temperature depending ‘battery characteristics—temperature
and SOC dependent’, the resistance of RC concentration overvoltage has to be
deﬁned depending on the State of Charge.

RQH,trans,charge,i(QQH,act)

RQH,trans,discharge(QQH,act)

Resistance of RC Transfer Overvoltage—Charge i = , …,
5
Resistance of RC Transfer Overvoltage—Discharge

Ohm

Ohm

For each activated, temperature depending ‘battery characteristics—temperature
and SOC dependent’, the resistance of RC transfer overvoltage has to be deﬁned
depending on the State of Charge.

2.14.3 Input and Output Variables

2.14.3.1 Electrical Connections

IQH
UQH,net

Actual Battery Current
Actual Net Voltage

A
V

2.14.3.2 Data Input

TQH,ambient

Ambient Temperature

°C

(continued)

2.14.3.3 Data Output

146

TQH,extern
ZQH

UQH,net
IQH
QQH
SOCQH
TQH
ZQH,overcharge
ZQH,overvoltage
ZQH,undervoltage
PQH
PQH,loss

2 Mathematics Behind the Models

Temperature external
Switch

°C
–

Net Voltage
Current
Battery Charge
State of Charge
Temperature
Status—Overcharge
Status—Overvoltage
Status—Undervoltage
Power
Power Loss

V
A
A s
A s
°C
–
–
–

W
W

2.14.4 Computation Variables

UQH,terminal
UQH,idle

Terminal Voltage of a cell
Idle Voltage of a cell
Terminal Current of a cell
State of Capacity of a cell
Actual Current through cell
Charge of RC Concentration Overvoltage
Charge of RC Transfer Overvoltage
Actual Charge of the cell
Current through resistance of RC Transfer Overvoltage
Current through ohmic resistance of RC Concentration Overvoltage
Maximum Current in charge mode

IQH,terminal
SOCQH
IQH,ohmic
QQH,conc
QQH,trans
QQH
IQH,ohmic,trans
IQH,ohmic,conc
IQH,max,charge
IQH,max,discharge Maximum Current in discharge mode
PQH,out,max
Maximum Power out
PQH,in,max
Maximum Power in
PQH,th
Total thermal Power
PQH,th,el
Thermal Power within the cell
PQH,th,ambient
Thermal Power transferred to the environment
TQH,bat
Actual Temperature of the battery
TQH,ambient
Actual ambient Temperature

V
V
A
–

A
A s
A s
A s
A
A
A
A
W
W
W
W
W
°C
°C

2.14 Battery H (QH)

2.14.5 Equation System

147

ð2:14:1Þ

ð2:14:2Þ

ð2:14:3Þ

ð2:14:4Þ

ð2:14:5Þ

ð2:14:6Þ

Through an internal calculation it is possible to use one single cell as well as any
combination of cells. Therefore the user can construct any desired module.

2.14.5.1 Electrical Equations

The electrical equations of a battery cell are described as follows [2]:

(cid:1)

(cid:1)

(cid:3)

UQH;terminal ¼ UQH;idle IQH;terminal; SOC

(cid:4) IQH;ohmic (cid:2) RQH IQH;terminal

(cid:4) QQH;conc=CQH;conc (cid:4) QQH;trans=CQH;trans

(cid:3)

(cid:1)

IQH;ohmic;trans ¼ QQH;trans= CQH;trans (cid:2) RQH;trans
(cid:3)

IQH;ohmic;conc ¼ QQH;conc= CQH;conc (cid:2) RQH;conc

(cid:1)

(cid:3)

Here the current inﬂuences the idle voltage and the resistance only by its sign.

The maximal currents of the battery cell are calculated by [2]:
(cid:1)

(cid:3)

IQH;max;charge ¼ ðUQH;idle;charge IQH;terminal; SOC

(cid:1)

(cid:4) UQH;max (cid:4) QQH;conc=CQH;conc

(cid:3)

(cid:4) QQH;trans=CQH;transÞ=RQH IQH;terminal

:

IQH;max;discharge ¼ ðUQH;idle;discharge IQH;terminal; SOC

(cid:4) UQH;min;discharge

(cid:1)

(cid:3)

(cid:4) QQH;conc=CQH;conc (cid:4) QQH;trans=CQH;transÞ=RQH IQH;terminal

(cid:1)

(cid:3)

and [2]:

with [2]:

SOCQH ¼ QQH=QQH;max

The initial values are calculated by [2]:

QQH;init ¼ SOCQH;init (cid:2) QQH;max

ð2:14:7Þ

The maximum power in and maximum power out are calculated in a numerical

way by searching for the maximum within the functions [2]:

PQH;out;max UQH;min;discharge; IQH;terminal

and PQH;in;max UQH;max;charge; IQH;terminal

(cid:3)

(cid:1)

(cid:3)

(cid:1)

148

2 Mathematics Behind the Models

2.14.5.2 Thermal Equations

The basic equation for the heating within a material is [2]:

dQ ¼ mQH;cell (cid:2) CQH;heatdTQH;bat ¼ PQH;thdt

ð2:14:8Þ

Here, PQH,th is the total power that is converted into heat. It consists of the heat
power inside the cell caused by electrical losses and of the heat transfer to the
environment [2]:

PQH;th ¼ PQH;th;el þ PQH;th;ambient

ð2:14:9Þ

and it is [2]:

and [2]:

PQH;th;ambient ¼ aQH;th;trans TQH;bat (cid:4) TQH;ambient

(cid:1)

(cid:3)

ð2:14:10Þ

PQH;th;el ¼ I2

(cid:2) RQH þ I2
QH;ohmic
QH;ohmic;trans
(cid:1)
þ 0:5IQH;terminal (cid:2) UQH;idle IQH;terminal (cid:2) SOCQH

(cid:2) RQH;trans þ I2

(cid:10)
(cid:10)

(cid:1)

(cid:3)

(cid:2) RQH;conc
(cid:1)
(cid:4) UQH;idle (cid:4)IQH;terminal; SOCQH

(cid:3)

(cid:10)
(cid:3)
(cid:10)

(cid:1)
QH;conc TQH;act

(cid:3)

ð2:14:11Þ

with the last term describing the losses caused by the polarization voltage.

2.15 Gearbox Control (O)

The gearbox control is needed to deﬁne an automatic gearbox. In the gearbox
control, the gear shifting process can be deﬁned automatically without any inﬂu-
ence of the driver [1].

The gearbox control shifts the gears dependent on a speed or a velocity. The
decision which one of the two shifting strategies is used is done in the calculation
tasks. Which speed, respectively which velocity is used can be deﬁned via the
Data Bus. It is possible to deﬁne the engine speed but it is also possible to deﬁne the
wheel speed as reference [1].

The gearbox control is also the connection between the gearbox program and the

gearbox [1].

2.15.1 Properties

Switch Output
If this switch is activated a result output for this component is made.

2.15 Gearbox Control (O)

149

Switch Time Delay Gear Dependent
If this switch is activated, the time delay between the start of a shifting procedure
and the start of a gear change can be deﬁned gear dependent.

This functionality is necessary especially for automatic gearboxes or Shift by

Wire (Step-Tronic).

Switch Skipping Gear(s) For Upshifting Allowed
When this switch is activated, then the highest gear satisfying the shifting condition
will be shifted, thus more than one gear step could be skipped.

Switch Skipping Gear(s) For Downshifting Allowed
When this switch is activated, then the lowest gear satisfying the shifting condition
will be shifted, thus more than one gear step could be skipped.

The following Selection Buttons are only used for Task ‘System Analysis Mode

(SAM)’:

Selection Button SAM
Shifting Strategy
Gearbox Control

For automatic cockpits it can be determined that the gearbox control controls the
gear shifting process.

Gear Shifting Program

For automatic cockpits it can be determined that the gearbox program controls the
gear shifting process.

Selection Button SAM

Gear Selection Upshifting
According to Velocity

The values for shifting gears according to velocity as deﬁned for the driver (manual
cockpit or pressed Tiptronic switch for automatic cockpits) or with gear box control
(automatic cockpit and deactivated Tiptronic switch) are activated.

According to Speed

The values for shifting gears according to speed as deﬁned for the driver (manual
cockpit or pressed Tiptronic switch for automatic cockpits) or with gear box control
(automatic cockpit and deactivated Tiptronic switch) are activated.

Selection Button SAM

Gear Selection Downshifting

This selection button has to be selected analog to the button SAM: Gear Selection
Upshifting.

150

2 Mathematics Behind the Models

2.15.2 User-Deﬁned Variables

Gear Shifting according to Velocity

vO,inc[n]
vO,decr[n]

Upshifting Velocity vO,inc[n] for the nth gear
Downshifting Velocity vO,decr[n] for the nth gear

km/h
km/h

The velocities for up- and downshifting can be read e.g. in the following way:
The upshifting velocity of the 2nd gear means that at this velocity the gearbox
control is upshifting from the 2nd into the 3rd gear. The downshifting velocity for
the 2nd gear means that at this velocity the gearbox control is downshifting from
the 3rd into the 2nd gear. Therefore it is necessary to deﬁne the up- and down-
shifting velocities always only for one gear less than are available in the gearbox
(i.e., for a ﬁve step gearbox, only for four gears the up- and downshifting velocities
have to be deﬁned).

Gear Shifting according to Speed

_uO;incr i½ (cid:3)
_uO;decr i½ (cid:3)

Upshifting Speed _uO;incr i½ (cid:3) for the nth gear
Downshifting Speed _uO;decr i½ (cid:3) for the nth gear

rpm

rpm

Similar to the shifting according to velocity the speeds for up- and downshifting

can be read e.g. in that way:

The upshifting speed of the 2nd gear means that at this speed the gearbox control
is upshifting from the 2nd into the 3rd gear. The downshifting speed for the 2nd
gear means that at this speed the gearbox control is downshifting from the 3rd into
the 2nd gear.

Therefore it is necessary to deﬁne the up- and downshifting speeds always only
for one gear less than are available in the gearbox (i.e., for a ﬁve step gearbox, only
for four gears the up- and downshifting speeds have to be deﬁned).

Gear Shifting according to Speed of next Gear

_uO;incr;next i½ (cid:3)
_uO;decr;next i½ (cid:3)

Upshifting Speed of next Gear for the nth gear

Downshifting Speed of next Gear for the nth gear

rpm

rpm

Here the upshifting and downshifting speeds of the next gear are deﬁned sep-

arate for each gear.

Delay Time Gear Dependent

TO,delay,incr[i]
TO,delay,decr[i]

Upshifting delay time for the ith gear
Downshifting delay time for the ith gear

s
s

Here the upshifting and downshifting time delays are deﬁned separately for each
gear. Shifting procedures which are not described in the table get the time delay 0.

2.15 Gearbox Control (O)

151

2.15.3 Input and Output Variables

2.15.3.1 Data Input

–
–
–
–

km/h
rad/s
–
–

–

s

Gear Selection Upshifting
Gear Selection Downshifting
Desired Gear (Cockpit)
Current Gear
Velocity
Reference Speed

Operation Control
Desired Gear (Gearbox Program)

Zcont,up
Zcont,dn
jO,targ
jO,actual
vV,act
_uref;act
Zoperate
jO,prog

jO,new
tO,delay

2.15.3.2 Data Output

Desired Gear
Time Delay Gear Dependent

2.15.4 Computation Variables

jG,new/up
jG,new,dn

New gear up
New gear down

–
–

2.15.5 Equation System

The gear shifting strategy up (Zcont,up) and down (Zcont,dn) has the information from
where the gearbox control should take the target gear:
(cid:129) proﬁle shifting
(cid:129) velocity shifting
(cid:129) speed shifting
(cid:129) program shifting

152

2 Mathematics Behind the Models

2.15.5.1 Proﬁle Shifting

The target gear position comes from the driving proﬁle [2]:

(cid:1)

(cid:1)

If

If

jG;target (cid:5) jG;act

! jG;new;up ¼ jG;target

jG;target (cid:6) jG;act

! jG;new;dn ¼ jG;target

(cid:3)

(cid:3)

ð2:15:1Þ

ð2:15:2Þ

2.15.5.2 Velocity Shifting

The reference is the vehicle velocity [2].
(cid:3)

(cid:1)

(cid:1)

(cid:3)

If

If

jG;act \ NG
(cid:3)
(cid:1)

jG;act [ 1

^ Vv;act (cid:5) Vo;incrbjG;actc
(cid:3)
(cid:1)

^ Vv;act (cid:6) Vo;decvbjG;actc

! jG;new;up ¼ jG;act þ 1

ð2:15:3Þ

! jG;new;dn ¼ jG;act (cid:4) 1

ð2:15:4Þ

2.15.5.3 Speed Shifting

Each angular velocity could be selected via Data Bus for the reference speed [2].

(cid:1)

If

If

jG;act \ NG
(cid:3)
(cid:1)

jG;act [ 1

(cid:3)

(cid:1)

(cid:1)

^ _uref;act

(cid:5) _uo;incr

! jG;new;up ¼ jG;act þ 1

ð2:15:5Þ

^ _uref;act

(cid:6) _uo;deu

bjG;actc

! jG;new;dn ¼ jG;act (cid:4) 1

ð2:15:6Þ

(cid:3)

bjG;actb
(cid:3)

2.15.5.4 Program Shifting

The shifting information is taken from the shifting program.

For up- and downshifting [2]:

(cid:1)
jG;prog (cid:5) jG;act
(cid:1)
jG;prog (cid:6) jG;act

(cid:3)

(cid:3)

If

If

! jG;new;up ¼ jG;prog

! jG;new;dn ¼ jG;prog

The new gear position is chosen as follows [2]:

(cid:3)

(cid:1)

jG;new;up (cid:5) jG;act þ 1
(cid:3)

If
(cid:1)
jG;new;dn (cid:6) jG;act (cid:4) 1

else if

! jG;new ¼ jG;act þ 1

! jG;new ¼ jG;act (cid:4) 1

else ! jG;new ¼ jG;act

ð2:15:7Þ

ð2:15:8Þ

ð2:15:9Þ

ð2:15:10Þ

ð2:15:11Þ

2.16 Gearbox Program (P)

153

2.16 Gearbox Program (P)

Is used for automatic gearboxes in combination with the gearbox control.

The gearbox program allows for a more complicated gear shifting process than
the gearbox control, because here in addition the load signal of the engine is
considered [1].

The gearbox program shifts the gears according to given curves. The curves are
given as a function of the load signal and the engine speed. The target gear
determined by the program is transmitted to the gearbox control that transmits it to
the gearbox. Furthermore the curves could be optimized using iSIGHT. These
optimized curves (optimized shifting program) could also be used as input curves
for the gearbox program [1].

2.16.1 Properties

Switch Output
A result output for this component is made if this switch is activated.

Switch Optimized Shifting Program
By activating this switch the optimized shifting table is used in the gearbox
(An optimized shifting table must be established using “Start
program.
Optimization of Shifting Program”.)

Selection Button Shifting Program Selection

In this case up to ﬁve shifting programs can be deﬁned.

Selection Button Shifting Program Selection

In this case a shifting program is activated which can be optimized with iSIGHT.

Selection Button Shifting Program Selection

In this case up to ﬁve shifting programs and up to ﬁve kick down tables can be
deﬁned.

Remark: the advanced shifting programs import gear shifting data generated by the
task ‘GSP Generation’.

Default
Optimized
Advanced

Default
Optimized
Advanced

Default
Optimized
Advanced

154

2 Mathematics Behind the Models

Switch Shifting Program 2–5 (Data Bus Dependent)
With these switches the additional deﬁned shifting programs (from 2 up to 5,
default or advanced) can be activated. With the Data Bus input ‘Shifting Program
Selector’ (which provides a double value), interpolations between the shifting
programs can be done.

Switch Kickdown
With this switch the kickdown table is activated. If the ‘Advanced Shifting Program
Selection’ has been done, up to 5 kickdown tables can be activated.

Switch Shift Remaining Time
When this switch is activated, the remaining time for upshifting and downshifting
for every gear can be deﬁned. The remaining time is the minimal time after the shift
decision, in which no further shifting is allowed.

2.16.2 User-Deﬁned Variables

Shifting Programs Standard

Shifting Program

(cid:12)
(cid:11)
_uP;incr n; aE;dk
(cid:12)
(cid:11)
vP;incr n; aE;dk
(cid:12)
(cid:11)
_uP;decr n; aE;dk
(cid:12)
(cid:11)
vP;decr n; aE;dk

or

or

Upshifting Speed (Velocity) dependent on the gear
and the load signal

Downshifting Speed (Velocity) dependent on the gear
and the load signal

rpm or
km/h

rpm or
km/h

The gear shifting process is done similar to the gearbox control. The only

difference is the dependence on the load signal of the engine.

If the shifting program should be deﬁned not by speed but by velocity, the Data
Bus input ‘Velocity’ must be connected. The units of the shifting program and the
optimized shifting program inﬂuence each other. That means, if one of these pro-
grams is loaded with a different unit, also the other program gets this new unit.
The speeds for up- and downshifting can be read e.g. in the following way:
The upshifting speed of the 2nd gear with the special load signal means that at
this speed with this load signal the gearbox control is upshifting from the 2nd into
the 3rd gear.

The downshifting speed for the 2nd gear with the special load signal means that
at this speed with this load signal the gearbox control is downshifting from the 3rd
into the 2nd gear. Because it is not possible to deﬁne the shifting speeds for every
possible load signal the characteristic will be interpolated between the given points.
It is only necessary to deﬁne the up- and downshifting speeds always for one
gear less than are available in the gearbox (i.e., for a ﬁve step gearbox, only for four
gears the up- and downshifting speeds have to be deﬁned).

155

2.16 Gearbox Program (P)

Shifting Programs 2–5

(cid:12)
(cid:11)
_uP;incr n; aE;dk
(cid:12)
(cid:11)
vP;incr n; aE;dk
(cid:12)
(cid:11)
_uP;decr n; aE;dk
(cid:12)
(cid:11)
vP;decr n; aE;dk

or

or

Upshifting Speed 2–5 (Velocity) dependent on the gear
and the load signal

Downshifting Speed 2–5 (Velocity) dependent on the
gear and the load signal

rpm or
km/h

rpm or
km/h

With the properties switches ‘Shifting Program 2–5’ up to four additional

shifting programs can be deﬁned.

With the Data Bus input ‘Shifting Program Selector’ (which provides a double

value), interpolations between the deﬁned shifting programs can be done.

Optimized Shifting Program

b1
b3

Weight for the penalty term “Performance” in the objective function
Weight for the penalty term “Driveability” in the objective function

–
–

Regarding the minimization of the fuel consumption and the minimization of the
Full Load Acceleration time in standard driving cycles, it is possible to optimize the
Gear Shifting Program. Furthermore the driving performance should be improved
and the shifting process which should be optimized is equal to the normal gear
shifting process (see Fig. 2.16).

Figure 2.16 shows a typical gear shifting map. The green line is for downshif-
ting, the red one for upshifting of the gear. The ﬁrst lines are the change between
the gears one and two, second pair between two and three and so on. This means, if
the actual speed is lower than the most left green line, then the gear is changed from
the second to the ﬁrst gear, and if it is larger than the ﬁrst red one, then the gear is
changed from the ﬁrst to the second gear.

2 to 1

1 to 2

]

%

[
 
l
a
n
g
i
s
 
d
a
o
L

100
90
80
70
60
50
40
30
20
10
0

1 Up

2 Up

3 Up

4 Up

1 Down

2 Down

3 Down

4 Down

0

1000

2000

3000
Gear output speed [1/min]

4000

5000

6000

Fig. 2.16 Gear shifting map example. (dashed red down shifting, black up shifting) [2]

156

2 Mathematics Behind the Models

]

%

[
 
l
a
n
g
i
s
 
d
a
o
L

100
90
80
70
60
50
40
30
20
10
0

0

1000

2000
4000
3000
Gear output speed [1/min]

5000

6000

Fig. 2.17 Restrictions in the Gear Shifting Program [2]

The discretized gear shifting map has between 80 and 100 unknowns, depending

on the reﬁnement level of the gear shifting map in the input data.

The following ﬁgure denotes the possible movements of the unknowns (dis-
cretization node). The horizontal lines can move to the right and left and the inner
points may move up and down.

The limits for the movements are for the inner points the neighbor points of the
same line and for the horizontal lines the corresponding other line (the up for the
down line and vice versa) such that there is still a hysteresis in the curve.

This is needed for the decision of the Gear Shifting Program about up or

downshifting for an actual speed of the vehicle (Fig. 2.17).

The fuel consumption is given by the calculation of the driving cycle in liters per
100 km as calculated in the task for the cycle. To the optimization objective
different penalty terms are added to introduce some regularization of the perfor-
mance and the result.

The objective function for the fuel optimization is [2]:

J ¼ afc þ b1

ð
vactual (cid:4) vdesired

Þ2dt þ b2

Z

gear0
j

jdt þ b3

Z

j

acceleration0

jdt:

time

time

Z

time

ð2:16:1Þ

where the weight β2 is calculated according to the input of β1 and β3
The penalty terms stand for the driving accuracy (the difference between the
actual velocity and the desired velocity should be minimized), measuring the
number of gear changes to avoid oscillations and the drivability avoiding large
changes in the acceleration of the car.

For the Full Load Acceleration optimization the sum over the velocity measure
points is minimized. The measure points si describe the time, when a prescribed
velocity is reached.

2.16 Gearbox Program (P)

157

P

si:

The objective function is the sum over all measure points
For the optimization of the fuel consumption different driving cycles can be
included. Thereby a wider range of the gear shifting map may be covered. For the
Full Load Acceleration 100 % of the gas pedal as well as smaller values are
possible, as it can be conﬁgured in the task.

Velocity measure points which are not reached with the initial gear shifting map
are ignored. Afterwards only modiﬁcations are allowed such that all velocity
measure points are reached.

The data preparation is similar to the preparation for a normal calculation of the

model in AVL CRUISE, only that some input data now has a special meaning.

The driving cycles now determine the fuel consumption for the objective, similar

with the Full Load Acceleration. Other tasks are not taken into consideration.

At least one driving cycle or one Full Load Acceleration task has to be active.

Only the active ones are taken into account.

As described for the Full Load Acceleration the objective function in this case is
determined through the velocity measure points. The measure points which are
deﬁned in the task then describe also the objective function for the optimization.
The subdivisions in the gear shifting map of the gear shifting program determine
the number of unknowns. Each of the divisions is taken as unknown, one for the
upshifting and one for down. The ﬁner the map the more unknowns.

After the optimization run the result can be loaded using the switch “Optimized
Shifting Program” in the properties box. About the result calculated by the opti-
mization routines one has to note that only active parts of the gear shifting map are
adapted.

This means only those parts who have an effect on the result may be different
from the original one. The other parts are not changed. This may lead to some sharp
bends in the curve.

Since iSIGHT is a standalone program it is possible to start other AVL CRUISE
processes which are not related to the optimization process during optimization
takes place. Due to the fact that the objective function (2.16.1) includes all char-
acteristics of the vehicle and its parts with the connections, no smoothness
assumptions are valid for the objective function.

Consequently the direct application of gradient based methods is avoided and a
line search in coordinate direction (meaning every unknown) is used to achieve a
decrease of the objective function in a stable way in a ﬁrst step. For every calcu-
lation of the objective values AVL CRUISE (optimization kernel calls) must be
called (see Fig. 2.18).

For the optimization within iSIGHT a Sequential Quadratic Programming
(SQP) method (NLPQL by Prof. Dr. K Schittkowsi) is used which is described
shortly below.

NLPQL solves smooth nonlinear problems under nonlinear equality and

inequality constraints, i.e. [2]:

min f(x)

158

2 Mathematics Behind the Models

AVL 
CRUISE
GUI

data check

data 
preparation

iSIGHT call

iSIGHT

file system 
adaptation

data 
adaptation

optimization  
kernel calls

results

Fig. 2.18 iSIGHT is called for optimization in AVL CRUISE [2]

x 2 IRn : gj xð Þ ¼ 0; j ¼ 1; . . .; me

ð2:16:2Þ

ðxÞ (cid:5) 0; j ¼ me þ 1; . . .; m

gj
xl (cid:6) x (cid:6) xu

where x is an n-dimensional parameter vector (see discretization nodes) with the
lower bound xl and the upper bound xu. These are not handled separately, but
considered as general inequality constraints. Since the objective function f (x) and
the constraints gj (x) are continuously differentiable and the problem is not too big
NLPQL has proved to ﬁnd the local minimum of the minimization problem very
efﬁciently. None the less it has to be stated that it is necessary to ﬁnd start values
sufﬁciently close to the optimum.

The basics of SQP algorithms is described in more detail below:
The idea of this algorithm is to formulate and solve a quadratic programming sub
problem in each iteration which is obtained by linearizing the constraints and
approximating the Lagrangian function [2]:

L x; uð

Þ :¼ f xð Þ (cid:4)

ujgj

ðx):

ð2:16:3Þ

Xm

j¼1

quadratically, where x ϵ IRn, and where u = (u1,…, um)T ϵ IRm is the multiplier

vector.

To formulate the quadratic subproblem, it will be proceeded from given iterates
xk ϵ IRn, an approximation of the solution, vk ϵ IRm and approximation of the
multipliers, and Bk ϵ IRnxn an approximation of the Hessian of the Lagrangian
function.

Then the following quadratic programming problem has to be solved [2]:

2.16 Gearbox Program (P)

min

dT Bkd þ rf xkð

ÞT d

1
2

159

ð2:16:4Þ

d 2 IRn : rgj xkð
ÞT d þ gj xkð

ÞTd þ gj xkð

Þ ¼ 0; j ¼ 1; . . .; me

rgj xkð
corresponding multiplier. A new itereate is obtained by [2]:

Þ (cid:5) 0; j ¼ me; . . .; m:. Let dk be the optimal solution and uk the

(cid:4)

(cid:5)

xkþ1
vkþ1

(cid:4) (cid:5)
xk
vk

:=

(cid:4)

(cid:5)

þ ak

dk
uk (cid:4) vk

ð2:16:5Þ

where αk ϵ (0, 1] is a suitable steplength parameter.

An SQP method is identical to Newtons’s method to solve the necessary opti-

mality conditions, if Bk is the Hessian of the

Lagrangian function and if the startvalues are close to a solution.
If dk = 0 is an optimal solution of (4) and uk the corresponding multiplier
vector, then xk and uk satisfy the necessary optimality conditions of (2.16.1).
Since the calculation of the Hessian of the Lagrangian function is very expensive
regarding run time, the Hessian matrix is approximated by updating Bk by the
BFGS quasi-Newton formula. The calculation of any new matrix Bk + 1 depends
only on Bk and two vectors [2]:

ð
qk :¼ rxL xkþ1; uk

ð
Þ (cid:4) rxL xk; uk

Þ

wk :¼ xkþ1 (cid:4) xk
Y
ð

Bk; qk; wk

Þ

Bkþ1 :¼

Y
ð

B; q; w

Þ :¼ B þ qqT
qT w

(cid:4) BwwT B
wT Bw

ð2:16:6Þ

ð2:16:2Þ

ð2:16:7Þ

ð2:16:8Þ

The above formula yields a positive deﬁnite matrix Bk+1 provided that Bk is

positive deﬁnite and qT

k wk [ 0.

As already stated, the given optimization problem is not smooth. To avoid the
direct calculation of the gradients the results calculated in the line search are
approximated with a quadratic function. Since this function is differentiable, the
gradients used in the SQP method could be calculated. The optimization of the gear
include any constraints, but some boundaries for the
shifting map does not
parameter vector (discretization nodes) which are chosen according to the possible
movement of the nodes.

The optimized shifting program can be deﬁned and optimized in the unit for
speed as well as in the unit for velocity. The units of the shifting program and the
optimized shifting program inﬂuence each other. That means, if one of these pro-
grams is loaded with a different unit, also the other program gets this new unit.

160

2 Mathematics Behind the Models

If the optimized shifting program is deﬁned in the unit for velocity, the Data Bus
input ‘Velocity’ must be connected.

Kickdown Table

_uP;incr;KD n½ (cid:3)
_uP;decr;KD n½ (cid:3)

Upshifting Speed at Kickdown dependent on the gear

Downshifting Speed at Kickdown dependent on the gear

rpm

rpm

The Kickdown Table is used when the driver steps full on the acceleration pedal
(load signal = 100 %). Instead of this criterion, the optional Data Bus input
‘Kickdown Signal’ can be used to control the kickdown event.

Velocities can be deﬁned instead of speeds. In this case the Data Bus input

‘Velocity’ has to be connected.

Shifting Programs Advanced
Shifting Programs 1–5

(cid:12)
(cid:11)
_uP;adv;incr n; aE;dk
(cid:12)
(cid:11)
vP;adv;incr n; aE;dk
(cid:12)
(cid:11)
_uP;adv;decr n; aE;dk
(cid:12)
(cid:11)
vP;adv;decr n; aE;dk

or

or

Upshifting Speed 1–5 (Velocity) dependent on the
gear and the load signal

Downshifting Speed 1–5 (Velocity) dependent on
the gear and the load signal

rpm or
km/h

rpm or
km/h

Up to ﬁve shifting programs can be deﬁned. With the Data Bus input ‘Shifting
Program Selector’ (which provides a double value), interpolations between the
shifting programs can be done.
Kickdown Tables 1–5

_uP;adv;incr;KD n½ (cid:3).
_uP;adv;decr;KD n½ (cid:3).

Upshifting Speed at Kickdown dependent on the gear

Downshifting Speed at Kickdown dependent on the gear

rpm

rpm

To each advanced Shifting Program an associated Kickdown Table can be

deﬁned. To do this, the properties switch ‘Kickdown Table’ must be activated.

Selection Button Data Sheet Selection

All 1,…,5
When this switch is set to ‘all’ and more than one shifting program is activated,
the Data Bus input ‘Shifting Program Selector’ is used to determine the shifting
program and Kickdown Table used for calculation. A constant program/kickdown
table can be selected with the values 1–5.

Remark: The advanced shifting programs import gear shifting data generated by
the task ‘GSP Generation’

2.16 Gearbox Program (P)

Shift Remaining Time

161

tP;upShiftRemain n½ (cid:3)
tP;DownShiftRemain n½ (cid:3)

Remaining Time for Upshifting dependent on the gear
Remaining Time for Downshifting dependent on the gear

s
s

When in the properties window the switch ‘Shift Remaining Time’ is activated,
the remaining time for upshifting and downshifting for every gear can be deﬁned.
The remaining time is the minimal time after the shift decision, in which no further
shifting is allowed.

Exception: a kickdown situation. In this case there is no remaining time.

2.16.3 Input and Output Variables

2.16.3.1 Data Input

jP,act
_uP;ref;act
αP,act
SP,KD
vP,act
cP,sel

Current Gear
Speed

Load Signal
Kickdown Signal
Velocity
Shifting Program Selector

2.16.3.2 Data Output

jP,new
_uP;upshifting
_uP;downshifting

Desired Gear
Speed Upshifting

Speed Downshifting

–

rad/s
–
–

m/s
–

–

rad/s

rad/s

These channels with the actual speeds for up and downshifting are available for
user-deﬁned controls (in function component, Black Box, MATLAB® API,
MATLAB® DLL).

For advanced control algorithms, for current load signal and gear, the gearbox

program calculates upper and lower speed limits for shifting.

In order to ensure the existence of upper and lower speed limits, in the lowest gear,
lower speed limit is calculated as (current speed—INFINITESPEED), and in the
highest gear, upper speed limit is calculated as (current speed + INFINITESPEED).
INFINITESPEED is deﬁned in the Cruise.ini ﬁle with the default value of

104.72 rad/s which equals 1000 rpm.

162

NG

2.16.4 Computation Variables

Number of gears

–

2 Mathematics Behind the Models

2.16.5 Equation System

Gear shifting to the next or next lowest gear will be done according to the gear
shifting criteria by using the deﬁned maps.

2.17 CVT Control (H)

The CVT Control is an easy way to pretend a target transmission considering the
velocity and the engine load. In addition there is a possibility of controlling a
clutch. This clutch is simply added to the model but it is not necessary [1].

Switch Output
If this switch is activated a result output for this component is made.

2.17.1 Properties

Selection Button Control Value

Transmission Ratio
Input Speed
Input Speed (ECO)

Selection Button Control Value

Transmission Ratio
Input Speed
Input Speed (ECO)

In this case the CVT is controlled by deﬁnition of Desired Transmission Ratio
depending on velocity and load signal.

In this case the CVT is controlled by deﬁnition of Desired Input Speed depending
on velocity and load signal. With this information the actual transmission ratio is
then calculated. When using this option, the Data Bus input channel ‘Input Speed’
has to be connected.

2.17 CVT Control (H)

163

In this case a separate map can be activated to import data generated by the task
‘GSP Generation’.

Selection Button Control Value

Transmission Ratio
Input Speed
Input Speed (ECO)

2.17.2 User-Deﬁned Variables

Time Constant Load Signal

Time constant Load Signal

s

Here the time constant of the PT1-retarding element for the load signal can be

tload

deﬁned.

Time Constant Velocity

tv

Time constant Velocity

s

Here the time constant of the PT1-retarding element for the velocity can be

deﬁned.

Desired Transmission Ratio

iH,soll (vV, αE,dk)

Desired Transmission Ratio as a function of velocity and load signal

–

Here the demand transmission of the CVT gearbox can be deﬁned as a function

of the velocity and the load signal.

Desired Input Speed

(cid:1)
_uH;soll vV; aE;dk

(cid:3)

Desired Input Speed as a function of velocity and load signal

rad/s

Here the demand input speed of the CVT gearbox can be deﬁned as a function of

the velocity and the load signal.

To use this option, the Selection button ‘Control Value’ has to be set to ‘Input

Speed’ and the Data Bus input channel ‘Output Speed’ has to be connected.

Desired Input Speed (ECO)

(cid:1)
_uH;soll vV; aE;dk

(cid:3)

Desired Input Speed as a function of velocity and load signal

rad/s

164

2 Mathematics Behind the Models

This map works just like the ‘Desired Input Speed’ map. To use it, the selection
button ‘Control Value’ has to be set to ‘Input Speed (ECO)’ and the Data Bus input
channel ‘Output Speed’ has to be connected.

Desired Clutch Release

(cid:1)
_u; aE;dk
LH;soll
(cid:1)
LH;soll vV; aE;dk

(cid:3)
(cid:3)

or

Desired Clutch Release as a function of speed (or
velocity) and load signal

%

The demand clutch release of the starting clutch can be deﬁned as a function of

the speed (or velocity) and the load signal.

Fast Linear Interpolation for CVT Control Maps
The interpolation in the maps of CVT control (e.g. interpolation of transmission
ratio) is done by an alternative method which does not use the map preprocessing
approximation to equidistant points.

This method is the default setting and can be changed in the ‘Interpolation and
Approximation’ section in the ‘Expert Mode’ settings of the Project Settings
(switch ‘Fast Linear Interpolation for CVT-Control-Maps’).

2.17.3 Input and Output Variables

2.17.3.1 Data Input

αH,act
_u

H;ref;act

iH
VH
MH
_u

H;out;control

Load Signal
Speed

Current Transmission Ratio
Velocity
Torque
Output Speed

2.17.3.2 Data Output

_iH;dem;act
LH,dem,act

Desired Transmission Ratio

Desired Clutch Release

–

rad/s
–

m/s
Nm
rad/s

–

%

2.17 CVT Control (H)

2.17.3.3 Equation System

165

The demanded transmission step is selected from the map for the current vehicle
velocity and the throttle position.

The same thing is done for the new clutch release. Here, the reference speed and

the throttle position are taken into consideration.

2.18 Anti-Slip Control (ASC)

The Anti-Slip Control checks the Force Transmission Factor (ratio between force
that has to be transmitted and maximum transmittable force) of all connected
wheels (driven wheels). If the force that has to be transmitted exceeds the adhesion
limit, the load signal or the clutch release changes [1].

The Anti-Slip Control is only active when a model is calculated quasi-stationary

in combination with special drive train conﬁgurations [1].

2.18.1 Properties

Switch Output
A result output for this component is made if this switch is activated.

Switch Use for Simulation
If the ASC should be used for calculations in simulation mode this switch can be
activated. In this case the parameters for the PID controller can be set.

2.18.2 User-Deﬁned Variables

PID Controller

PASC,pro
PASC,dif
PASC,int

Proportional Parameter
Differential Parameter
Integral Parameter

–

s
1/s

Here the parameters for the PID controller can be deﬁned. This controller is used

for the controlling of the ASC.

166

2 Mathematics Behind the Models

2.18.3 Input and Output Variables

2.18.3.1 Data Input

Load Signal
Clutch Release
Wheel slip of the ith connected wheel

%
–
–

A maximum of four wheels can be connected with the ASC.

αASC,in
SASC,in
SASC,i

αASC,out
SASC,out

2.18.3.2 Data Output

Load Signal
Clutch Release

%
–

2.18.3.3 Equation System

At ﬁrst, the wheel with the highest value for the load transmitting factor is selected
(Fig. 2.19). If this value greater than 1, the Anti-Slip Control is activated (ZASC = −1)
and the load position will be reduced as long as the wheels have slip conditions.
For the task Full Load Acceleration from rest, the value for the clutch release

will be increased.

For the modiﬁcation of the signals a PID controller is used. The parameter values

have to be entered in the input dialog.

Fig. 2.19 Load transmitting factor [2]

2.19 PID Control (PID)

167

2.19 PID Control (PID)

Combined with other signal processing components (e.g. ‘function’ component),
the PID control may be used to build up more powerful control subsystems in
AVL CRUISE. It basically supports two operation modes [1].

The ﬁrst mode is the ‘Standard PID Control’ mode, using the difference between
a desired value and an actual value’ to generate an ‘output value’. The second mode
is the ‘Advanced Signal Control with Limitation’ mode, where an additional input
‘Control Value’
(typically ‘Desired Clutch Release’ signal
from component
‘Cockpit’) is taken into account and added to the ‘output value’ [1].

In this mode, ‘Output Value’ may be used to limit ‘Actual Value’ from the lower
side (as, e.g., wheel load signal) or from the upper side (as, e.g., vehicle acceler-
ation). This mode may be used with caution for other signals, too. It is important
that the ‘Control Value’ has a ‘natural’ limit of zero, as it is the case with ‘Desired
Clutch Release’ [1].

2.19.1 Properties

Switch Output
If this switch is activated a result output for this component is made.

Selection Button PID Mode
Standard PID Control
Advanced Signal Control With Limitation

The functionality of a standard PID control is supported.

Selection Button PID Mode
Standard PID Control
Advanced Signal Control With Limitation

The second operation mode of the PID control is calculated.

Selection Button Actual Value Limitation

Lower Limit
Upper Limit

Lower Limit
Upper Limit

The actual value is limited from the lower side. This option is only available in the
second operation mode of the PID control.

Selection Button Actual Value Limitation

The actual value is limited from the upper side. This option is only available in the
second operation mode of the PID control.

168

2 Mathematics Behind the Models

Switch Fixed Desired Value
In this case the desired value is deﬁned by a constant value. This switch can only be
chosen in the ‘Simple PID Control’ mode.

Switch Output Value Limitation
If this switch is activated, the output value can be limited by deﬁning of a minimum
and a maximum value.

2.19.2 User-Deﬁned Variables

CPID,P
CPID,P
CPID,I

Proportional Parameter
Differential Parameter
Integral Parameter

The PID parameters should be deﬁned.

Actual Value Limitation

CPID,act,min

Minimum

If the selection button Actual Value Limitation is set to Lower Limit, the

possible minimum of the actual value has to be deﬁned.

CPID,act,max

Maximum

If the selection button Actual Value Limitation is set to Upper Limit, the

possible minimum of the actual value has to be deﬁned.

Fixed Desired Value

If the switch Fixed Desired Value is chosen, the desired constant has to be

CPID,ﬁxed

deﬁned.

CPID,out,min
CPID,out,max

Output Value Limitation

Fixed Value

Minimum
Maximum

If the switch Output Value Limitation is chosen, the possible minimum and

maximum of the output value are deﬁned here.

–

s
1/s

–

–

–

–
–

2.19 PID Control (PID)

169

2.19.3 Input and Output Variables

2.19.3.1 Data Input

CPID,act
CPID,desired
CPID,control

Actual Value
Desired Value
Control Value

2.19.3.2 Data Output

CPID,out

Output Value

–
–
–

–

The output value is sent to the Data Bus and can be used by other components.

2.19.4 Equation System

2.19.4.1 Calculation of Delta Signal and PID output

The difference between target value and actual value is calculated by [2]:

DC ¼ CPID;desired (cid:4) CPID;act

ð2:19:1Þ

If there is a limitation of the actual value by deﬁnition of a lower limit, the sign

of ΔC is changed.

The controller output is deﬁned by [2]:

CPID;out ¼ CPID;P (cid:2) DC þ CPID;I (cid:2) Zt

DCð

Þ sð Þds þ CPID;D (cid:2) d DCð
dt

Þ

0

ð2:19:2Þ

In the 2nd mode (‘Advanced Signal Control With Limitation’), the entire con-

troller output is calculated by [2]:

CPID;entireOut ¼ CPID;out þ CPID;control

ð2:19:3Þ

2.19.4.2 Output Value Limitation

CPID,entireOut is limited by CPID,act,min and CPID,act,max.

Additionally, in the following 2 cases:

170

2 Mathematics Behind the Models

1. CPID;out;old (cid:6) CPID;act;min
2. CPID;out;old (cid:5) CPID;act;max

and CPID;out\0
and CPID;out [ 0;

CPID,out is set to 0.

2.19.4.3 Reset of Integral

If the PID Control is in 2nd mode (‘Advanced Signal Control With Limitation’),
ΔC < 0 andC PID,out = 0, the control is set to ‘neutral’ position, that means ΔC,
ΔCold and the

Integral are set to 0.

2.20 Brake (B)

The brake component is described by brake data and dimensions. It is possible to
deﬁne drum brakes as well as disc brakes. The retarder is used for heavy vehicles
and is described below.

The braking torque is computed considering the braking dimensions and the
input brake pressure. This brake pressure can come from the cockpit component or
brake control [1].

If the vehicle is standing still, the degrees of freedom will be reduced as this
reduces the calculation time also. This reduction is done in a way that the equation
system is switched if a small velocity threshold is reached. In this case movement is
suppressed. At the same time it is always checked if the instantaneous compulsive
force is smaller than the braking torque. If this condition is no longer true the brake
is given free again [1].

2.20.1 Properties

Switch Output
A result output for this component is made if this switch is activated.

Switch Dynamic Mode
This switch is activated by default. The brake calculation always stays dynamic and
never switches to a kinematic connection. Deactivation might be done for modeling
a sticking brake in kinematic mode.

Selection Button Control Variable

Brake Pressure
Braking Torque

2.20 Brake (B)

171

In this case the brake is controlled by the brake pressure which has to be supplied
via Data Bus input ‘Brake Pressure’.

Selection Button Control Variable

Brake Pressure
Braking Torque

In this case the engine is controlled by the desired braking torque value which has
to come from the connected Data Bus input ‘Braking Torque.’

2.20.2 User-Deﬁned Variables

The brake piston surface is the area of the hydraulic cylinder. Multiplied with the

brake pressure and the efﬁciency, it gives the axial brake force.

Brake Piston Surface

Friction Coefﬁcient

m2

–

The friction coefﬁcient is between the brake drum, respectively the friction disc

and the brake shoes.

Speciﬁc Brake Factor (Disc brake cB = 1; Drum brake cB > 1)

–

The speciﬁc brake factor is a factor that depends on the design of the brake.
For disc brakes it is always one, for drum brakes it is usually larger than 1.

Effective Friction Radius

m

The effective friction radius is the radius where the braking force applies.

Efﬁciency

–

The efﬁciency considers the effects of the conversion of the hydraulic into the

mechanical part of the brake (Fig. 2.20).

Inertia Moment

kg m2

AB

µB

cB

rB

ƞB

ΘB

172

2 Mathematics Behind the Models

Drum Brake 
(Simplex)

Drum Brake 
(Duplex)

cB

2.7

cB

3.7

Drum Brake 
(Duplex)

Fig. 2.20 Speciﬁc brake factors for different brake types [2]

cB

1.7

2.20.3 Input and Output Variables

2.20.3.1 Mechanical Connection

Angular velocity of the brake
Angular acceleration of the brake
Braking torque

rad/s
rad/s2
Nm

2.20.3.2 Data Input

Brake Pressure
Braking Torque

Pa
Nm

_uB
€uB
MB

PB

MB

2.20 Brake (B)

2.20.3.3 Data Output

173

_uB
MB

PB

Speed
Braking Torque
Power

rad/s
Nm
W

2.20.3.4 Equation System

The instantaneous braking torque will be computed as follows [2]:

MB ¼ 2 (cid:2) pB

(cid:2) AB (cid:2) gB

(cid:2) lB

(cid:2) rB (cid:2) cB

ð2:20:1Þ

2.21 Cockpit (CO)

The cockpit links the driver and the vehicle. In this component, there are only
connections made via the Data Bus. On one hand, the driver receives information
such as the vehicle velocity and the vehicle acceleration. On the other hand,
information about of the driver, such as the pedal positions, are delivered to other
components. The pedal positions (e.g. clutch pedal position) are transferred into
corresponding indicators (e.g.. clutch release) via the pedal characteristics (e.g.
clutch pedal characteristic) [1].

2.21.1 Properties

Switch Output
A result output for this component is made if this switch is activated.

Switch Actual Distance and Velocity From Data Bus
The actual distance and velocity are taken from the Data Bus channels ‘Actual
Distance extern’ and ‘Actual Velocity extern’.

Switch Desired Velocity From Data Bus
When using AVL CRUISE as a dynamic linked library (CruiseNT.dll) with the
component ‘Interface’, the internal driver can control the velocity which is preset
over the Data Bus channel ‘Desired Velocity extern’.

It is important to connect the channel on the Data Bus system with an external
time depending signal. The driver will follow this desired velocity in an appropriate
range. Note that there must be an adapted proﬁle. e.g.. gear shifting in the task
Cycle Run.

174

2 Mathematics Behind the Models

2.21.2 User-Deﬁned Variables

ZCO,gear

Switch for manual or automatic gear shifting

–

The switch is used for the Calculation Tasks, so that the calculation knows if the
gear shifting process should be controlled by the driver (manual) or the gearbox
control.

–
–

N

NCO,G,for
NCO,G,rev

Number of Gears (forward)
Number of Gears (reverse)

This is used to indicate to the driver how many gears the gearbox contains, i.e., if

there is still another gear for upshifting or not.

FCO,brake,max

Maximum Brake Force

The maximum brake pedal force is needed for the calculation of the brake pedal
position. Output of the driver component is the brake pedal force. This brake pedal
force divided by the maximum brake pedal force is the brake pedal position.

It is also possible to deﬁne a maximum brake force in the component driver.
With this maximum brake force, the behavior of a driver can be considered. You
can have a driver who is stepping with a maximum of e.g. 100 N on the brake pedal
(deﬁned in the driver component) and in the cockpit the maximum brake pedal
force is deﬁned as 200 N. That means that the driver can have a maximum of 50 %
of the brake pedal position (100 N divided by 200 N). Thus, he has a lower brake
pressure and a longer brake distance.

NCO,R

Number of Retarder Steps

–

This is used to give the driver the information how many retarder steps the
retarder is containing, i.e., if there is still another step with a higher braking torque
or not.

Acceleration Pedal Characteristic

αCO,th (Ldk)

Load signal as function of the Acceleration Pedal Travel

%

Clutch Pedal Characteristic

Brake Pedal Characteristic

ZCO,clutch (LC)

Clutch Release as a function of the Clutch Pedal Travel

%

pCO,brake (LBr)

Brake Pressure as a function of the Speciﬁc Brake Pedal Force

bar

2.21 Cockpit (CO)

175

The characteristics of the brake pedal, the clutch pedal, and the acceleration
pedal can be deﬁned. It is possible to deﬁne an idle path or a special shape of the
characteristic.

2.21.3 Input and Output Variables

2.21.3.1 Data Input

2.21.3.2 Data Output

_u

CO

ZCO,cont,in (i)
jCO,act
jCO,target
_u

CO;measure 1

_u

CO;measure 2

sextern
vextern
vextern

ZCO,acc,out
pCO,br,out
ZCO,cl,out
NCO,G,out
ZCO,sh,up,out
ZCO,sh,dn,out
ZCO,sh,sel
NCO,ret,out
ZCO,br,sigl
ZCO,rev,sig
_u

CO;out
vCO,out
αCO,out
tCO,out
sCO,out
ZCO,start,out
TCO,ambient
ZCO,cont,out

Speed
Operation Control 0–4
Gear Indicator
Target Gear
Measuring Speed 1

Measuring Speed 2

Actual Distance extern
Actual Velocity extern
Desired Velocity extern

Load Signal
Brake Pressure
Desired Clutch Release
Desired Gear
Gear Selection Upshifting
Gear Selection Downshifting
Control Lever
Retarder Step
Brake Light Switch
Reverse Gear Switch
Speed

Velocity
Acceleration
Real Time
Distance
Start Switch
Ambient Temperature
Operation Control

rad/s
–
–
–

rad/s

rad/s

m
m/s
m/s

–

bar
%
–
–
–
–
–
–
–

rad/s

m/s
m/s2
s
m
–
°C
–

(continued)

176

ZCO,sig,out(i)
ZCO,kick,out
_u

CO;measure 1

_u

CO;measure 2
ZCO,Jake Brake
vCO,desired
vCO,max
jCO,proﬁle
NCO,task

2 Mathematics Behind the Models

Course Signal 1–3
Kickdown Signal
Measuring Speed 1

Measuring Speed 2

Jake Brake Activation
Desired Velocity from Proﬁle
Course Speed Limit
Desired Gear from Proﬁle
Type of Task

–
–

rad/s

rad/s
–

m/s
m/s
–
–

2.21.3.3 Equation System

In the module cockpit, switch, and selection functions were done. Input data were
transformed depending to the calculation settings and maps.

After that the changed values were put onto the output channels.

2.22 Exhaust System (EX)

Exhaust systems consider the effects of the catalytic converter and soot ﬁlter on the
raw emissions of the engine. Starting with the temperature of the catalytic con-
verter, factors for the conversion will be computed for the single emissions com-
ponents on the basis of the temperature-dependent maps [1].

2.22.1 Properties

Switch Output
A result output for this component is made if this switch is activated.

Calculation of temperature by using the thermal model

Selection Button Temperature
Temperature calculated
Temperature from Data Bus

Selection Button Temperature

Temperature calculated
Temperature from Data Bus

The temperature is calculated by an external simulation tool and is transferred into
the catalyst component via Data Bus.

2.22 Exhaust System (EX)

177

2.22.2 User-Deﬁned Variables

ZEX,loss

Heat Loss Coefﬁcient

–

The heat loss coefﬁcient is for determining which amount of the exhaust energy
the engine has delivered reaches the exhaust system and which amount is lost
between the engine and the exhaust system to the environment.

The heat loss coefﬁcient is the percentage of the exhaust energy delivered by the

engine which reaches the exhaust system.

mEX

Weight of Catalytic Converter

kg

This is the weight of the catalytic converter. This weight is needed for the
calculation of the temperature of the catalytic converter and as consequence the
efﬁciency of the emission conversion (Fig. 2.21).

Cp,EX

Speciﬁc Heat Capacity Cat

This is the speciﬁc heat capacity of the catalytic converter which is needed for

the calculation of the temperature of the catalytic converter.

AEX,ref

Reference Area Cat/Air

The reference area of the exhaust system is the outside surface area of the
catalytic converter. It is needed for the calculation of the heat transfer between the
catalytic converter and the ambient air.

αEX,air

Heat Transfer Coefﬁcient Cat/Air

W/m2 K

This is the coefﬁcient for the heat transfer between the catalytic converter and the
ambient air. With this heat transfer, the energy lost to the environment can be
determined.

TEX,op

Operating Temperature Cat

°C

J/kg

m2

Fig. 2.21 Thermal balance in
the exhaust system [2]

Heat transfer from the 
Exhaust Gas to the 
Catalytic Converter 

Catalytic Converter 
mEX, cp,EX

Heat transfer from the 
Catalytic Converter to 
the Environment

178

2 Mathematics Behind the Models

The operating temperature is needed for a calculation with hot start. If the hot
start is chosen, the temperature of the catalytic converter at the beginning of the
calculation is equal to the operating temperature. If cold start is chosen, the tem-
perature of the catalytic converter at the beginning of the calculation is equal to the
ambient temperature.
Conversion Efﬁciency

Þ

gEX;NOx TEXð
gEX;CO TEXð
Þ
gEX;HC TEXð
Þ
gEX;Soot TEXð

Þ

NOx—Conversion Efﬁciency
CO—Conversion Efﬁciency
HC—Conversion Efﬁciency
Soot—Conversion Efﬁciency

–

–

–

–

In these tables, the conversion efﬁciencies of the different emissions can be

deﬁned dependent on the actual temperature of the catalytic converter.

Heat Transfer Gas/Cat

αEX,gas(TEX)

Heat-up Proportion of Exhaust Gas Energy

–

This is the proportion of the heat of the exhaust gas which is transferred to the

exhaust system.

2.22.3 Input and Output Variables

2.22.3.1 Data Input

TEZ,ext,in

Temperature External

K

2.22.3.2 Data Output

PEX,out
eEX,NOx,out
eEX,CO,out
eEX,HC,out
eEX,SOOT,out
TEX

Residual Energy
Rest Emissions NOX
Rest Emissions CO
Rest Emissions HC
Rest Emissions SOOT
Temperature

W
kg/s
kg/s
kg/s
kg/s
°C

2.22 Exhaust System (EX)

179

2.22.4 Computation Variables

QEX
ƞEX, …,act

Heat capacity of the exhaust system
Actual reduction rate

J/K
–

2.22.5 Equation System

In relation to the entered exhaust energy PEX, the heat transmitting conditions, the
heat capacity of the exhaust system, and the temperature of the exhaust system TEX
are calculated.

In the next calculation step, the efﬁciency values ƞEX,act concerning TEX are

evaluated out of the maps.

The rest emissions are calculated with the following formula [2]

eEX;out ¼ eEX;...;in (cid:2) 1 (cid:4) gEX;...;act

(cid:1)

(cid:3)

ð2:22:1Þ

2.23 MATLAB®/Simulink™ (ml)

The interface to MATLAB® integrates controllers and also mechanical elements,
such as special drives created by MATLAB®/Simulink™, into the computational
model of AVL CRUISE. An element created and parameterized under Simulink™
will be compiled to a so-called “Dynamic Link Library” (DLL) under Windows.
These ﬁles will be integrated into AVL CRUISE. The advantage of this procedure
is that AVL CRUISE itself does not need to be recompiled if MATLAB®/
Simulink™ modules are integrated [1].

The input and output variables will be transferred by means of imports and
outports. These ports create the interface to the MATLAB® module and are
those of
the AVL CRUISE Data Bus. As two simulations,
available at
AVL CRUISE and MATLAB®/Simulink™, take place at the same time in this
case, the integration steps of the two programs will have to be harmonized by a
suitable selection of the step width [1].

i.e.,

2.23.1 Properties

Switch Output
A result output for this component is made if this switch is activated.

180

2 Mathematics Behind the Models

2.23.2 User-Deﬁned Variables

CML,Lib

Name of MATLAB®-Library (can be selected in a ﬁle selection dialog)

–

2.23.3 Input and Output Variables

2.23.3.1 Data Input

XML,in(i)

Inport 0–98

2.23.3.2 Data Output

XML,out(i)

Outport 0–98

–

–

2.23.3.3 Equation System

The input values are transferred to the MATLAB® function. From the module, the
results are received and input to the output channels.

Refer to the interfaces manual for more information.

2.24 Function (FU)

The component Function can be used for calculating with user-deﬁned functions.

There are two possibilities to deﬁne the function:

(a) Function deﬁnition in RPN-notation style (Reverse Polish Notation, UPN,
Postﬁx Notation, Stack Logic). No need for programming, the component has
a user-friendly selection table. Only one function output y can be deﬁned.

(b) Programming in C code. Up to 99 function outputs can be deﬁned.

Up to 99 input values can be read through the Data Bus. The values are the
function arguments, together with up to 10 constants deﬁned by the user.
Those arguments must be connected to form the function term by using
operators which can be selected from a selection menu. Also the most
important physical constants (e.g., n) are in this menu, which can be selected
as additional function arguments. After the function value has been calculated,
it can be used on the Data Bus as an output value. When deﬁning the function
in C code, it is possible to deliver values up to 99 function outputs [1].

2.24 Function (FU)

2.24.1 Properties

181

Switch Output
If this switch is activated a result output for this component is made.

In this case the formula deﬁnition has to be done by the so-called Reverse Polish
Notation (UPN, postﬁx notation, stack logic).

Selection Button Formula Mode

RPN-Formula
C-Function

Selection Button Formula Mode

RPN-Formula
C-Function

The function has to be deﬁned in C code.

2.24.2 User-Deﬁned Variables

RPN-Formula Mode
This mode is active if the selection button ‘Formula Mode’ is set to RPN-formula.

ZFU(i)

User-deﬁned Constants (maximum 10)

–

Up to 10 constants can be deﬁned to be used in the function as arguments (upper

case letters A, B, C, D, E, F, G, H, K, M).

ZFU,pi
ZFU,acc

Physical Constant PI (π)
Physical Constant 9.81

–
kg m/s2

The most important pre-deﬁned constants can be selected from a selection menu

and used as function arguments.

tFU

Variable ‘realTime’

–

In every time step this variable has the same value as the Data Bus output channel
‘Real Time’ of component cockpit. It can be used in System Analysis Mode
(SAM) in models without a cockpit.

182

opFU,arith(j)
opFU,arith(j)

opFU,arith(j)

opFU,unary(j)
opFU,unary(j)
opFU,trig(j)
opFU,hyp(j)
opFU,log(j)
opFU,logical(j)
?
ENTER

2 Mathematics Behind the Models

Arithmetical Operators: +, −, −, /
Operators: Derivation (2 arguments), Integration (3 arguments; the 3rd
argument represents the Reset signal, see below)
Operators: Time Derivation (1 argument), Time Integration (2
arguments; the 2rd argument represents the Reset signal, see below)
Operators: abs, sgn, high, low, max, min, 1/x, **, +/−
Operators: rad > deg, deg > rad
Operators: sin, cos, tan, arcsin, arccos, arctan
Operators: sinh, cosh, tanh, arsinh, arcosh, artanh
Operators: ln, exp
Operators: NOT, AND, OR, <=, >=, <, >, ==, !=
Space Symbol
End Mark of the function deﬁnition

–
–

–

–
–
–
–
–
–
–
–

The operators are selected from a selection menu. They form a function term
with the constants and input values from the Data Bus as arguments. The function
deﬁnition format is the so-called Reverse Polish Notation (UPN, postﬁx notation,
stack logic), i.e., the term “A + a[0] =” is written as “A a[0] + ENTER”. The
deﬁnition is done in a table and should be completed by typing Enter.

Click on the Function Preview button to open a window showing the function
term converted into the “normal” preﬁx notation. Additionally, there is a copy
button so that the user can copy this preﬁx term and paste it for example into the
comment line.

C-Function Mode

This mode is active if the selection button ‘Formula Mode’ is set to C-Function.

ZFU,C-Function

Function String

The function is written in C code, e.g.
‘y[0] = sin(2*a[0])/pow(a[1],1.5)—2.3’
Following contents are allowed (besides the input channels: a[0], a[1], …, a

[98]):

ZFU,C,Num

as variables.

Numerical Constants

Free user-deﬁned, e.g. 1, 3.14, 0.05
User-deﬁned constants A, B, C like in the RPN-mode can be deﬁned in C code

–

–

tFU

Variable ‘realTime’

–

2.24 Function (FU)

183

This is a pre-deﬁned variable of type ‘double’ which can be used in the C code
without a declaration. In every time step this variable has the same value as the Data
Bus output channel ‘Real Time’ of component cockpit. It can be used in System
Analysis Mode (SAM) in models without a cockpit.

Additionally, most of the ANSI C operators and statements can be used, e.g., the

Up to 99 Data Bus output variables y[0], y[1], …, y[98] can be delivered with

if-then statement.

output values.

2.24.3 Input and Output Variables

2.24.3.1 Data Input

XFU,in(i)

Input Channels a[0], a[1], …, a[98]

–

Up to 99 values can be read from the Data Bus and used as function arguments

(for RPN- mode only the ﬁrst 20).

2.24.3.2 Data Output

XFU,out

Output Channels y[0], y[1], …, y[98] (for RPN-mode only y)

–

The function values are sent to the Data Bus and can be used by other com-
ponents. When deﬁning the function in RPN-Formula mode, only the output y[0]
can be used.

2.24.4 Equation System

The user-deﬁned constants and the input values are transferred to the function
which calculates the output values by using the formula that has been deﬁned by the
user in a table, or by using the user-deﬁned C-function code. The output value(s)
can be used by other components through the Data Bus.

Example
The input value a[0] should be multiplied by 9.81. The result should be multiplied
by the factor 0.92 which has been deﬁned as a constant (B).

In the parameter ﬁeld the letter B is assigned the value 0.92. The function is

deﬁned in the formula table as follows:

B:= 0.92

2 Mathematics Behind the Models

The expressions of the table are selected in a certain selection menu. At the end

of the table ENTER should always be written.

Derivation
This operation has 2 arguments. For example, the following input table means that
the signal of Data Bus input a[0] should be differentiated by the signal of Data Bus
input a[1].

184

Position

Position

1
2
3
4
5
6

1
2
3
4

1
2
3
4
5

Integration
This operation has 3 arguments:

Position

Y=

a[0]
9.81
*
B
*
ENTER

y=

a[0]
a[1]
Derivation
ENTER

y=

a[0]
a[1]
a[2]
Integration
ENTER

The above input table means that the signal of Data Bus input a[0] should be
integrated by the signal of Data Bus input a[1], whereas Data Bus signal a[4]
represents the reset signal.

The meaning of the reset signal is as follows:

Value

>0
0
<0

Action
“normal” summation
Reset; integration output is set to 0 and stays 0 as long as the reset value is <=0
No further summation

The trapezoid method is used as integration method.

2.24 Function (FU)

185

Time Derivation, Time Integration
These operations are similar to derivation/integration, except that they have one
argument less.

Their ﬁrst argument is not differentiated/integrated by a second argument which
can be chosen by using the Data Bus, but always by the (internal) simulation time.

2.25 Constants (CN)

In the Constants component the user can deﬁne up to 99 constant values which can
be used by other components through the Data Bus. The values can be of type
integer, double or string [1].

2.25.1 Properties

Switch Output
If this switch is activated a result output for this component is made.

2.25.2 User-Deﬁned Variables

ZCN(i)

User-deﬁned Constants (maximum 99)

–

Up to 99 constants can be deﬁned which can be used by other components via
Data Bus. Every constant requires the deﬁnition of the Data Bus channel number, a
comment, the constant value, the unit and the data type. Data type can be of integer,
double or string.

In the case of a string constant, the unit deﬁnition is not used in calculation. The

Data Bus transfers the pointer (address) of the string.

2.25.3 Input and Output Variables

2.25.3.1 Data Output

ZCN,out(i)

Constant Outputs (maximum 99)

–

The constant output values are sent to the Data Bus and can be used by other

components.

186

2.26 Monitor

2 Mathematics Behind the Models

The monitor can be introduced if the calculation run must be detected. It is possible
to show some results of the calculation while the calculation is running. This is
done via the online-monitor [1].

It is possible to connect up to ten input channels of the monitor to output
channels of different components that are available at the AVL CRUISE Data Bus.
Currently, the output in the online-monitor is only available in the form of

tables [1].

2.26.1 Properties

Switch Output
A result output for this component is made if this switch is activated.

2.26.2 Input and Output Variables

2.26.2.1 Data Input

XMon,in(i)

Input 0–9

–

These input values can be read in via the Data Bus. During the calculation, they

were written on the online-monitor for each time step.

2.27 Wheel/Tire (W)

The wheels and tires link the vehicle to the road. The component wheel allows to
consider many inﬂuencing variables and their effect on the rolling state.

The moment of rolling drag can be computed on the basis of the wheel load, the

corrected dynamic rolling radius, and the coefﬁcient of rolling drag [1].

The longitudinal

tire force (circumferential force) results from the friction
coefﬁcient, the wheel load as well as from the wheel load factor and the slip factor.
It is possible to deﬁne variable friction coefﬁcients along the driving proﬁle when
different road conditions are considered [1].

The wheel component also includes a detailed rolling resistance furnished by
Michelin. This model describes the rolling resistance of the tire depending on the
tire inﬂation pressure, load, translation speed, the ambient temperature and the time
[1].

2.27 Wheel/Tire (W)

2.27.1 Properties

187

Switch Variation
The Wheel can be given free for variation with this switch. The setup of the
variation parameters is done in the folder.

Switch Output
If this switch is activated a result output for this component is made.

In this case the input constant value is used for the dynamic rolling radius.

Selection Button Dynamic Rolling Radius

Constant Value
From Characteristic

Selection Button Dynamic Rolling Radius

Constant Value
From Characteristic

In this case the dynamic rolling radius is interpolated out of the characteristic.

In this case no consideration of the wheel slip in the calculation is possible.

Here the deﬁnition of the wheel slip is done by the characteristics “Maximum in the
Slip Characteristic” and “Asymptote in the slip characteristic.” If Function with
Limit is selected the maximum slip is limited with a slip which is slightly higher
than the maximum value from the slip characteristic.

This limitation is also used for Function without limitation for all stationary
calculations (Climbing Performance, Full Load Acceleration/Acceleration in all
Gears, Maximum Traction Force). This is done to avoid instabilities in the calcu-
lation and therefore results which can be misunderstood.

Selection Button Wheel Slip

deactivated
Function
Function with Limit
Map
Map with Limit

Selection Button Wheel Slip

deactivated
Function
Function with Limit
Map
Map with Limit

Selection Button Wheel Slip

deactivated
Function
Function with Limit
Map
Map with Limit

188

2 Mathematics Behind the Models

Here the speciﬁc traction (as percentage of the wheel load) is deﬁned as function
of the wheel slip and the friction coefﬁcient of the road. If Map with Limit is
selected the maximum slip is limited with a slip which is slightly higher than the
maximum value from the traction map.

This limitation is also used for Map without limitation for all stationary cal-
culations (Climbing Performance, Full Load Acceleration/Acceleration in all Gears,
Maximum Traction Force). This is done to avoid instabilities in the calculation and
therefore results which can be misunderstood.

Switch Rolling Resistance Model
If this switch is activated, the rolling resistance is calculated by a detailed resistance
model.

Switch Rolling Resistance
wheel load dependent
wheel pressure dependent
velocity dependent
temperature dependent

With these switches the input of the rolling resistance can be deﬁned. It is possible
to activate more than one inﬂuence. All activated rolling resistances are added to the
overall rolling resistance. These switches can only be activated if the Switch
Rolling Resistance Model is deactivated.

Selection Button Dimensions

calculated
deﬁned

calculated
deﬁned

In this case the tire diameter and the surface area are calculated with the input data
of tire section width, tire aspect ratio and tire seat diameter.

Selection Button Dimensions

In this case the tire diameter and the surface area are deﬁned by the user.

Selection Button Wheel Location

Vehicle: Front Left
Vehicle: Rear Left
Vehicle: Rear Right
Vehicle: Front Right
Trailer: Left
Trailer: Right
Two Axle Trailer: Front Left
Two Axle Trailer: Rear Left
Two Axle Trailer: Rear Right
Two Axle Trailer: Front Right

With this selection button the location can be deﬁned where this wheel is located on
the vehicle or the trailer.

Wheel Slip

θW

µW,tire

2.27 Wheel/Tire (W)

189

2.27.2 User-Deﬁned Variables

Inertia Moment of the Wheel

kg m2

Friction Coefﬁcient of Tire

The friction coefﬁcient of the tire depends on the material used in the tire. With
this friction coefﬁcient it is possible to consider the effects of different wheels on the
behavior of the vehicle.

FW,s,norm

Reference Wheel Load

The curves for the maximum slip in the slip curve and the transmission ratio at

inﬁnite slip are measured at the reference wheel load.

The calculation of the longitudinal force is done like follows [2]:

FL ¼ lRoad

(cid:2) lW;Tire

(cid:2) cS (cid:2) cF (cid:2) FW;s

ð2:27:1Þ

–

N

Longitudinal force

FL
µRoad Friction Coefﬁcient of the road
cS
Slip Correction Factor
cF
Wheel Load Correction Factor
FW,s Wheel Load

cW,s,F

Wheel Load Correction Coefﬁcient

–

For the real wheel load is never the reference wheel load the longitudinal force
has to be corrected with the wheel load correction factor (cF). For this case the
correction coefﬁcient is used. It determines the gradient of the curve (refer to
Fig. 2.22; the gradient is (cid:4) cW;S;F
ÞAlthough the gradient is normally negative, a
FW;S;norm
positive correction coefﬁcient has to be entered in the input ﬁeld [2].

cF ¼ 1 (cid:4) FW;act (cid:4) FW;S;norm

(cid:2) cW;S;F

FW;S;norm

ð2:27:2Þ

FW,act actual wheel load

190

2 Mathematics Behind the Models

cF

1

FW,s,norm

FW,s

Fig. 2.22 Wheel load correction factor [2]

Rolling Radius

Static Rolling Radius

rW,stat

Static Rolling Radius

mm

The static rolling radius is the distance between the center of the wheel and the

road surface for the loaded vehicle but without moving.

The dynamic rolling radius is the distance between the center of the wheel and
the road surface for the loaded vehicle with moving. The dynamic rolling radius is
usually a little bit bigger than the static rolling radius.

Dynamic Rolling Radius (Constant)

rW,dyn

Dynamic Rolling Radius

mm

The constant value is used when the selection button Dynamic rolling radius is

set to constant value.

Dynamic Rolling Radius (Characteristic)

rW,dyn(vV)

Dynamic Rolling Radius

mm

Here the dynamic rolling radius can be deﬁned as function of the velocity. This
characteristic is active when the selection button Dynamic rolling radius is set to
“from characteristic.”

Slip Curve
Maximum in the Slip Characteristic

sW,grenz(µU,road)

Slip at Maximum Traction

%

2.27 Wheel/Tire (W)

191

cs

1

µW,U

sW,grenz

Fig. 2.23 Slip correction factor [2]

sw

–

Asymptote of Slip Characteristic

µW,U(µU,road)

Speciﬁc Traction at Inﬁnite Slip

The slip at maximum traction is together with the speciﬁc traction at inﬁnite slip
the Characteristic Values for the slip correction factor (refer to Fig. 2.23). The slip
correction factor depends on the friction coefﬁcient of the road.

Traction Map

µW,U(sW,µU,road)

Speciﬁc Traction

%

This is a second possibility for the description of the wheel slip.

Rolling Resistance Factor
The rolling resistance is given in %, i.e., the rolling resistance force is calculated
with [2]:

FW;r ¼ cW;r (cid:2) FW;s

ð2:27:3Þ

FW,r Rolling Resistance Force

cW,r,load

Rolling Resistance wheel load dependent

%

This part of the rolling resistance depends on the wheel load.

cW,r,pres
pW,ref

Rolling Resistance wheel pressure dependent
Nominal wheel pressure

%
bar

This part of the rolling resistance is converted form the nominal wheel pressure

to the actual wheel pressure.

192

cW,r

2 Mathematics Behind the Models

Fig. 2.24 Rolling resistance [2]

vV

cW,r(vV)

Rolling Resistance as function of Vehicle Velocity

%

The rolling resistance depends on the vehicle velocity. It is nearly constant at
lower velocities and increases when the velocity is getting higher. The velocity
where the rolling resistance starts to increase depends on the design of the tire (refer
to Fig. 2.24).

cW,r,temp(TU)

Rolling Resistance temperature dependent

%

This part of

the rolling resistance depends on the actual environment

temperature.

In the case of cornering the rolling resistance increases. It is possible specify a

proximity relationship between this increase and the actual side slip angle.

Transient Rolling Resistance
The following inputs are required when the switch Rolling Resistance Model is
activated.

Speciﬁcation of dimension:

Tire Section Width

mm

The Tire Section Width is the linear distance between the outside sidewalls of an
inﬂated tire without any load (exclusive of protruding side ribs and decorations).

Tire Aspect ratio

%

The Tire Aspect Ratio is (Section Height).100/Section Width, whereas the
Section Height is the distance from rim seat to outer thread surface of the unloaded
tire.

DW,seat

Tire Seat diameter

in

The tire seat diameter is the diameter of the rim seat supporting the tire bead.

WW

RW

2.27 Wheel/Tire (W)

193

DW,design

Tire Design Diameter

m

The tire design diameter is the diameter of the inﬂated tire without any load.

AW

Tire Surface Area

m2

The surface area is the total external surface area of the tire.
Depending on the selection button dimensions, the tire section width, tire aspect
ratio and tire seat diameter, or the tire design diameter and tire surface area have to
be deﬁned.

Measured data at ISO-test conditions:

The tire velocity is the tangential velocity of the tire.

Tire-speciﬁc data:

cW,roll,ISO
pW,ISO
FW,ISO
vW,ISO

TW,ISO
cW,conv,ISO

αW
βW
bW,lin
cW,quad
cW,ambient
γW,conv
mW
cW,heat,equiv
kW,emp
cW,aero

Rolling Resistance Coefﬁcient
Tire Inﬂation Pressure
Tire Load
Tire Velocity

Reference Temperature
Convection Coefﬁcient

Pressure Sensitivity Exponent
Load Sensitivity Exponent
Linear Speed Coefﬁcient
Quadratic Speed Coefﬁcient
Temperature Sensitivity Coefﬁcient
Convection Coefﬁcient Exponent
Tire Mass
Speciﬁc Heat Capacity Of Tire
Empirical Rolling Resistance Coefﬁcient
Air Resistance

–

bar
N
m/s

C
–

–
–
–
–

1/k
–

kg
J/kg K
1/K
N

Initial conditions:

TW,init

Initial Temperature

C

194

2 Mathematics Behind the Models

2.27.3 Input and Output Variables

2.27.3.1 Mechanical Connection

Angular velocity of the wheel

Angular acceleration of the wheel

Angular velocity of a virtual wheel

Angular acceleration of a virtual wheel

Torque on the drive side
Vehicle forced moment

rad/s
rad/s2
rad/s
rad/s2
Nm
Nm

_u
W;in
€uW;in
_u
W;out
€uW;out
MW,in
MW,out

sW
_u

W

MW,trans
TW,act
FW,act
PW
PW,loss
FW,roll

TW,ambient

Ambient Temperature

K

2.27.3.2 Data Input

2.27.3.3 Data Output

Slip Signal
Speed
Wheel Torque
Tire Temperature
Wheel Load
Power
Power Loss
Rolling Resistance Force

%
rad/s
Nm
K
Nm
W
W
N

2.27.4 Computation Variables

SW,peak,act
µW,asym,act
CW,coeff1
CW,coeff2
vW,ref
FW,a
FW,roll
rW,dyn

Actual slip of peak friction point for current road condition
Actual Asymptote of slip correction factor for current road condition
Wheel slip coefﬁcient 1
Wheel slip coefﬁcient 2
Reference Velocity
Longitudinal force of tires
Rolling drag
Corrected dynamic rolling radius

–
–
–
–

m/s
N
N
m

(continued)

2.27 Wheel/Tire (W)

MW,trans
Mw,roll
Mw,slip
Mw,virt
FW,roll
TW,act
TW,stab

Torque transmitted by the wheel
Rolling drag moment
Slip moment
Vehicle moment on a virtual wheel
Instantaneous Rolling Resistance
Instantaneous Tire Temperature
Stabilized Tire Temperature

2.27.5 Equation System

2.27.5.1 Dynamic Wheel Radius

195

Nm
Nm
Nm
Nm
N
K
K

There are two possibilities for determining the dynamic wheel radius.

1. Dynamic wheel base radius (ZW=1)

The dynamic wheel radius is constant for the whole speed range [2]:

rW;dyn ¼ rW;dyn;base

ð2:27:4Þ

2. Dynamic wheel radius map (ZW = 2)

The dynamic wheel radius rW, dyn is evaluated from the map for the actual
wheel speed _uW;out2].

rW;dyn ¼ rW;dyn;list vVð

Þ

ð2:27:5Þ

2.27.5.2 Forces and Moments

Rolling Drag Moment [2]

MW;roll ¼ FW;in (cid:2) cW;r vV;act

(cid:2) rW;dyn

ð2:27:6Þ

(cid:1)

(cid:3)

The rolling resistance coefﬁcient is evaluated out of the map Cw,f(Vv) for the

actual vehicle velocity.

The rolling resistance is deﬁned as followed [2]:

c ¼ cv þ cqcRL þ cT þ cp

ð2:27:7Þ

c
rolling resistance factor
cV velocity proportional part

196

cv = cv(v)

cρ Rolling resistance inﬂuenced by side slip angle [2]:

cq ¼ mvehicle (cid:2) v2
q (cid:2) g

(cid:1)

(cid:1)

(cid:3)

(cid:3)

vehicle

(cid:2) abs sin af ðrÞ

side slip angle

af(r)
cRL wheel load proportional part [2]:
(cid:1)

cRL ¼ c(cid:11)

RL

(cid:11) FN (cid:4) FN;Norm

=FN

(cid:3)

reference wheel load proportional part

*

cRL
FN,Norm reference wheel load
cT

temperature proportional part [2]:

2 Mathematics Behind the Models

ð2:27:8Þ

ð2:27:9Þ

cT ¼ cT TUð

Þ

ð2:27:10Þ

cp

tire pressure proportional part [2]:

cp ¼ c(cid:11)

p

ð

(cid:11) pNorm (cid:4) pact

Þ=pNorm

ð2:27:11Þ

*

factor at reference tire pressure

cRL
pNorm reference tire pressure
pact

actual tire pressure (load-dependent deﬁnition in vehicle component)

Slip Moment

Wheel Slip function
For the current road condition (µu,road) the Slip Characteristics can be evaluated
from the SW;peak lu;road

and lw;asym lu;road

(cid:1)

(cid:3)

(cid:3)

(cid:1)

With this, we calculate the slip coefﬁcients [2]:

Cw;coeff1 ¼ 2 (cid:4)

(cid:1)
2 (cid:2) arcsin lw;asxm;act
p

(cid:3)

Cw;coeff2 ¼

1
SW;peak;act

(cid:2) tan

(cid:1)

p2
(cid:1)
4 (cid:2) p (cid:4) arcsin lw;asym;act

(cid:3)

(cid:3)

Reference Velocity [2]

If vV;act [ _u

W;in

(cid:2) rw;dyn ! vW;ref ¼ vV;act

Else ! vW;ref ¼ _u

(cid:2) rW;dyn

W;in

ð2:27:12Þ

ð2:27:13Þ

ð2:27:14Þ

ð2:27:15Þ

2.27 Wheel/Tire (W)

197

Current wheel slip
Independently from the operating mode the wheel slip results from [2]

_uW;in

(cid:2) rW;dyn (cid:4) vV;act

sW ¼

(cid:10)
(cid:10)

for

vW;ref

(cid:10)
(cid:10)\10(cid:4)4sW ¼ 0

ð2:27:16Þ

vW;ref

Slip difference
The slip difference is deﬁned as difference between the actual slip and the inﬁnite
slip with the peak friction value [2].

DSW ¼ SW (cid:4) SW;peak;act

ð2:27:17Þ

Selection for different ΔsW [2]

DSW\0
Mw;slip ¼ 0

DSW (cid:6) 0:03

MW;slip ¼ (cid:4)SIGN SWð

Þ (cid:2) 5 (cid:2) 105 (cid:7) DS2
W

DSW [ 0:03

MW;slip ¼ (cid:4)SIGN SWð

Þ (cid:2) 5 (cid:7) 105 (cid:2) 0:03 (cid:2) 2 (cid:2) DSw (cid:4) 0:03

ð

Þ

ð2:27:18Þ

ð2:27:19Þ

ð2:27:20Þ

The Transmittable Longitudinal Wheel Force
This is the force value which can be transmitted by the wheel—road friction.

The maximum slip correction factor is [2]:

CW;lim ¼ sin CW;coeff1 (cid:2) arctan CW;coeff2 (cid:2) SW
(cid:8)

h
(cid:2) tanh 3:6 (cid:2) v2

V;act

þ 0:0278 þ _u (cid:2) rW;dyn

2(cid:2)0:02

(cid:3)

i :
(cid:9)

ð2:27:21Þ

(cid:1)

(cid:3)

(cid:1)

Fw;pot ¼ Fw;in (cid:2) lw;tire

(cid:2) lu;road

ð2:27:22Þ

For the actual wheel slip, the maximum transmittable force is [2]:

FV;a;lim ¼ CW;lim (cid:2) FW;pot

ð2:27:23Þ

The moment of the vehicle (acting at the virtual wheel with r =1 m) in deﬁned as

followed [2]:

MV;virt ¼ FV;a;lim (cid:2) 1 m

ð2:27:24Þ

198

2 Mathematics Behind the Models

For the actual longitudinal force FW,a
For the actual longitudinal force, the necessary slip correction factor can be cal-
culated back [2]:

CW;act ¼ FW;a
FW;pot

Cslip ¼

FW;a
FW;pot (cid:2) Cw;coeff1 (cid:2) Cw;coeff2

ð2:27:25Þ

ð2:27:26Þ

if (Fw,a> FV,a,lim) more longitudinal force should be transmitted as it is possible

with the actual wheel slip.

For rolling resistance and slip together [2]:

(cid:1)

(cid:3)

MW;trans ¼ (cid:4) FW;a (cid:2) rW;dyn (cid:4) MW;roll (cid:4) MW;lip

ð2:27:27Þ

Wheel power
The wheel power is calculated out of the transmitted wheel torque and the wheel
speed [2]:

PW;trans ¼ MW;trans (cid:2) _uW

ð2:27:28Þ

2.27.5.3 Rolling Resistance Model

Determination of the exterior diameter and the surface area [2]:

DW;design ¼ DW;seat þ 2RW (cid:2) WW
 

100

!

AW ¼ DW;design (cid:2) p (cid:2) WW þ 2p

D2

W;design
4

(cid:4)

D2

W;seat
4

ð2:27:29Þ

ð2:27:30Þ

The fundamental assumption of this detailed tire model is that the transient tire
temperature response can be modeled in the same way as the steady state response
to the ambient temperature [2]:
(cid:11)

(cid:1)

(cid:3)

(cid:12)

FW;roll ¼ FW;roll;stab 1 þ kW;emp TW;act (cid:4) TW;stab

ð2:27:31Þ

In order to calculate the instantaneous rolling resistance at each time step, the

subsequent algorithm has to be followed:

2.27 Wheel/Tire (W)

199

(1) The steady state rolling resistance value FW,roll,stab at current conditions as a
function of tire load FW,act, tire inﬂation pressure zV,load, tire translation speed
vW,act and ambient temperature TU [2]:
 

FW;roll;stab ¼ cW;roll;ISO (cid:2) FW;act
"

(cid:4)

pact
pW;ISO
(cid:5)
vW;act (cid:4) vW;ISO
(cid:2) 1 þ b
vW;ISO
(cid:11)
(cid:1)
(cid:2) 1 þ cW;ambient TW;ISO (cid:4) TU

þ c
(cid:3)

(cid:12)

!aW

(cid:4)

(cid:5)b

W

FW;act
FW;ISO
(cid:4)

#

(cid:5)
2

vW;act (cid:4) vW;ISO
vW;ISO

ð2:27:32Þ
in which the coefﬁcients cW,roll,ISO, pW,ISO, vW,ISO, TW,ISO, bW,lin, cW,quad, αW,
βW and cW,ambient are unique to each tire. The subscript ISO simply refers to
the parameters value under ISO (or actual) test conditions. Naturally these
values must be furnished along with the model coefﬁcients.
In the above equation, we have not yet added the aerodynamic drag. Since the
aerodynamic drag is assumed independent of temperature, it is added after the
instantaneous rolling resistance is calculated.

(2) The stabilized tire temperature TW,stab is equal to [2]:
TW;stab ¼ TU þ vW;act (cid:2) FW;roll;stab
CW;conv (cid:2) AW

ð2:27:33Þ

where [2]:

cW;conv ¼ cW;conv;ISO

ð2:27:34Þ

(cid:4)

(cid:5)
c

vW;act
vW;ISO

and cW,conv,ISO, γ and AW are unique to each tire. For the case of vW,act = 0 it is
necessary
To apply a free convection exchange coefﬁcient. In this case, we ﬁrst calculate
the Rayleigh number [2]:

(cid:1)

(cid:3)

g (cid:2) bW TW;act (cid:4) TU

(cid:2) D3

W;design

RaD ¼

va

ð2:27:35Þ

with [2]:
g
βW

gravitational constant (9.81 m/s2)
volumetric thermal expansion coefﬁcient of air (which can be
approximated as

K(cid:4)1

½

(cid:3)

2
TW;actþTU

v [m/s2] kinematic viscosity of air (evaluated at TW;actþTU

through interpola-

2

tion in a table)

200

2 Mathematics Behind the Models

α [m/s2]

thermal diffusivity of air (evaluated at TW;actþTU
in a table)

2

through interpolation

Then the Nusselt number and subsequently the heat transfer coefﬁcient are
calculated [2]:

D

NuD ¼ 0:15Ra0:333
cW;heat ¼ NuD (cid:2) kW;therm
DW;design

ð2:27:36Þ

ð2:27:37Þ

with
kW,therm [W/mK]

thermal conductivity of air (evaluated at TW;actþTU
interpolation in a table)

2

through

(3) The instantaneous average tire temperature at each time increment is then

obtained by integrating [2]:

TW;act tð Þ (cid:4) TW;act;last ¼

FW;roll (cid:2) vW;act (cid:4) cW;heat (cid:2) AW TW;act;last (cid:4) TU

1
mW (cid:2) CW;heat;equiv

(cid:11)

Zt

0

(cid:1)

(cid:12)
(cid:3)

d~t

ð2:27:38Þ

with
cW,heat,equiv equivalent speciﬁc heat of the tire [J/kg K]

(4) Once the instantaneous tire temperature is calculated, the instantaneous rolling

resistance is calculated by [2]:
(cid:11)

FW;roll ¼ FW;roll;stab 1 þ kW;emp TW;act (cid:4) TW;stab

ð2:27:39Þ

(cid:1)

(cid:3)

(cid:12)

(5) Concluding the (temperature-independent) aerodynamic drag is added to

receive the ﬁnal, entire instantaneous rolling resistance [2]:

FW;roll ¼ FW;roll þ cW;aero

ð2:27:40Þ

(cid:4)

(cid:5)
2

vW;act
vW;ISO

References

1. AVL Cruise (2011) Users guide, AVL list GmbH, Graz, Austria, Document no. 04.0104.2011,

2. AVL Cruise (2009) Theory manual, AVL list GmbH, Graz, Austria, Document no.

Edition 06.2011

04.0108.2009, Edition 06.2009

References

201

3. Patton KJ, Nitschke RG, Heywood JB, Development and evalu-ation of a friction model for

spark-ignition engines. SAE Paper No. 89-0836

4. Shayler PJ, Christian SJ, Ma T, A model for the investigation of temperature heat ﬂow and

friction characteristics during engine warm-up. SAE Paper 93-1153

5. Shayler PJ, Leong DKW, Murphy M (2003) Friction teardown data from motored engine tests
on light duty automotive diesel engines at low temperatures and speeds. In: ASME 2003, Fall
Technical Conference

Chapter 3
Virtual Powertrain Design

The drivetrain conﬁguration is freely deﬁnable and the user can build in as many
clutches, torque converters, or elastic shafts as required.

The drivetrain conﬁguration is like a standard vehicle with a manual gearbox. In
this conﬁguration, only one clutch is allowed. In front and after the clutch, there can
only be one degree of freedom. In addition, just one gearbox is allowed in this
conﬁguration. The standard manual gearbox was developed for shifting in the next
gear according to the engine speeds. In addition, check that the friction clutch is
directly connected to the gearbox.

The drivetrain conﬁguration is like a standard vehicle with an automatic gear-
box. In this conﬁguration, only one torque converter is allowed. In front and after
the torque, converter there can only be one degree of freedom. In addition, just one
gearbox or one Continuously Variable Transmission (CVT) is allowed in this
conﬁguration. For the different conﬁgurations, different calculation algorithms are
used. Thus the calculation times can be decreased for standard drivetrains [1].

Standard automatic was developed for shifting according to speeds in the next
gear. In addition, the torque converter is directly connected to the gearbox or the
CVT.

In the User Area (Fig. 3.1) click on the Projects folder with the right mouse
button and select new project. Enter a name and select OK. The new name will
appear in the projects tree. Select this new project with the right mouse button and
select new version. Enter the new version name or keep the default version name.
Select OK. Select the version with the right mouse button and select save. All ﬁles
and subdirectories required for the project management are created [2].

In the navigation frame there is current default project directory with tree
structure, showing all existing subfolders, projects, and versions in that directory.
On the right side of the window, there are detailed data regarding objects in the tree
structure.

To start a new project, in User tab with right mouse click popup menu, select
new and chose project or version and create project or version with new name. For
already existing project, load project or version by selecting the desired version of
the project from project tree structure in User view [1].

After starting AVL CRUISE platform, select Desk tab and click to Vehicle

Model to open Desk Area to begin building the new model.

© Springer International Publishing Switzerland 2015
B.O. Varga et al., Electric and Plug-In Hybrid Vehicles,
Green Energy and Technology, DOI 10.1007/978-3-319-18639-9_3

203

204

3 Virtual Powertrain Design

Fig. 3.1 User Area

Fig. 3.2 Desk Area

To insert component into model click on the Desk Area (Fig. 3.2) and then click

on the Vehicle Model.

The components used to build the models are located under the Desk Area—

Modules Sidebar, and are described in Table 3.1.

In addition to the components of the drivetrain, whose single modules are
deﬁned by a Conﬁguration File at the program start, there are general modules on
each view which corresponds to a vehicle.

3 Virtual Powertrain Design

205

Table 3.1 Components Description

Symbol

Component

Category Vehicles

Category Clutches

Vehicle: The vehicle is the basic component of every model. In this
component, the general data of a model like the nominal dimensions or
the weights are deﬁned. Only one vehicle component is required in a
model. Road resistances and dynamic wheel loads are calculated for road
and dynamometer runs based on the dimensions and the load state. The
wheel loads are calculated considering motion. The aerodynamic, rolling,
climbing, acceleration, and total resistance are calculated.

Clutch: The clutch contains a model for a friction clutch as it is used in
vehicle with manual gearboxes. In this case, the clutch is controlled by
the driver via the cockpit. The clutch can also be used together with a
CVT gearbox and it is only necessary for starting. In this case, the clutch
is controlled by the control module CVT control. The clutch slips to
compensate for the difference in the rotational speeds of engine and
drivetrain when the vehicle is set in motion.
Torque Converter: employ the force represented by a moving ﬂuid to
transmit engine torque. As these devices compensate for differences in
the rotating speeds of engine and drivetrain, they are ideal for effecting
the transition from stationary to mobile operation. The torque converter
also multiplies torque. First, pump converts the mechanical energy
emanating from the power unit into ﬂuid energy; a second
transformation, back into mechanical energy.
Automatic Clutch: The automatic clutch is used as the starting clutch in
vehicles. This component holds a model of an uncontrolled automatic
clutch which is often used as the starting clutch (centrifugal clutch) in
vehicles. The transferable torque is based on the speed ratio between
input and output considering the mass moments of inertia. The clutch
torque is described by characteristics which depend on the speed ratio
between input and output.
Shaft: is used to make elastic connections between different components
and for the study of low-frequency dynamic effects in the drivetrain,
which are caused by shifting gears. Shaft connections in the drivetrain
can be modeled to be rigid or elastic at torsion. The clearance in elastic
shaft connections can also be taken into account. The torsional stiffness
of the shaft depends on the length of the shaft.

Gearbox: Gear transmissions featuring several ﬁxed ratios can maintain
a correspondence between the respective performance curves for engine
and vehicle. The component gearbox contains a model for a gearbox with
different gear steps. The gearbox can be used for a manual or automatic
gearbox. When used as an automatic gearbox, the gear shifting process
will be controlled by the control module gearbox control or gearbox
program.

(continued)

Category Gearbox

206

Table 3.1 (continued)

Symbol

Category Engines

3 Virtual Powertrain Design

Component
CVT: The Continuously Variable Transmission can convert every point
on the engine’s operating curve to an operating curve of its own, and
every engine operating curve into an operating range within the ﬁeld of
potential driving conditions. With the model of the CVT gearbox it is
possible to change the transmission between two user-deﬁned threshold
values. The adjusting speed between different transmissions is internal
ﬁxed at a constant value.
Single Ratio (Transmission Step): The Single Ratio Transmission is a
gear step with ﬁxed ratio. It can be used as a transmission step of the
differential (ﬁnal drive unit). A drive torque will be transferred to a power
take-off torque of the transmission step by considering the transmission,
the mass moments of inertia and the loss moments. The transmission
ratio can be changed by multiplication with an additional factor and is
deﬁned by the number of teeth of input and output.
Differential (Power Divider): The division of one drive torque into two
power take-off torques will be done by considering the transmission, the
moments of inertia. The differential unit compensates for discrepancies in
the respective rotation rates of the drive wheels: between inside and
outside wheels during cornering and between different drive axles on
4WD vehicles. This wheel then responds to the application of excessive
force by spinning.
Planetary Gear: The planetary gearbox belongs to the power split
devices. It consists of three main components: the sun gear, the planet
carrier and the ring gear. This gearbox can be used in hybrid systems,
where vehicles are be driven using different power supplies. With the
planetary gear, it is possible to add torque and speed with different
directions at the transmission input shafts. The speed ratio and the
direction of rotation can be changed according to which member is ﬁxed.

Engine: The internal combustion engine will be modeled by means of
characteristic curves and maps. This component contains a model for a
internal combustion engine. The characteristic curves for the full load,
the fuel consumption, and others can be freely deﬁned by the user. It is
possible to deﬁne a gasoline engine as well as a diesel engine. In this
component, a temperature model is included to consider the inﬂuence of
the temperature on the fuel consumption and emissions while the engine
is cold.
Boost Engine: The Boost engine component supplies a connection to the
engine cycle simulation AVL BOOST and enables a coupling with the
BOOST combustion engine model in AVL CRUISE. Additionally, the
AVL CRUISE user can start the pre- and postprocessors of AVL BOOST
by pressing the appropriate button, thereby using all the features of
AVL BOOST. Engine maps can be either precalculated or then used as
stationary maps or the calculation can run online considering all the
transient effects.

(continued)

3 Virtual Powertrain Design

207

Table 3.1 (continued)

Symbol

Component

Category Electrical Modules

Electric Motor: Can be used for electrically driven vehicles, cars with
hybrid drive or to operate auxiliaries such as a fan or an oil pump. The
electric motor is deﬁned by means of characteristic curves. Therefore,
different motor type models can be constructed. Efﬁciency map is
dependent on the speed and the voltage. Map of the output torque
dependent on the speed and the voltage. Efﬁciency map is dependent on
the speed and the voltage.
Generator: The generator must furnish the vehicle’s electrical system
with a sufﬁcient supply of current under all operating conditions. The
objective is to achieve balanced charging the curves for performance and
speed-frequency response must be selected to ensure that the amount of
current generated under actual operating conditions. The current
delivered by the generator results from a map dependent on the speed and
the main voltage.
Battery: The battery must be capable of limited-duration high-current
delivery for starting, and it must be able to furnish some or all of the
electrical energy for other important system components for limited
periods with the engine at idle or off. The lead-acid storage battery
represents the usual means of meeting these demands. The instantaneous
charge of the battery is determined by means of a balance computation.
The charge capacity is the nominal capacity of the battery.
Electrical Consumer: Electric consumers are represented as ohmic
resistors in the onboard network. They represent an electric current loss.
The number of resistors that can be deﬁned is user dependent. The
resistors can be ﬁxed by a constant value or by means of characteristic
curves. It is possible to deﬁne resistors as a function of any external input
value. It is also possible to deﬁne an external switch that switches the
resistor on and off depending on exceeding an external value.

Electric Machine: The electric machine component can be used either as
an electric motor or as a generator. There are separate characteristic maps
for each mode. Together with the battery H and supercapacitor
components, the user can simulate hybrid systems. The model of the
electric machine contains two components, the inverter and the electric
motor. For this type of model, a characteristic map for the efﬁciency is
used to calculate the loss of power.
Supercapacitor: This component is a capacitor with a very high
capacity. It stores energy in electrostatic ﬁelds and can reach a very high
power density (up to 1 kW per kg). The thermal behavior of the
supercapacitor is described by a thermal substitution model. Single cells
can be modeled as well as any combination of them. The supercapacitors
cell structure is kind of a matrix with a constant number of rows and a
constant number of cells in each row.

(continued)

Category Hybrid Modules

208

Table 3.1 (continued)

Symbol

Category Controls

3 Virtual Powertrain Design

Component
Battery H: The basic model consists of a voltage source and an ohmic
resistance. Internal resistance can be deﬁned either as a constant value or
as a temperature dependent function. The resistance is constructed in a
way that a big part of the complex processes within the battery are taken
into consideration. The thermal behavior of the battery is described by a
thermal substitution model. Single cells can be modeled as well as any
combination of them.

Gearbox control: The gearbox control is required to deﬁne an automatic
gearbox. In the gearbox control, the gear shifting process can be deﬁned
automatically without any inﬂuence of the driver. The gearbox control
shifts the gears dependent on a speed or velocity. In the calculation tasks
it is decided which of the two shifting strategies is used. The speed,
respectively, which velocity is used can be deﬁned via the Data Bus
connection.
Gearbox program: This is used for automatic gearboxes in combination
with the gearbox control. The gearbox program allows for a more
complicated gear shifting process than the gearbox control, as the load
signal of the engine is considered. The gearbox program shifts the gears
according to given curves as a function of the load signal and the engine
speed. The target gear determined by the program is transmitted to the
gearbox control that transmits it to the gearbox.
CVT control: This component controls the CVT gearbox. The
transmission of the CVT can be deﬁned as function of the vehicle
velocity and the throttle position. The CVT is controlled by deﬁnition of
desired input speed depending on velocity and load signal. When using
this option, the Data Bus input channel input speed has to be connected.
Multiple transmission ratio maps can be handled in a single simulation
by changing the value of input signal.
ASC (Anti-Slip Control): This component controls the coefﬁcient of
friction of the single wheels. For the maximum value, the throttle
position or the clutch release is changed. The ASC checks the force
transmission factor (ratio between force that should be transmitted and
maximum transmittable force) of all connected wheels (driven wheels). If
the force that has to be transmitted exceeds the adhesion limit, the load
signal or the clutches release change.
PID control: Combined with other signal processing components
(function component), the PID control may be used to build-up more
powerful control subsystems in AVL CRUISE. It basically supports two
operation modes. The ﬁrst mode is the standard PID control mode, using
the difference between a desired value and an actual value to generate an
output value. The second mode is the advanced signal control with
limitation mode.
Battery Management System: This component serves to control energy
ﬂow from/to the battery. The desired current limits from/to the battery
can be deﬁned as function of any set parameter so that the electric loads
(like electric machine) can adapt themselves to. For the set parameter, the
type of data and the units can be selected by a special input dialog. The
lower and upper thresholds of State of Charge determine the operation
area of the battery.

(continued)

3 Virtual Powertrain Design

209

Table 3.1 (continued)

Symbol

Component

Category Brakes

Category Special Modules

Brake: The brake component is described by brake data and dimensions.
It is possible to deﬁne drum brakes as well as disk brakes. The braking
torque is computed considering the braking dimensions and the input
brake pressure. This brake pressure can come from the cockpit
component or brake control. The brake calculation always stays dynamic
and never switches to a kinematic connection. The brake is controlled by
the brake pressure which has to be supplied via Data Bus input.

Cockpit: The cockpit links the driver and the vehicle. In this component,
connections are only made via the Data Bus connection. On one hand,
the driver gets information such as the vehicle velocity and the vehicle
acceleration. On the other hand, information from the driver such as the
pedal positions is delivered to other components. The pedal positions
(clutch pedal position) are transferred into corresponding indicators
(clutch release) via the pedal characteristics (clutch pedal).
Exhaust System: Exhaust systems consider the effects of the catalytic
converter and soot ﬁller on the raw emissions of the engine. Starting with
the temperature of the catalytic converter, factors for the conversion will
be computed for the single emissions components on the basis of the
temperature dependent maps. The heat loss coefﬁcient is the percentage
of the exhaust energy delivered by the engine which reaches the exhaust
system.
Map: The component map interpolates a user-deﬁned function which can
be one or two dimensional. It has two Data Bus inputs for the
independent function variables and one output for the interpolated
function value. In the case of a one-dimensional function the second Data
Bus input is ignored. The type of data can be selected by a special input
dialog. Please note that all data coming via the Data Bus are in SI units.
The conversion to the deﬁned unit in the map is then done in the
component.
Steplike Map: The map is deﬁned as a group of curves. The ﬁrst column
contains the curve parameters, which can be interpreted as the curve
height (z-value). The points belonging to the same curve share the same
parameter value. The second and the third columns contain the x and y
values. This group of curves separates the domain into sections with
constant z-values, equal to parameter of the lower boundary curve (lower
means smaller z-value).
Function: The component function can be used for calculating with
user-deﬁned functions. There are two possibilities to deﬁne the function:
in RPN-notation style (Reverse Polish Notation) where only one function
output y can be deﬁned and programming in C-style, where up to 99
function outputs can be deﬁned. Those arguments must be connected to
form the function term by using operators which can be selected from a
selection menu.

(continued)

210

Table 3.1 (continued)

Symbol

Category Interfaces

3 Virtual Powertrain Design

Component
Constants: Up to 99 constants can be deﬁned which can be used by other
components via Data Bus. Every constant requires the deﬁnition of the
Data Bus channel number, a comment, the constant value, the unit and
the data type. Data type can be of integer, double or string. In the case of
a string constant, the unit deﬁnition is not used in calculation. The
constant output values are sent to the Data Bus and can be used by other
components.
Monitor: The monitor can be introduced, if the calculation run must be
detected. It is possible to show some results of the calculation while the
calculation is running. This is done via the online monitor. It is possible
to connect up to ten input channels of the monitor to output channels of
different components that are available at the AVL CRUISE Data Bus.
The output in the online monitor is only available in the form of tables.
More than one monitor component can be used in a AVL CRUISE
model.
Hub: The component hub is a combination of a brake and a virtual
wheel. It is used in models with an interface to a co-simulating program
which simulates the environment, the vehicle and the wheel. The
component has the Data Bus inputs braking torque and (wheel) resistance
torque which can be connected with an interface component like
AVL CRUISE interface or CM-Car. When set to dynamic, the brake
calculation always stays dynamic and never switches to a kinematic
connection.
nD-Table: The component n-dimensional lookup table interpolates a
user-deﬁned function which can be up to ten dimensions. It has ten Data
Bus inputs for the independent function variables and ﬁve Data Bus
outputs for the interpolated function value. In the case of less than ten
input connected, the leftover Data Bus are ignored. The component n-d
lookup table serves for the input of general maps. These maps can have
from one to ten independent input values.

AVL Exhaust System: The component AVL Exhaust System extends
the AVL CRUISE library in order to meet all user requirements
regarding emissions (more detailed and accurate results). The component
supplies a connection to the after treatment system of AVL BOOST and
enables a coupling with the BOOST after treatment model in
AVL CRUISE. By naming a BOOSTDLL and a model ﬁle (*.atm), the
BOOST after treatment system can be started from AVL CRUISE in the
form of a coupled calculation.
MATLAB®/Simulink™: The interface that allows integrating controllers
and/or mechanical elements, such as special drives, into the
computational model of AVL CRUISE. The input and output variables
will be transferred by means of inports and outports. As two simulations,
for AVL CRUISE and MATLAB®, take place at the same time in this
case, the integration steps of the two programs will have to be
harmonized by a suitable selection of the step width.

(continued)

3 Virtual Powertrain Design

211

Table 3.1 (continued)

Symbol

Component
AVL CRUISE Interface: The AVL CRUISE interface component
deﬁnes the interface between AVL CRUISE models calculated in client
mode with AVL CRUISE DLL and the calling applications. In every
time step, AVL CRUISE data goes to the server application through up
to 99 Data Bus input channels AVL CRUISE to environment, and from
there, data comes back to AVL CRUISE through up to 99 output
channels environment to AVL CRUISE which can be connected with
AVL CRUISE components.
CarMaker Interface: The CM-Car component deﬁnes the interface in
co-simulation between AVL CRUISE powertrain models calculated with
the SAM calculation task and the CarMaker simulation package. In every
time step, AVL CRUISE data goes to the CarMaker application through
Data Bus input channels AVL CRUISE to CarMaker, and from there,
data comes back through output channels CarMaker to AVL CRUISE
which can be connected to the other components.
TruckMaker Interface: The CM-Truck component deﬁnes the interface
in co-simulation between AVL CRUISE powertrain models calculated
with the SAM calculation task and the TruckMaker simulation package.
In every time step, AVL CRUISE data goes to the TruckMaker
application through Data Bus input channels AVL CRUISE to
TruckMaker, and from there, data comes back through output channels
TruckMaker to AVL CRUISE which can be connected to the other
components.
CarSim Interface: The CarSim component deﬁnes the interface in
co-simulation between AVL CRUISE powertrain models calculated with
the SAM Calculation Task and the CarSim simulation package. In every
time step, AVL CRUISE data goes to the CarSim application through
Data Bus input channels AVL CRUISE to CarSim, and from there, data
comes back to AVL CRUISE through output channels CarSim to
AVL CRUISE which can be connected to the other AVL CRUISE
components.
TruckSim Interface: The TruckSim component deﬁnes the interface in
co-simulation between AVL CRUISE powertrain models calculated with
the SAM calculation task and the TruckSim simulation package. In every
time step, AVL CRUISE data goes to the TruckSim application through
Data Bus input channels AVL CRUISE to CarSim, and from there, data
comes back to AVL CRUISE through output channels CarSim to
AVL CRUISE which can be connected to the other AVL CRUISE
components.
AVL PUMA Interface: The AVL PUMA component serves as an
interface to AVL PUMA Open engine testbed automation system and it
is based on the existing AVL CRUISE interface component.
AVL PUMA Open is the application-oriented automation system for the
engine, powertrain and vehicle testbeds of AVL. In addition to standard
features such as fully automated test runs or manual operation, the
AVL PUMA Open automation system provides reliable and precise
control of measuring devices and test cell facilities.

(continued)

212

Table 3.1 (continued)

Symbol

3 Virtual Powertrain Design

Component
ETAS Interface: component deﬁnes the interface between
AVL CRUISE models calculated in client mode and the calling
applications. In every time step, AVL CRUISE data goes to the server
application through up to 99 Data Bus input channels AVL CRUISE to
ETAS, and from there, data comes back to AVL CRUISE through up to
99 output channels which can be connected with AVL CRUISE
components. This interface offers a variety of possibilities to the user, for
example, modeling of a testbed conﬁguration in ETAS Labcar.
NI VeriStand Interface: component deﬁnes the interface between
AVL CRUISE models calculated in client mode with AVL CRUISE
DLL and the calling applications. In every time step, AVL CRUISE data
goes to the server application through up to 99 Data Bus input channels,
and from there, data comes back to AVL CRUISE through up to 99
output channels which can be connected with AVL CRUISE
components.
AVL DRIVE: The component AVL DRIVE enables an evaluation of the
drivability of AVL CRUISE results. This evaluation is possible only in
simulation mode, and therefore only in the tasks which provide this
mode. Before evaluation start, a model must be parametrized also in
AVL DRIVE. AVL DRIVE is only launched when activation is selected.
This functionality is used for calibration of the model in AVL CRUISE
without doing a AVL DRIVE evaluation every time.
Black Box: Similar to the interface for MATLAB®/Simulink™, the
Black Box component allows to process program codes provided by the
user, third parties (C or Fortran) or a dynamic link (DLL or SO). These
Black Boxes are called several times per time step and can be used for
purely logical functions which do not depend on the last call. These
Black Boxes are called only once per time step and can be used if any
memory effects should be considered.

Wheel: The wheels and tires link the vehicle to the road. The wheel
component considers many inﬂuencing variables and their effect on the
rolling state. The moment of rolling drag can be computed on the basis of
the wheel load, the corrected dynamic rolling radius, and the coefﬁcient
of rolling drag. The longitudinal tire force results from the friction
coefﬁcient, the wheel load as well as from the wheel load factor and the
slip factor.

Category Wheel

3 Virtual Powertrain Design

213

Step 1              
Create 
project/version

Step 2              

Step 3               

Create vehicle 
model

Insert energetic 
connection

Step 4               
Insert  
informational 
connection

Step 5                
Input data                
in                      

components

Step 6              
Create                  

task folders          
add tasks

Step 7               
Setup      
calculations

Step 8                    
Run           

calculation

View and     
evaluate results

Step 9                 

Fig. 3.3 Work process ﬂow

In the Vehicle Modeler, the components are organized in component groups and
they can simply be dragged and dropped onto the working area, where they can be
linked together to represent the desired drivetrain conﬁguration.

To build a new model in AVL CRUISE, the recommended work process ﬂow to

create a project/version is described in Fig. 3.3.

To connect the components, the user must click with the right mouse button on
connector of the ﬁrst component to be connected and chose connect (or break the
established connections, or cloning the pin if are more of them needed). Drag the
connection with the mouse toward to desired component. Click with the left mouse
button on connector of the second component to be connected.

There are two types of connections: energetic connections (mechanical con-
nection—blue, exhaust connection—gray, electrical connection—red), and infor-
mational connection (red–green–blue).

Energetic connections which transfer energy are divided by the type of energy
which is transferred into the following groups (mechanical, exhaust, electrical) and
are established by polylines between the pins.

Information to the Data Bus is the only informational connection. These con-
nections are established by an arrow which shows the information ﬂow. The
energetic connections are represented in form of lines on the screen [3].

The components with informational connections have only a small colored
arrow on the left bottom corner of the symbol. For connecting the different modules
with information ﬂow, open the Data Bus dialog by double clicking with the left
mouse button on the colored lines (red—green—blue) at the bottom of the vehicle
modeler (Fig. 3.4).

The connections in the data bus are described as follows: in the ﬁrst column
(component … requires) all components are listed which need information from
other components (e.g., IC Engine). In the second column (input information …
from), all values required by this component will be displayed (e.g., Throttle
Position). Values that are marked in blue in this column have to be connected;
values marked in black are optional. After selecting a value in the second column,

214

3 Virtual Powertrain Design

Fig. 3.4 Data Bus window

in the third column (component … delivering) all components appear which can
deliver such information (e.g., Cockpit; in this case the only component that can
deliver a throttle position). In the fourth column (output information …), the values
appear that can deliver this information (e.g., Throttle Position).

In AVL CRUISE a preselection is done so that only the components that can
provide the input information as requested in the second column are presented in
the third and fourth columns (in this case, only the Cockpit can deliver an infor-
mation like the throttle position). For this, the Cockpit delivers the information
about the actual throttle position to the engine, where it is used to determine the
output torque.

Click on a components Data Bus symbol (input or output) with the left mouse
visualizes the Data Bus connections between this component and other components
(Fig. 3.5). The channels appear as colored lines and also their names are written.
Freezing visualization is possible by clicking on the connection icon until other
connection is selected.

Components can be encoded using the button in the upper left corner of the
components window. The user can deﬁne a password with a maximum length of
eight characters. Encrypted components cannot be opened until the correct pass-
word is entered. If a model which contains encrypted components is calculated, all
results can be viewed except
the encrypted components.
Macrocomponents can also be encrypted using the right mouse button [1].

the results of

Components and their connections can be grouped into subsystems. The sub-
systems can be activated or deactivated so that several conﬁgurations of an active
subsystem can be deﬁned. With these three subsystems it is possible to deﬁne two

3 Virtual Powertrain Design

215

Fig. 3.5 Data Bus visualization

vehicle conﬁgurations, which are from now on called systems. The structure of the
systems/subsystems and their activation status is shown i
(cid:129) Conventional System, containing the subsystems:

– Main (activated);
– Manual Transmission (activated);
– Hybrid (deactivated).

(cid:129) A Hybrid System, containing the active subsystems:

– Main (activated);
– Manual Transmission (deactivated);
– Hybrid (activated).

n the navigation tree and also in the “Systems” section of the sidebar of the vehicle
modeler.

Each component of the model has a popup menu accessible by right mouse

button click (Fig. 3.6).

Special components which have the sheet description of Data Bus (Function,

Map, Interface Components, etc.) have user-deﬁned channel names.

The Kinematic Chain Browser can be launched in the popup menu of a selected
component (Fig. 3.7). All mechanical connections starting from the selected
component are shown in a tree structure in the left side of the window. When a
second component is selected in the tree structure, all speeds between the selected
components are shown in the table in the right side of the window, each row
representing one gear of the gearbox [1].

216

3 Virtual Powertrain Design

Fig. 3.6 Component popup menu

Fig. 3.7 Kinematic Chain Browser

Speed values of components which have an inﬂuence on the speed (Gearbox,
Single Ratio Transmission) are marked green. The last column of the table shows
the entire speed ratio. The input speed can be deﬁned manually, default value is
1000 rpm.

3 Virtual Powertrain Design

217

Direction is shown with arrows above component icons. The direction can be
changed by sorting it in the tree structure. This can be done by double clicking on a
module in the tree or by clicking on the button. The selected module will then
become the new root module. In the head of the table, symbols indicate in which
direction the modules are calculated: >> X >> forward, << X << backward.

If the component data has been changed, the Kinematic Chain Browser can

calculate once more and update its results when pressing the update button.

The Kinematic Chain Browser also takes into account the ratio changes of the
Component Variation or Matrix Calculation. When opening the Kinematic Chain
Browser, the ratios of the basic model are taken for the calculation. When a certain
variation case is selected in the variations DoE plan, the chain browser calculates
with the ratios of that case.

Activation and deactivation of Task Folders and tasks within Task Folders is
always related to the actual system. Deﬁnition can be done in the sidebar of the
vehicle modeler: after the selection of a system, its Task Folders and tasks can be
activated/deactivated in the ‘Tasks’ sheet of the sidebar (Fig. 3.8).

Cycle Run (Fig. 3.9) is a calculation task for the fuel consumption and emissions
calculation. This is done for a ﬁxed driving proﬁle. The determination of this proﬁle
has to be entered as function of the time. This task should be used especially for

Fig. 3.8 Task Folders

218

3 Virtual Powertrain Design

Fig. 3.9 Cycle Run

evaluations of standard driving proﬁles. The Cycle Run can be calculated as
quasi-stationary and simulation. It is possible to select chassis dynamometer or
road. Just as for the Driving Proﬁle, a Gear Selection Mode can be stated.

The Cycle Run additionally depends on: Course, Proﬁle and Driver. In this task,
the behavior of the vehicle when following a velocity proﬁle is observed. The
reference axis is time [1].

Course component characterizes the environment and the driving conditions as
function of the driving distance or time (Fig. 3.10). Among other things, the
instantaneous atmospheric pressure and density as well as the temperature are
acquired to describe the ambient conditions [1].

These variables are based upon the values existing at standard conditions, which

will be adopted or computed according to the input.

All inputs are functions of the driving distance or time. If cornering is chosen,

the angle of approach must be declared.

The Proﬁle data (Fig. 3.11) should be entered as function of the time or distance.

The following data is required [1]:
(cid:129) Velocity: the rated of vehicle velocity;
(cid:129) Gear: actual gear for shifting according to proﬁle for manual gearboxes or

gearbox control;

(cid:129) Shifting Time: for manual gearboxes this shifting time is used if it is above the

ergonomic border of the driver;

(cid:129) Start Signal: to switch the engine on and off during the cycle;
(cid:129) Minimum and maximum velocity: to set the threshold values that may not be

exceeded during the test run;

3 Virtual Powertrain Design

219

Fig. 3.10 Course component

Fig. 3.11 Proﬁle data

(cid:129) Stop Time: (only for distance-dependent proﬁle) for a distance-dependent pro-

ﬁle stop times of the vehicle can be deﬁned;

(cid:129) Additional Load: is deﬁned as a function of time or distance and added to the
load of the empty vehicle. This type of load deﬁnition can be activated in the
tasks “Cycle Run” and “Cruising”.

220

3 Virtual Powertrain Design

Fig. 3.12 Driver

The Driver should imitate the behavior of a real driver as well as possible
(Fig. 3.12). For this purpose, the behavior can be deﬁned by different input data.
The used data can be divided into the following groups:
(cid:129) Data deﬁning the shifting behavior;
(cid:129) Data deﬁning the starting behavior;
(cid:129) Data deﬁning the driving behavior.

The data for the starting and driving behavior can be deﬁned by the user (expert

mode) or default values can be used (standard) [1].

Simulation allows modeling of the real behavior if the overall model is har-
monized correspondingly. This will automatically lead to a control loop in which
the driver (modeled as Driver Module in the program) acts as a controller when
simulating a real driving task. For this the driver has to change the acceleration,
brake, or clutch pedal position.

In the elastic connections, the torsional stiffness of the connection (shafts) can be

taken into account.

To solve the differential equation system, a single-step integration method has
been implemented. This method calculates the actual conditions and the conditions
of the next time step. If the accuracy limits cannot be reached with the chosen time
step width (check with a second integration method),
the time step width is
decreased [1].

If the temporary results cause a change of the lock conditions, the equation

system is switched to a new one.

3 Virtual Powertrain Design

221

General Conﬁgurations are models without any restrictions in the build-up of the

model. The calculation is done without special knowledge about the drivetrain.

In general, all component speciﬁc calculations are done in the respective mod-
ules. The values which are determined in the modules are combined together to an
equation system with the smallest possible number of degrees of freedom. The
integration for this reduced system can be done independent of the external modules
in the internal equation solver.

References

1. AVL Cruise (2011) Users Guide, AVL List GmbH, Graz, Austria, Document no. 04.0104.2011,

2. AVL Cruise (2011) Release Note, AVL List GmbH, Graz, Austria, Document no.

3. AVL Cruise (2011) Database, AVL List GmbH, Graz, Austria, Document no. 04.0112.2011,

Edition 06.2011

04.0102.2011, Edition 06.2011

Edition 06.2011

Chapter 4
Classical Powertrain Conﬁguration Model
and Simulation

4.1 Classical Vehicle Model

4.1.1 Classic CVT Model

This chapter describes how to create and run the model of a manual front wheel
drive. To place a component in the working area, click on the component group
with the left mouse button, move the mouse over the required component, and then
click and drag the component into the vehicle model area. Arrange the components
as shown in Fig. 4.1 and connect the components as speciﬁed in the diagram.

Place the following components in the working area: Vehicle (1), IC Engine (2),
Torque Converter (3), CVT Continuously Variable Transmission (4), Final Drive
(5), Vehicle Front Right (6), Vehicle Rear Right (7), Vehicle Front Left (8), Vehicle
Rear Left (9), Front Disk Brake (10), Rear Drum Brake (11), Front Disk Brake (12),
Rear Drum Brake (13), Differential (14), Cockpit (15), CVT Control (16), ASC
Anti-Slip Control (17), Catalyst (18), and Monitor (19).

There are three types of energy connections: mechanical, exhaust, and electrical

and are made by connecting polylines between the pins.

All the connections in the Data Bus for this model are described in Table 4.1 [1].
Validation of the connections are marked using bold and are required for the
functioning of the model.

Vehicle (1) is one of the main objects in a model. This component contains
general data of the vehicle, such as nominal dimensions and weights. Only one
vehicle component is required in a model. Road resistances and dynamic wheel
loads are calculated for road and dynamometer runs based on the dimensions and
the load state. The wheel loads are calculated considering motion. The aerody-
namic, rolling, climbing, acceleration, and total resistance are calculated [2].

To deﬁne component input data (Table 4.2) double click on the icon or click on
it the right mouse button and select edit to open the following window (Fig. 4.2).

© Springer International Publishing Switzerland 2015
B.O. Varga et al., Electric and Plug-In Hybrid Vehicles,
Green Energy and Technology, DOI 10.1007/978-3-319-18639-9_4

223

224

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.1 Complete CVT model

The properties window is accessed through properties button in the input data
window, or from the pop-up menu by selecting “Properties”. Selected parameters
have an inﬂuence on the needed component data input for calculation (Fig. 4.3).
With these settings it is also possible to run a calculation with minimal input data,
as the input ﬁelds of the unavailable data can be switched off.

IC Engine (2) component contains a model for an internal combustion engine.
The characteristic curves for the full load, fuel consumption, and others can be
freely deﬁned by the user. It is possible to deﬁne a gasoline engine as well as a
diesel engine. In this component a temperature model is included to consider the
inﬂuence of the temperature on the fuel consumption and emissions while the
engine is cold. The engine will be modeled by a structure of characteristic curves
and maps [2]. To deﬁne component input data (Table 4.3) double click on the icon
or click on it with the right mouse button and select edit to open the following
window (Fig. 4.4).

To load IC Engine characteristic click on the Full Load Characteristic tab
(Fig. 4.5). Select (kW) unit from the b column using pull-down menu. Add rows by
clicking on and enter the following data (Table 4.4).

The Motoring Curve (Fig. 4.6) will be deﬁned similar to the Full Load
Characteristic as power versus engine speed (Table 4.5). Engine Maps Basic data
can be loaded from the folder projects\CVT_FWD\CVT_FWD.dbf [1].

In the Fuel Consumption Map (Fig. 4.7, Table 4.6) the actual fuel consumption for
stationary operation is listed depending on the brake mean pressure with the engine
speed as parameter (a—speed (1/min), b—BMEP (bar), c—volume ﬂow (l/h)).

4.1 Classical Vehicle Model

Table 4.1 Data Bus connection

225

Component
requires

Input information

Output information

Component
delivering

ASC

Cockpit

CVT
CVT Control

Cockpit
Cockpit
Cockpit
Cockpit
CVT
IC Engine
IC Engine

Load signal
Slip Signal Front Left Wheel Front Left
Slip Signal Front Right Wheel Front Right
Brake Pressure
Brake Front Disk
Brake Rear Drum Brake Pressure
Brake Pressure
Brake Front Disk
Brake Rear Drum Brake Pressure
Gear Indicator
Cockpit
Operation Control 0
Speed
Desired Transmission CVT Control
Current Transmission CVT
Load Signal
Speed
Torque
Velocity
Load Signal
Start Switch
Vehicle Acceleration
Vehicle Velocity
Vehicle Distance
Engine Load Signal
Engine Speed
Desired Clutch Release CVT Control

Cockpit
CVT
CVT
Cockpit
ASC
Cockpit
Vehicle
Vehicle
Vehicle
IC Engine
IC Engine

Torque Converter

IC Engine

Monitor

Load Signal
Slip Signal
Slip Signal
Brake Pressure
Brake Pressure
Brake Pressure
Brake Pressure
Current Gear
Operation Control
Engine Speed
Desired Transmission
Current Transmission
Load Signal
Output Speed
Input Torque
Velocity
Load Signal
Start Switch
Acceleration
Velocity
Distance
Actual Load Signal
Engine Speed
Desired Clutch Release

Table 4.2 Vehicle component input data

Name

Gas Tank Volume
Distance from Hitch to Front Axle
Height of Support Point at Bench Test
Wheel Base
Distance of Gravity Center empty/half/full
Height of Gravity Center empty/half/full
Height of Hitch empty/half/full
Tire Inﬂation Pressure Front Axle
Tire Inﬂation Pressure Rear Axle
Curb Weight
Gross Weight
Frontal Area
Drag Coefﬁcient

Value

0.05
2970.0
100.0
2250.0
900.0/910.0/920.0
550.0/545.0/540.0
420.0/410.0/400.0
2.2
2.2
970.0
1410.0
1.80
0.35

Unit
m3
mm
mm
mm
mm
mm
mm
bar
bar
kg
kg
m2
–

226

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.2 Vehicle input data speciﬁcations window

Fig. 4.3 Properties of Vehicle

This representation is used to make a unique relation between the Brake Mean
Effective Pressure (BMEP) and the fuel consumption for a given engine speed. The
Fuel Consumption Map can also be deﬁned as a Speciﬁc Consumption Map (Fig. 4.8,
Table 4.7).

4.1 Classical Vehicle Model

227

Table 4.3 IC Engine
components input data

Name

Engine Displacement
Engine Working Temperature
Number of Cylinders
Number of Strokes
Idle Speed
Maximum Speed
Inertia Moment
Response Time
Heating Value for Gasoline
Fuel Density
Idle Consumption
Idle Emission NOx
Idle Emission CO
Idle Emission HC
Lower Speed for Fuel Shut-Off
Upper Speed For Fuel Shut-Off

Value

1360.0
80.0
4
4
800.0
6000.0
0.1
0.1
44500.0
0.737
1.0
0.02
0.10
0.01
1300.0
1400.0

Unit
cm3
°C
–
–

1/min
1/min
kg m2
s
kJ/kg
kg/l
l/h
kg/h
kg/h
kg/h
1/min
1/min

Fig. 4.4 IC Engine input data speciﬁcations window

The Speciﬁc Consumption Map can be loaded according to the following
parameters a—speed (1/min), b—BMEP (bar), c—speciﬁc volume ﬂow (l/kWh).
The speciﬁc fuel consumption map is only used when the corresponding switch is
activated [1].

In the emission maps the emissions for the different exhaust gases are listed
dependent on the mean pressure with the engine speed as parameter (a—speed (1/min),
b—BMEP (bar), c—mass ﬂow (kg/h), namely NOx emission map in Fig. 4.9 and
Table 4.8, CO emission map in Fig. 4.10 and Table 4.9, HC emission map in Fig. 4.11
and Table 4.10 [1].

The Torque Converter (3) employs the force represented by a moving ﬂuid to
transmit engine torque (Fig. 4.12). As these devices compensate for the differences
between the engine speed and drivetrain, they are ideal for the transition from

228

4 Classical Powertrain Conﬁguration Model and Simulation

)

W
k
(
 
r
e
w
o
P

50

45

40

35

30

25

20

15

10

5

0

)

W
k
(
 
r
e
w
o
P

0

-0.5

-1

-1.5

-2

-2.5

-3

-3.5

-4

800

1800

2800

3800

4800

5800

Speed (1/min)

Fig. 4.5 Full Load Characteristic

Table 4.4 Full Load Characteristic data

Speed (1/min)

Power (kW)

Speed (1/min)

Power (kW)

800.0
1300.0
1800.0
2000.0
2300.0
2900.0
3500.0

5.3
9.8
14.7
17.5
20.6
27.1
33.5

4100.0
4600.0
5000.0
5300.0
5500.0
5800.0
6000.0

39.4
43.7
46.4
47.2
47.0
45.9
43.8

800

1800

2800

3800

4800

5800

Speed (1/min)

Fig. 4.6 Motoring Curve

4.1 Classical Vehicle Model

Table 4.5 Motoring Curve data

Speed (1/min)

Power (kW)

229

800.0
1600.0
2400.0
3300.0
4400.0
5200.0
6000.0

)
h
/
l
(
 

w
o
l
F
 
e
m
u
l
o
V

35

30

25

20

15

10

5

0

0.0
−0.8
−1.5
−2.2
−3.0
−3.5
−4.0

Engine
Speed
(1/min)

850
1250
1700
2300
2900
3500
4200
5100
6000

-5

0

15

20

5
10
BMEP (bar)

Fig. 4.7 Fuel Consumption Map

stationary to mobile operation. The torque converter also multiplies torque. First, an
impeller (pump) converts the mechanical energy from the power unit into ﬂuid
energy (hydraulic ﬂuid); a second transformation, back into mechanical energy,
occurs using the turbine blades [2].

These devices offer economical exploitation when used together with mechan-
ical variable ratio transmissions; operation with nonpositive engagement (slip) is
limited for better efﬁciency. The torque on the converter input and output depends
on the speed ratio between pump and turbine as well on the absolute angular
velocity of the pump (a—speed ratio (-), b—torque ratio (-), c—pump torque (-) as
shown in Fig. 4.13 and Table 4.11) [1].

To deﬁne component input data (Table 4.12) double click on the icon or click on

it with the right mouse button and select edit to open the following window.

CVT (4) can convert every point on the engine operating curve to an operating
curve of its own, and every engine operating curve into an operating range within
the ﬁeld of potential driving conditions (Fig. 4.14). Its advantage over conventional

230

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.6 Fuel Consumption Map data

(a)
850

1250

1700

2300

2900

3500

4200

5100

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−4.0
0.6
−4.0
0.7
−4.0
1.0
−4.0
1.4
−4.0
1.7
−4.0
2.1
−4.0
2.7
−4.0
3.7
−4.0
4.8

−0.5
0.7
−0.5
0.8
−0.5
1.1
−0.5
1.5
−0.5
1.8
−0.5
2.2
−0.5
2.8
−0.5
3.8
−0.5
5.0

0.0
0.8
0.0
0.9
0.0
1.2
0.0
1.6
0.0
1.9
0
2.4
0
2.9
0
4.0
0
5.2

1.6
1.0
1.8
1.4
2.1
1.9
2.3
2.8
2.4
3.5
2.4
4.3
2.4
5.1
3.6
8.3
2.8
9.2

3.2
1.3
3.3
1.9
3.5
2.5
3.1
3.3
4.0
4.6
4.0
5.7
4.0
6.6
5.1
10.0
4.2
11.4

4.6
1.6
4.7
2.4
4.9
3.1
5.3
4.6
5.5
5.7
7.1
8.1
7.1
8.0
6.6
12.0
5.5
13.5

6.0
2.0
7.6
3.4
7.8
4.3
8.2
6.5
8.4
7.8
10.3
11.0
10.3
11.2
9.8
16.7
8.4
19.0

7.3
2.3
8.9
4.0
9.5
5.1
9.6
7.3
9.8
8.9
11.6
12.4
11.6
12.8
11.2
19.2
9.7
22.7

8.6
2.8
10.2
4.5
10.9
6.3
12.3
9.5
11.3
10.0
13.4
14.5
13.4
17.6
12.5
22.6
12.1
29.8

9.3
3.2
10.9
4.6
12.3
7.1
14.3
11.6
14.8
14.1
15.1
16.9
15.1
21.7
14.5
28.2
13.1
32.7

)
h
W
k
/
l
(
 

w
o
l
F
 
e
m
u
l
o
V
 
c
i
f
i
c
e
p
S

4.00

3.50

3.00

2.50

2.00

1.50

1.00

0.50

0.00

Engine
Speed 
(1/min)
850
1250
1700
2300
2900
3500
4200
5100
6000

0.00

5.00

10.00

15.00

BMEP (bar)

Fig. 4.8 Speciﬁc Consumption Map

ﬁxed-ratio transmissions lies in the potential for enhancing performance and fuel
economy while reducing exhaust emissions [2].

To deﬁne component input data (Table 4.13) double click on the icon or click on
it with the right mouse button and select edit to open the following window [1].

4.1 Classical Vehicle Model

231

Table 4.7 Speciﬁc Consumption Map data

(a)
850

1250

1700

2300

2900

3500

4200

5100

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

1.60
0.76
0.19
4.07
0.42
1.83
0.73
1.18
0.71
1.18
0.72
1.19
0.70
1.23
1.99
0.63
1.21
0.97

3.16
0.50
1.82
0.63
2.06
0.54
2.30
0.54
2.42
0.51
2.41
0.51
2.31
0.53
3.62
0.45
2.76
0.56

4.55
0.43
3.32
0.46
3.54
0.42
3.07
0.48
3.47
0.41
3.97
0.41
3.82
0.41
5.10
0.39
4.18
0.46

5.95
0.39
4.73
0.41
4.89
0.37
5.25
0.34
5.49
0.36
7.04
0.33
5.34
0.36
6.63
0.36
5.53
0.41

7.32
0.38
6.17
0.38
6.33
0.35
6.71
0.36
6.97
0.34
8.59
0.32
6.90
0.33
8.12
0.34
8.39
0.38

8.63
0.38
7.59
0.36
7.83
0.33
8.21
0.35
8.41
0.32
10.31
0.31
8.53
0.32
9.77
0.34
9.72
0.39

9.30
0.40
8.90
0.36
9.48
0.32
9.63
0.34
9.81
0.32
11.61
0.31
9.99
0.31
11.19
0.34
10.88
0.40

1.2

1

0.8

0.6

0.4

0.2

)
h
/
g
k
(
 

w
o
l
F
 
s
s
a
M

0

-4

1

6
BMEP (bar)

11

16

Fig. 4.9 NOx emission map

–
–

10.88
0.34
12.30
0.34
14.29
0.36
14.75
0.33
15.11
0.32
15.11
0.35
14.50
0.39
13.05
0.42

–
–

10.21
0.35
10.93
0.34
13.34
0.34
11.29
0.31
13.35
0.31
13.06
0.32
12.53
0.36
12.05
0.41

850

1250

1700

2300

2900

3500

4200

5100

6000

Engine
Speed
(1/min)

232

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.8 NOx emission map data

(a)
850

1250

1700

2300

2900

3500

4200

5100

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−4.0
0.00
−4.0
0.00
−4.0
0.01
−4.0
0.01
−4.0
0.02
−4.0
0.02
−4.0
0.03
−4.0
0.03
−4.0
0.05

−0.5
0.00
−0.5
0.01
−0.5
0.01
−0.5
0.01
−0.5
0.02
−0.5
0.02
−0.5
0.03
−0.5
0.04
−0.5
0.07

0.00
0.00
0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.02
0.00
0.03
0.00
0.05
0.00
0.06
0.00
0.10

1.61
0.01
1.82
0.02
0.42
0.01
0.73
0.03
0.70
0.04
0.68
0.06
0.75
0.08
1.97
0.19
1.21
0.27

3.16
0.02
3.32
0.04
2.08
0.04
2.20
0.07
2.41
0.11
2.41
0.17
2.31
0.18
3.62
0.34
2.76
0.48

4.55
0.05
4.73
0.07
4.89
0.13
5.24
0.19
5.47
0.27
7.05
0.44
5.41
0.39
6.65
0.61
5.68
0.73

5.95
0.06
6.17
0.10
7.83
0.20
8.21
0.29
8.41
0.40
8.59
0.51
8.53
0.58
9.77
0.81
9.43
0.95

7.32
0.08
8.90
0.13
9.48
0.22
9.55
0.32
9.81
0.44
11.6
0.59
9.99
0.65
11.5
0.89
12.3
1.11

8.62
0.10
10.2
0.15
10.1
0.23
12.4
0.33
12.0
0.49
14.3
0.62
12.6
0.75
12.8
0.96
13.5
1.18

9.30
0.11
10.9
0.16
12.3
0.25
14.3
0.34
15.2
0.58
15.1
0.64
15.1
0.87
14.7
1.14
14.2
1.23

)
h
/
g
k
(
 

w
o
l
F
 
s
s
a
M

14

12

10

8

6

4

2

0

Engine
Speed
(1/min)

850

1250

1700

2300

2900

3500

4200

5100

6000

-4

1

11

16

6
BMEP (bar)

Fig. 4.10 CO emission map

4.1 Classical Vehicle Model

233

Table 4.9 CO emission map data

(a)
850

1250

1700

2300

2900

3500

4200

5100

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−4.0
0.03
−4.0
0.04
−4.0
0.05
−4.0
0.06
−4.0
0.10
−4.0
0.11
−4.0
0.15
−4.0
0.18
−4.0
0.24

−1.6
0.03
−1.7
0.04
−1.7
0.06
−1.7
0.07
−1.7
0.10
−1.7
0.12
−1.7
0.15
−1.7
0.19
−1.7
0.25

0.00
0.04
0.00
0.06
0.00
0.08
0.00
0.09
0.00
0.12
0.00
0.13
0.00
0.17
0.00
0.21
0.00
0.29

1.60
0.07
1.82
0.08
2.06
0.12
0.73
0.12
0.85
0.15
0.72
0.16
0.72
0.22
1.00
0.31
1.21
0.38

3.16
0.10
4.73
0.15
4.89
0.25
2.30
0.21
2.42
0.27
2.41
0.32
3.82
0.57
3.62
0.68
4.18
1.08

4.55
0.13
6.16
0.21
6.37
0.24
5.22
0.38
5.52
0.52
7.04
0.68
6.88
1.10
6.55
1.24
6.35
1.79

5.95
0.17
7.59
0.25
7.83
0.41
8.21
0.67
8.42
0.83
10.2
2.28
9.48
2.05
8.86
2.03
7.77
3.63

7.32
0.21
9.89
0.97
9.82
1.17
10.6
1.72
9.62
1.35
11.9
4.62
10.1
2.85
9.48
2.69
9.72
7.78

0.4

0.35

0.3

0.25

0.2

0.15

0.1

0.05

)
h
/
g
k
(
 

w
o
l
F
 
s
s
a
M

0

-4

1

6
BMEP (bar)

11

16

Fig. 4.11 HC emission map

9.66
0.62
11.1
1.55
12.3
2.46
14.3
3.17
14.8
4.88
15.1
7.60
15.1
8.69
12.5
9.11
13.1
14.2

9.18
0.52
10.6
1.28
11.0
1.76
12.4
2.74
11.7
3.52
12.3
5.21
13.1
7.24
11.3
7.14
12.1
12.2

850

1250

1700

2300

2900

3500

4200

5100

6000

Engine
Speed
(1/min)

234

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.10 HC emission map data

(a)
850

1250

1700

2300

2900

3500

4200

5100

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−4.0
0.00
−4.0
0.01
−4.0
0.01
−4.0
0.01
−4.0
0.01
−4.0
0.01
−4.0
0.01
−4.0
0.01
−4.0
0.02

−1.6
0.01
−1.6
0.01
−1.6
0.01
−1.6
0.01
−1.6
0.01
−1.6
0.01
−1.6
0.01
−1.6
0.02
−1.6
0.02

0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.02
0.00
0.02

1.60
0.01
1.82
0.01
3.54
0.03
0.73
0.01
0.79
0.01
0.74
0.02
2.43
0.04
3.64
0.06
2.76
0.06

3.16
0.02
3.32
0.02
4.89
0.04
2.30
0.03
2.45
0.03
2.49
0.03
3.89
0.05
5.10
0.08
4.18
0.09

4.55
0.02
4.73
0.03
6.33
0.05
5.25
0.05
5.60
0.06
7.06
0.08
5.38
0.07
6.63
0.09
5.53
0.10

5.95
0.03
6.17
0.03
7.83
0.06
6.71
0.05
6.97
0.07
8.59
0.10
6.91
0.09
8.06
0.11
6.94
0.12

7.32
0.03
7.60
0.04
9.72
0.08
9.89
0.09
9.85
0.11
10.5
0.13
9.85
0.13
11.2
0.22
10.9
0.26

8.63
0.03
8.90
0.05
11.9
0.11
12.6
0.15
11.4
0.14
11.7
0.18
13.0
0.26
12.5
0.29
12.1
0.33

9.30
0.04
10.9
0.07
12.8
0.14
14.8
0.18
14.8
0.20
15.0
0.32
14.6
0.33
14.6
0.35
13.1
0.39

Fig. 4.12 Torque Converter input data speciﬁcations window

The Efﬁciency Fixed curve can be deﬁned as function of the transmission ratio
(Fig. 4.15). The additional torque loss correction ﬁxed curve is deﬁned as function
of the transmission ratio and the drive speed (Fig. 4.16).

Final Drive (5) is a gear step with ﬁxed ratio. It can be used as a transmission
step of the differential (ﬁnal drive unit). A drive torque will be transferred to a
power take-off torque of the transmission step by considering the transmission, the
mass moments of inertia, and the moment of loss (Fig. 4.17) [2]. To deﬁne

4.1 Classical Vehicle Model

235

2.5

1.5

2

1

0

0.5

-0.5

-1

-1.5

-2

-2.5

)
-
(
 
o
i
t
a
R
 
e
u
q
r
o
T

)
-
(
 
e
u
q
r
o
T
p
m
u
P

 

800

300

-700

-1200

0

0.5

1

1.5

2

2.5

-200

Speed Ratio (-)

Fig. 4.13 Torque conversion curve

Table 4.11 Torque conversion curve data

Speed
Ratio (–)
0.000
0.100
0.200
0.300
0.400
0.500
0.600
0.700
0.800
0.848
0.850
0.900
0.920
0.940
0.950
0.960
0.965
0.970

Torque
Ratio (–)
2.430
2.220
2.110
1.930
1.770
1.600
1.440
1.290
1.120
1.060
1.020
1.000
1.000
1.000
1.000
1.000
1.000
1.000

Pump
Torque (–)
357
357
354
340
333
316
301
280
256
213
202
183
167
137
117
99
80
72

Speed
Ratio (–)
0.975
0.980
0.985
0.989
1.000
1.019
1.021
1.027
1.032
1.043
1.065
1.088
1.112
1.252
1.431
1.669
2.004
2.506

Torque
Ratio (–)
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000

Pump
Torque (–)
65
40
24
12
0
−13
−15
−18
−20
−27
−41
−59
−77
−169
−266
−416
−689
−1188

component input data double click on the Single Ratio Transmission icon and enter
the following data (Table 4.14).

The Wheels and Tires link the vehicle to the road. The wheel components take
into consideration many inﬂuencing variables and their effect on the rolling state
(Fig. 4.18).

4 Classical Powertrain Conﬁguration Model and Simulation

236

Name

Table 4.12 Torque Converter input data

Inertia Moment of Pump with Oil
Max. Torque lock-up Clutch
Inertia Moment of Turbine with Oil
Input Mode

Value

0.016
1.0
0.011
Torque Conversion

Unit
kg m2
Nm
kg m2
–

Fig. 4.14 CVT input data speciﬁcations window

Table 4.13 CVT input data

Name

Adjustment Time
Minimum Ratio
Inertia Moment In
Switching Threshold
Maximum Ratio
Inertia Moment Out

Value

2.00
0.85
0.03
0.001
3.85
0.03

Unit

s
–
kg m2
–
–
kg m2

The moment of rolling drag can be computed on the basis of the wheel load, the

corrected dynamic rolling radius, and the coefﬁcient of rolling drag.

The longitudinal tire force results from the friction coefﬁcient, the wheel load as
well as from the wheel load factor and the slip factor. It is possible to deﬁne
variable friction coefﬁcients along the driving proﬁle when different road conditions
are considered [2].

Information data for the four wheels are the same (Vehicle Front Right (6),

Vehicle Rear Right (7), Vehicle Front Left (8), and Vehicle Rear Left (9)).

Double click on the wheel and enter the following data (Table 4.15). Select
Properties menu and deﬁne the appropriate wheel location for each wheel (Vehicle:
Front Right, Rear Right, Front Left, and Rear Left) [1].

4.1 Classical Vehicle Model

237

)
-
(
 

y
c
n
e
i
c
i
f
f

E

0.92

0.91

0.9

0.89

0.88

0.87

0.86

0.85

)

m
N

(
 
s
s
o
L
 
e
u
q
r
o
T

4.5

4.3

4.1

3.9

3.7

3.5

3.3

3.1

2.9

2.7

2.5

0.85

1.35

1.85
2.85
2.35
Transmission Ratio (-)

3.35

3.85

Fig. 4.15 Efﬁciency

1000

2000

3000

4000

5000

6000

Speed (1/min)

Fig. 4.16 Torque loss correction ﬁxed

Fig. 4.17 Final Drive input data speciﬁcations window

238

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.14 Final Drive input data

Name

Transmission Ratio
Inertia Moment In
Inertia Moment Out
Efﬁciency

Value

3.40
0.01
0.01
0.95

Unit
–
kg m2
kg m2
–

Fig. 4.18 Wheels input data speciﬁcations window

Table 4.15 Wheel input data

Name

Wheel Inertia Moment
Friction Coefﬁcient of Tire
Reference Wheel Load
Wheel Load Correction Coefﬁcient
Static Rolling Radius
Circumference
Dynamic Rolling Radius
Circumference

Value

0.40
0.95
2200.0
0.02
250.0
1570.80
260.0
1633.63

Unit
kg m2
–

N
–

mm
mm
mm
mm

The static rolling radius is the distance between the center of the wheel and the
road surface for the loaded, not moving vehicle. The static rolling radius is not used
for AVL CRUISE calculation, but only for the Kinematic Chain Browser.

4.1 Classical Vehicle Model

239

)

%

(
 
r
o
t
c
a
F
 
e
c
n
a
t
s
i
s
e
R
g
n
i
l
l
o
R

 

2
1.9
1.8
1.7
1.6
1.5
1.4
1.3
1.2
1.1
1

0

50

200

250

300

100

150
Velocity (km/h)

Fig. 4.19 Rolling resistance factor

Table 4.16 Rolling resistance factor data

Velocity (km/h)

Velocity (km/h)

Rolling Resistance
Factor (%)

Rolling Resistance
Factor (%)

0
20
50
100
125
150

1.00
1.00
1.00
1.01
1.05
1.13

160
180
200
230
250
280

1.21
1.27
1.38
1.58
1.73
2.03

The dynamic rolling radius is the distance between the center of the wheel and
the road surface for the loaded, moving vehicle. The dynamic rolling radius is
usually a little bit bigger than the static rolling radius.

The dynamic rolling radius can be deﬁned as function of the velocity (Fig. 4.19
and Table 4.16). This characteristic is active when dynamic rolling radius is set
from characteristic (a—velocity (km/h), b—rolling resistance factors (%)).

The Brake component is described by brake data and dimensions. It is possible
to deﬁne drum brakes as well as disk brakes. The retarder is used for heavy vehicles
and is described below (Fig. 4.20).

The braking torque is computed considering the braking dimensions and the
input brake pressure. This brake pressure can come from the cockpit component or
brake control. If the vehicle is standing still, the degrees of freedom will be reduced
as this also reduces the calculation time. This reduction is done in a way that the
equation system is switched if a small velocity threshold is reached. In this case
movement is suppressed [2].

240

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.20 Brake input data speciﬁcations window

Table 4.17 Brakes input data

Name

Brake
Piston Surface
Speciﬁc Factor
Efﬁciency
Inertia Moment
Friction Coefﬁcient
Friction Radius

Value

Front Right
1500.0
1.00
0.97
0.05
0.20
100

Value

Rear Right
500.0
3.00
0.97
0.05
0.20
90

Value

Front Left
1500.0
1.00
0.97
0.05
0.20
100

Value

Rear Left
500.0
3.00
0.97
0.05
0.20
90

Unit
–
mm2
–
–
kg m2
–

mm

At the same time, the instantaneous compulsive force is checked (if it is smaller
than the braking torque). If this condition is no longer true the brake is released.
Input data for the two front brakes are the same and also the data for the two rear
brakes are the same (Front Disk Brake Right (10), Rear Drum Brake Right (11),
Front Disk Brake Left (12) and Rear Drum Brake Left (13)). Double click on the
brake icon and enter the following data (Table 4.17).

Differential (14) unit compensates for discrepancies in the respective rotation
rates of the drive wheels: between inside and outside wheels during cornering and
between different drive axles on 4WD vehicles (Fig. 4.21).

When there is a unilateral variation in road surfaces it results in different coef-
ﬁcients of friction at the respective wheels, this balance effect limits the effective
drive torque to a level deﬁned as twice the traction force available at the wheel (tire)
with the lower friction coefﬁcient [2].

This wheel then responds to the excessive force by spinning. To avoid such

effects a positive lock is available at the component.

In the differential it is possible to deﬁne the torque split factor. This is needed if

it is used as a central differential for a four wheel drive.

4.1 Classical Vehicle Model

241

Fig. 4.21 Differential input data speciﬁcations window

Table 4.18 Differential input data

Name

Differential Lock
Torque Split Factor
Inertia Moment In
Inertia Moment Out1
Inertia Moment Out2

Value

Unlocked
1.00
0.01
0.01
0.01

Unit
–
–
kg m2
kg m2
kg m2

To deﬁne component input data double click on the differential icon and enter

the following data (Table 4.18).

The Kinematic Chain Browser can be launched in the pop-up menu of a selected
component (Fig. 4.22). All mechanical connections starting from the selected
component are shown in a tree structure on the left side of the window. When a
second component is selected in the tree structure, all speeds between the selected
components are shown in the table on the right side of the window, each row
representing one gear of the gearbox [2].

Cockpit (15) links the driver and the vehicle (Fig. 4.23). In this component

connections are only made via Data Bus.

The driver gets information such as vehicle velocity and vehicle acceleration, but
also generates information such as the pedal positions for other components. The
pedal positions are transferred to corresponding indicators via the pedal charac-
teristics (Table 4.19) [2].

To deﬁne the input data click on the acceleration pedal characteristic (a—
acceleration pedal travel (%), b—load signal (%)) and brake pedal characteristic (a
—speciﬁc brake pedal force (%), b—brake pressure (bar)) tabs and enter the fol-
lowing data (Fig. 4.24).

242

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.22 Kinematic Chain Browser

Fig. 4.23 Cockpit input data speciﬁcations window

Table 4.19 Cockpit input data

Name

Shift Mode
Number of Gears Forward
Number of Gears Back
Maximum Brake Force
Brake Light Switch Threshold
Number of Retarder Steps

Value

Automatic
5
1
200.0
1.0
4

Unit
–
–
–

N
%
–

4.1 Classical Vehicle Model

243

)
r
a
b
(
 
e
r
u
s
s
e
r
P
 
e
k
a
r
B

100

90

80

70

60

50

40

30

20

10

0

0

20

40

60

80

100

Specific Brake Pedal Force (%)

Fig. 4.24 Pedal characteristic

Fig. 4.25 CVT control input data speciﬁcations window

Table 4.20 CVT control input data

Name

Maximum Velocity
Maximum Speed
Load Signal Time Constant
Velocity Time Constant

Value

50.00
6000
0.50
0.50

Unit

m/s
1/min
s
s

The CVT Control (16) is an easy way to provide target transmission consid-
ering the velocity and the engine load. In addition, it is possible to control the
clutch. This clutch is simply added to the model (Fig. 4.25).

To deﬁne component input data double click on the CVT control icon and enter

the following data (Table 4.20).

244

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.21 Desired transmission ratio data

(a)
0

5

10

15

20

25

30

35

40

45

50

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

0
3.9
0
2.7
0
1.4
0
1.0
0
0.9
0
0.9
0
0.9
0
0.9
0
0.9
0
0.9
0
0.9

10
3.9
10
2.9
10
1.6
10
1.1
10
0.9
10
0.9
10
0.9
10
0.9
10
0.9
10
0.9
10
0.9

20
3.9
20
3.0
20
1.8
20
1.2
20
0.9
20
0.9
20
0.9
20
0.9
20
0.9
20
0.9
20
0.9

30
3.9
30
3.2
30
1.9
30
1.3
30
1.0
30
0.9
30
0.9
30
0.9
30
0.9
30
0.9
30
0.9

40
3.9
40
3.3
40
2.0
40
1.3
40
1.0
40
0.9
40
0.9
40
0.9
40
0.9
40
0.9
40
0.9

50
3.9
50
3.4
50
2.1
50
1.4
50
1.0
50
0.9
50
0.9
50
0.9
50
0.9
50
0.9
50
0.9

60
3.9
60
3.5
60
2.2
60
1.5
60
1.1
60
0.9
60
0.9
60
0.9
60
0.9
60
0.9
60
0.9

70
3.9
70
3.6
70
2.4
70
1.6
70
1.2
70
1.0
70
0.9
70
0.9
70
0.9
70
0.9
70
0.9

80
3.9
80
3.7
80
2.7
80
1.8
80
1.5
80
1.2
80
1.0
80
0.9
80
0.9
80
0.9
80
0.9

90
3.9
90
3.8
90
3.1
90
2.3
90
1.8
90
1.4
90
1.2
90
1.1
90
1.0
90
0.9
90
0.9

100
3.9
100
3.9
100
3.8
100
2.8
100
2.1
100
1.7
100
1.4
100
1.2
100
1.1
100
1.0
100
0.9

To deﬁne the input data for desired transmission ratio click on the tabs and enter the
following data (Table 4.21 and Fig. 4.26). The demand transmission of the CVT
gearbox can be deﬁned as a function of a—velocity (m/s), b—load signal (%) and c—
transmission ratio (–). The interpolation of transmission ratio in the maps of CVT
control are done by an alternative method and can be changed in the interpolation and
approximation section in the Expert Mode settings of the Project Settings [3].

To deﬁne the input data for desired clutch release click on the tabs and enter the
following data (Fig. 4.27 and Table 4.22). The demand clutch release of the
starting clutch can be deﬁned as a function of a—speed (1/min), b—load signal (%)
and c—clutch release (%) [3].

The ASC Anti-Slip Control (17) checks the force transmission factor (ratio
between force that should be transmitted and maximum transmittable force) of all
connected wheels (driven wheels). If the force that has to be transmitted exceeds the
adhesion limit, the load signal or the clutch releases changes [2].

4.1 Classical Vehicle Model

245

)
-
(
 

 

o
i
t
a
R
n
o
i
s
s
i

m
s
n
a
r
T

4.00

3.50

3.00

2.50

2.00

1.50

1.00

0.50

Velocity
(m/s)

0
5
10
15
20
25
30
35
40
45
50

0

20

80

100

40
Load Signal (%)

60

Fig. 4.26 Desired transmission ratio

Fig. 4.27 Desired clutch
release

The Anti-Slip Control (Fig. 4.28) is only active when a model is calculated
quasi-stationary in combination with special drivetrain conﬁgurations and does not
require data entry.

If the Anti-Slip Control is used for calculations in simulation mode this switch
can be activated. In this case the parameters for the PID controller can be set
(proportional (–), differential (s) and integral parameter (1/s)).

246

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.22 Desired clutch release data

(a)
0

800

1600

2400

3200

4000

4800

5600

6400

7200

8000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

0
100
0
100
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0

10
100
10
100
10
0
10
0
10
0
10
0
10
0
10
0
10
0
10
0
10
0

20
100
20
100
20
0
20
0
20
0
20
0
20
0
20
0
20
0
20
0
20
0

30
100
30
100
30
0
30
0
30
0
30
0
30
0
30
0
30
0
30
0
30
0

40
100
40
100
40
0
40
0
40
0
40
0
40
0
40
0
40
0
40
0
40
0

50
100
50
100
50
0
50
0
50
0
50
0
50
0
50
0
50
0
50
0
50
0

60
100
60
100
60
0
60
0
60
0
60
0
60
0
60
0
60
0
60
0
60
0

70
100
70
100
70
0
70
0
70
0
70
0
70
0
70
0
70
0
70
0
70
0

80
100
80
100
80
0
80
0
80
0
80
0
80
0
80
0
80
0
80
0
80
0

90
100
90
100
90
0
90
0
90
0
90
0
90
0
90
0
90
0
90
0
90
0

100
100
100
100
100
0
100
0
100
0
100
0
100
0
100
0
100
0
100
0
100
0

Fig. 4.28 ASC Anti-Slip Control input data speciﬁcations window

Catalyst (18) or exhaust systems consider the effects of the catalytic converter

and soot ﬁller on the raw emissions of the engine.

Starting with the temperature of the catalytic converter, factors for the conver-
sion will be computed for the single emission components using temperature-
dependent maps (Fig. 4.29).

4.1 Classical Vehicle Model

247

Fig. 4.29 Catalyst input data speciﬁcations window

Table 4.23 Catalyst input data

Name
Heat Loss Coefﬁcient
Weight of Catalyst
Speciﬁc Heat Capacity of Catalyst
Reference Area Cat/Air
Heat Transfer Coefﬁcient Cat/Air
Operating Temperature Catalyst

Value

0.90
7.50

200.0

0.20

10.0
400.0

Unit
–

kg
J/kg K
m2
W/m2 K
°C

The heat loss coefﬁcient is the percentage of the exhaust energy delivered by the

engine which reaches the exhaust system [2].

To deﬁne component input data double click on the catalyst icon and enter the

following data (Table 4.23).

Conversion efﬁciencies of the different emissions (NOx, CO, HC and Soot) can

be deﬁned dependent on the actual temperature of the catalytic converter.

Conversion efﬁciencies curve can be deﬁned as function of a—temperature (°C)
and efﬁciency (–)
(Table 4.24 and Fig. 4.30—NOx conversion efﬁciencies,
Table 4.25 and Fig. 4.31—CO conversion efﬁciencies, Table 4.26 and Fig. 4.32—
HC conversion efﬁciencies).

The heat transfer Gas/Cat (Table 4.27 and Fig. 4.33) is the proportion of the
exhaust gas which is transferred to the exhaust system and can be deﬁned as a
function of a—temperature (°C) and b—heat-up proportion of exhaust gas
energy (%) [1].

The Monitor (19) can be introduced, if the calculation run must be detected. It is
possible to show some results of the calculation while the calculation is running.
This is done via the online monitor. It is possible to connect up to ten input channels
of the monitor to output channels of different components that are available at the
AVL CRUISE—Data Bus [2].

248

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.24 NOx conversion efﬁciencies data
Efﬁciency
(–)
0.000
0.000
0.003
0.007
0.013
0.021
0.031
0.045

Temperature
(°C)
0
170
180
190
200
210
215
220

Temperature
(°C)
225
230
235
240
245
250
255
260

Efﬁciency
(–)
0.100
0.160
0.220
0.320
0.485
0.670
0.830
0.920

Temperature
(°C)
265
270
280
290
300
400
500
–

Efﬁciency
(–)
0.975
0.992
0.996
0.997
0.997
0.996
0.996
–

1.000
0.900
0.800
0.700
0.600
0.500
0.400
0.300
0.200
0.100
0.000

)
-
(
 
y
c
n
e
i
c
i
f
f

E

0

100

400

500

200
Temperature (°C)

300

Fig. 4.30 NOx conversion efﬁciency

Table 4.25 CO conversion efﬁciencies data
Efﬁciency
(–)
0.000
0.000
0.003
0.007
0.013
0.021
0.031
0.045

Temperature
(°C)
0
170
180
190
200
210
215
220

Temperature
(°C)
225
230
235
240
245
250
255
260

Efﬁciency
(–)
0.100
0.160
0.220
0.320
0.485
0.670
0.830
0.920

Temperature
(°C)
265
270
280
290
300
400
500
–

Efﬁciency
(–)
0.975
0.992
0.996
0.997
0.997
0.996
0.996
–

4.1 Classical Vehicle Model

249

0

100

400

500

200
Temperature (°C)

300

Fig. 4.31 CO conversion efﬁciency

Table 4.26 HC conversion efﬁciencies data
Efﬁciency
(–)
0.000
0.000
0.003
0.007
0.013
0.021
0.031
0.045

Temperature
(°C)
0
170
180
190
200
210
215
220

Temperature
(°C)
225
230
235
240
245
250
255
260

Efﬁciency
(–)
0.100
0.160
0.220
0.320
0.485
0.670
0.830
0.920

Temperature
(°C)
265
270
280
290
300
400
500
–

Efﬁciency
(–)
0.975
0.992
0.996
0.997
0.997
0.996
0.996
–

1.000
0.900
0.800
0.700
0.600
0.500
0.400
0.300
0.200
0.100
0.000

)
-
(
 
y
c
n
e
i
c
i
f
f

E

1.000
0.900
0.800
0.700
0.600
0.500
0.400
0.300
0.200
0.100
0.000

)
-
(
 
y
c
n
e
i
c
i
f
f

E

0

100

400

500

200
Temperature (°C)

300

Fig. 4.32 HC conversion efﬁciency

250

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.27 Heat transfer
Gas/Cat data

Temperature (°C)

Heat-Up Proportion of Exhaust
Gas Energy (%)

–30
210
270
500
600
1000

41
39
65
64
64
64

 
t
s
u
a
h
x
E

 
f
o
 
n
o
i
t
r
o
p
o
r
P
p
U

 

-
t
a
e
H

)

%

(
 
y
g
r
e
n
E
 
s
a
G

70

65

60

55

50

45

40

35

-50

150

750

950

350
Temperature (°C)

550

Fig. 4.33 Heat transfer Gas/Cat

Currently, the output in the online monitor is only available in the form of tables.
More than one monitor component can be used in a AVL CRUISE model. In this
case, more than one instance of the online monitor is activated during calculation.
Click on the description of Data Bus tab and open the following dialog. To select
a Data Bus channel, click to access the available list. Enter the text for the
description and then click on to select the unit (Fig. 4.34).

4.1.2 Automatic FWD Model

This chapter describes how to create and run the model of an automatic front wheel
drive vehicle. To place a component in the working area, click on the component
group with the left mouse button, move the mouse over the required component and
then click and drag the component into the vehicle model area. Put the component
with release of the mouse button on the desired place.

Place the following components in the working area: Vehicle (1), IC Engine (2),
Torque Converter (3), Gearbox (4), Final Drive (5), Vehicle Front Right (6),

4.1 Classical Vehicle Model

251

Fig. 4.34 Monitor description of Data Bus

Vehicle Rear Right (7), Vehicle Front Left (8), Vehicle Rear Left (9), Front Disk
Brake (10), Rear Drum Brake (11), Front Disk Brake (12), Rear Drum Brake (13),
Differential (14), Cockpit (15), Gearbox control (16), Gearbox program (17), ASC
Anti-Slip Control (18), Catalyst (19) and Monitor (20).

Arrange the components as shown in Fig. 4.35 and connect the components as

speciﬁed in the diagram.

The electric connections for energy transfer are splinted as a function of energy
that is transferred into mechanical, for exhaust gases and electrical connections. The
links between elements are speciﬁed in red, green, or blue, depending on their type.
All the connections in the Data Bus for this model are described in Table 4.28
[1]. Validation of the connections marked in bold are required for functioning of the
model.

The Vehicle (1) is one of the main objects in a model. This component contains
general data of the vehicle, such as nominal dimensions and weights. Only one
vehicle component is required in a model.

Road resistances and dynamic wheel loads are calculated for road and dyna-
mometer runs based on the dimensions and the load state. The wheel loads are

252

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.35 Complete model automatic FWD

calculated considering motion. The aerodynamic, rolling, climbing, acceleration,
and total resistance are calculated [2].

To deﬁne component input data (Table 4.29) double click on the icon and select

edit to open the following window (Fig. 4.36).

IC Engine (2) component contains a model for a combustion engine. The
characteristic curves for the full load, the fuel consumption, and others can be freely
deﬁned by the user [2].

To deﬁne component input data (Table 4.30) double click on the icon and select

edit to open the following window (Fig. 4.37).

To load IC Engine characteristic click on the Full Load Characteristic tab
(Table 4.31 and Fig. 4.38). Select a—speed (1/min) and b—power (kW) by
pull-down menu and enter the following data.

The Motoring Curve (Table 4.32 and Fig. 4.39) will be deﬁned similar to the

Full Load Characteristic as power versus engine speed [1].

Fuel Consumption Map (Table 4.33 and Fig. 4.40) shows the actual fuel con-
sumption for stationary operation (a—speed (1/min), b—BMEP (bar), c—volume
ﬂow (l/h)).

In the emission maps the emissions for the different exhaust gases are listed
dependent on the mean pressure with the engine speed as parameter (a—speed
(1/min), b—BMEP (bar), c—mass ﬂow (kg/h), namely NOx emission map in
Fig. 4.41 and Table 4.34, CO emission map in Fig. 4.42 and Table 4.35, HC
emission map in Fig. 4.43 and Table 4.36 [1].

4.1 Classical Vehicle Model

253

Table 4.28 All the Data Bus connection

Component
Requires

ASC

Brake Front Disk
Brake Rear Drum
Brake Front Disk
Brake Rear Drum
Cockpit

Differential
IC Engine

Gearbox
Gearbox Control

Gearbox Program

Monitor

Input Information

Load Signal
Slip Front Left
Slip Front Right
Brake Pressure
Brake Pressure
Brake Pressure
Brake Pressure
Gear Indicator
Operation Control 0
Speed
–

Load Signal
Start Switch
Desired Gear
Current Gear
Desired Gear
Cockpit
Desired Gear GB
Gear Downshifting

Gear Upshifting
Operation Control
Reference Speed
Velocity
Current Gear
Load Signal
Speed
Vehicle Acceleration
Vehicle Velocity
Vehicle Distance
Engine Load Signal

Component
Delivering

Cockpit
Wheel Front Left
Wheel Front Right
Cockpit
Cockpit
Cockpit
Cockpit
Gear Box
IC Engine
Engine Speed
–

ASC
Cockpit
Gearbox Control
Gearbox
Cockpit

Gearbox Program
Cockpit

Cockpit
Cockpit
Torque Converter
Cockpit
Gearbox
Cockpit
Gearbox
Vehicle Automatic
Vehicle Automatic
Vehicle Automatic
IC Engine

Engine Speed

IC Engine

Output
Information

Load Signal
Slip Signal
Slip Signal
Brake Pressure
Brake Pressure
Brake Pressure
Brake Pressure
Current Gear
Operation Control
Speed
–

Load Signal
Start Switch
Desired Gear
Current Gear
Desired Gear

Desired Gear
Gear
Downshifting
Gear Upshifting
Operation Control
Turbine Speed
Velocity
Current Gear
Load Signal
Output Speed
Acceleration
Velocity
Distance
Actual Load
Signal
Engine Speed

Torque Converter (3) employs the force represented by a moving ﬂuid to
transmit engine torque (Fig. 4.44). As these devices compensate for differences in
the rotating speeds of engine and drivetrain, they are ideal for effecting the tran-
sition from stationary to mobile operation [2].

To deﬁne component input data (Table 4.37) double click on the icon and select
edit to open the following window. The torque on the converter input and output
depends on the speed ration between pump and turbine as well as on the absolute

4 Classical Powertrain Conﬁguration Model and Simulation

254

Name

Table 4.29 Vehicle component input data

Gas Tank Volume
Distance from Hitch to Front Axle
Height of Support Point at Bench Test
Wheel Base
Distance of Gravity Center
empty/half/full
Height of Gravity Center
empty/half/full
Height of Hitch empty/half/full
Tire Inﬂation Pressure Front Axle
Tire Inﬂation Pressure Rear Axle
Curb Weight
Gross Weight
Frontal Area
Drag Coefﬁcient

Value

0.070
3200.0
100.0
2500.0
1200.0/1210.0/1220.0

550.0/540.0/530.0

400.0/380.0/360.0
2.200
2.200
1450.0
1890.0
2.000
0.400

Unit
m3
mm
mm
mm
mm

mm

mm
bar
bar
kg
kg
m2
–

Fig. 4.36 Vehicle input data speciﬁcations window

4.1 Classical Vehicle Model

255

Table 4.30 IC Engine component input data

Name

Engine Displacement
Engine Working Temperature
Number of Cylinders
Number of Strokes
Idle Speed
Maximum Speed
Inertia Moment
Response Time
Heating Value for Gasoline
Fuel Density
Idle Consumption
Idle Emission NOx
Idle Emission CO
Idle Emission HC
Residual Fuel Consumption
Lower Speed for Fuel Shut-Off
Upper Speed for Fuel Shut-Off

Value

1998.0
80.00

800.0
6000.0

44500.0

4.000
4.000

0.150
0.100

0.737
1.500
0.030
0.150
0.015
0.000

1000.0
1200.0

Unit
cm3
°C
–
–

1/min
1/min
kg m2
s
kJ/kg
kg/l
l/h
kg/h
kg/h
kg/h
l/h
1/min
1/min

Fig. 4.37 IC Engine input data speciﬁcations window

angular velocity of the pump (a—speed ratio (–), b—torque ratio (–), c—pump
torque (–), Fig. 4.45 and Table 4.38).

Gearbox (4) transmissions featuring several ﬁxed ratios can maintain a corre-
spondence between the respective performance curves for engine and vehicle

256

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.31 Full Load Characteristic data

Speed (1/min)

Power (kW)

Speed (1/min)

Power (kW)

]

W
k
[
 
r
e
w
o
P

129

109

89

69

49

29

9

800
1300
1800
2100
2500
3000
3250
3500

800
1400
2000
2600
3300
800
1400

9
25
37
46
57
69
76
84

0.0
−3.0
−5.5
−7.5
−9.5
0.0
−3.0

3900
4300
4800
5200
5600
5800
6000
–

3900
4500
5200
6000
3900
4500
–

800

1800

4800

5800

2800

3800
Speed [1/min]

Fig. 4.38 Full Load Characteristic

Table 4.32 Motoring Curve data

Speed (1/min)

Power (kW)

Speed (1/min)

95
104
117
124
127
126
125
–

Power (kW)
−11.0
−12.0
−13.0
−14.0
−11.0
−12.0
–

(Fig. 4.46). The correspondence with the hyperbola for maximum engine output
will be acceptable or indeed quite good, depending on a multiplicity of factors
including the number of available gears, the spacing of the individual ratios within
the required conversion range, and the engines’ full-load torque curve [2].

4.1 Classical Vehicle Model

257

]

W
k
[
 
r
e
w
o
P

0

-2

-4

-6

-8

-10

-12

-14

800

1800

2800

3800

4800

5800

Speed [1/min]

Fig. 4.39 Motoring Curve

Table 4.33 Fuel Consumption Map data

(a)
700

1200

1700

2550

3000

3600

4150

5050

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−4.0
1.60
−4.0
1.75
−4.0
1.95
−4.0
2.25
−4.0
2.73
−4.0
3.22
−4.0
4.15
−4.0
5.25
−4.0
6.60

−0.5
1.61
−0.5
1.76
−0.5
1.96
−0.5
2.30
−0.5
2.84
−0.5
3.34
−0.5
4.27
−0.5
5.60
−0.5
7.25

0.0
1.65
0.0
1.80
0.0
2.00
0.0
2.45
0.0
3.00
0.0
3.67
0.0
4.64
0.0
6.00
0.0
8.00

1.60
1.88
0.35
1.93
0.42
2.16
0.73
2.98
0.71
3.55
0.72
4.44
0.70
5.41
1.99
9.43
1.21
10.4

3.16
2.13
1.82
2.35
2.06
2.85
2.30
4.20
2.42
5.21
2.41
6.40
2.31
7.66
3.62
12.3
2.76
13.9

4.55
2.50
3.32
2.78
3.54
3.72
3.80
5.69
3.97
6.85
3.97
8.47
3.82
9.96
5.10
14.9
4.18
17.1

5.95
2.96
6.17
4.25
6.33
5.53
6.71
8.30
6.97
10.0
7.04
12.2
5.34
12.2
8.12
20.7
6.94
23.9

7.32
3.55
7.59
4.97
9.48
7.70
9.55
10.9
8.41
11.5
10.3
16.6
8.53
17.0
11.2
28.4
9.72
34.0

8.63
4.19
8.90
5.87
10.9
9.43
12.4
15.1
11.3
14.8
14.7
24.8
13.1
26.8
12.5
33.5
12.1
44.7

9.30
4.79
10.9
6.72
12.3
10.6
14.3
17.6
14.8
20.9
15.1
25.4
15.1
33.0
14.5
41.8
13.1
49.0

The component Gearbox contains a model for a gear box with different gear
steps. The user can deﬁne as many gears as needed. When it is used as an automatic
gearbox, the gear shifting process will be controlled by the control module gearbox
control and program. To deﬁne component input data for Gear Ratio Table double
click on the icon and select edit to open the following window [1].

258

4 Classical Powertrain Conﬁguration Model and Simulation

-4

1

11

16

6
BMEP (bar)

Fig. 4.40 Fuel Consumption Map

Engine
Speed
(1/min)
700
1200
1700
2550
3000
3600
4150
5050
6000

Engine
Speed
(1/min)
700

1200

1700

2550

3000

3600

4150

5050

6000

)
h
/
l
(
 

w
o
l
F
 
e
m
u
l
o
V

50

45

40

35

30

25

20

15

10

5

0

)
h
/
g
k
(
 

w
o
l
F
 
s
s
a
M

1.80

1.60

1.40

1.20

1.00

0.80

0.60

0.40

0.20

0.00

-5.00

0.00

5.00

10.00

15.00

20.00

BMEP (bar)

Fig. 4.41 NOx emission map

The efﬁciency and torque loss correction can be deﬁned as function of the gear

efﬁciency (Fig. 4.47).

Final Drive (5) is a gear step with ﬁxed ratio (Fig. 4.48). It can be used as a
transmission step of the differential (ﬁnal drive unit). A drive torque will be
transferred to a power take-off torque of the transmission step by considering the
transmission, the mass moments of inertia and the moment of loss [2].

To deﬁne component input data double click on the ﬁnal drive icon and enter the

following data (Table 4.39).

The Wheels and Tires link the vehicle to the road. The wheel component

considers many inﬂuencing variables and their effect on the rolling state.

4.1 Classical Vehicle Model

259

Table 4.34 NOx emission map data

(a)
700

1200

1700

2550

3000

3600

4150

5050

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−5.0
0.00
−5.0
0.00
−5.0
0.00
−5.0
0.02
−5.0
0.01
−5.0
0.02
−5.0
0.04
−5.0
0.05
−5.0
0.14

−0.6
0.00
−0.4
0.00
−0.4
0.00
−0.5
0.02
−1.0
0.01
−0.4
0.03
−1.0
0.04
−1.3
0.05
−1.3
0.14

0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.02
−0.4
0.02
0.00
0.03
−0.4
0.04
−0.5
0.06
−0.4
0.16

0.90
0.01
0.21
0.00
0.25
0.00
0.41
0.03
0.00
0.02
0.36
0.04
0.00
0.05
0.00
0.07
0.00
0.18

1.76
0.02
0.66
0.00
0.90
0.01
2.00
0.09
0.41
0.03
2.65
0.25
0.79
0.11
2.19
0.28
1.33
0.41

3.48
0.03
2.00
0.01
2.27
0.04
5.78
0.27
2.66
0.14
4.37
0.42
2.54
0.27
3.98
0.50
3.04
0.71

5.01
0.06
3.65
0.06
3.89
0.12
7.38
0.34
6.04
0.42
7.74
0.69
7.59
0.75
5.61
0.70
4.60
0.96

6.55
0.09
6.79
0.15
6.96
0.25
10.5
0.47
9.25
0.60
9.45
0.77
10.9
0.99
8.93
1.11
7.63
1.23

10.2
0.16
11.9
0.24
13.5
0.37
15.7
0.50
15.8
0.71
16.9
0.91
16.6
1.32
16.2
1.75
14.4
1.62

8.05
0.12
9.79
0.19
10.4
0.32
13.6
0.49
10.8
0.66
12.8
0.88
14.4
1.14
12.9
1.41
10.7
1.41

700

1200

1700

2550

3000

3600

4150

5050

6000

Engine
Speed
(1/min)

)
h
/
g
k
(
 

w
o
l
F
 
s
s
a
M

20

18

16

14

12

10

8

6

4

2

0

-5

0

15

20

10
5
BMEP (bar)

Fig. 4.42 CO emission map

260

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.35 CO emission map data

(a)
700

1200

1700

2550

3000

3600

4150

5050

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−5.0
0.05
−5.0
0.03
−5.0
0.05
−5.0
0.15
−5.0
0.15
−5.0
0.17
−5.0
0.22
−5.0
0.25
−5.0
0.43

−0.8
0.05
−0.6
0.03
−0.6
0.05
−0.6
0.15
−0.5
0.15
−0.5
0.17
−0.6
0.22
−0.7
0.25
−0.5
0.43

0.00
0.06
0.00
0.03
0.00
0.06
0.00
0.16
0.00
0.18
0.00
0.19
0.00
0.25
0.00
0.28
0.00
0.46

1.76
0.08
0.22
0.07
0.50
0.08
0.88
0.19
0.78
0.23
0.76
0.26
0.77
0.33
1.23
0.41
1.33
0.55

3.48
0.12
3.82
0.17
4.25
0.24
3.60
0.39
2.66
0.39
4.17
0.63
5.93
0.97
3.98
1.00
6.08
2.65

5.01
0.17
5.44
0.21
5.87
0.33
6.30
0.69
6.04
0.95
7.39
0.97
9.67
2.24
5.61
1.23
7.63
4.38

6.55
0.21
7.10
0.31
7.60
0.39
8.05
0.83
9.29
1.53

8.05
0.27
8.69
0.87
9.40
1.12

11.5

3.15

10.8

2.75

11.3

13.1

3.76

6.06

11.1

12.6

4.07

6.92

10.5

4.12

10.7
11.7

12.3
10.6
11.9
15.4

0.6

0.5

0.4

0.3

0.2

0.1

)
h

/
g
k
(
 

w
o
l
F
 
s
s
a
M

0

-5

0

5
10
BMEP (bar)

15

20

Fig. 4.43 HC emission map

–
–

12.5
3.23
14.8
3.26
17.2
4.31
16.2
7.14
15.9
10.9
16.8
11.9
15.9
15.5
14.4
21.3

10.2
1.60
10.2
2.44
11.4
2.41
14.9
3.73
12.6
4.89
15.4
10.3
14.5
9.89
13.8
13.3
13.3
18.2

700

1200

1700

2550

3000

3600

4150

5050

6000

Engine
Speed
(1/min)

4.1 Classical Vehicle Model

261

Table 4.36 HC emission map data

(a)
700

1200

1700

2550

3000

3600

4150

5050

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−5.0
0.01
−5.0
0.01
−5.0
0.01
−5.0
0.02
−5.0
0.01
−5.0
0.02
−5.0
0.02
−5.0
0.03
−5.0
0.03

−0.9
0.01
−0.6
0.01
−0.6
0.01
−0.6
0.02
−0.5
0.02
−0.6
0.02
−0.6
0.02
−0.4
0.03
−0.8
0.03

0.00
0.02
0.00
0.02
0.00
0.01
0.00
0.02
0.00
0.02
0.00
0.02
0.00
0.02
0.00
0.03
0.00
0.04

0.66
0.02
0.21
0.01
0.47
0.02
0.33
0.02
0.80
0.03
0.30
0.02
0.30
0.03
0.57
0.03
0.52
0.04

1.74
0.02
2.04
0.02
2.29
0.03
2.58
0.05
2.73
0.05
2.65
0.06
2.54
0.07
2.24
0.06
1.36
0.05

3.44
0.03
3.72
0.03
5.43
0.06
5.88
0.09
4.49
0.08
4.37
0.09
5.87
0.12
5.93
0.14
3.09
0.09

6.49
0.04
5.30
0.04
7.03
0.08
7.52
0.10
7.88
0.10
7.74
0.12
7.59
0.14
7.76
0.15
7.77
0.18

7.98
0.04
6.91
0.05

10.1

0.06
9.97
0.07

10.5

14.3

0.16

0.33

10.7

13.9

0.20

0.33

11.1

12.8

0.16

0.22

11.3

12.8

0.23

0.30

10.9

14.2

0.22
9.32
0.19

0.42

12.6

0.36

10.9

12.2

0.31

0.40

–
–

12.2
0.11
–
–

16.0
0.50
16.6
0.40
16.2
0.51
16.3
0.54
15.9
0.56
14.6
0.59

Fig. 4.44 Torque Converter input data speciﬁcations window

Information data for the four wheels are the same (Vehicle Rear Right (6),

Vehicle Front Right (7), Vehicle Rear Left (8), and Vehicle Front Left (9)).

Double click on the wheel (Fig. 4.49) and enter the following data (Table 4.40).
Select Properties menu and deﬁne the appropriate wheel location for each wheel
(Vehicle: Front Right, Rear Right, Front Left, and Rear Left).

The static rolling radius is the distance between the center of the wheel and the

road surface for the loaded, not moving vehicle.

4 Classical Powertrain Conﬁguration Model and Simulation

262

Name

Table 4.37 Torque Converter input data

Inertia Moment of Pump with Oil
Max. Torque lock-up Clutch
Inertia Moment of Turbine with Oil
Input Mode

Value

0.015
1.000
0.015
Torque Conversion

Unit
kg m2
Nm
kg m2
–

2.5

1.5

2

1

0

0.5

-0.5

-1

-1.5

-2

-2.5

)
-
(
 
o
i
t
a
R
 
e
u
q
r
o
T

)

m
N

(
 
e
u
q
r
o
T
p
m
u
P

 

1200

800

400

-400

-800

-1200

0

2.5

0

0.5

1

1.5

2

Fig. 4.45 Torque conversion curve

Speed Ratio (-)

Table 4.38 Torque conversion curve data

Speed
Ratio (–)
0.000
0.100
0.200
0.300
0.400
0.500
0.600
0.700
0.800
0.848
0.850
0.900

Torque
Ratio (–)
2.430
2.220
2.110
1.930
1.770
1.600
1.440
1.290
1.120
1.060
1.020
1.000

Pump
Torque (–)
0.920
0.940
0.950
0.960
0.965
0.970
0.975
0.980
0.985
0.989
1.000
1.019

Speed
Ratio (–)
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000

Torque
Ratio (–)
1.021
1.027
1.032
1.043
1.065
1.088
1.112
1.252
1.431
1.669
2.004
2.506

Pump
Torque (–)
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000
1.000

4.1 Classical Vehicle Model

263

Fig. 4.46 Gearbox input data speciﬁcations window

0.96

0.955

0.95

0.945

)
-
(
 
y
c
n
e
i
c
i
f
f

E

0.94

0

1

2

3

4

5

Gear (-)

Fig. 4.47 Efﬁciency and torque loss correction

The dynamic rolling radius can be deﬁned as function of the velocity (Fig. 4.50
and Table 4.41). This characteristic is active when dynamic rolling radius is set
from characteristic (a—velocity (km/h), b—rolling resistance factors (%)).

The slip at maximum traction (Fig. 4.51) is, together with the speciﬁc traction at
inﬁnite slip (Fig. 4.52), the characteristic values for the slip correction factor. The
slip correction factor depends on the friction coefﬁcient of the road [1].

The Brake component is described by brake data and dimensions (Fig. 4.53). It

is possible to deﬁne drum brakes as well as disk brakes.

Input data for the two front brakes is the same and also the data for the two rear
brakes is the same (Rear Drum Brake Right (10), Front Disk Brake Right (11), Rear
Drum Brake Left (12) and Front Disk Brake Left (13)). Double click on the brake
icon and enter the following data (Table 4.42).

264

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.48 Final Drive input data speciﬁcations window

Table 4.39 Final Drive data

Name

Transmission Ratio
Inertia Moment In
Inertia Moment Out
Efﬁciency

Value

3.000
0.010
0.015
0.950

Unit
–
kg m2
kg m2
–

Fig. 4.49 Wheels input data speciﬁcations window

Differential (14) unit compensates for discrepancies in the respective rotation
rates of the drive wheels. To deﬁne component input data double click on the
differential icon and enter the following data (Table 4.43, Fig. 4.54).

4.1 Classical Vehicle Model

265

Table 4.40 Wheels input data

Name

Wheel Inertia Moment
Friction Coefﬁcient of Tire
Reference Wheel Load
Wheel Load Correction Coefﬁcient
Static Rolling Radius
Circumference
Dynamic Rolling Radius
Circumference

Value

0.500
0.950

2200.0

0.020

300.0
1884.96
310.0
1947.79

Unit
kg m2
–

N
–

mm
mm
mm
mm

)

%

(
 
r
o
t
c
a
F
 
e
c
n
e
t
s
i
s
e
R
 
g
n
i
l
l
o
R

2.3

2.2

2.1

2

1.9

1.8

1.7

1.6

1.5

1.4

1.3

0

40

80

200

240

280

120
Velocity (km/h)

160

Fig. 4.50 Rolling resistance factor

The Kinematic Chain Browser can be launched in the pop-up menu of a selected

component (Fig. 4.55).

The Cockpit (15) links the driver and the vehicle (Fig. 4.56). In this component
connections are only made via the Data Bus. The pedal positions are transferred to
corresponding indicators via the pedal characteristics (Table 4.44) [2].

To deﬁne the input data click on the acceleration pedal characteristic (a—
acceleration pedal travel (%), b—load signal (%)) and brake pedal characteristic (a
—speciﬁc brake pedal force (%), b—brake pressure (bar)) tabs and enter the fol-
lowing data (Fig. 4.57).

The Gearbox Control

is required to deﬁne an automatic gearbox
(Fig. 4.58). In the gearbox control, the gear shifting process can be deﬁned auto-
matically without any inﬂuence of the driver.

(16)

The gearbox control shifts the gears dependent on a speed or velocity. In the
calculation tasks it is decided which of the two shifting strategies is used. The speed
or velocity can be deﬁned via the Data Bus. It is possible to deﬁne the engine speed
and the wheel speed as Ref. [2].

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.41 Rolling resistance factor data

Velocity (km/h)

Velocity (km/h)

Rolling Resistance
Factor (%)

Rolling Resistance
Factor (%)

1.35
1.36
1.37
1.38
1.39
1.50

180
200
230
250
280
180

1.65
1.75
1.95
2.10
2.30
1.65

266

0
20
50
100
120
150

)

%

 

(
 
n
o
i
t
c
a
r
T
m
u
m
i
x
a
M

 
t
a
 
p
i
l
S

15

14

13

12

11

10

9

8

7

 

p

i
l

S
 
e
t
i
n
i
f
n
I
 
t
a
 
n
o
i
t
c
a
r
T
 
c
i
f
i
c
e
p
S

)

%

(

90
88
86
84
82
80
78
76
74
72
70

0.1

0.2

0.3

0.4

0.5

0.6

0.7

0.8

0.9

1

Friction Coefficient of Road (-)

Fig. 4.51 Maximum in the slip characteristic

0.1

0.2

0.3

0.4

0.5

0.6

0.7

0.8

0.9

1

Friction Coefficient of Road (-)

Fig. 4.52 Asymptote of slip characteristic

4.1 Classical Vehicle Model

267

Fig. 4.53 Brake input data speciﬁcations window

Table 4.42 Brakes input data

Name

Brake

Piston Surface
Speciﬁc Factor
Efﬁciency
Inertia Moment
Friction Coefﬁcient
Friction Radius

Value

Front
Right
1800.0
1.00
0.97
0.02
0.25
120.0

Value

Rear
Right
1500.0
1.00
0.97
0.02
0.25
100.0

Value

Front
Left
1800.0
1.00
0.97
0.02
0.25
120.0

Value

Rear
Left
1500.0
1.00
0.97
0.02
0.25
100.0

Unit
–

mm2
–
–
kg m2
–

mm

Therefore, it is necessary to deﬁne the upshifting and downshifting velocities

always only for one gear less than are available in the gearbox.

To deﬁne component input data double click on the gearbox control icon and

enter the following data (Table 4.45) [3].

The gearbox control is also the connection between the gearbox program and

the gearbox.

The velocities for upshifting and downshifting can be checked in the following
way: the upshifting velocity of the 2nd gear means that at this velocity the gearbox
control is upshifting from the 2nd into the 3rd gear. The downshifting velocity for
the 2nd gear means that at this velocity the gearbox control is downshifting from
the 3rd into the 2nd gear.

The Gearbox Program (17) is used for automatic gearboxes in combination
with the gearbox control (Fig. 4.59). The gearbox program allows for a more
complicated gear shifting process than the gearbox control, as the load signal of the
engine is considered. The gearbox program shifts the gears according to given

268

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.43 Differential input data

Name

Differential Lock
Torque Split Factor
Inertia Moment In
Inertia Moment Out1
Inertia Moment Out2

Value

Unlocked
1.00
0.02
0.02
0.02

Unit
–
–
kg m2
kg m2
kg m2

Fig. 4.54 Differential input data speciﬁcations window

Fig. 4.55 Kinematic Chain Browser

4.1 Classical Vehicle Model

269

Fig. 4.56 Cockpit input data speciﬁcations window

Table 4.44 Cockpit input data

Name

Shift Mode
Number of Gears Forward
Number of Gears Back
Maximum Brake Force
Brake Light Switch Threshold
Number of Retarder Steps

Value

Automatic
5.00
1.00
100.0
1.00
0.00

Unit
–
–
–

N
%
–

)

%

(
 
l
a
n
g
i
S
d
a
o
L

 

100

90

80

70

60

50

40

30

20

10

0

0

20

40

60

80

100

Acceleration Pedal Travel (%)

Fig. 4.57 Pedal characteristic

curves. The curves are given as a function of the load signal and the engine speed.
The target gear determined by the program is transmitted to the gearbox control that
transmits it to the gearbox.

270

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.58 Gearbox control input data speciﬁcations window

Table 4.45 Gearbox control
input data

c—Downshifting (km/h)

20
40
60
80

25
50
75
100

b—Upshifting (km/h)

Shifting According to Velocity
a—Gear (–)
1
2
3
4
Shifting According to Speed
a—Gear (–)
1
2
3
4
Shifting According to Speed in next Gear
a—Gear (–)
1
2
3
4

b—Upshifting (1/min)
2000
2000
2000
2000

b—Upshifting (1/min)
3000
3000
3000
3000

c—Downshifting (1/min)
1500
1500
1500
1500

c—Downshifting (1/min)
2500
2500
2500
2500

Furthermore, the curves could be optimized using iSIGHT interface module.
These optimized curves (optimized shifting program) could also be used as input
curves for the gearbox program [2].

The gear shifting process is done similar to the gearbox control. The only
difference is the dependence on the load signal of the engine. If the shifting program
should be deﬁned not by speed but by velocity, the Data Bus input velocity must be
connected.

The units of the shifting program and the optimized shifting program inﬂuence
each other. This means that if one of these programs is loaded with a different unit,
the other program also gets this new unit.

4.1 Classical Vehicle Model

271

Fig. 4.59 Gearbox program input data speciﬁcations window

With the properties switches shifting program 2–5 up to four additional shifting
programs can be deﬁned (a—gear (–), b—load signal (%), c—speed upshifting
(1/min) and d—speed downshifting (1/min)).

With the Data Bus input shifting program selector (which provides a double
interpolations between the deﬁned shifting programs can be done

value),
(Fig. 4.60a, b and Tables 4.46, 4.47) [3].

The speeds for upshifting and downshifting can be checked in the following
way: the upshifting speed of the 2nd gear with the special load signal means that at
this speed with this load signal the gearbox control is upshifting from the 2nd into
the 3rd gear. The downshifting speed for the 2nd gear with the special load signal
means that at this speed with this load signal the gearbox control is downshifting
from the 3rd into the 2nd gear.

The ASC Anti-Slip Control (18) checks the force transmission factor of all

connected wheels (Fig. 4.61).

The ASC is only active when a model is calculated quasi-stationary in combi-

nation with special drivetrain conﬁgurations and does not require data entry.

If the ASC is used for calculations in simulation mode this switch can be
activated. In this case the parameters for the PID controller can be set proportional
(–), differential (s), and integral parameter (1/s).

Catalyst (19) or exhaust systems consider the effects of the catalytic converter

and soot ﬁller on the raw emissions of the engine (Fig. 4.62).

To deﬁne component input data double click on the catalyst icon and enter the

following data (Table 4.48).

Conversion efﬁciencies of the different emissions (NOx, CO, HC, and Soot) can

be deﬁned dependent on the actual temperature of the catalytic converter.

Conversion efﬁciencies curve can be deﬁned as function of a—temperature (°C)
(Fig. 4.63 and Table 4.49—NOx conversion efﬁciencies,
and efﬁciency (–)
Fig. 4.64 and Table 4.50—CO conversion efﬁciencies, Fig. 4.65 and Table 4.51—
HC conversion efﬁciencies).

The heat transfer Gas/Cat (Table 4.52 and Fig. 4.66) are the proportion of the
exhaust gas which is transferred to the exhaust system and can be deﬁned as a
function of a—temperature (°C) and b—heat-up proportion of exhaust gas energy
(%) [1].

272

4 Classical Powertrain Conﬁguration Model and Simulation

1

2

3

4

Gear
(-)

1

2

3

4

1

2

3

4

500

1500

2500

3500

4500

5500

Speed Upshifting (1/min)

1

2

3

4

Gear
(-)

(a)

100

)

%

(
 
l
a
n
g
i
S
d
a
o
L

 

)

%

(
 
l
a
n
g
i
S
d
a
o
L

 

90

80

70

60

50

40

30

20

10

0

90

80

70

60

50

40

30

20

10

0

(b)

100

0

1000

2000

3000

4000

Speed Downshifting (1/min)

Fig. 4.60 Shifting programs standard. a speed upshifting. b speed downshifting

Table 4.46 Upshifting program data

(a)
1

2

3

4

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

0
770
0
1250
0
1820
0
2500

20
770
20
1250
20
1820
20
2500

30
770
30
1250
30
1820
30
3100

40
770
40
1250
40
2350
40
3800

60
1200
60
1950
60
3300
60
5100

65
1290
65
2125
65
3550
65
5460

72
1420
72
2370
72
3900
72
5460

80
1550
80
2650
80
3900
80
5460

100
1550
100
2650
100
3900
100
5460

4.1 Classical Vehicle Model

273

Table 4.47 Downshifting program data

(a)
1

2

3

4

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

0
510
0
890
0
1380
0
2000

20
510
20
890
20
1380
20
2000

30
510
30
890
30
1380
30
2400

40
510
40
890
40
1700
40
2800

60
780
60
1285
60
2250
60
3500

65
848
65
1384
65
2392
65
3700

72
942
72
1522
72
2590
72
3700

80
1050
80
1680
80
2590
80
3700

100
1050
100
1680
100
2590
100
3700

Fig. 4.61 ASC input data speciﬁcations window

Fig. 4.62 Catalyst input data speciﬁcations window

The Monitor component (20) can be introduced, if the calculation run must be
detected. It is possible to show some results of the calculation while the calculation
is running.

274

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.48 Catalyst input data

Name
Heat Loss Coefﬁcient
Weight of Catalyst
Speciﬁc Heat Capacity of Catalyst
Reference Area Cat/Air
Heat Transfer Coefﬁcient Cat/Air
Operating Temperature Catalyst

Value

0.950

12.00

220.0

0.300

25.00

500.0

Unit
–

kg
J/kg K
m2
W/m2 K
°C

1.000
0.900
0.800
0.700
0.600
0.500
0.400
0.300
0.200
0.100
0.000

)
-
(
 

y
c
n
e
i
c
i
f
f

E

0

100

400

500

200
Temperature (°C)

300

Fig. 4.63 NOx conversion efﬁciencies

Table 4.49 NOx conversion efﬁciencies data
Efﬁciency
(–)
0.000
0.000
0.003
0.007
0.013
0.021
0.031
0.045

Temperature
(°C)
0
170
180
190
200
210
215
220

Temperature
(°C)
225
230
235
240
245
250
255
260

Efﬁciency
(–)
0.100
0.160
0.220
0.320
0.485
0.670
0.830
0.920

Temperature
(°C)
265
270
280
290
300
400
500
–

Efﬁciency
(–)
0.975
0.992
0.996
0.997
0.997
0.996
0.996
–

Click on the description of Data Bus tab and open the following dialog. To select
a Data Bus channel, click to access at the available list. Enter the text for the
description and then click on to select the unit (Fig. 4.67).

4.1 Classical Vehicle Model

275

0

100

400

500

200
Temperature (°C)

300

Fig. 4.64 CO conversion efﬁciencies

Table 4.50 CO conversion efﬁciencies data
Efﬁciency
(–)
0.000
0.000
0.003
0.007
0.013
0.021
0.031
0.045

Temperature
(°C)
0
170
180
190
200
210
215
220

Temperature
(°C)
225
230
235
240
245
250
255
260

Efﬁciency
(–)
0.100
0.160
0.220
0.320
0.485
0.670
0.830
0.920

Temperature
(°C)
265
270
280
290
300
400
500
–

Efﬁciency
(–)
0.975
0.992
0.996
0.997
0.997
0.996
0.996
–

1.000
0.900
0.800
0.700
0.600
0.500
0.400
0.300
0.200
0.100
0.000

)
-
(
 
y
c
n
e
i
c
i
f
f

E

1.000
0.900
0.800
0.700
0.600
0.500
0.400
0.300
0.200
0.100
0.000

)
-
(
 
y
c
n
e
i
c
i
f
f

E

0

100

400

500

200
Temperature (°C)

300

Fig. 4.65 HC conversion efﬁciencies

276

4 Classical Powertrain Conﬁguration Model and Simulation

Table 4.51 HC conversion efﬁciencies data
Efﬁciency
(–)
0.000
0.000
0.003
0.007
0.013
0.021
0.031
0.045

Temperature
(°C)
0
170
180
190
200
210
215
220

Temperature
(°C)
225
230
235
240
245
250
255
260

Efﬁciency
(–)
0.100
0.160
0.220
0.320
0.485
0.670
0.830
0.920

Temperature
(°C)
265
270
280
290
300
400
500
–

Efﬁciency
(–)
0.975
0.992
0.996
0.997
0.997
0.996
0.996
–

Table 4.52 Heat transfer
Gas/Cat data

Temperature (°C)

Heat-Up Proportion of Exhaust
Gas Energy (%)

−30
210
270
500
600
1000

41
39
65
64
64
64

)

%

(
 
y
g
r
e
n
E
 
s
a
G

 
t
s
u
a
h
x
E

 
f
o
 
n
o
i
t
r
o
p
o
r
P
p
U

 

-
t
a
e
H

70

65

60

55

50

45

40

35

-50

150

750

950

350
Temperature (°C)

550

Fig. 4.66 Heat transfer Gas/Cat

4.2 Run Simulation

277

Fig. 4.67 Monitor description of Data Bus

4.2 Run Simulation

4.2.1 Result Manager

To run a simulation for each model, there are ﬁve different options for calculation
[2]:
(cid:129) Single Calculation is a regular calculation with the input data supplied in the
components. The output of the result deﬁnes which components result will be
written and available in the Result Manager.

(cid:129) Matrix Calculation is used for multiple calculations and to evaluate the effect of
varying the values of input parameters on vehicle performance, consumption
and emissions. The results can be viewed for each varied calculation.

(cid:129) Component Variation is used for multiple calculations and the calculation
consists of sub-calculations in which components are replaced by components
of the same type. The results can be viewed in the Result Manager.

(cid:129) System Variation is used for multiple calculations from a list of all the model

systems. The results can be viewed similar to Component Variation.

(cid:129) Batch Calculation is used for calculations series of different projects, either
Single Calculation, Matrix Calculation with DoE option and Component
Variation with DoE option.

278

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.68 Start calculation

To run the calculation in the Desk Area click on Calculation Center or click on
AVL blue button in the upper right corner (Fig. 4.68). Click on to “Start
Calculation” button to run the simulation.

After the completion of the simulation click on the Result Manager in the
Navigation Frame (Fig. 4.69) and expand the task of which the results should be
viewed. The selected objects are shown in the right section of the window.

Project information can be viewed in the main window by selecting info in the
tree structure or by double clicking info in the right window. The window shows
general information: project name, author, vehicle model, drivetrain model, date,
and state (regarding errors), then the tree structure of the folder with deﬁned
Calculation Tasks (different status for run or not run is shown using blue/gray
color). The picture of the Vehicle Model is also displayed.

One output ﬁle is produced for each component in the Vehicle Model and each
Calculation Task. Data for diagrams are extracted from these ﬁles and are shown as
Energy Flow Graphics, presentation diagrams for current tasks and standard dia-
grams for used components.

In the tree structure of the Result Manager all deﬁned Calculation Task folders
are shown separately for each task. The folders with results are shown in color;
tasks which are not simulated are gray. Files for each Calculation Task are located
inside the respective folder. In Result Manager, all components are listed where
results have been written in pages mode or data sources mode (Fig. 4.70).

The result output for components is selected with output in the properties

window of the respective component [4].

4.2 Run Simulation

279

Fig. 4.69 Result Manager window

Select as deﬁned in module for output of results in the folder of the corre-
sponding calculation task. There are two types of result outputs available with the
Result Manager: standard diagrams and presentation diagrams.

Standard diagrams (Fig. 4.71) are created separately for each component and
only contain results of the individual component and represent time histories of the
single components.

Standard diagrams have a predeﬁned representation page, which can only be
changed in some parts. Standard diagrams are opened by selecting the respective
calculation task in the tree structure of Result Manager and then selecting the
corresponding component.

The pages mode sidebar is divided into a list of predeﬁned standard diagram
pages for the respective component and TeimView Assistant with a tree structure of
components with all available curves and the current parameter for current diagram
of respective component with the list of all used curves. TeimView has two tabs:
pages and data sources. Pages are used to view results as curves in standard diagram
and data sources in tables as numerical data for the respective component for
analyzing and extracting [2].

The data sources mode sidebar (Fig. 4.72) has a tree structure where the data
source, data ﬁle, and table are shown. In data sources view there is a list of all curve
data that can be shown.

280

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.70 Result Manager pages mode

Fig. 4.71 Standard diagrams

The Energy Flow Graphics feature can be selected in the Result Manager
(Fig. 4.73). An animation shows the ﬂow between the drivetrain components over
time of the following parameters: Current (A), Energy Stored (kJ), Energy (kJ),
Power (kW), Speed (1/min), Velocity (km/h), Torque (Nm), Force (N), Voltage
(V).

4.2 Run Simulation

281

Fig. 4.72 Result Manager data sources mode

The animation can be controlled by using the play, pause, stepwise, stop, repeat,
velocity switches. A time-bar, showing the actual simulation time, can be moved to
a certain time-step with the mouse.

Below the ﬂow graphics a monitor is shown which displays the result curves of
the selected components. With the zoom-option, the horizontal can be scaled so that
long cycles can also be viewed properly.

In addition to the graphical representation, the associated values can also be

viewed in the monitor as well as in the drivetrain ﬂow graphics.

The values of the Energy Flow Graphics can also be displayed in a pie chart.
Clicking the button EFG pie chart opens an area where the segments can be added
or removed with the buttons “+” and “−”.

The association between a segment and a component parameter can be done by
adding the segment in the segment list and then a left mouse-click on a connector of
the component (Fig. 4.74). Several connectors can be chosen for one segment. In
that case, the segment represents the sum of all associated values. The segment list
consists of the absolute segment values as well as of the values in terms of per-
centages [2].

The task of the mode trimap is to construct a 3D surface and describe it by
isolines. The input data (3D points) are projected into the x-y-surface and are
triangulated (in 2D). The isolines are created by an intersection list (Fig. 4.75) [2].

282

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.73 Energy Flow Graphics

4.2.2 Standard Diagrams

To evaluate the fuel economy characteristics of the IC Engine motored bus a typical
NEDC cycle was simulated (Fig. 4.76).

The total distance of this cycle is 1.0931 m, the total time is 1180 s, idle standing
time is 267 s, average speed including stops is 33.35 km/h, average driving speed
excluding stops is 43.10 km/h, average acceleration is 0.506 m/s2 and maximum
acceleration is 1.042 m/s2.

The statistical percentages of IC Engine operating region are found in conden-

sation map and it is show in Fig. 4.77.

Driving time distribution in consumption map is show in Fig. 4.78, the engine
speed for IC Engine is show in Fig. 4.79, the engine torque for IC Engine is show in
Fig. 4.80, engine power for IC Engine is show in Fig. 4.81 and the mean effective
pressure for IC Engine is show in Fig. 4.82.

4.2 Run Simulation

283

Fig. 4.74 EFG pie chart

Fig. 4.75 Trimap diagram

284

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.76 Typical NEDC cycle

Fig. 4.77 Statistical percentages of engine operating region

4.2 Run Simulation

285

Fig. 4.78 Driving time distribution in consumption map

Fig. 4.79 Engine speed for IC Engine

286

4 Classical Powertrain Conﬁguration Model and Simulation

Fig. 4.80 Engine torque for IC Engine

Fig. 4.81 Engine power for IC Engine

References

287

Fig. 4.82 Mean effective pressure for IC Engine

References

Edition 06.2011

Edition 06.2011

Edition 06.2011

1. AVL Cruise (2011) Primer. AVL List GmbH, Graz, Austria, Document no. 04.0103.2011,

2. AVL Cruise (2011) Users Guide. AVL List GmbH, Graz, Austria, Document no. 04.0104.2011,

3. AVL Cruise (2011) Gear Shifting Program (GSP). AVL List GmbH, Graz, Austria, Document

no. 04.0114.2011, Edition 06.2011

4. AVL Cruise (2011) Notes. AVL List GmbH, Graz, Austria, Document no. 04.0102.2011,

Chapter 5
Hybrid Powertrain Conﬁguration Model
and Simulation

5.1 Hybrid Vehicle Model Creation

5.1.1 Hybrid CVT Model

This chapter describes how to create and run the model of a hybrid CVT
front-wheel drive. To place a component in the working area, click on the com-
ponent group with the left mouse button, move the mouse over the required
component, and then click and drag the component into the vehicle model area.
Arrange the components as shown in the following ﬁgure (Fig. 5.1) and connect the
components as speciﬁed in the diagram. All the connections in the Data Bus for this
model are described in Table 5.1 [1].

Place the following components in the working area: Vehicle (1), IC Engine (2),
Clutch (3), CVT Continuously Variable Transmission (4), Final Drive (5), Vehicle
Front Right (6), Vehicle Front Left (7), Vehicle Rear Right (8), Vehicle Rear Left
(9), Rear Drum Brake (10), Front Disk Brake (11), Front Disk Brake (12), Rear
Drum Brake (13), E-Machine (14), Differential (15), Cockpit (16), CVT control
(17), Battery H (18), MATLAB® DLL (19), Delta Torque CE (20), Delta Torque
Brake (21), Total Torque (22), and Monitor (23).

The Vehicle (1) is one of the main objects in a model. This component contains
general data of the vehicle, such as nominal dimensions and weights. Only one
vehicle component is required in a model. Road resistances and dynamic wheel
loads are calculated for road and dynamometer runs based on the dimensions and
the load state. The wheel loads are calculated considering motion. The aerody-
namic, rolling, climbing, acceleration, and total resistance are calculated [2].

To deﬁne component input data (Table 5.2) double click on the icon or click on
it with the right mouse button and select edit to open the following window
(Fig. 5.2).

The properties window is accessed through properties button in the input data
window, or from the pop-up menu by selecting “properties.” Selected parameters

© Springer International Publishing Switzerland 2015
B.O. Varga et al., Electric and Plug-In Hybrid Vehicles,
Green Energy and Technology, DOI 10.1007/978-3-319-18639-9_5

289

290

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.1 Complete CVT hybrid model

have inﬂuence on needed component data input for calculation (Fig. 5.3). With
these settings, it is also possible to run a calculation with minimal input data, as the
input ﬁelds of the unavailable data can be switched off.

IC Engine (2) component contains a model for an internal combustion engine.
The characteristic curves for the full load, the fuel consumption, and others can be
freely deﬁned by the user [2]. It is possible to deﬁne a gasoline engine as well as a
diesel engine. In this component a temperature model is included to consider the
inﬂuence of the temperature on the fuel consumption and emissions while the
engine is cold. The engine will be modelled by a structure of characteristic maps.
To deﬁne component input data (Table 5.3) double click on the icon or click on
it the right mouse button and select edit to open the following window (Fig. 5.4).
The properties window is accessed through properties button in input data

window, or from pop-up menu (Fig. 5.5).

To load IC Engine characteristic click on the Full Load Characteristic tab
(Fig. 5.6). Add rows by clicking on and enter the following data (Table 5.4) [1].
The Motoring Curve (Fig. 5.7) will be deﬁned similar to the Full Load

Characteristic either as power dependent on the engine speeds (Table 5.5).

At the Fuel Consumption Map (Table 5.6 and Fig. 5.8) the actual fuel con-
sumption for stationary operation is listed depending on the brake mean pressure
with the engine speed (a—speed (1/min), b—BMEP (bar), c—volume ﬂow (l/h)).
In the emission maps the emissions for the different exhaust gases are listed
dependent on the mean pressure with the engine speed as parameter (a—speed
(1/min), b—BMEP (bar), c—mass ﬂow (kg/h), namely NOx emission map in

5.1 Hybrid Vehicle Model Creation

291

n
o
i
t
a
m
r
o
f
n
I

t
u
p
t
u
O

t
n
e
i
b
m
A
e
s
r
u
o
C

e
r
u
s
s
e
r
P

e
k
a
r
B

e
r
u
s
s
e
r
P

e
k
a
r
B

e
r
u
s
s
e
r
P

e
k
a
r
B

e
r
u
s
s
e
r
P

e
k
a
r
B

e
s
a
e
l
e
R

h
c
t
u
l
C

e
r
i
s
e
D

l
o
r
t
n
o
C

n
o
i
t
a
r
e
p
O

d
e
e
p
S

e
n
i
g
n
E

C

I

r
a
e
G

t
n
e
r
r
u
C

n
o
i
s
s
i
m
s
n
a
r
T

d
e
r
i
s
e
D

n
o
i
s
s
i
m
s
n
a
r
T

t
n
e
r
r
u
C

e
r
u
t
a
r
e
p
m
e
T

d
e
e
p
S

e
n
i
g
n
E

C

I

l
a
n
g
i
S

d
a
o
L

t
n
e
i
b
m
A
e
s
r
u
o
C

y
t
i
c
o
l
e
V

e
u
q
r
o
T

l
a
n
g
i
S

d
a
o
L

l
a
n
g
i
S

d
a
o
L

h
c
t
i

w
S

t
r
a
t
S

l
a
n
g
i
S

d
a
o
L

)
d
e
u
n
i
t
n
o
c
(

S
M
E

e
r
u
s
s
e
r
P

e
k
a
r
B

S
M
E

l
a
n
g
i
S

d
a
o
L

e
r
u
s
s
e
r
P

e
k
a
r
B

g
n
i
r
e
v
i
l
e
D

t
n
e
n
o
p
m
o
C

e
k
a
r
B

e
u
q
r
o
T

a
t
l
e
D

e
k
a
r
B

e
u
q
r
o
T

a
t
l
e
D

e
k
a
r
B

e
u
q
r
o
T

a
t
l
e
D

e
k
a
r
B

e
u
q
r
o
T

a
t
l
e
D

t
i
p
k
c
o
C

e
n
i
g
n
E

C

I

e
n
i
g
n
E

C

I

t
i
p
k
c
o
C

T
V
C

l
o
r
t
n
o
C

T
V
C

e
n
i
h
c
a

M
-
E

T
V
C

E
C

e
u
q
r
o
T

a
t
l
e
D

e
u
q
r
o
T

l
a
t
o
T

e
n
i
g
n
E

C

I

L
L
D
®
B
A
L
T
A
M

E
C

e
u
q
r
o
T

a
t
l
e
D

L
L
D
®
B
A
L
T
A
M

L
L
D
®
B
A
L
T
A
M

L
L
D
®
B
A
L
T
A
M

t
i
p
k
c
o
C

t
i
p
k
c
o
C

t
i
p
k
c
o
C

t
i
p
k
c
o
C

e
r
u
t
a
r
e
p
m
e
T

t
n
e
i
b
m
A

n
o
i
t
a
m
r
o
f
n
I

t
u
p
n
I

e
r
u
s
s
e
r
P

e
k
a
r
B

e
r
u
s
s
e
r
P

e
k
a
r
B

e
r
u
s
s
e
r
P

e
k
a
r
B

e
r
u
s
s
e
r
P

e
k
a
r
B

e
s
a
e
l
e
R
h
c
t
u
C
e
r
i
s
e
D

l

0

l
o
r
t
n
o
C
n
o
i
t
a
r
e
p
O

r
o
t
a
c
i
d
n
I

r
a
e
G

d
e
e
p
S

n
o
i
s
s
i

m
s
n
a
r
T

d
e
r
i
s
e
D

e
r
u
t
a
r
e
p
m
e
T

n
o
i
s
s
i

m
s
n
a
r
T

t
n
e
r
r
u
C

l
a
n
g
i
S

d
a
o
L

e
r
u
t
a
r
e
p
m
e
T

t
n
e
i
b
m
A

e
u
q
r
o
T

y
t
i
c
o
l
e
V

d
e
e
p
S

l
a
n
g
i
S

d
a
o
L

l
a
n
g
i
S

d
a
o
L

h
c
t
i

w
S

t
r
a
t
S

t
i
p
k
c
o
C

l
a
n
g
i
S

d
a
o
L

S
M
E

l
a
n
g
i
S

d
a
o
L

e
r
u
s
s
e
r
P

e
k
a
r
B

S
M
E

e
r
u
s
s
e
r
P

e
k
a
r
B

s
n
o
i
t
c
e
n
n
o
c

s
u
B

a
t
a
D

1
.
5

e
l
b
a
T

s
e
r
i
u
q
e
R

t
n
e
n
o
p
m
o
C

m
u
r
D

r
a
e
R

e
k
a
r
B

k
s
i
D

t
n
o
r
F

e
k
a
r
B

m
u
r
D

r
a
e
R

e
k
a
r
B

k
s
i
D

t
n
o
r
F

e
k
a
r
B

H
y
r
e
t
t
a
B

t
i
p
k
c
o
C

h
c
t
u
l
C

T
V
C

l
o
r
t
n
o
C

T
V
C

E
C

e
u
q
r
o
T

a
t
l
e
D

B

e
u
q
r
o
T

a
t
l
e
D

e
n
i
h
c
a

M
-
E

e
n
i
g
n
E

C

I

292

5 Hybrid Powertrain Conﬁguration Model and Simulation

n
o
i
t
a
m
r
o
f
n
I

t
u
p
t
u
O

g
n
i
r
e
v
i
l
e
D

t
n
e
n
o
p
m
o
C

l
e
e
h
w
y
l
F

e
u
q
r
o
T

d
e
e
p
S

e
n
i
g
n
E

C

I

l
e
e
h
w
y
l
F

e
u
q
r
o
T

e
r
u
s
s
e
r
P

e
k
a
r
B

l
a
n
g
i
S

d
a
o
L

e
u
q
r
o
T

e
g
r
a
h
C

y
r
e
t
t
a
B

o
i
t
a
R

t
n
e
r
r
u
C

h
c
t
i

w
S

t
r
a
t
S

e
s
a
e
l
e
R

h
c
t
u
l
C

n
o
i
t
a
r
e
l
e
c
c
A

t
n
e
r
r
u
C

y
t
i
c
o
l
e
V

y
t
i
c
o
l
e
V

e
c
n
a
t
s
i
D

l
a
n
g
i
S

d
a
o
L

l
a
u
t
c
A

d
e
e
p
S

e
n
i
g
n
E

C

I

t
n
e
i
b
m
A
e
s
r
u
o
C

e
n
i
h
c
a

M
-
E

e
n
i
g
n
E

C

I

e
n
i
g
n
E

C

I

e
n
i
g
n
E

C

I

t
i
p
k
c
o
C

t
i
p
k
c
o
C

e
l
c
i
h
e
V

H
y
r
e
t
t
a
B

t
i
p
k
c
o
C

H
y
r
e
t
t
a
B

h
c
t
u
l
C

T
V
C

d
i
r
b
y
H
e
l
c
i
h
e
V

d
i
r
b
y
H
e
l
c
i
h
e
V

d
i
r
b
y
H
e
l
c
i
h
e
V

e
n
i
g
n
E

C

I

e
n
i
g
n
E

C

I

t
i
p
k
c
o
C

n
o
i
t
a
m
r
o
f
n
I

t
u
p
n
I

l
e
e
h
w
y
l
F

e
u
q
r
o
T

d
e
e
p
S

e
n
i
g
n
E

C

I

l
e
e
h
w
y
l
F

e
u
q
r
o
T

e
r
u
s
s
e
r
P

e
k
a
r
B

l
a
n
g
i
S

d
a
o
L

e
u
q
r
o
T

e
g
r
a
h
C

y
r
e
t
t
a
B

o
i
t
a
R

t
n
e
r
r
u
C

h
c
t
i

w
S

t
r
a
t
S

e
s
a
e
l
e
R

h
c
t
u
l
C

y
t
i
c
o
l
e
V

t
n
e
r
r
u
C

n
o
i
t
a
r
e
l
e
c
c
A
e
l
c
i
h
e
V

y
t
i
c
o
l
e
V
e
l
c
i
h
e
V

e
c
n
a
t
s
i
D
e
l
c
i
h
e
V

l
a
n
g
i
S

d
a
o
L

e
n
i
g
n
E

C

I

d
e
e
p
S

e
n
i
g
n
E

C

I

e
r
u
t
a
r
e
p
m
e
T

)
d
e
u
n
i
t
n
o
c
(

1
.
5

e
l
b
a
T

s
e
r
i
u
q
e
R

t
n
e
n
o
p
m
o
C

e
u
q
r
o
T

l
a
t
o
T

L
L
D
®
B
A
L
T
A
M

r
o
t
i
n
o
M

o
i
t
a
R

e
l
g
n
i
S

5.1 Hybrid Vehicle Model Creation

293

Table 5.2 Vehicle components input data

Name

Gas Tank Volume
Distance from Hitch to Front Axle
Height of Support Point at Bench Test
Wheel Base
Distance of Gravity Center empty/half/full
Height of Gravity Center empty/half/full
Height of Hitch empty/half/full
Tire Inﬂation Pressure Front Axle
Tire Inﬂation Pressure Rear Axle
Curb Weight
Gross Weight
Frontal Area
Drag Coefﬁcient

Value

0.050
3200.0
100.0
2690.0
1080.0/1090.0/1100.0
560.0/550.0/540.0
390.0/380.0/370.0
2.200
2.200
1300.0
1600.0
2.000
0.300

Unit
m3
mm
mm
mm
mm
mm
mm
bar
bar
kg
kg
m2
–

Fig. 5.2 Vehicle input data speciﬁcations window

Fig. 5.9 and Table 5.7, CO emission map in Fig. 5.10 and Table 5.8, HC emission
map in Fig. 5.11 and Table 5.9) [1].

The Clutch (3) makes stationary idle possible, transition to motion, and inter-
ruption of the power ﬂow (Fig. 5.12). The clutch slips to compensate for the

294

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.3 Properties of Vehicle

Table 5.3 IC Engine
components input data

Name

Engine Displacement
Engine Working Temperature
Number of Cylinders/Strokes
Idle/Maximum Speed
Inertia Moment
Response Time
Heating Value for Gasoline
Fuel Density
Idle Consumption
Idle Emission NOx/CO/HC

Value

1460.0
90.00
4/4
790.0/5600.0
0.190
0.040
42700.0
0.720
0.500
0.0015/0.075/0.050

Unit
cm3
°C
–

1/min
kg m2
s
kJ/kg
kg/l
l/h
kg/h

difference in the rotational speeds of engine and drive train when the vehicle is set
in motion. When a change in operation conditions makes it necessary to change
gears, the clutch disengages the engine from the drivetrain for the duration of the
procedure [2].

The clutch can be used together with a CVT gearbox and it is only necessary for
starting. In this case, the clutch is controlled by the control module CVT control.
To deﬁne component input data (Table 5.10) double click on the icon and select
edit to open the following window (Fig. 5.13).

The pressure force is the axial force when the frictional surfaces are pressed
together. This pressure force depends on the clutch release. With the pressure force
the transmitted torque can be calculated by considering the dimensions (a—clutch
release (%), b—pressure force (N)).

CVT (4) can convert every point on the engine operating curve to an operating
curve of its own, and every engine operating curve into an operating range within

5.1 Hybrid Vehicle Model Creation

295

Fig. 5.4 IC Engine input data speciﬁcations window

Fig. 5.5 Properties of IC Engine

296

5 Hybrid Powertrain Conﬁguration Model and Simulation

750

1750

2750
Speed (1/min)

3750

Fig. 5.6 Full Load Characteristic

Table 5.4 Full Load
Characteristic data

Speed (1/min) Torque (Nm) Speed (1/min) Torque (Nm)

800
1000
1500
2000

90
100
108
115

2500
3000
3500
5000

120
125
130
120

)

m
N

(
 
e
u
q
r
o
T

135

130

125

120

115

110

105

100

95

90

)

m
N

(
 
e
u
q
r
o
T

0

-1

-2

-3

-4

-5

-6

-7

0

500

1000

2500

3000

3500

1500
2000
Speed (1/min)

Fig. 5.7 Motoring Curve

0
300
600
800
1500
2000
2500
3500

(a)
850

1250

1700

2300

2900

3500

4200

5100

6000

5.1 Hybrid Vehicle Model Creation

297

Table 5.5 Motoring Curve data

Speed (1/min)

Torque (Nm)

0.00
−3.00
−4.00
−4.25
−4.25
−4.50
−5.00
−7.00

Table 5.6 Fuel Consumption Map data

(b) −4.0
0.60
(c)
(b) −4.0
(c)
0.73
(b) −4.0
1.00
(c)
(b) −4.0
(c)
1.45
(b) −4.0
(c)
1.70
(b) −4.0
(c)
2.10
(b) −4.0
(c)
2.65
(b) −4.0
(c)
3.65
(b) −4.0
4.80
(c)

−0.5
0.62
−0.5
0.82
−0.5
1.05
−0.5
1.50
−0.5
1.78
−0.5
2.15
−0.5
2.75
−0.5
3.78
−0.5
4.95

0.0
0.71
0.0
0.90
0.0
1.14
0.0
1.56
0.0
1.93
0
2.40
0
2.92
0
3.99
0
5.17

1.60
1.02
0.19
0.96
2.06
1.86
2.30
2.83
0.71
2.40
2.41
4.26
2.31
5.04
3.62
8.30
2.76
9.24

3.16
1.32
1.82
1.42
3.54
2.48
3.07
3.34
3.97
4.63
3.97
5.65
3.82
6.56
5.10

10.0

4.18

11.4

4.55
1.64
3.32
1.88
4.89
3.07
5.25
4.61
5.49
5.68
7.04
8.12
5.34
8.02
8.12
14.0
5.53
13.5

5.95
1.95
4.73
2.37
6.33
3.69
6.71
5.47
8.41
7.77
8.59
9.54
8.53

11.2

9.77

16.7

7.32
2.34
7.59
3.35
7.83
4.34
9.63
7.34
9.81
8.87

10.3
11.1

9.99

12.8
11.2
19.2

8.39

9.72

19.0

22.7

8.63
2.76
8.90
3.96

10.9

6.29

12.3

9.51

11.3
10.0
13.4
14.5
13.1
17.6
12.5
22.6
10.9
26.1

9.30
3.15
10.9
4.54
12.3
7.08
14.3
11.6
14.8
14.1
15.1
16.9
15.1
21.7
14.5
28.2
13.1
32.7

the ﬁeld of potential driving conditions (Fig. 5.14). With the model of the CVT
is possible to change the transmission between two user-deﬁned
gearbox it
threshold values. The adjusting speed between different transmissions is internal
ﬁxed at a constant value [2].

To deﬁne component input data (Table 5.11) double click on the icon and select
edit to open the following window. The efﬁciency ﬁxed curve can be deﬁned as
function of the transmission ratio (Fig. 5.15).

Final Drive (5) or Single Ratio Transmission is a gear step with ﬁxed ratio. It

can be used as a transmission step of the differential (Fig. 5.16).

298

5 Hybrid Powertrain Conﬁguration Model and Simulation

-4

0

12

16

4
8
BMEP (bar)

Fig. 5.8 Fuel Consumption Map

Engine
Speed
(1/min)

850

1250

1700

2300

2900

3500

4200

5100

6000

Engine
Speed
(1/min)
850

1250

1700

2300

2900

3500

4200

5100

6000

35

30

25

20

15

10

5

0

)
h

/
l
(
 

w
o
l
F
 
e
m
u
l
o
V

)
h
/
g
k
(
 

w
o
l
F
 
s
s
a
M

1.2

1

0.8

0.6

0.4

0.2

0

-4

1

6
BMEP (bar)

11

16

Fig. 5.9 NOx emission map

To deﬁne component input data double click on the ﬁnal drive icon and enter

the following data (Table 5.12).

The Wheels and Tires link the vehicle to the road. The wheel component
considers many inﬂuencing variables and their effect on the rolling state (Fig. 5.17).
Information data for the four wheels is the same (Vehicle Front Right (6),
Vehicle Front Left (7), Vehicle Rear Right (8), and Vehicle Rear Left (9)). Double
click on the wheel and enter the following data (Table 5.13) [1].

5.1 Hybrid Vehicle Model Creation

299

Table 5.7 NOx emission map data

(a)
850

1250

1700

2300

2900

3500

4200

5100

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−4.0
0.00
−4.0
0.00
−4.0
0.01
−4.0
0.01
−4.0
0.02
−4.0
0.02
−4.0
0.03
−4.0
0.03
−4.0
0.05

−0.5
0.00
−0.5
0.01
−0.5
0.01
−0.5
0.01
−0.5
0.02
−0.5
0.02
−0.5
0.03
−0.5
0.04
−0.5
0.07

0.00
0.00
0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.02
0.00
0.03
0.00
0.05
0.00
0.06
0.00
0.10

1.61
0.01
1.82
0.02
0.42
0.01
0.73
0.03
0.70
0.04
0.68
0.06
0.75
0.08
1.97
0.19
1.21
0.27

3.16
0.02
3.32
0.04
2.08
0.04
2.20
0.07
2.41
0.11
2.41
0.17
2.31
0.18
3.62
0.34
2.76
0.48

4.55
0.05
4.73
0.07
4.89
0.13
5.24
0.19
5.47
0.27
7.05
0.44
5.41
0.39
6.65
0.61
5.68
0.73

5.95
0.06
6.17
0.10
7.83
0.20
8.21
0.29
8.41
0.40
8.59
0.51
8.53
0.58
9.77
0.81
9.43
0.95

7.32
0.08
8.90
0.13
9.48
0.22
9.55
0.32
9.81
0.44

0.59
9.99
0.65

8.62
0.10

9.30
0.11

10.2

10.9

0.15

0.16

10.1

12.3

0.23

0.25

12.4

14.3

0.33

0.34

12.0

15.2

0.49

0.58

0.62

0.64

12.6

15.1

0.75

0.87

11.6

14.3

15.1

11.5

12.8

14.7

0.89

0.96

1.14

12.3

13.5

14.2

1.11

1.18

1.23

)
h

/
g
k
(
 

w
o
l
F
 
s
s
a
M

14

12

10

8

6

4

2

0

Engine
Speed
(1/min)

850

1250

1700

2300

2900

3500

4200

5100

6000

-4

1

6

11

16

Fig. 5.10 CO emission map

300

5 Hybrid Powertrain Conﬁguration Model and Simulation

Table 5.8 CO emission map data

(a)
850

1250

1700

2300

2900

3500

4200

5100

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−4.0
0.03
−4.0
0.04
−4.0
0.05
−4.0
0.06
−4.0
0.10
−4.0
0.11
−4.0
0.15
−4.0
0.18
−4.0
0.24

−1.6
0.03
−1.7
0.04
−1.7
0.06
−1.7
0.07
−1.7
0.10
−1.7
0.12
−1.7
0.15
−1.7
0.19
−1.7
0.25

0.00
0.04
0.00
0.06
0.00
0.08
0.00
0.09
0.00
0.12
0.00
0.13
0.00
0.17
0.00
0.21
0.00
0.29

1.60
0.07
1.82
0.08
2.06
0.12
0.73
0.12
0.85
0.15
0.72
0.16
0.72
0.22
1.00
0.31
1.21
0.38

3.16
0.10
4.73
0.15
4.89
0.25
2.30
0.21
2.42
0.27
2.41
0.32
3.82
0.57
3.62
0.68
4.18
1.08

4.55
0.13
6.16
0.21
6.37
0.24
5.22
0.38
5.52
0.52
7.04
0.68
6.88
1.10
6.55
1.24
6.35
1.79

5.95
0.17
7.59
0.25
7.83
0.41
8.21
0.67
8.42
0.83

2.28
9.48
2.05
8.86
2.03
7.77
3.63

7.32
0.21
9.89
0.97
9.82
1.17

1.72
9.62
1.35

10.6

4.62

10.1

2.85
9.48
2.69
9.72
7.78

9.18
0.52
10.6
1.28
11.0
1.76
12.4
2.74
11.7
3.52
12.3
5.21
13.1
7.24
11.3
7.14
12.1
12.2

9.66
0.62

11.1

1.55

12.3

2.46

14.3

3.17

14.8

4.88

15.1

7.60

15.1

8.69

12.5

9.11

13.1
14.2

10.2

11.9

0.4

0.35

0.3

0.25

0.2

0.15

0.1

0.05

)
h
/
g
k
(
 

w
o
l
F
 
s
s
a
M

Engine
Speed
(1/min)

850

1250

1700

2300

2900

3500

4200

5100

6000

0

-4

1

6

11

16

Fig. 5.11 HC emission map

5.1 Hybrid Vehicle Model Creation

301

Table 5.9 HC emission map data

(a)
850

1250

1700

2300

2900

3500

4200

5100

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−4.0
0.00
−4.0
0.01
−4.0
0.01
−4.0
0.01
−4.0
0.01
−4.0
0.01
−4.0
0.01
−4.0
0.01
−4.0
0.02

−1.6
0.01
−1.6
0.01
−1.6
0.01
−1.6
0.01
−1.6
0.01
−1.6
0.01
−1.6
0.01
−1.6
0.02
−1.6
0.02

0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.01
0.00
0.02
0.00
0.02

1.60
0.01
1.82
0.01
3.54
0.03
0.73
0.01
0.79
0.01
0.74
0.02
2.43
0.04
3.64
0.06
2.76
0.06

3.16
0.02
3.32
0.02
4.89
0.04
2.30
0.03
2.45
0.03
2.49
0.03
3.89
0.05
5.10
0.08
4.18
0.09

4.55
0.02
4.73
0.03
6.33
0.05
5.25
0.05
5.60
0.06
7.06
0.08
5.38
0.07
6.63
0.09
5.53
0.10

5.95
0.03
6.17
0.03
7.83
0.06
6.71
0.05
6.97
0.07
8.59
0.10
6.91
0.09
8.06
0.11
6.94
0.12

7.32
0.03
7.60
0.04
9.72
0.08
9.89
0.09
9.85
0.11

0.13
9.85
0.13

8.63
0.03
8.90
0.05

9.30
0.04

10.9

0.07

11.9

12.8

0.11

0.14

12.6

14.8

0.15

0.18

11.4

14.8

0.14

0.20

0.18

0.32

13.0

14.6

0.26

0.33

10.5

11.7

15.0

11.2

12.5

14.6

0.22

0.29

0.35

10.9

12.1

13.1

0.26

0.33

0.39

Fig. 5.12 Clutch input data speciﬁcations window

The Brake component is described by brake data and dimensions (Fig. 5.18). It

is possible to deﬁne drum brakes as well as disk brakes.

Input data for the two front brakes is the same and also the data for the two rear
brakes is the same (Rear Drum Brake Right (10), Front Disk Brake Right (11), Rear

302

5 Hybrid Powertrain Conﬁguration Model and Simulation

Table 5.10 Clutch input data Name

Inertia Moment In
Inertia Moment Out
Clutch Release
Pressure Force
Clutch Release
Pressure Force
Maximum transferable Torque

Value

0.001
0.001
0.000
6000
100
0.000
300

Unit
kg m2
kg m2
%
N
%
N
Nm

)

N

(
 
e
c
r
o
F
 
e
r
u
s
s
e
r
P

6000

5000

4000

3000

2000

1000

0

0

20

40

60
Clutch Release (%)

80

100

Fig. 5.13 Pressure force

Fig. 5.14 CVT input data speciﬁcations window

5.1 Hybrid Vehicle Model Creation

303

Table 5.11 CVT input data

Name

Inertia Moment In
Inertia Moment Out
Adjustment Time
Minimum Ratio
Switching Threshold
Maximum Ratio

Value

0.035
0.045
2.500
0.500
0.040
2.873

Unit
kg m2
kg m2
s
–
–
–

)
-
(
 
y
c
n
e
i
c
i
f
f

E

0.895
0.893
0.891
0.889
0.887
0.885
0.883
0.881
0.879
0.877
0.875

0.45

0.95

1.45

1.95

2.45

Transmission Ratio (-)

Fig. 5.15 Efﬁciency ﬁxed

Fig. 5.16 Final Drive input data speciﬁcations window

304

5 Hybrid Powertrain Conﬁguration Model and Simulation

Table 5.12 Final Drive input
data

Name

Inertia Moment In
Inertia Moment Out
Transmission Ratio
Efﬁciency

Value

0.01
0.02
5.50
0.90

Unit
kg m2
kg m2
–
–

Fig. 5.17 Wheels input data speciﬁcations window

Table 5.13 Wheels input
data

Name

Wheel Inertia Moment
Friction Coefﬁcient of Tire
Reference Wheel Load
Wheel Load Correction Coefﬁcient
Static Rolling Radius
Circumference
Dynamic Rolling Radius
Circumference

Value

1.000
0.950

3200.0

0.000

290.0
1822.12
310.0
1947.79

Unit
kg m2
–

N
–

mm
mm
mm
mm

Drum Brake Left (12), and Front Disk Brake Left (13)). Double click on the brake
icon and enter the following data (Table 5.14).

Using E-Machine component (14) together with the battery H, the user can
simulate hybrid systems. The model of the electric machine contains two compo-
nents, the inverter and the electric motor. For this type of model a characteristic map
for the efﬁciency is used to calculate the loss of power. The thermic model takes the
warm up of the electric machine into account regarding the occurring losses. The

5.1 Hybrid Vehicle Model Creation

305

Fig. 5.18 Brake input data speciﬁcations window

Table 5.14 Brakes input data

Name

Brake

Value

Value

Value

Front Right

Rear Right

Front Left

Piston Surface
Speciﬁc Factor
Efﬁciency
Inertia Moment
Friction Coefﬁcient
Friction Radius

1700.0
1.000
0.950
0.030
0.200
100.0

500.0
2.500
0.950
0.030
0.200
90.00

1700.0
1.000
0.950
0.030
0.200
100.0

Value

Rear
Left
500.0
2.500
0.950
0.030
0.200
90.00

Unit
–

mm2
–
–
kg m2
–

mm

warm up of the environment with respect to the cooling system due to the electric
machine is not considered in the electric machine component.

The maximal power should be restricted to avoid exceeding the given limit for
the temperature due to the occurring losses. Therefore, the permissible losses are
dependent on the actual temperature of the motor and the maximal moment of
inertia is determined according to these values [2].

Double click on the e-machine icon and enter the following data (Fig. 5.19).
The value of the voltage level should be entered at which the following char-
acteristic maps of the machine have been measured. In addition to the U1 level
(Fig. 5.20 and Table 5.15) the U2 level (Fig. 5.21 and Table 5.16) will be activated
in the property window.

For each level the corresponding voltage value must be deﬁned and the corre-
sponding characteristic maps (voltage for U1 = 80 V, voltage for U1 = 280 V). The
maximum mechanical (power) torque is deﬁned as a function of the machine speed
(a—speed (1/min), b—torque (Nm)) [1].

306

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.19 E-Machine input data speciﬁcations window

)

m
N

(
 
e
u
q
r
o
T

70

60

50

40

30

20

10

0

1000

2000

3000

6000

7000

8000

9000

5000

4000
Speed (1/min)

Fig. 5.20 Maximum mechanical torque variation U1

Table 5.15 Maximum
mechanical torque
variation U1

Speed (1/min) Torque (Nm) Speed (1/min) Torque (Nm)

0
2000
2500
3500

65
65
50
36

4500
5500
6500
8500

28
23
19
15

5.1 Hybrid Vehicle Model Creation

307

)

m
N

(
 
e
u
q
r
o
T

70

60

50

40

30

20

10

0

1000

2000

3000

6000

7000

8000

9000

5000

4000
Speed (1/min)

Fig. 5.21 Maximum mechanical torque variation U2

Table 5.16 Maximum
mechanical torque variation
U2

Speed (1/min) Torque (Nm) Speed (1/min) Torque (Nm)

0
2000
2500
3500

65
65
50
36

4500
5500
6500
8500

28
23
19
15

The efﬁciency curve can be deﬁned as function of the maximum mechanical

torque (Fig. 5.22 and Table 5.17) [1].

The Differential (15) is a particular type of simple planetary gear train that has
the property that the angular velocity of its carrier is the average of the angular
velocities of its sun and annular gears (Fig. 5.23). To deﬁne component input data
double click on the differential icon and enter the following data (Table 5.18).

The Kinematic Chain Browser can be launched in the pop-up menu of a selected
component. All mechanical connections starting from the selected component are
shown in a tree structure in the left side of the window (Fig. 5.24—Electric
Machine, Fig. 5.25—Gasoline Engine).

The Cockpit (16) links the driver and the vehicle (Fig. 5.26). In this component
connections are only made via the Data Bus. The pedal positions are transferred
into corresponding indicators via the pedal characteristics (Table 5.19).

To deﬁne the input data click on the acceleration pedal characteristic
(a—acceleration pedal travel (%), b—load signal (%)), clutch pedal characteristic

308

5 Hybrid Powertrain Conﬁguration Model and Simulation

)

%

(
 
y
c
n
e
i
c
i
f
f

E

98

93

88

83

78

73

68

63

58

53

48

Engine
Speed
(1/min)

500
1000
1500
2000
2500
3500
4500
5500
6500
8500

0

10

20

50

60

70

30

40
Torque (Nm)

Fig. 5.22 Efﬁciency curves

Table 5.17 Efﬁciency curve data

(a)
500

1000

1500

2000

2500

3500

4500

5500

6500

8500

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

5
90
5
88
5
90
5
92
5
91
5
92
5
92
5
90
5
88
5
85

10
87
10
89
10
91
10
92
10
93
10
94
10
95
10
94
10
94
10
92

20
83
20
90
20
91
20
92
20
93
20
95
20
97
20
96
–
–
–
–

23
82
23
89
23
91
23
92
23
93
23
95
23
97
–
–
–
–
–
–

26
80
26
88
26
90
26
92
26
93
26
95
–
–
–
–
–
–
–
–

30
79
30
87
30
90
30
92
30
93
–
–
–
–
–
–
–
–
–
–

34
78
34
87
34
90
34
92
34
93
–
–
–
–
–
–
–
–
–
–

39
76
39
86
39
90
39
91
39
93
–
–
–
–
–
–
–
–
–
–

44
69
44
84
44
88
44
90
–
–
–
–
–
–
–
–
–
–
–
–

48
65
48
81
48
85
48
90
–
–
–
–
–
–
–
–
–
–
–
–

52
61
52
74
52
80
52
84
–
–
–
–
–
–
–
–
–
–
–
–

58
56
58
66
58
73
58
77
–
–
–
–
–
–
–
–
–
–
–
–

65
51
65
59
65
65
65
71
–
–
–
–
–
–
–
–
–
–
–
–

5.1 Hybrid Vehicle Model Creation

309

Fig. 5.23 Differential input data speciﬁcations window

Table 5.18 Differential input
data

Name

Differential Lock
Torque Split Factor
Inertia Moment In
Inertia Moment Out1
Inertia Moment Out2

Value

Unlocked
1.000
0.020
0.020
0.020

Unit
–
–
kg m2
kg m2
kg m2

Fig. 5.24 Kinematic Chain Browser e-machine component

(a—clutch pedal travel (%), b—clutch release (%)), and brake pedal characteristic
(a—speciﬁc brake pedal force (%), b—brake pressure (bar)) tabs and enter the
following data for all (Fig. 5.27).

The CVT Control (17) is an easy way to provide target transmission consid-
ering the velocity and the engine load (Fig. 5.28). In addition it is possible to
control a clutch. To deﬁne component input data double click on the CVT control
icon and enter the following data (Table 5.20).

310

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.25 Kinematic Chain Browser IC Engine component

Fig. 5.26 Cockpit input data speciﬁcations window

Table 5.19 Cockpit input
data

Name

Shift Mode
Number of Gears Forward
Number of Gears Back
Maximum Brake Force
Brake Light Switch Threshold
Number of Retarder Steps

Value

Manual
1.000
1.000
100.0
1.000
0.000

Unit
–
–
–

N
%
–

5.1 Hybrid Vehicle Model Creation

311

)

%

(
 
e
s
a
e
l
e
R
h
c
t
u
l
C

 

100

90

80

70

60

50

40

30

20

10

0

0

20

40

60

80

100

Pedal Travel (%)

Fig. 5.27 Pedal characteristic

Fig. 5.28 CVT control input data speciﬁcations window

Table 5.20 CVT control
input data

Name

Load Signal Time Constant
Velocity Time Constant

3.0
1.0

s
s

Value

Unit

The desired transmission ratio (Fig. 5.29 and Table 5.21) can be deﬁned as a
function of a—velocity (m/s), b—load signal (%), and c—transmission ratio (−).
The desired clutch release (Fig. 5.30 and Table 5.22) of the starting clutch can be
deﬁned as a function of a—speed (1/min), b—load signal (%), and c—clutch
release (%) [3].

The Battery H (18) component is used for simulating hybrid and electric
vehicles. The basic model consists of a voltage source and an ohmic resistance
(Fig. 5.31) [2].

312

5 Hybrid Powertrain Conﬁguration Model and Simulation

2.9

2.4

1.9

1.4

0.9

)
-
(
 
o
i
t
a
R
n
o
i
s
s
i

 

m
s
n
a
r
T

0.4

0

Velocity
(m/s)
0
3
6
8
14
17
19
22
25
28
31
33
36
39
42
44
47

20

40

60
Load Signal (%)

80

100

Fig. 5.29 Desired transmission ratio

Table 5.21 Desired transmission ratio data

(a)

(b)

(a)

0
0
0
0
0
3
3
3
3
3
(a)

28
28
28
28
28
31
31
31
31
31

(b)

0
25
50
75
100
0
25
50
75
100
(b)

0
25
50
75
100
0
25
50
75
100

(c)

2.9
2.9
2.9
2.9
2.9
2.4
2.9
2.9
2.9
2.9

6
6
6
6
6
8
8
8
8
8

(c)

0.6
0.6
0.7
0.7
0.7
0.6
0.6
0.6
0.6
0.7

(c)

1.8
2.1
2.4
2.7
2.9
1.2
1.5
1.7
2.0
2.2
(b)

0
25
50
75
100
0
25
50
75
100

0
25
50
75
100
0
25
50
75
100
(a)

33
33
33
33
33
36
36
36
36
36

(a)

11
11
11
11
11
14
14
14
14
14

(b)

0
25
50
75
100
0
25
50
75
100

(c)

1.2
1.0
1.1
1.3
1.7
1.0
1.1
1.2
1.3
1.4

(c)

0.5
0.5
0.6
0.6
0.7
0.5
0.5
0.6
0.6
0.7

(a)

39
39
39
39
39
42
42
42
42
42

(a)

17
17
17
17
17
19
19
19
19
19

(b)

0
25
50
75
100
0
25
50
75
100

(b)

0
25
50
75
100
0
25
50
75
100
(c)

0.5
0.5
0.6
0.6
0.6
0.5
0.5
0.5
0.5
0.6

(c)

0.8
0.9
1.0
1.1
1.2
0.7
0.8
0.9
1.0
1.0
(a)

44
44
44
44
44
47
47
47
47
47

(a)

22
22
22
22
22
25
25
25
25
25

(b)

0
25
50
75
100
0
25
50
75
100

(c)

0.6
0.7
0.8
0.8
0.9
0.5
0.6
0.7
0.7
0.8

(b)

0
25
50
75
100
0
25
50
75
100

(c)

0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5
0.5

5.1 Hybrid Vehicle Model Creation

313

Velocity
(km/h)

0
10
20
30
40

)

%

(
 
e
s
a
e
l
e
R
h
c
t
u
l
C

 

100

90

80

70

60

50

40

30

20

10

0

0

10

20

30

70

80

90

100

40

60
50
Load Signal (%)

Fig. 5.30 Desired clutch release

Table 5.22 Desired clutch release data

(a)

0
0
0
0
0
10
10
10
10
10

(b)

0
25
50
75
100
0
25
50
75
100

(c)

100
75
60
40
25
0
20
40
60
80

(a)

20
20
20
20
20
30
30
30
30
30

(b)

0
25
50
75
100
0
25
50
75
100

(c)

0
5
10
20
25
0
0
0
2.5
7.5

(a)

40
40
50
50
60
60
80
80
90
90

(b)

0
100
0
100
0
100
0
100
0
100

0
0
0
0
0
0
0
0
0
0

(c)

(c)

(c)

(a)

100
100
110
110
120
120
130
130
140
140

(b)

0
100
0
100
0
100
0
100
0
100

0
0
0
0
0
0
0
0
0
0

(a)

150
150
160
160
170
170
–
–
–
–

(b)

0
100
0
100
0
100
–
–
–
–

0
0
0
0
0
0
–
–
–
–

Double click on the battery H icon and enter the following data (Table 5.23).
The resistance is constructed in a way that a big part of the complex processes
within the battery are taken into consideration. 2 RC elements which describe the
concentration overvoltage and the transfer overvoltage can be added optionally.

The thermal behavior of the battery H is described by a thermal substitution
model. The warming caused by the losses inside the battery H and the cooling
caused by convection is taken into consideration.

Single cells can be modelled as well as any combination of cells. Therefore, the

user can construct any desired model.

The idle voltage—charge (b) is the idle voltage of one cell in charge mode.
There is no electrical consumer; it is a function of the State of Charge SOC (a)
(Fig. 5.32 and Table 5.24).

314

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.31 Battery H input data speciﬁcations window

Table 5.23 Battery H input
data

Name

Maximum Charge
Nominal Voltage
Maximum Voltage
Initial Charge
Minimum Voltage
Number of Cells per Cell-Row
Number of Cell-Row
Operating Temperature
Mass of a Cell
Speciﬁc Heat Transition
Speciﬁc Heat Capacity
Internal Resistance

Value

25,000
160.00
175.00
92.00
145.0
1.000
1.000
25.00
0.200
250.0
1000
0.600

Unit

As
V
V
%
V
–
–
°C
kg
W/K
J/kg K
Ω

The Idle voltage—discharge (b) of one cell is the voltage without an electrical
consumer, there is no ﬂow of current, and it is a function of the State of Charge
SOC (a) (Fig. 5.33 and Table 5.25).

MATLAB® DLL (19) Engineering Measurement System (EMS) interface
allows to integrate controllers and/or mechanical elements, such as special drives,
which have been created using MATLAB®/Simulink™, into the computational

5.1 Hybrid Vehicle Model Creation

315

Fig. 5.32 Idle voltage charge

170

165

160

155

150

)

V

(
 
e
g
a
t
l
o
V

145

0

170

165

160

155

150

)

V

(
 
e
g
a
t
l
o
V

145

0

20

40

60

80

100

State of Charge (%)

Table 5.24 Idle voltage—charge data

State of Charge (%)

Voltage (V)

State of Charge (%)

Voltage (V)

0
20
40
60

145
150
153
155

80
90
95
100

157
159
163
170

Fig. 5.33 Idle voltage
discharge

20

40

60

80

100

State of Charge (%)

model of AVL CRUISE. If an element
is created and parameterized under
Simulink™, it will be compiled to a so-called Dynamic Link Library (DLL) under
Windows. These ﬁles will be integrated into AVL CRUISE. The advantage of this

5 Hybrid Powertrain Conﬁguration Model and Simulation

Table 5.25 Idle voltage—discharge data

State of Charge (%)

Voltage (V)

State of Charge (%)

Voltage (V)

145
150
153
155

80
90
95
100

157
159
163
170

316

0
20
40
60

procedure is that AVL CRUISE itself does not need to be compiled again if
MATLAB®/Simulink™ modules are to be integrated (Fig. 5.34) [2].

The input and output variables will be transferred by means of in-ports and out-
ports. These ports create the interface to the MATLAB® module and are available at
the AVL CRUISE Data Bus.

The compiled DLL ﬁle will be loaded from folder: project/version/userdata/

_CRUISE_R121_ctrl_3_DLL.dll.

The input values are transferred to the MATLAB® function. From the module,

the results are received and input to the output channels (Table 5.26).

The Delta Torque Combustion Engine (20) component is a function used to
calculate with user-deﬁned functions, in this case the adaption of the acceleration
pedal for the IC Engine with Integrated Starter Generator (ISG).

The Integrated Starter Generator (ISG) merges both the conventional starter and
generator of an automobile in a single electric device. The ISG produces electric
power when the vehicle is running, which is used to supply electric devices and to
charge the battery.

The ISG can help to decelerate the vehicle by generating electric power, which is
called regenerative braking. The electric power generated charges the battery,
reducing fuel consumption. If a clutch disconnects the ISG and the compressor
from the engine during the idle stop, the ISG can drive the air-conditioning com-
pressor via a belt [2].

Fig. 5.34 MATLAB® DLL input data speciﬁcations window

5.1 Hybrid Vehicle Model Creation

317

Table 5.26 Description of Data Bus

Data Bus Channel

Description

Connection

Decouple

Inport 0
Inport 1
Inport 2
Inport 3
Inport 4
Inport 5
Inport 6
Inport 7
Inport 8
Inport 9
Outport 0
Outport 1
Outport 2
Outport 3

Engine Speed
Torque behind Flywheel
Load Signal
Brake Pressure
Velocity
Battery Charge
Start Switch
Current Transmission Ratio
Actual Clutch Release
Current
Start Switch
Load Signal—EMS
Load Signal
Brake Pressure—EMS

Unit

rad/s
Nm
–

Pa
m/s
As
–
–
–

A
–
–
–

Pa

Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional

0
0
0
0
0
0
0
0
0
0
0
0
0
0

To deﬁne component input data double click on the delta torque combustion
engine icon and enter the following data for function (Fig. 5.35), and for description
of Data Bus (Table 5.27).

The Delta Torque Brake (21) component is a function used to calculate (with
user-deﬁned functions), the adaption brake pedal for mechanical brake with ISG.

Fig. 5.35 Delta torque combustion engine input data speciﬁcations window

5 Hybrid Powertrain Conﬁguration Model and Simulation

318

a[0]
a[1]
y[0]

Table 5.27 Description of Data Bus

Data Bus Channel

Description
Load Signal—Cockpit
Load Signal—EMS
Load Signal

Unit
–
–
–

Connection

Decouple

Optional
Optional
Optional

0
0
0

To deﬁne component input data double click on the delta torque brake icon and
enter the following data for function (Fig. 5.36), and for description of Data Bus
(Table 5.28).

The Total Torque (22) component

is a function used to calculate with
user-deﬁned functions, the summation of torque from IC Engine and ISG. To deﬁne
component input data double click on the total torque icon and enter the following
data for function (Fig. 5.37), and for description of Data Bus (Table 5.29).

Fig. 5.36 Delta torque brake input data speciﬁcations window

Table 5.28 Description of Data Bus

Data Bus Channel

Unit

Connection

Decouple

Description
Brake Pressure—Cockpit
Brake Pressure—EMS
Brake Pressure

Pa
Pa
Pa

Optional
Optional
Optional

0
0
0

a[0]
a[1]
y[0]

5.1 Hybrid Vehicle Model Creation

319

a[0]
a[1]
y[0]

detected.

Fig. 5.37 Total torque input data speciﬁcations window

Table 5.29 Description of Data Bus

Data Bus Channel

Description

Connection

Decouple

Torque
Torque behind Flywheel
Torque

Unit

Nm
Nm
Nm

Optional
Optional
Optional

0
0
0

The Monitor component (23) can be introduced, if the calculation run must be

It is possible to show some results of the calculation while the calculation is
running. This is done via the online monitor. It is possible to connect up to ten input
channels of the monitor to output channels of different components that are
available at the AVL CRUISE—Data Bus [2].

Click on the description of Data Bus tab and open the following dialog. To select
a Data Bus channel, click to access at the available list. Enter the text for the
description and then click on to select the unit (Table 5.30).

Table 5.30 Description of
Data Bus

Data Bus Channel

Description

Input 0
Input 1
Input 2
Input 3
Input 4

Vehicle Acceleration
Vehicle Velocity
Vehicle Distance
Engine Load Signal
Engine Speed

Unit
m/s2
km/h
m
–

1/min

320

5 Hybrid Powertrain Conﬁguration Model and Simulation

5.1.2 Hybrid Planetary Gearbox Model

This chapter describes how to create and run the simulation for a hybrid FWD
model with planetary gearbox.

To place a component in the working area, click on the component group with
the left mouse button, move the mouse over the required component, and then click
and drag the component into the vehicle model area. Put the component with
release of the mouse button on the desired place.

Place the following components in the working area: Vehicle (1), IC Engine (2),
Final Drive (3), Vehicle Front Left (4), Vehicle Front Right (5), Vehicle Rear Left
(6), Vehicle Rear Right (7), Front Disk Brake (8), Rear Drum Brake (9), Rear Drum
Brake (10), Front Disk Brake (11), E-Machine (12), Generator (13), Differential
(14), Planetary Gearbox (15), Cockpit (16), ASC (17), Battery H (18), MATLAB®
DLL (19), and Monitor (20).

Arrange the components as shown in the following ﬁgure (Fig. 5.38) and con-

nect the components as speciﬁed in the diagram [1].

All the connections in the data bus for this model are described in Table 5.31.
The Vehicle (1) is one of the main objects in a model. This component contains

general data of the vehicle, such as nominal dimensions and weights.

To deﬁne component input data (Table 5.32) double click on the icon and select

edit to open the following window (Fig. 5.39).

IC Engine (2) component contains a model for an internal combustion engine.
To deﬁne component input data (Table 5.33) double click on the icon and select

edit to open the following window (Fig. 5.40).

Fig. 5.38 Complete hybrid FWD model with planetary gearbox

5.1 Hybrid Vehicle Model Creation

321

Table 5.31 Data Bus connections

Component Requires

Input Information

Component Delivering Output Information

ASC

Brake Front Disk
Brake Rear Drum
Brake Rear Drum
Brake Front Disk
Cockpit

E-Machine

Generator

IC Engine

MATLAB® DLL

Monitor

Cockpit

Load Signal
Slip Signal Front Left Wheel Front Left
Slip Signal Front Right Wheel Front Right
MATLAB® DLL
Brake Pressure
MATLAB® DLL
Brake Pressure
MATLAB® DLL
Brake Pressure
MATLAB® DLL
Brake Pressure
Gear Indicator
E-Machine
Operation Control 0
IC Engine
E-Machine
Operation Control 1
Generator
Operation Control 2
Speed
Single Ratio
MATLAB® DLL
Load Signal
MATLAB® DLL
Switch
MATLAB® DLL
Load Signal
MATLAB® DLL
Switch
MATLAB® DLL
Load Signal
MATLAB® DLL
Start Switch
Cockpit
Signal Acceleration
Cockpit
Vehicle Velocity
Battery H
Battery Status Charge
IC Engine
IC Engine Torque
Generator
Generator Torque
Generator
Generator Speed
E-Machine
E-Machine Speed
Cockpit
Brake Pressure
E-Machine
E-Machine Torque
IC Engine
IC Engine Speed
Vehicle
Vehicle Acceleration
Vehicle
Vehicle Velocity
Vehicle
Vehicle Distance
IC Engine
IC Engine Load Signal
IC Engine
IC Engine Speed

Load Signal
Slip Signal
Slip Signal
Brake Pressure
Brake Pressure
Brake Pressure
Brake Pressure
Operation Control
Operation Control
Operation Control
Operation Control
Input Speed
Load Signal
Start Switch
Load Signal
Start Switch
Load Signal
Start Switch
Load Signal
Velocity
Battery Charge
Torque Flywheel
Torque
Speed
Speed
Brake Pressure
Torque
IC Engine Speed
Acceleration
Velocity
Distance
Actual Load Signal
IC Engine Speed

To load IC Engine characteristic click on the Full Load Characteristic tab
(Fig. 5.41). Select (kW) unit from the b column by pull-down menu. Add rows by
clicking on and enter the following data (Table 5.34).

5 Hybrid Powertrain Conﬁguration Model and Simulation

322

Name

Table 5.32 Vehicle component input data

Gas Tank Volume
Distance from Hitch to Front Axle
Height of Support Point at Bench Test
Wheel Base
Distance of Gravity Center
empty/half/full
Height of Gravity Center
empty/half/full
Height of Hitch empty/half/full
Tire Inﬂation Pressure Front Axle
Tire Inﬂation Pressure Rear Axle
Curb Weight
Gross Weight
Frontal Area
Drag Coefﬁcient

Value

0.050
3000.0
100.0
2500.0
980.0/990.0/1000.0

570.0/560.0/550.0

400.0/390.0/380.0
2.000
2.200
1200.0
1600.0
1.750
0.300

Unit
m3
mm
mm
mm
mm

mm

mm
bar
bar
kg
kg
m2
–

Fig. 5.39 Vehicle input data speciﬁcations window

The Motoring Curve (Fig. 5.42) will be deﬁned similar to the Full Load

Characteristic either as power dependent on the engine speeds (Table 5.35) [1].

At the Fuel Consumption Map (Fig. 5.43 and Table 5.36) the actual fuel con-
sumption for stationary operation is listed depending on the brake mean pressure
with the engine speed as parameter (a—speed (1/min), b—BMEP (bar), c—volume
ﬂow (l/h)) [1].

5.1 Hybrid Vehicle Model Creation

323

Table 5.33 IC Engine
component input data

Name

Engine Type
Engine Charger
Engine Displacement
Engine Working Temperature
Number of Cylinders
Number of Strokes
Idle Speed
Maximum Speed
Inertia Moment
Response Time
Heating Value for Gasoline
Fuel Density
Speciﬁc Carbon Content

Value

Gasoline
Without
1490.0
100.0
4.000
4.000
900.0
4900.0
0.150
0.200
43500.0
0.750
0.860

Unit
–
–
cm3
°C
–
–

1/min
1/min
kg m2
s
kJ/kg
kg/l
–

Fig. 5.40 IC Engine input data speciﬁcations window

Final Drive (3) or Single Ratio Transmission is a gear step with ﬁxed ratio

(Fig. 5.44). It can be used as a transmission step of the differential [2].

To deﬁne component input data double click on the ﬁnal drive icon and enter the

following data (Table 5.37).

The Wheels are: Vehicle Front Left (4), Vehicle Front Right (5), Vehicle Rear
Left (6), and Vehicle Rear Right (7) with the data deﬁned in Table 5.38 and
Fig. 5.45.

324

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.41 Full Load
Characteristic

1000

1500

2000

2500

3000

3500

4000

4500

5000

Speed (1/min)

Table 5.34 Full Load
Characteristic data

Speed (1/min) Torque (Nm) Speed (1/min) Torque (Nm)

80
90
98
104
109

3500
4000
4200
4500
4700

113
115
115
112
110

Fig. 5.42 Motoring Curve

)

m
N

(
 
e
u
q
r
o
T

115

110

105

100

95

90

85

80

1000
1500
2000
2500
3000

)

m
N

(
 
e
u
q
r
o
T

-5

-10

-15

-20

-25

-30

-35

-40

1000

1500

2000

3500

4000

4500

3000

2500
Speed (1/min)

Table 5.35 Motoring Curve
data

Speed (1/min) Torque (Nm) Speed (1/min) Torque (Nm)

1000

−8.00

4500

−40.00

The Brake component is described by brake data and dimensions (Fig. 5.46 and
Table 5.39). It is possible to deﬁne drum brakes as well as disk brakes (Front Disk
Brake Right (8), Rear Drum Brake Left (9), Rear Drum Brake Right (10), and Front
Disk Brake Left (11)).

5.1 Hybrid Vehicle Model Creation

325

)
h
/
l
(
 

w
o
l
F
 
e
m
u
l
o
V

10.00

9.00

8.00

7.00

6.00

5.00

4.00

3.00

2.00

1.00

0.00

Engine
Speed
(1/min)

1000

1250

1500

1750

2000

2250

2500

2750

3000

3250

3500

4000

0.00 1.00 2.00 3.00 4.00 5.00 6.00 7.00 8.00 9.00
BMEP (bar)

Fig. 5.43 Fuel Consumption Map

Table 5.36 Fuel Consumption Map data

(a)
1000

1500

1750

2000

2500

2750

3000

3500

4000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

0.72
0.54
0.72
0.77
0.72
0.88
0.72
0.99
0.72
1.23
0.72
1.36
0.72
1.51
0.72
1.90
0.72
2.44

1.42
0.71
1.42
1.03
1.42
1.18
1.42
1.33
1.42
1.65
1.42
1.82
1.42
2.02
1.42
2.50
1.42
3.12

2.86
1.05
2.86
1.53
2.86
1.77
2.86
2.01
2.86
2.50
2.86
2.76
2.86
3.04
2.86
3.68
2.86
4.48

3.56
1.22
3.56
1.79
3.56
2.07
3.56
2.35
3.56
2.92
3.56
3.22
3.56
3.55
3.56
4.28
3.56
5.16

4.28
1.39
4.28
2.04
4.28
2.37
4.28
2.69
4.28
3.34
4.28
3.69
4.28
4.05
4.28
4.87
4.28
5.83

5.70
1.73
5.70
2.55
5.70
2.96
5.70
3.37
5.70
4.19
5.70
4.62
5.70
5.07
5.70
6.06
5.70
7.19

6.42
1.90
6.42
2.81
6.42
3.25
6.42
3.70
6.42
4.62
6.42
5.09
6.42
5.58
6.42
6.65
6.42
7.87

7.14
1.90
7.14
2.93
7.14
3.48
7.14
4.04
7.14
5.04
7.14
5.55
7.14
6.09
7.14
7.24
7.14
8.54

7.84
1.90
7.84
2.93
7.84
3.48
7.84
4.04
7.84
5.25
7.84
5.90
7.84
6.60
7.84
7.84
7.84
9.22

8.56
1.90
8.56
2.93
8.56
3.48
8.56
4.04
8.56
5.25
8.56
5.90
8.56
6.60
8.56
8.13
8.56
9.90

326

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.44 Final Drive input data speciﬁcations window

Table 5.37 Final Drive input
data

Name

Transmission Ratio
Inertia Moment In
Inertia Moment Out

Value

4.0000
0.0015
0.0015

Unit
–
kg m2
kg m2

Table 5.38 Wheels input
data

Name

Wheel Inertia Moment
Friction Coefﬁcient of Tire
Reference Wheel Load
Wheel Load Correction Coefﬁcient
Static Rolling Radius
Circumference
Dynamic Rolling Radius
Circumference
Friction Coefﬁcient of Road
Slip at Maximum Traction
Speciﬁc Traction at Inﬁnite Slip
Rolling Resistance Factor

Value

0.850
0.950
2500
0.020
290.00
1822.12
295.00
1853.54
1.050
12.50
78.00
0.900

Unit
kg m2
–

N
–

mm
mm
mm
mm
–

%
%
%

E-Machine (12) characteristic map for the efﬁciency is used to calculate the loss
of power. Double click on the e-machine icon and enter the following data
(Fig. 5.47 and Table 5.40).

The value of the voltage level should be entered at which the following char-

acteristic maps of the machine have been measured (U1 = 280 V).

The maximum mechanical (power) torque (Table 5.41 and Fig. 5.48) is deﬁned

as a function of the machine speed (a—speed (1/min), b—torque (Nm)).

5.1 Hybrid Vehicle Model Creation

327

Fig. 5.45 Wheels input data speciﬁcations window

Fig. 5.46 Brake input data speciﬁcations window

Table 5.39 Brakes input data

Name

Brake

Value

Value

Value

Front Right

Rear Right

Front Left

Piston Surface
Speciﬁc Factor
Efﬁciency
Inertia Moment
Friction Coefﬁcient
Friction Radius

2500.0
1.000
0.990
0.020
0.250
100

900.0
1.000
0.990
0.015
0.250
120

2500.0
1.000
0.990
0.020
0.250
100

Value

Rear
Left
900.0
1.000
0.990
0.015
0.250
120

Unit
–

mm2
–
–
kg m2
–

mm

328

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.47 E-Machine input data speciﬁcations window

Table 5.40 E-Machine input data

Name

Type of Machine
Characteristic Maps and Curves
Nominal Voltage
Inertia Moment
Maximum Current—Motor
Mass of Machine
Initial Temperature
Speciﬁc Heat Transition
Layout Temperature
Maximum Speed
Drag Torque at Maximum Speed
Maximum Current—Generator
Thermal Time Constant of Max Speed
Maximum Temperature
Speciﬁc Heat Capacity
Temperature Coefﬁcient of Remanence Induction

Value

PSM
Motor-related
280.0
0.025
120.0
50.00
70.00
2200
70.00
6000
−10.00
300.0
1.000
90.00
430.0
−0.002

Unit
–
–

V
kg m2
A
kg
°C
W/K
°C
1/min
Nm
A
s
°C
J/kg K
1/K

5.1 Hybrid Vehicle Model Creation

329

Table 5.41 Maximum
mechanical torque data

Speed (1/min)

Torque (Nm)

Fig. 5.48 Maximum
mechanical torque

305
305
280
192
144
115
96
82
72
65
48

0
500
1000
1500
2000
2500
3000
3500
4000
4500
6000

)

m
N

(
 
e
u
q
r
o
T

320

280

240

200

160

120

80

40

0

1000

4000

5000

6000

2000

3000
Speed (1/min)

The efﬁciency map (Fig. 5.49 and Table 5.42) is deﬁned dependent on a—speed

(1/min), b—power (kW), and c—efﬁciency (%) [1].

The Generator (13) must supply the vehicle electrical system with a sufﬁcient
current under all operating conditions in order to ensure that the state of charge in
the engine storage device is consistently maintained at an adequate level [2].
Double click on the generator icon and enter the following data (Fig. 5.50 and
Table 5.43).

The maximum mechanical (power) torque (Fig. 5.51 and Table 5.44) is deﬁned

as a function of the machine speed (a—speed (1/min), b—torque (Nm)).

The alternator systems are designed to supply charge voltages of 14 V (with
28 V for heavy utility vehicles) in order to maintain an adequate charge in 12 V (or
24 V) batteries.

The current delivered by the generator results from a map dependent on the
the

speed and the main voltage. By considering the internal

resistance,

330

5 Hybrid Powertrain Conﬁguration Model and Simulation

)

m
N

(
 
y
c
n
e
i
c
i
f
f

E

100

95

90

85

80

75

70

65

60

55

50

Engine
Speed
(1/min)
500

1000

1500

2000

2500

3000

3500

4000

4500

0.00

50.00

150.00

200.00

100.00
Power (kW)

Fig. 5.49 Efﬁciency map

Table 5.42 Efﬁciency map data

(a)
500

1000

1500

2000

2500

3000

3500

4000

4500

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

0.26

82.7

0.52

80.7

0.79

78.9

1.05

77.9

1.31

76.9

1.57

76.9

1.83

76.0

2.09

76.0

2.36

75.1

3.14

75.1

1.83
85.5
3.67
89.3
5.50
89.3
7.33
90.3
9.16
90.3
11.0
90.3
12.83
90.3
14.7
90.2
16.5
90.3
21.9
90.3

3.40

80.6

6.81

86.5
10.2
88.4
13.6
90.3
17.0
90.3
20.42
91.2
23.8
91.2
27.3
90.3
30.6
90.3
40.8
90.3

4.97

76.0

9.95

84.6
14.9
87.4
19.9
88.4
24.9
89.3
39.27
87.4
45.8
87.4
52.4
87.4
58.9
87.4
78.5
87.4

6.54

72.2
13.1
81.7
19.6
85.5
26.2
87.4
32.7
87.4
48.7
83.6
56.8
83.6
64.9
83.6
73.0
83.6
97.4
83.6

9.69
64.6
16.2
78.9
24.4
83.6
32.5
83.6
48.4
81.7
58.1
81.7
78.8
74.1
77.5
81.7
87.2
81.7
116
81.7

12.8
58.9
19.4
76.9
29.1
81.7
45.0
74.1
56.3
74.1
76.9
72.2
89.8
72.2
102
72.2
115
72.2
154
72.2

14.4
56.1
25.7
72.2
38.5
72.2
57.6
70.3
64.1
72.2
86.4
70.3
100
70.3
115
70.3
129
70.3
173
70.3

15.9
53.2
31.9
68.4
47.9
68.4
63.9
68.4
79.9
68.4
95.8
68.4
111
68.4
128
68.4
144
68.4
191
68.4

5.1 Hybrid Vehicle Model Creation

331

Fig. 5.50 Generator input data speciﬁcations window

Table 5.43 Generator input
data

Name

Nominal Voltage
Inertia Moment
Maximum Current—Motor
Mass of Machine
Initial Temperature
Speciﬁc Heat Transition
Layout Temperature
Maximum Speed
Drag Torque at Maximum Speed
Maximum Current—Generator
Thermal Time Constant of Max Speed
Maximum Temperature
Speciﬁc Heat Capacity
Coefﬁcient of Remanence Induction

Value

280.0
0.025
120.0
30.00
70.00
2200
70.00
8000
0.000
300.0
1.000
95.00
430.0
−0.002

Unit

V
kg m2
A
kg
°C
W/K
°C
1/min
Nm
A
s
°C
J/kg K
1/K

instantaneous current consumption helps to acquire the torque absorbed by the
generator with the corresponding moments of loss [2].

The efﬁciency map (Fig. 5.52 and Table 5.45) is deﬁned dependent on a—speed

(1/min), b—power (kW) and efﬁciency (%).

The Differential (14) is a particular type of simple planetary gear train that has
the property that the angular velocity of its carrier is the average of the angular

332

5 Hybrid Powertrain Conﬁguration Model and Simulation

60

40

20

0

-20

-40

-60

)

m
N

(
 
e
u
q
r
o
T

-7000

-5250

-3500

-1750

0

1750

3500

5250

7000

Speed (1/min)

Fig. 5.51 Maximum mechanical torque

Table 5.44 Maximum mechanical torque data

Speed
(1/min)

Torque
(Nm)

Speed
(1/min)

0
500
1000
1500
2000
2500
3000
3500
4000
5500
7000

55
55
55
55
55
55
48
41
36
26
20

Torque
(Nm)
−55
−55
−55
−55
−55
−55
−48
−41
−36
−26
−20

Speed
(1/min)
−7000
−5500
−4000
−3500
−3000
−2500
−2000
−1500
−1000
−500
0

Torque
(Nm)
−20
−26
−36
−41
−48
−55
−55
−55
−55
−55
−55

Speed
(1/min)
−7000
−5500
−4000
−3500
−3000
−2500
−2000
−1500
−1000
−500
0

Torque
(Nm)

20
26
36
41
48
55
55
55
55
55
55

0
500
1000
1500
2000
2500
3000
3500
4000
5500
7000

velocities of its sun and annular gears. To deﬁne component input data double click
on the differential icon and enter the following data (Fig. 5.53 and Table 5.46).

The Kinematic Chain Browser can be launched in the pop-up menu of a selected

component (Fig. 5.54—E-Machine, Fig. 5.55—IC Engine).

5.1 Hybrid Vehicle Model Creation

333

)

%

(
 
y
c
n
e
i
c
i
f
f

E

90

85

80

75

70

65

60

55

Speed
(1/min)

-4000
-3500
-3000
-2500
-2000
-1500
-1000
-500
500
1000
1500
2000
2500
3000
3500
4000
5500

-32

-24

-16

-8

16

24

32

8
0
Power (kW)

Fig. 5.52 Efﬁciency map

The Cockpit (16) links the driver and the vehicle. In this component connections
are only made via the Data Bus. The pedal positions are transferred into corre-
sponding indicators via the pedal characteristics (Table 5.47).

To deﬁne the input data click on the acceleration pedal characteristic (a—
acceleration pedal travel (%), b—load signal (%)) and brake pedal characteristic (a
—speciﬁc brake pedal force (%), b—brake pressure (bar)) tabs and enter the fol-
lowing data for all (Fig. 5.56).

The ASC Anti-Slip Control (17) checks the force transmission factor of all
connected wheels (Fig. 5.57). The Anti-Slip Control is only active when a model is
calculated quasi-stationary in combination with special drive train conﬁgurations
and does not require data entry [2].

If the Anti-Slip Control should be used for calculations in simulation mode, this
switch can be activated. In this case the parameters for the PID controller can be set
(proportional—1 (−), differential—0 (s), and integral parameter—1 (1/s)).

The Battery H (18) component is used to simulate hybrid vehicles (Fig. 5.58).

Double click on the battery H icon and enter the following data (Table 5.48).

The idle voltage—charge (b) is a function of the State of Charge SOC
(a) (Fig. 5.59 and Table 5.49), and the idle voltage—discharge (b) is a function of
the SOC (a) (Fig. 5.60 and Table 5.50).

334

5 Hybrid Powertrain Conﬁguration Model and Simulation

Table 5.45 Efﬁciency map data

(a)
−4000

−3500

−3000

−2500

−2000

−1500

−1000

−500

500

1000

1500

2000

2500

3000

3500

4000

5500

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

2
75
2
76
2
77
1
78
1
77
1
78
1
77
0
76
0
76
1
77
1
78
1
78
1
77
2
76
5
85
6
86
9
85

6
85
6
85
5
86
4
85
3
84
2
82
2
80
1
65
1
66
2
80
2
83
3
85
4
85
5
86
9
86
10
87
15
87

11
87
9
86
8
85
7
84
7
81
4
80
3
76
2
59
2
60
3
76
4
81
5
83
7
84
8
85
13
86
15
85
20
86

19
84
16
83
14
82
11
81
9
78
6
77
4
72
2
54
2
54
4
72
7
75
9
81
11
80
14
82
16
83
19
84
24
84

23
83
20
82
17
80
14
79
11
76
9
72
6
64
3
49
3
50
5
68
8
72
11
76
14
78
17
80
20
82
23
83
31
83

−23
83
−20
82
−17
80
−14
79
−11
76
−9
72
−6
64
−3
49
−3
50
−5
68
−8
72
−11
76
−14
78
−17
80
−20
82
−23
83
−31
83

−19
84
−16
83
−14
82
−11
81
−9
78
−6
77
−4
72
−2
54
−2
54
−4
72
−7
75
−9
81
−11
80
−14
82
−16
83
−19
84
−24
84

−11
87
−9
86
−8
85
−7
84
−7
81
−4
80
−3
76
−2
59
2
60
−3
76
−4
81
−5
83
−7
84
−8
85
−13
86
−15
85
−20
86

−6
85
−6
85
−5
86
−4
85
−3
84
−2
82
−2
80
−1
65
−1
66
−2
80
−2
83
−3
85
−4
85
−5
86
−9
86
−10
87
−15
87

−2
75
−2
76
−2
77
−1
78
−1
77
−1
78
−1
77
0
76
0
76
−1
77
−1
78
−1
78
−1
77
−2
76
−5
85
−6
86
−9
85

MATLAB® DLL (19)

interface allows to integrate controllers or also
mechanical elements, such as special drives, which have been created using
MATLAB®/Simulink™ into the computational model of AVL CRUISE (Fig. 5.61).

5.1 Hybrid Vehicle Model Creation

335

Fig. 5.53 Differential input data speciﬁcations window

Table 5.46 Differential input
data

Name

Differential Lock
Torque Split Factor
Inertia Moment In
Inertia Moment Out1
Inertia Moment Out2

Value

Unlocked
1.000
3.0e−4
3.0e−4
3.0e−4

Unit
–
–
kg m2
kg m2
kg m2

Fig. 5.54 Kinematic Chain Browser E-Machine

The compiled DLL ﬁle will be loaded from folder: project/version/userdata/
_MatLab_Controller.dll. The input values are transferred to the MATLAB® func-
tion [2]. The results are received and input to the output channels (Table 5.51).

The Monitor (20) can be introduced, if the calculation run must be detected
(Fig. 5.62). It is possible to show some results of the calculation while the calcu-
lation is running. This is done via the online monitor. It is possible to connect up to

336

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.55 Kinematic Chain Browser IC Engine

Table 5.47 Cockpit input
data

Name

Shift Mode
Number of Gears Forward
Number of Gears Back
Maximum Brake Force
Brake Light Switch Threshold
Number of Retarder Steps

Value

Automatic
1.00
0.00
100.0
1.0.0
0.00

Unit
–
–
–

N
%
–

)

%

(
 
l
a
n
g
i

 

S
d
a
o
L

100

90

80

70

60

50

40

30

20

10

0

0

20

40

60

80

100

Acceleration Pedal Travel (%)

Fig. 5.56 Pedal characteristic

5.1 Hybrid Vehicle Model Creation

337

Fig. 5.57 ASC Anti-Slip Control input data speciﬁcations window

Fig. 5.58 Battery H input data speciﬁcations window

ten input channels of the monitor to output channels of different components that
are available at the AVL CRUISE—Data Bus [2].

Click on the description of Data Bus tab and open the following dialog. To select
a Data Bus channel, click to access at the available list. Enter the text for the
description and then click on to select the unit (Table 5.52).

338

Name

Table 5.48 Battery H input data

Maximum Charge
Nominal Voltage
Maximum Voltage
Initial Charge
Minimum Voltage
Number of Cells per Cell-Row
Number of Cell-Row
Operating Temperature
Mass of a Cell
Speciﬁc Heat Transition
Speciﬁc Heat Capacity
Internal Resistance

Fig. 5.59 Idle voltage charge

5 Hybrid Powertrain Conﬁguration Model and Simulation

Value

6.5
7.2
9.0
65
6
40
1
25
1
0.7
800
0.02

Unit

Ah
V
V
%
V
–
–
°C
kg
W/K
J/kg K
Ω

)

V

(
 
e
g
a
t
l
o
V

8.40

8.20

8.00

7.80

7.60

7.40

7.20

0

20

40

60

80

100

State of Charge (%)

Table 5.49 Idle voltage—charge data

State of Charge (%)

Voltage (V)

State of Charge (%)

Voltage (V)

0
10
20
30
40
50

7.23
7.40
7.51
7.59
7.65
7.69

60
70
80
90
100
–

7.73
7.77
7.81
7.91
8.36
–

5.1 Hybrid Vehicle Model Creation

339

)

V

(
 
e
g
a
t
l
o
V

8.40

8.20

8.00

7.80

7.60

7.40

7.20

0

Fig. 5.61 MATLAB® DLL

20

40

60

80

100

State of Discharge (%)

Fig. 5.60 Idle voltage discharge

Table 5.50 Idle voltage—discharge data

State of Charge (%)

Voltage (V)

State of Charge (%)

Voltage (V)

0
10
20
30
40
50

7.23
7.40
7.51
7.59
7.65
7.69

60
70
80
90
100
–

7.73
7.77
7.81
7.91
8.36
–

340

5 Hybrid Powertrain Conﬁguration Model and Simulation

Table 5.51 Description of Data Bus

Data Bus Channel

Description

Connection

Decouple

Inport 0
Inport 1
Inport 2
Inport 3
Inport 4
Inport 5
Inport 6
Inport 7
Inport 8
Inport 9
Inport 10
Inport 11
Inport 12
Inport 13
Inport 14
Inport 0
Inport 1
Inport 2
Inport 3
Inport 4
Inport 5
Inport 6
Inport 7
Inport 0

Load Signal (Acceleration)
Vehicle Velocity
Battery State of Charge (SOC)
IC Engine Torque
Generator Torque
Generator Speed
Electric Motor Speed
Brake Pressure
Electric Motor Torque
IC Engine Speed
Electric Motor Current
Electric Motor Voltage
Alternator Current
Alternator Voltage
Battery Current
Load Signal (Acceleration)
Vehicle Velocity
Battery State of Charge (SOC)
IC Engine Torque
Generator Torque
Generator Speed
Electric Motor Speed
Brake Pressure
Load Signal (Acceleration)

Unit
–

m/s
As
Nm
Nm
rad/s
rad/s
bar
Nm
rad/s
A
V
A
V
A
–

m/s
As
Nm
Nm
rad/s
rad/s
bar
–

Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional

0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0

Fig. 5.62 Monitor

Table 5.52 Description of
Data Bus

Data Bus Channel

Description

Input 0
Input 1
Input 2
Input 3
Input 4

Vehicle Acceleration
Vehicle Velocity
Vehicle Distance
Engine Load Signal
Engine Speed

Unit
m/s2
km/h
m
–

1/min

5.2 Run Simulation

5.2 Run Simulation

5.2.1 Result Manager

341

To run a simulation for each model, there are ﬁve different options for calculation
[2]:
(cid:129) Single Calculation is a regular calculation with the input data supplied in the
components. Output of result deﬁnes which components result will be written
and available in the Result Manager.

(cid:129) Matrix Calculation is used for multiple calculations and to evaluate the effect of
varying the values of input parameters on vehicle performance, consumption,
and emissions. The results can be viewed for each varied calculation.

(cid:129) Component Variation is used for multiple calculations and the calculation
consists of sub-calculations in which components are replaced by components
of the same type. The results can be viewed in the Result Manager.

(cid:129) System Variation is used for multiple calculations from a list of all the model’s

systems. The results can be viewed similar to Component Variation.

(cid:129) Batch Calculation is used for calculations of series of different projects, either
Single Calculation, Matrix Calculation with DoE option and Component
Variation with DoE option.

To run the calculation in the Desk Area click on Calculation Center or click on
AVL blue button in the upper right corner (Fig. 5.63). Click on to “Start
Calculation” button to run the simulation.

After the simulations are complete click on the Result Manager in the Navigation
Frame (Fig. 5.64) and expand the task of which the results should be viewed. The
selected object is shown in the right section of the window.

Project information can be viewed in the main window by selecting info in the
tree structure or by double clicking info in the right window. The window shows
general information: project name, author, vehicle model, drivetrain model, date
and state (regarding errors), then the tree structure of the folder with deﬁned
Calculation Tasks (different status for run or not run is shown using blue/gray
color). The picture of the Vehicle Model is also displayed.

One output ﬁle is produced for each component in the Vehicle Model and each
Calculation Task. Data for diagrams are extracted from these ﬁles and are shown as
Energy Flow Graphics, presentation diagrams for belonging task and standard
diagrams for used components.

In the tree structure of the Result Manager all deﬁned Calculation Task folders
are shown separately for each task. Those folders with results are shown in color;
tasks which are not run are gray. Files of the each Calculation Task are located
inside the respective folder. In Result Manager, all components are listed where
results have been written in pages mode or data sources mode (Fig. 5.65).

The result output for components is selected with output in the properties
window of the respective component. Select as deﬁned in module for output of

342

5 Hybrid Powertrain Conﬁguration Model and Simulation

 

Fig. 5.63 Start calculation

Fig. 5.64 Result Manager window

5.2 Run Simulation

343

Fig. 5.65 Result Manager pages mode

results in the folder of the corresponding calculation task. There are two types of
result outputs available with the Result Manager: standard diagrams and
presentation diagrams.

Standard diagrams (Fig. 5.66) are created separately for each component and
only contain results of the individual component and represent time histories of the
single components.

They have a predeﬁned representation page, which can only be changed in some
parts. Standard diagrams are opened by selecting the respective calculation task in
the tree structure of Result Manager and then selecting the corresponding
component.

The pages mode sidebar is divided into a list of predeﬁned standard diagram
pages for the respective component and TeimView Assistant with a tree structure of
components with all available curves and the current parameter for current diagram
of respective component with the list of all used curves. TeimView has two mode
tabs: pages and data sources. Pages are used to view results as curves in standard
diagram and data sources in tables as numerical data for the respective component
for analyzing and extracting [2].

The data sources mode sidebar (Fig. 5.67) has a tree structure where the data
source, data ﬁle, and table are shown. In data source view is a list of all curve data
that can be shown.

Energy Flow Graphics feature can be selected in the Result Manager (Fig. 5.68).
An animation shows the ﬂow between the drivetrain components over time of the

344

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.66 Standard diagrams

Fig. 5.67 Result Manager data sources mode

5.2 Run Simulation

345

Fig. 5.68 Energy Flow Graphics

following parameters: Current (A), Energy Stored (kJ), Energy (kJ), Power (kW),
Speed (1/min), Velocity (km/h), Torque (Nm), Force (N), Voltage (V).

The animation can be controlled by appropriate switches (play, pause, stepwise,
stop, repeat, velocity). A time bar, showing the actual simulation time, can be
moved to a certain time step with the mouse.

Below the Energy Flow Graphics a monitor is shown which displays the result
curves of selected components. With a zoom option, the horizontal direction can be
scaled so that long cycles can also be viewed properly.

In addition to the graphical representation, the associated values can also be

displayed in the monitor as well as in the drivetrain ﬂow graphics.

The values of the Energy Flow Graphics can also be displayed in a pie chart.
Clicking the button EFG pie chart opens an area where the segments can be

added or removed with the buttons “+” and “−”.

The association between a segment and a component parameter can be done by
marking the segment in the segment list and then doing a left mouse click on a

346

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.69 EFG pie chart

so-called connector of the component (Fig. 5.69). Several connectors can be chosen
for one segment. In that case, the segment represents the sum of all associated
values. The segment list consists of the absolute segment values as well as of the
values in terms of percentages [2].

The task of the mode trimap is to construct a 3D surface and describe it by
iso-lines. The input data which is data of 3D points is projected into the x-y-surface
and are triangulated (in 2D). The iso-lines are created by an intersection list
(Fig. 5.70).

5.2.2 Standard Diagrams

To evaluate the fuel economy characteristics of the IC Engine motored bus was
running a typical NEDC cycle (Fig. 5.71). The total distance of this cycle is
10.931 m, the total time is 1180 s, idle standing time is 267 s, average speed
including stops is 33.35 km/h, average driving speed excluding stops is 43.10 km/h,
average acceleration is 0.506 m/s2, and maximum acceleration is 1.042 m/s2.

The statistical percentages of IC Engine operating region are found in conden-
sation map and are show in Fig. 5.72. Driving time distribution in consumption map
is show in Fig. 5.73.

The fuel consumption of all engines can be evaluated overall, and at idle speed,
acceleration, constant ad deceleration as shown in Fig. 5.74, the electrical power,
maximum power out and maximum power input are shown in Fig. 5.75 and for the

5.2 Run Simulation

347

Fig. 5.70 Trimap diagram

Fig. 5.71 NEDC typical cycle

hybrid version also the charge, voltage, current, and State of Charge (SOC) are
important to monitor (Fig. 5.76).

During the test cycle, the electrical power and power loss are also monitored
(Fig. 5.77), and in Fig. 5.78 the total output and total input energy variation can be
seen. The clutch and brake travel are shown in Fig. 5.79, and in Fig. 5.80 the brake
pedal travel is correlated to the power of all brakes, also for the braking, in

348

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.72 Statistical percentages of engine operating region

Fig. 5.81, the braking torque and braking power are shown with the vehicle speed.
The raw emissions are shown in Fig. 5.82, while the speed input and output are
shown in Fig. 5.83.

5.2 Run Simulation

349

Fig. 5.73 Driving time distribution in consumption map

Fig. 5.74 All engine fuel consumptions

Rotational acceleration input and output (Fig. 5.84), clutch torque and maximum
torque (Fig. 5.85); acceleration, velocity, and distance (Fig. 5.86), load signal, brake
pressure, and clutch release (Fig. 5.87); operation control and speed (Fig. 5.88);
desired gear and current gear (Fig. 5.89) are all automatically generated graphs.

350

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.75 Electrical power, maximum power output, and maximum power input evaluation

Fig. 5.76 Charge, voltage, current, and State of Charge (SOC) monitoring

The real time, current gear, and velocity are shown in Fig. 5.90; speed input and
output in Fig. 5.91, torque input, output, and loss in Fig. 5.92, torque loss and
efﬁciency in Fig. 5.93, desired transmission ratio and transmission ratio in Fig. 5.94,
input and output speeds in Fig. 5.95, torque inputs and outputs in Fig. 5.96, torque,

5.2 Run Simulation

351

Fig. 5.77 Electrical power and power loss

Fig. 5.78 Total output and total input energy variation

speed, and mechanical power in Fig. 5.97, load signal, desired torque, and start
switch in Fig. 5.98.

From the electric motor, the voltage and current (Fig. 5.99) can be extracted, but
also: status overvoltage, operating mode, and operation control (Fig. 5.100), speed

352

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.79 Clutch and brake travel

Fig. 5.80 Brake pedal travel and power of all brakes

and rotational acceleration (Fig. 5.101), torque, maximum torque generator, and
maximum torque motor (Fig. 5.102), efﬁciency, electrical power, and power loss
(Fig. 5.103), total input and output energy (Fig. 5.104), engine torque, power, and
speed (Fig. 5.105), engine torque and mean effective pressure (Fig. 5.106), engine

5.2 Run Simulation

353

Fig. 5.81 Braking torque, braking power, and speed

Fig. 5.82 Raw NOx, CO, HC, and Soot emissions

activation, mean effective pressure, and fuel consumption (Fig. 5.107), engine
temperature and load signal (Fig. 5.108), HC, NOx, CO, and Soot emissions
(Fig. 5.109), engine rotational acceleration (Fig. 5.110), cold start factor and fuel
consumption (Fig. 5.111), power correction factor and engine torque (Fig. 5.112),
load signal, operator control and start switch (Fig. 5.113).

354

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.83 Speed input and output

Fig. 5.84 Rotational acceleration input and output

For all inputs and outputs, a speciﬁc graph can be made: brake pressure—
cockpit (Fig. 5.114), brake pressure—EMS (Fig. 5.115), brake pressure—output
(Fig. 5.116), load signal—cockpit (Fig. 5.117), load signal—EMS (Fig. 5.118),
load signal—output (Fig. 5.119), torque—input (Fig. 5.120), torque behind ﬂy-
wheel (Fig. 5.121), velocity (Fig. 5.122), battery charge (Fig. 5.123).

5.2 Run Simulation

355

Fig. 5.85 Clutch torque and maximum torque

Fig. 5.86 Acceleration, velocity, and distance

Further inputs and outputs can generate the following graphs: current trans-
mission ratio (Fig. 5.124), actual clutch release (Fig. 5.125), current—input
load signal—output
(Fig. 5.126),
(Fig. 5.128), vehicle distance—input (Fig. 5.129), engine load signal—input
(Fig. 5.130), speed input and output (Fig. 5.131), efﬁciency and torque loss

load signal—EMS—output

(Fig. 5.127),

356

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.87 Load signal, brake pressure, and clutch release

Fig. 5.88 Operation control and speed

loads front

(Fig. 5.132), air resistance force, resistance force, and traction force (Fig. 5.133),
(Fig. 5.135), axle loads
wheel
(Fig. 5.136), speed and rotational acceleration (Fig. 5.137), friction coefﬁcient and
friction coefﬁcient exploit (Fig. 5.138), longitudinal force and slip (Fig. 5.139),

(Fig. 5.134), wheel

loads rear

5.2 Run Simulation

357

Fig. 5.89 Desired gear and current gear

Fig. 5.90 The real time, current gear, and velocity

clutch pedal travel and acceleration pedal travel (Fig. 5.140), brake pedal travel and
acceleration pedal travel (Fig. 5.141), distance, velocity, and acceleration of the
vehicle (Fig. 5.142), electrical consumption and fuel consumption (Fig. 5.143), load
signal and vehicle acceleration (Fig. 5.144).

358

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.91 Speed input and output

Fig. 5.92 Torque input, output, and loss

5.2 Run Simulation

359

Fig. 5.93 Torque loss and efﬁciency

Fig. 5.94 Desired transmission ratio and transmission ratio

360

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.95 Input and output speeds

Fig. 5.96 Torque inputs and outputs

5.2 Run Simulation

361

Fig. 5.97 Torque, speed, and mechanical power

Fig. 5.98 Load signal, desired torque, and start switch

362

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.99 Motor voltage and current

Fig. 5.100 Status overvoltage, operating mode, and operation control

5.2 Run Simulation

363

Fig. 5.101 Speed and rotational acceleration

Fig. 5.102 Torque, maximum torque generator, and maximum torque motor

364

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.103 Efﬁciency, electrical power, and power loss

Fig. 5.104 Total input and output energy

5.2 Run Simulation

365

Fig. 5.105 Engine torque, power, and speed

Fig. 5.106 Engine torque and mean effective pressure

366

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.107 Engine activation, mean effective pressure, and fuel consumption

Fig. 5.108 Engine temperature and load signal

5.2 Run Simulation

367

Fig. 5.109 HC, NOx, CO, and Soot emissions

Fig. 5.110 Engine rotational acceleration

368

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.111 Cold start factor and fuel consumption

Fig. 5.112 Power correction factor and engine torque

5.2 Run Simulation

369

Fig. 5.113 Load signal, operator control, and start switch

Fig. 5.114 Brake pressure–cockpit

370

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.115 Brake pressure–EMS

Fig. 5.116 Brake pressure––output

5.2 Run Simulation

371

Fig. 5.117 Load signal–cockpit

Fig. 5.118 Load signal–EMS

372

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.119 Load signal––output

Fig. 5.120 Torque––input

5.2 Run Simulation

373

Fig. 5.121 Torque behind ﬂywheel

Fig. 5.122 Velocity

374

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.123 Battery charge

Fig. 5.124 Current transmission ratio

5.2 Run Simulation

375

Fig. 5.125 Actual clutch release

Fig. 5.126 Current—input

376

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.127 Load signal–EMS––output

Fig. 5.128 Load signal––output

5.2 Run Simulation

377

Fig. 5.129 Vehicle distance––input

Fig. 5.130 Engine load signal––input

378

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.131 Speed input and output

Fig. 5.132 Efﬁciency and torque loss

5.2 Run Simulation

379

Fig. 5.133 Air resistance force, resistance force, and traction force

Fig. 5.134 Wheel loads front

380

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.135 Wheel loads rear

Fig. 5.136 Axle loads

5.2 Run Simulation

381

Fig. 5.137 Speed and rotational acceleration

Fig. 5.138 Friction coefﬁcient and friction coefﬁcient exploit

382

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.139 Longitudinal force and slip

Fig. 5.140 Clutch pedal travel and acceleration pedal travel

5.2 Run Simulation

383

Fig. 5.141 Brake pedal travel and acceleration pedal travel

Fig. 5.142 Distance, velocity, and acceleration of the vehicle

384

5 Hybrid Powertrain Conﬁguration Model and Simulation

Fig. 5.143 Electrical consumption and fuel consumption

Fig. 5.144 Load signal and vehicle acceleration

References

References

Edition 06.2011

Edition 06.2011

1. AVL Cruise (2011) Primer. AVL List GmbH, Graz, Austria, Document no. 04.0103.2011,

2. AVL Cruise (2011) Users guide. AVL List GmbH, Graz, Austria, Document no. 04.0104.2011,

3. AVL Cruise (2011) Gear shifting program (GSP). AVL List GmbH, Graz, Austria, Document

no. 04.0114.2011, Edition 06.2011

385

Chapter 6
Electric Powertrain Conﬁguration Model
and Simulation

6.1 Electric Vehicle Model Creation

6.1.1 Electric FWD Model

This chapter describes how to create and run the model of an electric front-wheel
drive. To place a component in the working area, click on the component group
with the left mouse button, move the mouse over the required component, and then
click and drag the component into the Vehicle Model area. The components must
be arranged as shown in the following ﬁgure (Fig. 6.1) and connected as speciﬁed
in the diagram. All the connections in the Data Bus for this model are described in
Table 6.1 [2].

Place the following components in the working area: Vehicle (1), Final Drive
(2), Vehicle Rear Left (3), Vehicle Front Left (4), Vehicle Rear Right (5), Vehicle
Front Right (6), Rear Disk Brake (7), Front Disk Brake (8), Rear Disk Brake (9),
Front Disk Brake (10), E-Machine (11), Differential (12), Cockpit (13), ASC (14),
Electrical Consumer (15), Battery H (16), E-Drive Function (17), E-Brake &
M-Brake Function (18), Monitor (19), and Constants (20).

The Vehicle (1) is the main object in a model. This component contains general
data of the vehicle, such as nominal dimensions and weights. The aerodynamic,
rolling, climbing, acceleration, and total resistance are calculated [1].

To deﬁne component input data (Table 6.2), double click on the icon or click on

it by using the right mouse button and select edit (Fig. 6.2).

In the properties window the parameters which have inﬂuence on the needed

component data input for calculation are selected (Fig. 6.3).

Final Drive or Single Ratio Transmission (2) is a gear step with ﬁxed ratio
(Fig. 6.4). It can be used as a transmission step of the differential. To deﬁne
component input data, double click on the ﬁnal drive icon and enter the following
data (Table 6.3).

© Springer International Publishing Switzerland 2015
B.O. Varga et al., Electric and Plug-In Hybrid Vehicles,
Green Energy and Technology, DOI 10.1007/978-3-319-18639-9_6

387

388

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.1 Complete electric FWD model

The Wheel component considers many inﬂuencing variables and their effect on

the rolling state (Fig. 6.5). The wheels and tires link the vehicle to the road.

Information data for the four wheels is the same (Vehicle Rear Left (3), Vehicle
Front Left (4), Vehicle Rear Right (5), and Vehicle Front Left (6)). Double click on
the wheel and enter the following data (Table 6.4) [2].

The Brake component is described by brake data and dimensions (Fig. 6.6).
Input data for the two front brakes are the same and also the data for the two rear
brakes are the same (Rear Disk Brake Left (7), Front Disk Brake Left (8), Rear Disk
Brake Right (9), and Front Disk Brake Right (10)). Double click on the brake icon
and enter the following data (Table 6.5).

The E-Machine (11) component can be used either as an electric motor or as a
generator. There are separate characteristic maps for each mode. Together with the
battery H, the user can simulate an electric system. For this model, a characteristic
map for the efﬁciency is used to calculate the loss of power [1]. Double click on the
e-machine icon and enter the following data (Table 6.6 and Fig. 6.7).

The value of the voltage level has been measured and should be entered in the
following characteristic maps of the machine. For each level, the corresponding
voltage value must be deﬁned and the corresponding characteristic maps (voltage
for U1 = 100 V, voltage for U1 = 320 V). The maximum mechanical (power)
torque (Table 6.7 and Fig. 6.8) is deﬁned as a function of the machines speed (a—
speed (1/min), b—torque (Nm)) [2]. Efﬁciency map is dependent on speed and
power (or torque) and is shown in Table 6.8 and Fig. 6.9.

The Differential (12) is a particular type of simple planetary gear train that has
the property that the angular velocity of its carrier is the average of the angular

6.1 Electric Vehicle Model Creation

389

Table 6.1 Data Bus connections

ASC

Component requires

Input information

Component delivering Output information

Wheel Front Right

Cockpit
Cockpit
Wheel Front Right

Clutch Release
Load Signal
Slip Signal Front Left
Slip Signal Front Right Wheel Front Left
Slip Signal Rear Left
Slip Signal Rear Right Wheel Front Left
Ambient Temperature
Temperature External
Brake Pressure
Brake Pressure
Brake Pressure
Brake Pressure
Gear Indicator
Operation Control 0
Speed
Ambient Temperature
Load Signal
Temperature External
Set Value X
Vehicle Velocity
Vehicle Acceleration
Load Signal
Brake Pressure
Maxim Brake Pressure
Bremsfactor
eDrive_Torque
iFD
iTR
Brake_Factor_Front
Brake_Factor_Rear
Brake_Pressure_Driver
LoadSignal_Cockpit
Velocity
Torque eDrive

Cockpit
Cockpit
E-Brake & M-Brake
E-Brake & M-Brake
E-Brake & M-Brake
E-Brake & M-Brake
E-Machine
E-Machine
E-Machine
Cockpit
E-Drive
Cockpit
Battery H
Cockpit
Cockpit
Cockpit
Cockpit
Constants
Constants
E-Machine
Constants
Constants
Constants
Constants
Cockpit
Cockpit
Cockpit
E-Machine

Course Ambient
Load Signal
Slip Signal
Slip Signal
Slip Signal
Slip Signal
Course Ambient
Course Ambient
BRK_dp_Recup
BRK_dp_Recup
BRK_dp_Recup
BRK_dp_Recup
Operating Mode
Operation Control
Speed
Course Ambient
Mod Load Signal
Course Ambient
Net Voltage
Velocity
Acceleration
Load Signal
Brake Pressure
Maxim Brake Pressure
Brake Factor
Torque
iFD
iTR
Brake_Factor_Front
Brake_Factor_Rear
Brake Pressure
Load Signal
Velocity
Torque

Battery H

Brake Rear Disk
Brake Front Disk
Brake Rear Disk
Brake Front Disk
Cockpit

E-Machine

Electric Consumer
Function E-Drive

E-Brake M-Brake

Monitor

velocities of its sun and annular gears (Fig. 6.10). To deﬁne component input data,
double click on the differential icon and enter the following data (Table 6.9).

The Kinematic Chain Browser can be launched in the pop-up menu of a selected
component. All mechanical connections starting from the selected component are
shown in a tree-structure in the left side of the window (Fig. 6.11).

390

6 Electric Powertrain Conﬁguration Model and Simulation

Table 6.2 Vehicle
component input data

Name

Distance from Hitch to Front Axle
Height of Support Point at Bench Test
Wheel Base
Distance of Gravity Center empty
Distance of Gravity Center half
Distance of Gravity Center full
Height of Gravity Center empty
Height of Gravity Center half
Height of Gravity Center full
Height of Hitch empty
Height of Hitch half
Height of Hitch full
Tire Pressure Front/Rear Axle
Curb/Gross Weight
Frontal Area

Value

Unit

2400
500
2400
1200
1180
1160
500
490
480
500
490
480

2.40/2.20
1200/1500
2.00

mm
mm
mm
mm
mm
mm
mm
mm
mm
mm
mm
mm
bar
kg
m2

Fig. 6.2 Vehicle input data speciﬁcations window

The Cockpit (13) links the driver and the vehicle. The pedal positions are
transferred into corresponding indicators via the pedal characteristics (Table 6.10).
In this component, connections are only made via the Data Bus (Fig. 6.12).
To deﬁne the input data, click on the acceleration pedal characteristic
(a—acceleration pedal travel (%), b—load signal (%)), clutch pedal characteristic

6.1 Electric Vehicle Model Creation

391

Fig. 6.3 Properties of Vehicle

Fig. 6.4 Final Drive input data speciﬁcations window

Table 6.3 Final Drive input
data

Name

Transmission Ratio
Inertia Moment In
Inertia Moment Out
Efﬁciency

Value

6.000
0.015
0.015
0.950

Unit
–
kg m2
kg m2
–

(a—clutch pedal travel (%), b—clutch release (%)) and brake pedal characteristic
(a—speciﬁc brake pedal force (%), b—brake pressure (bar)) tabs and enter the
following data for all (Fig. 6.13) [2].

The ASC Anti-Slip Control (14) checks the force transmission factor of all
connected wheels (Fig. 6.14). The Anti-Slip Control is only active when a model is

392

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.5 Wheel input data speciﬁcations window

Table 6.4 Wheels input data Name

Wheel Inertia Moment
Friction Coefﬁcient of Tire
Reference Wheel Load
Wheel Load Correction Coefﬁcient
Static Rolling Radius
Circumference
Dynamic Rolling Radius
Circumference

Value

0.150
1.000

3200.0

0.000

300.0
1884.96
310.0
1947.79

Unit
kg m2
–

N
–

mm
mm
mm
mm

Fig. 6.6 Brake input data speciﬁcations window

6.1 Electric Vehicle Model Creation

393

Table 6.5 Brakes input data

Name

Brake
Piston Surface
Speciﬁc Factor
Efﬁciency
Inertia Moment
Friction Coefﬁcient
Friction Radius

Value

Front Right
1800.0

Value

Rear Right
1500.0

Value

Front Left
1800.0

Value

Rear Left
1500.0

1.000
0.990
0.015
0.250

1.000
0.990
0.015
0.250

1.000
0.990
0.015
0.250

1.000
0.990
0.015
0.250

120.0

100.0

120.0

100.0

Unit
–
mm2
–
–
kg m2
–

mm

Table 6.6 E-Machine input
data

Name

Type of Machine
Characteristic Maps and Curves
Nominal Voltage
Inertia Moment
Maximum Speed
Drag Torque at Maximum Speed
Initial Temperature
U1 Voltage
U2 Voltage

Value

ASM
Overall
320.0
1.0e−4
10000
0.000
20.00
100.0
320.0

Unit
–
–

V
kg m2
1/min
Nm
°C
V
V

Fig. 6.7 E-Machine input data speciﬁcations window

394

6 Electric Powertrain Conﬁguration Model and Simulation

Table 6.7 Maximum
mechanical torque data

Speed (1/min) Torque (Nm) Speed (1/min) Torque (Nm)

0
500
1000
1500
2000
2500
3000
3500
4000
4500
5000
5500
6000
6500

240
240
240
240
240
240
240
205
180
160
140
130
120
110

7000
7500
0
750
1500
2250
3000
3750
4500
5250
6000
6750
7500
–

105
95
−229
−229
−236
−238
−239
−191
−159
−136
−119
−106
−95

–

)

m
N

(
 
e
u
q
r
o
T

250

200

150

100

50

0

-50

-100

-150

-200

-250

0

1500

3000

4500

6000

7500

Speed (1/min)

Fig. 6.8 Maximum mechanical torque

calculated quasi-stationary in combination with special drivetrain conﬁgurations
and does not require data entry [1].

The Electrical Consumer (15) is represented as an ohmic resistor in the onboard
network (Fig. 6.15). They represent an electric current loss. The number of resistors
that can be deﬁned is user dependent [1].

The resistors parameter can be ﬁxed by a constant value or by means of charac-
teristic curves. It is possible to deﬁne resistors as a function of any external input value.
Double click on the electrical consumer icon and enter the data (Table 6.11). The
electrical consumer can be described as resistance depending on input value a—
voltage (V) and b—resistance (Ω) in resistance table (Fig. 6.16 and Table 6.12).

6.1 Electric Vehicle Model Creation

395

Table 6.8 Efﬁciency map data

(a)
500

1000

1500

2000

2500

3000

3500

4500

5500

6000

6500

7000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65

25
76
25
82
25
82
25
82
25
82
25
82
25
82
25
80
25
80
25
80
25
82
25
82

50
76
50
82
50
86
50
87
50
87
50
88
50
88
50
88
50
88
50
88
50
87
50
86

75
75
75
83
75
86
75
88
75
89
75
91
75
91
75
91
75
91
75
91
75
90
75
89

100
75
100
83
100
86
100
89
100
90
100
91
100
91
100
91
100
91
100
91
100
91
100
91

125
73
125
83
125
86
125
89
125
90
125
91
125
91
125
92
125
93
−95
93
−95
93
−95
93

–
–

150
81
150
86
150
88
150
91
150
91
150
92
150
93
–
–
−80
93
−80
93
−80
91

–
–

175
80
175
85
175
88
175
90
175
91
175
92
175
93
–
–
−65
92
−65
91
−65
89

–
–

200
79
200
84
200
87
200
89
200
90
200
91
200
93
–
–
−45
91
−45
88
−45
86

–
–

225
77
225
83
225
86
225
88
225
90
225
91
225
93
–
–
−35
86
−35
82
−35
80

–
–

240
76
240
82
240
85
240
88
240
90
240
91
240
93
–
–
−15
75
−15
73
−15
69

The Battery H (16) component is used for simulating of electrical vehicles
(Fig. 6.17). Double click on the battery H icon and enter the input data (Table 6.13).
The idle voltage—charge (b) is the idle voltage of one cell in charge mode.
When there is no electrical consumer; it is a function of the State of Charge SOC
(a) (Fig. 6.18 and Table 6.14). The idle voltage—discharge (b) of one cell is the
voltage without an electrical consumer, there is no ﬂow of current, and it is a
function of the SOC (a) (Fig. 6.19 and Table 6.15) [1].

E-Drive (17) component is a function that can be used to calculate the transition

from the electrical machine driving to electrical machine braking (Fig. 6.20).

To deﬁne component input data double click on the C code icon and enter the
following data for function (Fig. 6.21), and for description of Data Bus (Table 6.16)
[1].

E-Brake & M-Brake (18) component

is a function that can be used for

calculating the converting brake torque into pressure for all brakes (Fig. 6.21).

396

6 Electric Powertrain Conﬁguration Model and Simulation

)

m
N

(
 
y
c
n
e
i
c
i
f
f

E

95

90

85

80

75

70

65

60

-240 -200 -160 -120 -80 -40

80 120 160 200 240

40
0
Torque (Nm)

Fig. 6.9 Efﬁciency map

Engine
Speed
(1/min)
500
1000
1500
2000
2250
2500
3000
3500
3750
4000
4500
5000
5250
5500
6000
6500
6750
7000
7500

Fig. 6.10 Differential input data speciﬁcations window

To deﬁne component input data, double click on the C code icon and enter the
following data for function (Fig. 6.22), and for description of Data Bus (Table 6.17)
[1] (Fig. 6.23).

The Monitor component (19) can be introduced, if the calculation run must be
detected (Fig. 6.24). Click on the description of Data Bus tab and open the

6.1 Electric Vehicle Model Creation

397

Table 6.9 Differential input
data

Name

Differential Lock
Torque Split Factor
Inertia Moment In
Inertia Moment Out1
Inertia Moment Out2

Value

Unlocked
1.000
0.015
0.015
0.015

Unit
–
–
kg m2
kg m2
kg m2

Fig. 6.11 Kinematic Chain Browser

Table 6.10 Cockpit input
data

Name

Shift Mode
Number of Gears Forward
Number of Gears Back
Maximum Brake Force
Brake Light Switch Threshold
Number of Retarder Steps

Value

Manual
1.000
1.000

100.0

1.000
0.000

Unit
–
–
–

N
%
–

following dialog. To select a Data Bus channel, click to access at the available list.
Enter the text for the description and then click on to select the unit (Table 6.18).
Constants (20) component enables the user to deﬁne up to 99 constant values
which can be used by other components through the Data Bus. The values can be of
type integer, double or string (Table 6.19) [1].

6.1.2 Electric FWD RE Model

This chapter describes how to create and run the model of an electric front wheel
drive with range extender. To place a component in the working area, click on the

398

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.12 Cockpit input data speciﬁcations window

)

%

(
 
l
a
n
g
i
S
d
a
o
L

 

100
90
80
70
60
50
40
30
20
10
0

0

20

40

60

80

100

Acceleration Pedal Travel (%)

Fig. 6.13 Pedal characteristic

component group with the left mouse button, move the mouse over the required
component and then click and drag the component into the vehicle model area. Put
the component with release of the mouse button on the desired place.

Place the following components in the working area: Vehicle (1), IC Engine (2),
Final Drive (3), Vehicle Rear Left (4), Vehicle Front Left (5), Vehicle Rear Right
(6), Vehicle Front Right (7), Rear Disk Brake (8), Front Disk Brake (9), Rear Disk
Brake (10), Front Disk Brake (11), E-Machine (12), Generator (13), Differential
(14), Cockpit (15), ASC (16), Electrical Consumer (17), Battery H (18), E-Drive
Function (19), E-Brake & M-Brake Function (20), Range Extender Function (21),
Monitor (22), PID Control (23), and Constants (24).

6.1 Electric Vehicle Model Creation

399

Fig. 6.14 ASC Anti-Slip Control input data speciﬁcations window

Fig. 6.15 Electrical Consumer input data speciﬁcations window

Table 6.11 Electrical
Consumer input data

Name

Nominal Voltage
Direction
Exceeding Value Range
Threshold Value
Reference

Value

320.0
Positive
Admissible
0.500
Absolute

Unit

V
–
–
–
–

Arrange the components as shown in the following ﬁgure (Fig. 6.25) and con-
nect the components as speciﬁed in the diagram [2]. All the connections in the data
bus for this model are described in Table 6.20.

The Vehicle (1) contains general data of the vehicle (Fig. 6.26), such as nominal

dimensions and weights (Table 6.21).

IC Engine (2) component contains a model for an internal combustion engine.
To deﬁne component input data (Table 6.22), double click on the icon or click on it
with the right mouse button and select edit
to open the following window
(Fig. 6.27) [1].

400

6 Electric Powertrain Conﬁguration Model and Simulation

)

(

e
c
n
a
t
s
i
s
e
R

600

550

500

450

400

350

300

250

200

150

Fig. 6.16 Resistance Table

Table 6.12 Resistance Table
data

220

270

370

420

320
Voltage (V)

Voltage (V) Resistance (Ω) Speed (1/min) Torque (Nm)
220
240
260
280
300
320

160
190
225
260
300
340

385
430
480
530
590
–

340
360
380
400
420
–

Fig. 6.17 Battery H input data speciﬁcations window

6.1 Electric Vehicle Model Creation

401

Table 6.13 Battery H input
data

Name

Maximum Charge
Nominal Voltage
Maximum Voltage
Initial Charge
Minimum Voltage
Number of Cells per Cell-Row
Number of Cell-Row
Operating Temperature
Internal Resistance

Value

10.00

320.0
420.0

95.00

220.0

1.000
5.000

25.00

0.800

Unit

Ah
V
V
%
V
–
–
°C
Ω

)

V

(
 
e
g
a
t
l
o
V

350

345

340

335

330

325

320

315

310

20

40

60

80

100

State of Charge (%)

Fig. 6.18 Idle voltage charge

Table 6.14 Idle voltage—charge data

State of Charge (%)

Voltage (V)

State of Charge (%)

Voltage (V)

20
30
40
50
60

310
315
320
325
330

70
80
90
100
–

335
340
345
350
–

The properties window is accessed through properties button in the input data

window, or from the pop up menu (Fig. 6.28).

To load engine characteristic click on the Full Load Characteristic tab (Fig. 6.29

and Table 6.23).

The Motoring Curve (Fig. 6.30) will be deﬁned similar to the Full Load

Characteristic either as power dependent on the engine speeds [2].

402

6 Electric Powertrain Conﬁguration Model and Simulation

)

V

(
 
e
g
a
t
l
o
V

350

345

340

335

330

325

320

315

310

20

40

60

80

100

State of Charge (%)

Fig. 6.19 Idle voltage discharge

Table 6.15 Idle voltage—discharge data

State of Charge (%)

Voltage (V)

State of Charge (%)

Voltage (V)

20
30
40
50
60

310
315
320
325
330

70
80
90
100
–

335
340
345
350
–

Fig. 6.20 E-Drive input data speciﬁcations window

In the Fuel Consumption Map (Fig. 6.31 and Table 6.24), the actual fuel con-
sumption for stationary operation is listed depending on the brake mean pressure
with the engine speed as parameter (a—speed (1/min), b—BMEP (bar), c—volume

6.1 Electric Vehicle Model Creation

403

Fig. 6.21 C code function

Table 6.16 Description of Data Bus

Data Bus Channel

Description

Connection

Decouple

a[0]
a[1]
a[2]
a[3]
a[4]
a[5]
a[6]
y[0]

Vehicle Velocity
Vehicle Acceleration
Load Signal
Brake Pressure
Maximum Brake Pressure
Brems factor
a[6]
Mod Load Signal

Unit

km/h
m/s2
–

bar
bar
–
–
–

Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional

0
0
0
0
0
0
0
0

ﬂow (l/h)). In the emission maps, the emissions for the different exhaust gases are
listed dependent on the mean pressure with the engine speed as parameter (NOx
emission map—Fig. 6.32 and Table 6.25, CO emission map—Fig. 6.33 and
Table 6.26, HC emission map—Fig. 6.34 and Table 6.27) [2].

Final Drive (3) or Single Ratio Transmission is a gear step with ﬁxed ratio
(Fig. 6.35). To deﬁne component input data, double click on the ﬁnal drive icon
(Table 6.28).

The Wheel component considers many inﬂuencing variables and their effect on
the rolling state (Fig. 6.36). Information data for the four wheels is the same
(Vehicle Rear Left (4), Vehicle Front Left (5), Vehicle Rear Right (6), and Vehicle
Front Left (7)) [2].

Double click on the wheel and enter the following data (Table 6.29).

404

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.22 E-Drive input data speciﬁcations window

Table 6.17 Description of Data Bus

Data Bus Channel

Description

Unit

Connection

Decouple

a[0]
a[1]
a[2]
a[3]
a[4]
a[5]
y[0]

eDrive_Torque
iFD (Ratio of Final Drive)
iTR (Ratio of Final Transmission)
Brake_Factor_Front
Brake_Factor_Rear
Brake Pressure_Driver
BRK_dp_Recup

Nm
–
–
–
–

Pa
Pa

Optional
Optional
Optional
Optional
Optional
Optional
Optional

0
0
0
0
0
0
0

The Brake component is described by brake data and dimensions (Fig. 6.37).
Input data for the two front brakes is the same and also the data for the two rear
brakes is the same (Rear Disk Brake Left (8), Front Disk Brake Left (9), Rear Disk
Brake Right (10), and Front Disk Brake Right (11)).

Double click on the brake icon and enter the following data (Table 6.30).
Electric Machine (12) together with the battery H the user can simulate an
electric system. For this type of model, a characteristic map for the efﬁciency is
used to calculate the loss of power [1]. Double click on the electric machine icon
and enter the following data (Fig. 6.38 and Table 6.31).

The value of the voltage level should be entered at which the following char-
acteristic maps of the machine have been measured. For each level, the corre-
sponding voltage value must be deﬁned and the corresponding characteristic maps
(voltage for U1 = 100 V, voltage for U1 = 320 V).

The maximum mechanical (power) torque (Fig. 6.39 and Table 6.32) is deﬁned
as a function of the machines speed (a—speed (1/min), b—torque (Nm)) [2].
Efﬁciency map is deﬁned dependent on speed and power (or torque) and is shown
in Fig. 6.40 and Table 6.33.

6.1 Electric Vehicle Model Creation

405

Fig. 6.23 C code function

Fig. 6.24 Monitor

Table 6.18 Description of
Data Bus

Data Bus Channel

Description

Input 0
Input 1
Input 2

LoadSignal_Cockpit
Velocity
Torque_eDrive

Unit
–

km/h
Nm

406

6 Electric Powertrain Conﬁguration Model and Simulation

Table 6.19 Description of Data Bus

Data Bus Channel

Description

Constant 0
Constant 1
Constant 2
Constant 3
Constant 4
Constant 5

Brake_Factor_Front
Brake_Factor_Rear
iFD (Ratio of Final Drive)
iTR (Ratio of Final Transmission)
Maximum Brake Pressure
Brake Factor

Value

0.00012
0.00008
3.650
1.000

50.00

1.000

Unit
–
–
–
–

bar
–

Data Type

Double
Double
Double
Double
Double
Double

Fig. 6.25 Complete model electric FWD RE

The Generator (13) must supply the vehicles electrical system with a sufﬁcient
current under all operating conditions in order to ensure that the State of Charge in
the engine storage device is consistently maintained at an adequate level [1].
Double click on the generator icon and enter the following data (Fig. 6.41).

The maximum mechanical (power) torque (Fig. 6.42 and Table 6.34) is deﬁned
as a function of the machines speed (a—speed (1/min), b—torque (Nm)) [2]. The
efﬁciency map (Fig. 6.43 and Table 6.35) is deﬁned dependent on a—speed
(1/min), b—power (kW) and efﬁciency (%).

Differential (14) unit compensates for discrepancies in the respective rotation
rates of the drive wheels (Fig. 6.44). To deﬁne component input data, double click
on the differential icon and enter the following data (Table 6.36).

The Kinematic Chain Browser can be launched in the pop-up menu of a selected
component. All mechanical connections starting from the selected component are
shown in a tree-structure in the left side of the window (Fig. 6.45) [1].

6.1 Electric Vehicle Model Creation

407

Table 6.20 Data Bus connection

Component
requires

ASC

Input information

Output information

Component
delivering

Battery H

Brake Rear Disk
Brake Front Disk
Brake Rear Disk
Brake Front Disk
Cockpit

E-Machine

Generator

Electric Consumer
IC Engine

Function E-Drive

E-Brake M-Brake

Cockpit
Cockpit

Cockpit
Cockpit

E-Brake & M-Brake
E-Brake & M-Brake
E-Brake & M-Brake
E-Brake & M-Brake
E-Machine
E-Machine
E-Machine
Cockpit
E-Drive
Cockpit

Clutch Release
Load Signal
Slip Signal Front Left Wheel Front Right
Slip Signal Front Right Wheel Front Left
Slip Signal Rear Left Wheel Front Right
Slip Signal Rear Right Wheel Front Left
Ambient Temperature
Temperature
External
Brake Pressure
Brake Pressure
Brake Pressure
Brake Pressure
Gear Indicator
Operation Control 0
Speed
Ambient Temperature
Load Signal
Temperature
External
Load Signal
Switch
Temperature
External
Set Value X
Load Signal
Start Switch
Vehicle Velocity
Vehicle Acceleration
Load Signal
Brake Pressure
Maxim Brake Pressure Constants

Battery H
Range Extender
Range Extender
Cockpit
Cockpit
Cockpit
Cockpit

Range Extender
Range Extender
Cockpit

Bremsfactor
eDrive_Torque
iFD
iTR
Brake_Factor_Front
Brake_Factor_Rear
Brake_Pressure_Driver Cockpit

Constants
E-Machine
Constants
Constants
Constants
Constants

Clutch Release
Load Signal
Slip Signal
Slip Signal
Slip Signal
Slip Signal
Course Ambient
Course Ambient

BRK_dp_Recup
BRK_dp_Recup
BRK_dp_Recup
BRK_dp_Recup
Operating Mode
Operation Control
Speed
Course Ambient
Mod Load Signal
Course Ambient

Load_Signal_Gen
Start_Switch_Gen
Course Ambient

Net Voltage
Load_Signal_Engine
Start_Switch_Engine
Velocity
Acceleration
Load Signal
Brake Pressure
Maxim Brake
Pressure
Brake Factor
Torque
iFD
iTR
Brake_Factor_Front
Brake_Factor_Rear
Brake Pressure

(continued)

408

6 Electric Powertrain Conﬁguration Model and Simulation

Table 6.20 (continued)

Component
requires

Range Extender

Monitor

PID Control

Input information

Output information

SOC_Act
SOC_Min
SOC_Max
Start_Switch_CP
Engine_Speed
Load_Signal_Engine
Desired_Engine
LoadSignal_Cockpit
Velocity
Torque eDrive
SOC
Engine_Speed
Actual Value
Desired Value

Component
delivering

Battery H
Constants
Constants
Cockpit
IC Engine
PID Control
Speed_Constants
Cockpit
Cockpit
E-Machine
Battery H
IC Engine
IC Engine
Constants

State of Charge
SOC_Min
SOC_Max
Start Switch
Engine Speed
Output Value
Desired Engine
Load Signal
Velocity
Torque
Start of Charge
Engine Speed
Engine Speed
Desired Engine Speed

Fig. 6.26 Vehicle input data speciﬁcations window

6.1 Electric Vehicle Model Creation

409

Table 6.21 Vehicle component input data

Name

Distance from Hitch to Front Axle
Height of Support Point at Bench Test
Wheel Base
Distance of Gravity Center empty/half/full
Height of Gravity Center empty/half/full
Height of Hitch empty/half/full
Tire Inﬂation Pressure Front Axle
Tire Inﬂation Pressure Rear Axle
Curb Weight
Constant Part Resistance Function
Square Part Resistance Function
Gross Weight
Frontal Area

Table 6.22 IC Engine
component input data

Name

2400.0
1200.0/1150.0/1100.0
500.0/490.0/480.0
500.0/490.0/480.0

Value

2400.0

500.00

2.200
2.400

1200.0
143.0

0.034

1600.0

2.000

Unit

mm
mm
mm
mm
mm
mm
bar
bar
kg
N
N/(km/h)2
kg
m2

Engine Displacement
Engine Working Temperature
Number of Cylinders
Number of Strokes
Idle Speed
Maximum Speed
Inertia Moment
Response Time
Engine Type
Heating Value for Gasoline
Fuel Density

Value

2000.0
90.00

4.000
4.000

800.0
6000.0

0.150
0.100

Gasoline
44200.0

0.760

Unit
cm3
°C
–
–

1/min
1/min
kg m2
s
–

kJ/kg
kg/l

The Cockpit (15) links the driver and the vehicle. In this component, connec-
tions are only made via the Data Bus (Fig. 6.46). The pedal positions are transferred
into corresponding indicators via the pedal characteristics (Table 6.37).

To deﬁne the input data, click on the acceleration pedal characteristic (a—
acceleration pedal travel (%), b—load signal (%)), clutch pedal characteristic (a—
clutch pedal travel (%), b—clutch release (%)), and brake pedal characteristic (a—
speciﬁc brake pedal force (%), b—brake pressure (bar)) tabs and enter the following
data for all (Fig. 6.47) [2].

The ASC Anti-Slip Control (16) checks the force transmission factor of all
connected wheels (Fig. 6.48). The Anti-Slip Control is only active when a model is
calculated quasi-stationary in combination with special drivetrain conﬁgurations
and does not require data entry.

410

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.27 IC Engine input data speciﬁcations window

Fig. 6.28 Properties of IC Engine

The Electrical Consumer (17) is represented as ohmic resistors in the onboard
network (Fig. 6.49). They represent an electric current loss. Double click on the
electrical consumer icon and enter the data (Table 6.38).

The electrical consumer can be described as resistance depending on input value

a—voltage (V) and b—resistance (Ω) in Resistance Table (Fig. 6.50).

6.1 Electric Vehicle Model Creation

411

2000

3000

4000

5000

6000

Speed (1/min)

Fig. 6.29 Full Load Characteristic

Table 6.23 Full Load
Characteristic data

Speed (1/min) Torque (Nm) Speed (1/min) Torque (Nm)

800
1350
1800
2100
2500
3000
3300
3550

7
20
30
37
45
57
63
69

3900
4250
4750
5200
5500
5780
6000
–

77
85
94
100
103
103
102
–

)

m
N

(
 
e
u
q
r
o
T

105
95
85
75
65
55
45
35
25
15
5
1000

)

W
k
(
 
r
e
w
o
P

0

-2

-4

-6

-8

-10

-12

1000

2000

5000

6000

3000

4000

Speed (1/min)

Fig. 6.30 Motoring Curve

412

6 Electric Powertrain Conﬁguration Model and Simulation

)
h
/
l
(
 

w
o
l
F
 
e
m
u
l
o
V

45

40

35

30

25

20

15

10

5

0

Engine
Speed
(1/min)
700

1200

1700

2550

3000

3600

4150

5050

6000

-4

0

12

16

4
8
BMEP (bar)

Fig. 6.31 Fuel Consumption Map

Table 6.24 Fuel Consumption Map data

(a)
700

1200

1700

2550

3000

3600

4150

5050

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−4.0
1.29
−4.0
1.41
−4.0
1.57
−4.0
1.82
−4.0
2.20
−4.0
2.60
−4.0
3.35
−4.0
4.24
−4.0
5.33

−0.5
1.30
−0.5
1.42
−0.5
1.58
−0.5
1.86
−0.5
2.29
−0.5
2.69
−0.5
3.44
−0.5
4.52
−0.5
5.85

0.0
1.33
0.0
1.45
0.0
1.61
0.0
1.97
0.0
2.42
0.0
2.96
0.0
3.74
0.0
4.84
0.0
6.45

1.60
1.52
1.82
1.90
2.06
2.30
2.30
3.39
2.42
4.20
2.41
5.16
2.31
6.18
3.62
9.93
2.76
11.2

3.16
1.72
3.32
2.24
3.54
3.00
3.80
4.59
3.97
5.53
3.97
6.83
3.82
8.04
5.10
11.0
4.18
13.7

4.55
2.01
4.73
2.84
4.89
3.72
5.25
5.65
5.49
6.78
8.59
11.5
5.34
9.83
6.63
14.4
5.53
16.3

5.95
2.39
6.17
3.43
7.83
5.26
8.21
7.93
8.41
9.28
10.3
13.4
8.53
13.7
9.77
19.9
9.72
27.4

7.32
2.87
7.59
4.01
9.48
6.22
9.55
8.87
9.81
10.6
11.6
15.0
9.99
15.7
11.2
22.8
10.9
31.6

8.63
3.38
8.90
4.74
10.9
7.61
12.4
12.1
11.3
11.9
14.7
20.0
13.1
21.6
12.5
27.0
12.1
36.0

9.3
3.86
10.9
5.42
12.3
8.57
14.3
14.2
14.7
16.8
15.1
20.5
15.2
26.6
14.5
33.7
13.0
39.6

The Battery H (18) component

is used for simulating electrical vehicles
(Fig. 6.51). Double click on the battery H icon and enter the following data
(Table 6.39) [2].

6.1 Electric Vehicle Model Creation

413

)
h
/
g
k
(
 

w
o
l
F
 
s
s
a
M

1.400

1.200

1.000

0.800

0.600

0.400

0.200

0.000

Engine
Speed
(1/min)

700

1200

1700

2550

3000

3600

4150

5050

6000

-5

0

15

20

5
10
BMEP (bar)

Fig. 6.32 NOx emission map

Table 6.25 NOx emission map data

(a)
700

1200

1700

2550

3000

3600

4150

5050

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−5
0.00
−5
0.00
−5
0.00
−5
0.01
−5
0.01
−5
0.02
−5
0.03
−5
0.04
−5
0.11

−1
0.00
0
0.00
0
0.00
0
0.01
−1
0.01
0
0.02
−1
0.03
−1
0.04
−1
0.13

0
0.00
0
0.00
0
0.00
0
0.02
0
0.01
0
0.03
0
0.04
0
0.05
0
0.15

1
0.01
0
0.00
0
0.00
0
0.02
0
0.02
1
0.06
1
0.09
0
0.07
0
0.18

2
0.02
1
0.00
1
0.01
2
0.08
0
0.02
3
0.20
3
0.22
2
0.23
1
0.33

3
0.03
2
0.01
2
0.04
6
0.22
3
0.11
4
0.34
4
0.36
4
0.40
3
0.58

5
0.05
4
0.05
4
0.10
7
0.28
6
0.34
8
0.55
8
0.61
6
0.57
5
0.77

7
0.07
7
0.12
7
0.21
11
0.38
9
0.48
9
0.62
11
0.80
9
0.90
8
0.99

8
0.10
10
0.16
10
0.26
14
0.39
11
0.54
13
0.71
14
0.92
13
1.14
11
1.14

10
0.13
12
0.19
14
0.30
16
0.41
16
0.57
17
0.74
17
1.06
16
1.41
14
1.31

414

6 Electric Powertrain Conﬁguration Model and Simulation

)
h

/
g
k
(
 

w
o
l
F
 
s
s
a
M

18.000

16.000

14.000

12.000

10.000

8.000

6.000

4.000

2.000

0.000

Engine
Speed
(1/min)

700

1200

1700

2550

3000

3600

4150

5050

6000

-5

0

15

20

5
10
BMEP (bar)

Fig. 6.33 CO emission map

Table 6.26 CO emission map data

(a)
700

1200

1700

2550

3000

3600

4150

5050

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−5
0.04
−5
0.02
−5
0.04
−5
0.12
−5
0.12
−5
0.13
−5
0.17
−5
0.20
−5
0.35

−1
0.04
−1
0.02
−1
0.04
−1
0.12
0
0.15
−1
0.14
−1
0.18
−1
0.20
−1
0.35

0
0.05
0
0.06
0
0.05
0
0.13
1
0.19
0
0.16
0
0.20
0
0.23
0
0.37

2
0.07
2
0.08
1
0.06
1
0.15
3
0.32
1
0.21
1
0.26
1
0.33
1
0.44

3
0.10
4
0.13
2
0.13
3
0.23
4
0.49
3
0.37
6
0.78
4
0.81
6
2.14

5
0.14
5
0.17
6
0.27
6
0.56
6
0.77
7
0.79
10
1.81
9
1.60
8
3.53

7
0.17
7
0.25
8
0.32
8
0.67
9
1.23
11
3.03
11
3.29
11
3.33
11
9.42

8
0.22
9
0.70
9
0.90
11
2.54
11
2.22
13
4.89
13
5.59
12
8.58
12
12.5

10
1.30
10
1.97
11
1.94
15
3.01
13
3.95
15
8.30
14
7.98
14
10.8
13
14.7

−
−

13
2.61
15
2.63
17
3.50
16
5.76
16
8.82
17
9.58
16
12.5
14
17.2

6.1 Electric Vehicle Model Creation

415

)
h
/
g
k
(
 

w
o
l
F
 
s
s
a
M

0.500

0.450

0.400

0.350

0.300

0.250

0.200

0.150

0.100

0.050

0.000

Engine
Speed
(1/min)

700

1200

1700

2550

3000

3600

4150

5050

6000

-5

0

15

20

5
10
BMEP (bar)

Fig. 6.34 HC emission map

Table 6.27 HC emission map data

(a)
700

1200

1700

2550

3000

3600

4150

5050

6000

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

−5
0.01
−5
0.01
−5
0.01
−5
0.02
−5
0.01
−5
0.02
−5
0.02
−5
0.02
−5
0.03

−1
0.01
−1
0.01
−1
0.01
−1
0.02
0
0.02
−1
0.02
−1
0.02
0
0.02
−1
0.03

0
0.01
0
0.01
0
0.01
0
0.02
0
0.02
0
0.02
0
0.02
1
0.03
0
0.03

1
0.01
0
0.01
0
0.01
1
0.02
1
0.02
1
0.02
1
0.03
2
0.05
1
0.04

2
0.02
2
0.02
2
0.03
3
0.04
3
0.04
3
0.05
3
0.05
6
0.11
3
0.08

3
0.02
4
0.03
5
0.05
6
0.07
4
0.06
4
0.07
6
0.10
8
0.12
6
0.13

6
0.03
5
0.03
7
0.06
8
0.08
8
0.08
8
0.10
8
0.11
9
0.16
8
0.14

8
0.03
7
0.04
11
0.13
11
0.16
11
0.13
11
0.19
11
0.17
11
0.20
11
0.25

10
0.05
10
0.06
14
0.27
14
0.27
13
0.18
13
0.24
14
0.34
13
0.29
12
0.33

−

12
0.09
−
−

16
0.40
17
0.32
16
0.41
16
0.44
16
0.46
15
0.48

416

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.35 Final Drive input data speciﬁcations window

Table 6.28 Final Drive input
data

Name

Transmission Ratio
Inertia Moment In/Out
Efﬁciency

Value

6.000
0.015/0.015
0.950

Unit
–
kg m2
–

Fig. 6.36 Wheels input data speciﬁcations window

The idle voltage—charge (b) is the idle voltage of one cell in charge mode.
There is no electrical consumer; it is a function of the State of Charge SOC
(a) (Fig. 6.52 and Table 6.40). The idle voltage—discharge (b) of one cell is the
voltage without an electrical consumer, there is no ﬂow of current, and it is a
function of the SOC (a) (Fig. 6.53 and Table 6.41) [1].

6.1 Electric Vehicle Model Creation

417

Table 6.29 Wheels input
data

Name

Wheel Inertia Moment
Friction Coefﬁcient of Tire
Reference Wheel Load
Wheel Load Correction Coefﬁcient
Static Rolling Radius
Circumference
Dynamic Rolling Radius
Circumference
Friction Coefﬁcient of Road
Slip at Maximum Traction

Value

0.150
1.000

3300.00

0.000

290.0
1822.12
300.0
1884.96

1.050
7.000

Unit
kg m2
–

N
–

mm
mm
mm
mm
–

%

Fig. 6.37 Brake input data speciﬁcations window

Table 6.30 Brakes input data

Name

Brake
Piston Surface
Speciﬁc Factor
Efﬁciency
Inertia Moment
Friction Coefﬁcient
Friction Radius

Value

Front Right
1800.0

Value

Rear Right
1500.0

Value

Front Left
1800.0

Value

Rear Left
1500.0

1.000
0.990
0.015
0.250

1.000
0.990
0.015
0.250

1.000
0.990
0.015
0.250

1.000
0.990
0.015
0.250

120.0

100.0

120.0

100.0

Unit
–
mm2
–
–
kg m2
–

mm

E-Drive (19) component is a function that can be used for calculations (with
user-deﬁned functions) (Fig. 6.54). To deﬁne component input data, double click on
the C code icon and enter the following data for function (Fig. 6.55), and for
description of Data Bus (Table 6.42) [1].

418

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.38 E-Machine input data speciﬁcations window

Table 6.31 E-Machine input
data

Name

Type of Machine
Characteristic Maps and Curves
Nominal Voltage
Inertia Moment
Maximum Speed
Drag Torque at Maximum Speed
Initial Temperature
U1 Voltage
U2 Voltage

1.0e−4

Value

ASM
Overall
320

10000
0
20
100
320

Unit
–
–

V
kg m2
1/min
Nm
°C
V
V

)

m
N

(
 
e
u
q
r
o
T

250

200

150

100

50

0

-50

-100

-150

-200

-250

0

1000

2000

3000

4000

5000

6000

7000

8000

Fig. 6.39 Maximum mechanical torque

Speed (1/min)

−236
−238
−239
−191
−159
−136
−119
−106
−95

Engine
Speed
(1/min)
500
1000
1500
2000
2250
2500
3000
3500
3750
4000
4500
5000
5250
5500
6000
6500
6750
7000
7500

6.1 Electric Vehicle Model Creation

419

Table 6.32 Maximum mechanical torque data

Speed (1/min) Torque (Nm) Speed (1/min) Torque (Nm) Speed (1/min) Torque (Nm)

0
500
1000
1500
2000
2500
3000
3500
4000

240
240
240
240
240
240
240
205
180

4500
5000
5500
6000
6500
7000
7500
1
750

160
140
130
120
110
105
95
−229
−229

1500
2250
3000
3750
4500
5250
6000
6750
7500

)

%

(
 
y
c
n
e
i
c
i
f
f

E

95

90

85

80

75

70

65

60

-240

-180

-120

120

180

240

-60

0
Torque (Nm)

60

Fig. 6.40 Efﬁciency map

E-Brake & M-Brake (20) component is a function can be used for calculating
with user-deﬁned functions used to conversion of e-drive torque to brake pressure
(Fig. 6.56). To deﬁne component input data, double click on the C code icon and
enter the data for function (Fig. 6.57), and for Data Bus (Table 6.43) [1].

Range Extender (21) component is a function can be used for calculating with
user-deﬁned functions used to range extender control (Fig. 6.58). To deﬁne com-
ponent input data, double click on the C code icon and enter the following data for
function (Fig. 6.59), and for Data Bus (Table 6.44) [1].

The Monitor element (22) can be introduced, if the calculation run must be
detected (Fig. 6.60). Click on the description of Data Bus tab and open the fol-
lowing dialog. To select a Data Bus channel, click to access at the available list [1].
Enter the text for the description and then click on to select the unit (Table 6.45).

420

6 Electric Powertrain Conﬁguration Model and Simulation

Table 6.33 Efﬁciency curve data

(a)
500

1000

1500

2000

2500

3000

3500

4000

4500

5000

5500

6000

6500

7500

(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)
(b)
(c)

0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65

25
76
25
82
25
82
25
82
25
82
25
82
25
82
25
80
25
80
25
80
25
80
25
80
25
82
25
82

50
76
50
82
50
86
50
87
50
87
50
88
50
88
50
88
50
88
50
88
50
88
50
88
50
87
50
86

75
75
75
83
75
86
75
88
75
89
75
91
75
91
75
91
75
91
75
91
75
91
75
91
75
90
75
89

100
72
100
83
100
86
100
89
100
90
100
91
100
91
100
91
100
91
100
91
100
91
100
91
100
91
100
91

125
73
125
83
125
86
125
89
125
90
125
91
125
91
125
91
125
92
125
93
125
93
125
92
–
–
–
–

–
–

150
81
150
86
150
88
150
91
150
91
150
92
150
93
150
93
150
93
–
–
–
–
–
–
–
–

–
–

175
80
175
85
175
88
175
90
175
91
175
92
175
93
175
93
–
–
–
–
–
–
–
–
–
–

–
–

200
79
200
84
200
87
200
89
200
90
200
91
200
93
200
93
–
–
–
–
–
–
–
–
–
–

–
–

225
77
225
83
225
86
225
88
225
90
225
91
–
–

225
93
–
–
–
–
–
–
–
–
–
–

–
–

240
76
240
82
240
85
240
88
240
90
–
–
–
–

240
93
–
–
–
–
–
–
–
–
–
–

Fig. 6.41 Generator input data speciﬁcations window

6.1 Electric Vehicle Model Creation

421

)

m
N

(
 
e
u
q
r
o
T

250

200

150

100

50

0

-50

-100

-150

-200

-250

0

1000

2000

3000

4000

5000

6000

7000

8000

Fig. 6.42 Maximum mechanical torque

Speed (1/min)

Table 6.34 Maximum
mechanical torque data

Speed (1/min) Torque (Nm) Speed (1/min) Torque (Nm)

1
500
1000
1500
2000
2500
3000
3500
4000
4500
5000
5500
6000
6500
7000
7500

240
240
240
240
240
240
240
205
180
160
140
130
120
110
105
95

1
750
1500
2250
3000
3750
4500
5250
6000
6750
7500
–
–
–
–
–

−230
−230
−235
−237
−239
−190
−160
−135
−120
−105
−95

–
–
–
–
–

PID Control (23) may be used to build up more powerful control subsystems in
AVL CRUISE, combined with other signal processing components (Fig. 6.61).
Double click on the PID control icon and enter the data (Table 6.46).

422

6 Electric Powertrain Conﬁguration Model and Simulation

-250

-150

-50
Torque (Nm)

50

150

250

95

90

85

80

75

70

65

60

55

100
75
100
83
100
86
100
89
100
90
100
91
100
91
100
95
100
91
100
91
100
91
100
91

)

%

(
 

y
c
n
e
i
c
i
f
f

E

Fig. 6.43 Efﬁciency map

Table 6.35 Efﬁciency curve data

(a)
500

1000

1500

2000

2500

3000

3500

4000

4500

5000

5500

6000

0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65
0
65

25
76
25
82
25
82
25
82
25
82
25
82
25
82
25
80
25
80
25
80
25
80
25
80

50
76
50
82
50
86
50
87
50
87
50
88
50
88
50
88
50
88
50
88
50
88
50
88

75
75
75
83
75
86
75
88
75
89
75
91
75
91
75
91
75
91
75
91
75
91
75
91

Engine
Speed
(1/min)
500
1000
1500
2000
2250
2500
3000
3500
3750
4000
4500
5000
5250
5500
6000

125
73
125
83
125
86
125
89
125
90
125
91
125
91
125
91
125
92
125
93
125
93
125
–

150
–

150
81
150
86
150
88
150
91
150
91
150
92
150
93
150
93
150
93
150
93
150
–

175
–

175
80
175
85
175
88
175
90
175
91
175
92
175
93
175
93
175
–

175
–

175
–

200
–

200
79
200
84
200
87
200
89
200
90
200
91
200
93
200
–

200
–

200
–

200
–

225
–

225
77
225
83
225
86
225
88
225
90
225
91
225
–

225
–

225
–

225
–

225
–

240
–

240
76
240
–

240
86
240
88
240
90
240
–

240
–

240
–

240
–

240
–

240
–

6.1 Electric Vehicle Model Creation

423

Fig. 6.44 Differential input data speciﬁcations window

Table 6.36 Differential input
data

Name

Differential Lock
Torque Split Factor
Inertia Moment In
Inertia Moment Out1
Inertia Moment Out2
Stationary Efﬁciency

Value

Unlocked
1.000
0.015
0.015
0.015
0.950

Unit
–
–
kg m2
kg m2
kg m2
–

Fig. 6.45 Kinematic Chain Browser

Constants (24) component enables the user to deﬁne up to 99 constant values
which can be used by other components through the Data Bus (Fig. 6.62). The
values can be of type integer, double or string (Table 6.47) [1].

424

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.46 Cockpit input data speciﬁcations window

Table 6.37 Cockpit input
data

Name

Shift Mode
Number of Gears Forward
Number of Gears Back
Maximum Brake Force
Brake Light Switch Threshold
Number of Retarder Steps

Value

Manual
1.000
1.000

100.0

1.000
0.000

Unit
–
–
–

N
%
–

)
b

100

80

60

40

20

0

Fig. 6.47 Pedal characteristic

6.2 Run Simulation

6.2.1 Result Manager

0

20

40

60

80

100

a)

To run a simulation for each model,
calculation [1]:

there are ﬁve different options for

6.2 Run Simulation

425

Fig. 6.48 ASC input data speciﬁcations window

Fig. 6.49 Electrical Consumer input data speciﬁcations window

Table 6.38 Electrical
Consumer input data

Name

Nominal Voltage
Direction
Exceeding Value Range
Threshold Value
Reference

Value

320.0
Positive
Admissible
0.500
Absolute

Unit

V
–
–
–
–

(cid:129) Single Calculation is a regular calculation with the input data supplied in the
components. Output of result deﬁnes which components result will be written
and available in the Result Manager.

(cid:129) Matrix Calculation is used for multiple calculations and to evaluate the effect of
varying the values of input parameters on vehicle performance, consumption,
and emissions. The results can be viewed for each varied calculation.

(cid:129) Component Variation is used for multiple calculations and the calculation
consists of subcalculations in which components are replaced by components of
the same type. The results can be viewed in the Result Manager.

426

6 Electric Powertrain Conﬁguration Model and Simulation

)

(
 
e
c
n
a
t
is
s
e
R

600

550

500

450

400

350

300

250

200

150

220

270

370

420

320
Voltage (V)

Fig. 6.50 Resistance Table

Fig. 6.51 Battery H input data speciﬁcations window

(cid:129) System Variation is used for multiple calculations from a list of all the model’s

systems. The results can be viewed similar to Component Variation.

(cid:129) Batch Calculation is used for calculations series of different projects, either
Single Calculation, Matrix Calculation with DoE option, and Component
Variation with DoE option.

6.2 Run Simulation

427

Table 6.39 Battery H input
data

Name

Maximum Charge
Nominal Voltage
Maximum Voltage
Initial Charge
Minimum Voltage
Number of Cells per Cell-Row
Number of Cell-Row
Operating Temperature
Internal Resistance

Value

5.000
7.200
9.000

75.00

6.000

40.00

2.000

25.00

0.200

Unit

Ah
V
V
%
V
–
–
°C
Ω

)

V

(
 
e
g
a
t
l
o
V

8.40

8.20

8.00

7.80

7.60

7.40

7.20

0

20

40

60

State of Charge (%)

80

100

Fig. 6.52 Idle voltage charge

Table 6.40 Idle voltage—charge data

State of Charge (%)

Voltage (V)

State of Charge (%)

Voltage (V)

0
10
20
30
40
50

7.23
7.40
7.51
7.59
7.65
7.69

60
70
80
90
100
–

7.73
7.77
7.81
7.91
8.36
–

To run the calculation in the Desk Area, click on Calculation Center or click on
AVL blue button in the upper right corner (Fig. 6.63). Click on to “Start
Calculation” button to running the simulation.

After the simulations were complete, click on the Result Manager in the
Navigation Frame (Fig. 6.64) and expand the task of which the results should be
viewed. The selected object is shown in the right section of the window.

428

6 Electric Powertrain Conﬁguration Model and Simulation

8.40

8.20

8.00

7.80

7.60

7.40

7.20

)

V

(
 
e
g
a
t
l
o
V

0

20

40

60

State of Discharge (%)

80

100

Fig. 6.53 Idle voltage discharge

Table 6.41 Idle voltage—discharge data

State of Charge (%)

Voltage (V)

State of Charge (%)

Voltage (V)

0
10
20
30
40
50

7.23
7.40
7.51
7.59
7.65
7.69

60
70
80
90
100
–

7.73
7.77
7.81
7.91
8.36
–

Fig. 6.54 E-Drive input data speciﬁcations window

Project information can be viewed in the main window by selecting info in the
tree structure or by double clicking info in the right window. The window shows
general information: project name, author, vehicle model, drivetrain model, date
and state (regarding errors), then the tree structure of the Folder with deﬁned
Calculation Tasks (different status for run or not run is shown using blue/grey
color). The picture of the Vehicle Model is also displayed.

6.2 Run Simulation

429

/* Transition from edriving to ebraking*/
/*Checking whether the Driver applies the Brake pedal. This information can be 
directly taken from Cockpit: if the Brake Pressure is greater than Zero then there is 
a braking action additional the vehicle should still be on the move 
*/
if (a[3] > 0 && a[0] >0.1)
{
/*In this case the Brake pressure should be converted into Ratio of the maximum 
Brake Pressure. Additional a brake Factor can be also used to scale this ratio ac-
cording to the size of E-Motor in order to get suitable load to the E-Drive.
a[0] : Vehicle Velocity;
a[1]: Vehicle Acceleration;
a[2]: Load Signal;
a[3]: Brake Pressure;
a[4]: Maximum Brake Pressure;
a[5]:Brake factor.
*/

y[0] = a[3]/a[4]*(-1)*a[5];

}
else
{
/*If there isn't any brake action (Brake Pressure is equal Zero) then the load from 
Cockpit is used as drive load */

y[0] = a[2];

}

Fig. 6.55 C code function

Table 6.42 Description of Data Bus

Data Bus Channel

Description

Connection

Decouple

a[0]
a[1]
a[2]
a[3]
a[4]
a[5]
a[6]
y[0]

Vehicle Velocity
Vehicle Acceleration
Load Signal
Brake Pressure
Maximum Brake Pressure
Brems factor
a[6]
Mod Load Signal

Unit

km/h
m/s2
–

bar
bar
–
–
–

Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional

0
0
0
0
0
0
0
0

One output ﬁle is produced for each component in the Vehicle Model and each
Calculation Task. Data for diagrams are extracted from these ﬁles and are shown as
Energy Flow Graphics, presentation diagrams for belonging task and standard
diagrams for used components.

430

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.56 E-Brake & M-Brake input data speciﬁcations window

In the tree structure of the Result Manager, all deﬁned Calculation Task folders
are shown separately for each task. Those folders with results are shown in color;
tasks which are not run are grey. Files of the each Calculation Task are located
inside the respective folder. In Result Manager, all components are listed where
results have been written in pages mode or data sources mode (Fig. 6.65).

The result output for components is selected with output in the properties
window of the respective component. Select as deﬁned in module for output of
results in the folder of the corresponding calculation task. There are two types of
result outputs available with the Result Manager: standard diagrams and presen-
tation diagrams.

6.2.2 Standard Diagrams

Standard diagrams (Fig. 6.66) are created separately for each component and only
contain results of the individual component and represent time histories of the
single components.

They have a predeﬁned representation page, which can only be changed in some
parts. Standard diagrams are opened by selecting the respective Calculation Task in
the tree structure of Result Manager and then selecting the corresponding
component.

The pages mode sidebar is divided into a list of predeﬁned standard diagram
pages for the respective component and TeimView Assistant with a tree structure of
components with all available curves and the current parameter for current diagram
of respective component with the list of all used curves. TeimView has two modes
tabs: pages and data sources. Pages are used to view results as curves in standard

6.2 Run Simulation

431

/*Conversion routine*/
/*Converting brake Torque into Pressure for all Brakes (Front & Rear)*/
double E-Brake;
/* Check whether Torque of E-Drive is negative that means the load signal to the 
E-Motor is negative. 
In this case the corresponding brake Pressure will be calculated*/
if (a[0] < 0 )
{
/* The corresponding Brake  pressure will be determined by using the following 
equation:
M = 2 * P * A * eff * u * r * c
with
M: Brake Torque;
P: Brake Pressure;
A: Brake Piston Surface;
eff:  Efficiency;
u: Friction Coefficient;
r: effective Friction Radius;
c: Specific Brake factor.
P=M /(2 *A* eff * u * r* c)
It’s simplify the formula for Rear Brake and Front Brake by using 
Brake_Factor_Front and Brake_Factor_Rear in order to use the mean value of 
both:
Brake_Factor_Front= AF*effF*uF*rF*cF
Brake_Factor_Rear=  AR*effR*uR*rR*cR
It’s also to take into account the following ratios: Ratio of Final Drive (iFD) and 
Ratio of Transmission (iTR) between the E-Drive and E-Brake.
[P.S. The ratio iTR is equal 1 because there isn't any Gearbox in the model.]
P= M * iFD * iTR/[2 * (Brake_Factor_Front + Brake_Factor_Rear)/2]
The used channel data are then :
a[0] : eDrive_Torque;
a[1] : iFD;
a[2] : iTR;
a[3] : Brake_Factor_Front;
a[4] : Brake_Factor_Rear.
*/

eBrake = a[0]*2*a[1]*a[2]/(2*(a[3]+a[4]));

}
else
{
/* and if the Torque is positive that means E-Motor drives the vehicle the E-Brake 
should be equal Zero */

E-Brake = 0.;

}
/*Calculation of reduced mechanical E-Brake Function to determine a maximum 
value By applying negative load the E-Drive applies a resistance which generates 
electrical power. In this case the mechanical power required for breaking will be 
reduced by the power which the E-Motor has recuperated.
That means the vehicle will at first be electrically braked and The rest required 
brake energie will be provided by mechanical brakes */
if ((E-Brake+a[5])>0.0)
{

y[0]= (E-Brake+a[5]);

}
else
{

}

y[0]= 0.0;

Fig. 6.57 C code function

6 Electric Powertrain Conﬁguration Model and Simulation

Table 6.43 Description of Data Bus

Data Bus Channel

Description

Unit

Connection

Decouple

eDrive_Torque
iFD (Ratio of Final Drive)
iTR (Ratio of Final Transmission)
Brake_Factor_Front
Brake_Factor_Rear
Brake Pressure_Driver
BRK_dp_Recup

Nm
–
–
–
–

Pa
Pa

Optional
Optional
Optional
Optional
Optional
Optional
Optional

0
0
0
0
0
0
0

432

a[0]
a[1]
a[2]
a[3]
a[4]
a[5]
y[0]

Fig. 6.58 Range extender control input data speciﬁcations window

diagram and data sources in tables as numerical data for the respective component
for analyzing and extracting.

The data sources mode sidebar (Fig. 6.67) has a tree structure where the data
source, data ﬁle, and table are shown. In data source view is a list of all curve data
that can be shown.

Energy Flow Graphics feature can be selected in the Result Manager (Fig. 6.68).
An animation shows the ﬂow between the drivetrain components over time of the
following parameters: Current [A], Energy Stored [kJ], Energy [kJ], Power [kW],
Speed [1/min], Velocity [km/h], Torque [Nm], Force [N], Voltage [V].

The animation can be controlled by appropriate switches (play, pause, step-wise,
stop, repeat, velocity). A time-bar, showing the actual simulation time, can be
moved to a certain time-step with the mouse.

Below the ﬂow graphics a monitor is shown which displays the result curves of
selected components. With a zoom-option, the horizontal direction can be scaled so
that long cycles can also be viewed properly.

6.2 Run Simulation

433

/* Starting && Shut down Engine and Charging Battery*/
int  operatingMode;
if(realTime<=0.0) { operatingMode = 0; }
/*Checking whether the State of Charge exceeds the Minimum Value*/
if (a[0] <  a[1] )
{
/* Range extending: In this case the Engine should be started and Generator have 
to generate energy into Battery. */

operatingMode=1;

}
if  (a[0] >  a[2] )
{
/* Pure electrical Drive: In this case the Engine is turned off and the E-Motor per-
form the eDriving. */
operatingMode=0;

}
if (operatingMode)
{
/* Start Switch for Engine have to be set. The load signal for Generator should be 
applied when the engine is around its optimum operating area.
The load signal to the Engine is provided by PID which controls the Engine speed 
to the pre-defined speed level. */
y[0] = 1; /*start switch Gen*/
y[1] = 0; /*load signal Gen init*/
if (a[4]> (a[6]-50)) /*check on the ICE speed*/
{

y[3] = a[5]; /*load signal ICE*/
if ( (a[4]< (a[6]-50)) && (a[5]>0.5) ) /*check on the ICE speed and limit the 

y[1] = -0.5; /*load signal Gen*/

y[2] = a[3]; /*start switch ICE*/

y[3] = 0.5; /*load signal ICE*/

}

}

value*/
{

}
if (!operatingMode)
{
/* When ICE is turned off, all of the set values to the Range Extender components 
are set to not-active. */

y[0] = 0.0;
y[1] = 0.0;
y[2] = 0.0;
y[3] = 0.0;

}

Fig. 6.59 C code function

6 Electric Powertrain Conﬁguration Model and Simulation

Table 6.44 Description of Data Bus

Data Bus Channel

Description

Unit

Connection

Decouple

SOC_Act
SOC_Min
SOC_Max
Start_Switch _CP
Engine Speed
Load_Signal_Engine
Desired Engine Speed
Start_Switch_Gen
Load_Signal_Gen
Start Switch_Engine
Load_Signal_Engine

%
%
%
–

1/min
–

1/min
–
–
–
–

Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional
Optional

0
0
0
0
0
0
0
0
0
0
0

434

a[0]
a[1]
a[2]
a[3]
a[4]
a[5]
a[6]
y[0]
y[1]
y[2]
y[3]

Fig. 6.60 Monitor input data speciﬁcations window

Table 6.45 Description of
Data Bus

Data Bus Channel

Description

Input 0
Input 1
Input 2
Input 3
Input 4

LoadSignal_Cockpit
Velocity
Torque_eDrive
SOC (State of Charge)
Engine_Speed

Unit
–

km/h
Nm
%
rpm

In addition to the graphical representation, the associated values can also be

displayed in the monitor as well as in the drivetrain ﬂow graphics.

The values of the Energy Flow Graphics can also be displayed in a pie chart.
Clicking the button EFG pie chart opens an area where the segments can be

added or removed with the buttons “+” and “−.”

The association between a segment and a component parameter can be done by
marking the segment in the segment list and then doing a left mouse-click on a
so-called connector of the component (Fig. 6.69). Several connectors can be chosen
for one segment. In that case, the segment represents the sum of all associated
values. The segment list consists of the absolute segment values as well as of the
values in terms of percentages.

6.2 Run Simulation

435

Fig. 6.61 PID control input data speciﬁcations window

Table 6.46 PID control input
data

Name

Proportional Parameter
Derivative Parameter
Integral Parameter
Output Value Minimum
Output Value Maximum

Value

10.00

0.000
1.0e−4
0.000
1.000

Unit
–

s
1/s
–
–

Fig. 6.62 Constants input data speciﬁcations window

436

6 Electric Powertrain Conﬁguration Model and Simulation

Table 6.47 Constants table data

Data Bus Channel

Description

Value

Constant 0
Constant 1
Constant 2
Constant 3
Constant 4
Constant 5
Constant 6
Constant 7
Constant 8

Brake_Factor_Front
Brake_Factor_Rear
iFD (Ratio of Final Drive)
iTR (Ratio of Final Transmission)
Maximum Brake Pressure
Brake Factor
SOC_Min
SOC_Max
Desired Engine Speed

0.00015
0.00008
3.650
1.000

50.00

1.000

45.00
60.00

3000

Unit
–
–
–
–

bar
–

%
%
1/min

Type

Double
Double
Double
Double
Double
Double
Double
Double
Double

 

Fig. 6.63 Start calculation

To evaluate the economy characteristics the simulation was running a typical
NEDC cycle (Fig. 6.70). The total distance of this cycle is 10.931 m, the total time
is 1180 s, idle standing time is 267 s, average speed including stops is 33.35 km/h,
average driving speed excluding stops is 43.10 km/h, average acceleration is
0.506 m/s2 and maximum acceleration is 1.042 m/s2.

After running the simulation, all the results can be exported into graphs: the slip
signal for all the wheels (Fig. 6.71), the required friction coefﬁcient (Fig. 6.72),
comparison of front and back friction coefﬁcient (Fig. 6.73), electrical power,

6.2 Run Simulation

437

Fig. 6.64 Result Manager window

Fig. 6.65 Result Manager pages mode

438

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.66 Standard diagrams

Fig. 6.67 Result Manager data sources mode

6.2 Run Simulation

439

Fig. 6.68 Energy Flow Graphics

Fig. 6.69 Energy Flow Graphics pie chart

440

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.70 NEDC typical cycle

Fig. 6.71 The slip signal for all the wheels

maximum power out, and power input (Fig. 6.74), voltage, current, charge, and
State of Charge (Fig. 6.75), and electrical power and power loss (Fig. 6.76), total
input and output energy and charge (Fig. 6.77), speed, braking torque, and brake

6.2 Run Simulation

441

Fig. 6.72 The required friction coefﬁcient

Fig. 6.73 Comparison of front and back friction coefﬁcient

power (Fig. 6.78), brake pressure, braking torque and brake power (Fig. 6.79),
braking torque and rotational acceleration (Fig. 6.80), acceleration velocity and
distance (Fig. 6.81), acceleration pedal travel, brake pedal force and clutch pedal

442

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.74 Electrical power, maximum power out and power inputs

Fig. 6.75 Voltage, current, charge, and State of Charge

travel (Fig. 6.82), load signal, brake pressure, and clutch release (Fig. 6.83), real
time, current gear and velocity (Fig. 6.84), rotational accelerations (Fig. 6.85),
torques (Fig. 6.86), power loss and efﬁciency (Fig. 6.87), torque, speed, and

6.2 Run Simulation

443

Fig. 6.76 Electrical power and power loss

Fig. 6.77 Total input and output energy and charge

mechanical power (Fig. 6.88), torque, maximum torque—motor and maximum
torque—generator
loss
(Fig. 6.90), total input and output energy (Fig. 6.91).

(Fig. 6.89), efﬁciency, electrical power, and power

444

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.78 Speed, braking torque and brake power

Fig. 6.79 Brake pressure, braking torque, and brake power

For all inputs and outputs, a speciﬁc graph can be made: switch and resistance
(Fig. 6.92), e-drive torque input (Fig. 6.93), driver brake pressure (Fig. 6.94), input
vehicle velocity (Fig. 6.95), input vehicle acceleration (Fig. 6.96), input load signal

6.2 Run Simulation

445

Fig. 6.80 Braking torque and rotational acceleration

Fig. 6.81 Acceleration velocity and distance

(Fig. 6.97), input brake pressure (Fig. 6.98), mod load signal (Fig. 6.99), input load
signal cockpit (Fig. 6.100), speed input and output (Fig. 6.101), rotational accel-
eration input and output (Fig. 6.102), efﬁciency and torque loss (Fig. 6.103),

446

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.82 Acceleration pedal travel, brake pedal force, and clutch pedal travel

Fig. 6.83 Load signal, brake pressure, and clutch release

air resistance force, resistance force and traction force (Fig. 6.104), wheel loads
front (Fig. 6.105), wheel loads rear (Fig. 6.106), axle loads (Fig. 6.107), friction
coefﬁcient and friction coefﬁcient exploit (Fig. 6.108), longitudinal force and slip

6.2 Run Simulation

447

Fig. 6.84 Real time, current gear, and velocity

Fig. 6.85 Rotational accelerations

(Fig. 6.109), desired, current, minimum, and maximum velocity (Fig. 6.110), clutch
pedal travel and acceleration pedal travel (Fig. 6.111), brake pedal travel and
acceleration pedal travel (Fig. 6.112), clutch pedal travel and gear (Fig. 6.113),
brake pedal travel, and power of all brakes (Fig. 6.114).

448

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.86 Torques

Fig. 6.87 Power loss and efﬁciency

6.2 Run Simulation

449

Fig. 6.88 Torque, speed, and mechanical power

Fig. 6.89 Torque, maximum torque—motor, and maximum torque—generator

450

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.90 Efﬁciency, electrical power, and power loss

Fig. 6.91 Total input and output energy

6.2 Run Simulation

451

Fig. 6.92 Switch and resistance

Fig. 6.93 E-drive torque input

452

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.94 Driver brake pressure

Fig. 6.95 Input vehicle velocity

6.2 Run Simulation

453

Fig. 6.96 Input vehicle acceleration

Fig. 6.97 Input load signal

454

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.98 Input brake pressure

Fig. 6.99 Mode load signal

6.2 Run Simulation

455

Fig. 6.100 Input load signal cockpit

Fig. 6.101 Speed input and output

456

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.102 Rotational acceleration input and output

Fig. 6.103 Efﬁciency and torque loss

6.2 Run Simulation

457

Fig. 6.104 Air resistance force, resistance force and traction force

Fig. 6.105 Wheel loads front

458

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.106 Wheel loads rear

Fig. 6.107 Axle loads

6.2 Run Simulation

459

Fig. 6.108 Friction coefﬁcient and friction coefﬁcient exploit

Fig. 6.109 Longitudinal force and slip

460

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.110 Desired, current, minimum, and maximum velocity

Fig. 6.111 Clutch pedal travel and acceleration pedal travel

6.2 Run Simulation

461

Fig. 6.112 Brake pedal travel and acceleration pedal travel

Fig. 6.113 Clutch pedal travel and gear

462

6 Electric Powertrain Conﬁguration Model and Simulation

Fig. 6.114 Brake pedal travel and power of all brakes

References

Edition 06.2011

Edition 06.2011

1. AVL Cruise (2011) Users guide. AVL List GmbH, Graz, Austria, Document no. 04.0104.2011,

2. AVL Cruise (2011) Primer. AVL List GmbH, Graz, Austria, Document no. 04.0103.2011,

Chapter 7
Creating Virtual Road Infrastructure

7.1 AVL Road Importer

7.1.1 Getting Started

AVL Road Importer is an AVL Concerto™ option (Fig. 7.1). The purpose of this
option is to convert any GPS data or x, y data of a real road into a format readable
by AVL Concerto™ [1].

This tool is not a GIS tool in the sense that it does not permit to log GPS data nor
does it have any link to any mapping tool. All the data are provided by the user.
Therefore, the generated road is representative of that data. The only given
information about the road are the points, which the user can limit in case they
cannot be done with the given set of parameters.

This subchapter describes the possibilities of AVL Road Importer as well as its
intended use. To navigate, use the command bar available on the left part of the
screen. It is composed of four sections:

Data—in this section, the user is able to either import GPX or KML ﬁles to

AVL Concerto™ or simply choose a ﬁle in AVL Concerto™ Data Explorer;

Road—in this section, the user is able to choose what data to work with, but also

prepare it before the main algorithm;

Plot—in this section, the user can ﬁnd supplementary tools to verify the quality
of the road just generated but also you will be able to specify additional elements
such as speed limits;

Export—in this section, the user will ﬁnd the necessary tools to export to AVL

InMotion or AVL CRUISE format [1].

© Springer International Publishing Switzerland 2015
B.O. Varga et al., Electric and Plug-In Hybrid Vehicles,
Green Energy and Technology, DOI 10.1007/978-3-319-18639-9_7

463

464

7 Creating Virtual Road Infrastructure

Fig. 7.1 AVL Road Importer main menu

7.1.2 Data Submenu

The Data submenu is accessible by clicking on the button Data in the command bar.
In the submenu there are the following possibilities (Fig. 7.2):

Fig. 7.2 AVL Road Importer—Data submenu

7.1 AVL Road Importer

465

Open Data Explorer—this opens the AVL Concerto™ Data Explorer and the
user is able to access any AVL Concerto™ ﬁle (read). This is also where previously
imported KML and GPX ﬁles can be accessed.

Import KML File—the user is able to import KML through this. (by choosing
the KML ﬁles wish to import and click ok). KML (Keyhole Markup Language) is
an XML language focused on geographic visualization, including annotation of
maps and images. Geographic visualization includes not only the presentation
of graphical data on the globe, but also control of the user’s navigation in the sense
of where to go and where to look. After importing a KML ﬁle, it will appear in the
Channel-Browser. The imported ﬁles are saved to the directory/Roads/KML/as a
Concerto Transport File (CTF).

Import GPX File—the user will be able to import GPX through this (by
choosing the GPX ﬁles you wish to import and click ok). GPX (GPS eXchange
Format) is a lightweight XML data format for interchange of GPS data (waypoints,
routes, and tracks) between applications and web services on the Internet. After
importing a GPX ﬁle, it will appear in the Channel-Browser. The imported ﬁles are
saved to the directory/Roads/GPX/as a Concerto Transport File (CTF).

7.1.3 Road Submenu

The Road submenu is accessible by clicking on the button Road in the command
bar. In the submenu the user will ﬁnd the following possibilities (Fig. 7.3):

Fig. 7.3 AVL Road Importer—Road submenu

466

7 Creating Virtual Road Infrastructure

Channel Selection—by clicking on this button, the user can access the channel
selection page (Fig. 7.4) [1]. Each modiﬁcation of the parameters needs to be saved
by clicking on the Apply button.
(cid:129) Project—deﬁne the project name here. The project name in itself is not used by

the algorithm but it helps predeﬁne the name of the output ﬁles;

(cid:129) Road—deﬁne which channel to use for either latitude or longitude or x and y.
Each zone can be activated by checking the corresponding checkbox. If GPS
data is speciﬁed, the algorithm will convert it into UTM coordinates;

(cid:129) Altitude—deﬁnes which channel to use for the altitude. A channel can be
chosen directly into (from data) or the channel containing the barometric
pressure (from barometer). If the barometric pressure is chosen, the algorithm
will convert the pressure into an altitude in meters.

Fig. 7.4 AVL Road Importer—Channel selection

7.1 AVL Road Importer

467

Fig. 7.5 AVL Road Importer—Pre-processing

Preprocessing—by clicking on this button, the pre-processing page is accessed

(Fig. 7.5) [1]. This page serves two purposes:
(cid:129) The ﬁrst purpose is to be able to view quickly the selected data in the Channel

Selection page;

(cid:129) The second purpose is to declare invalid points in the data easily by selecting the

part which is invalid with the available cursors.

Invalidating data will make the algorithm ignore those points for road creation.
Parameters—by clicking on this button,
the parameters page is accessed
(Fig. 7.6) [1]. Each modiﬁcation of the parameters needs to be saved by clicking on
the Apply button.

This page regroups all parameters for the main algorithm. It is cut down in

several parts each regarding a certain aspect of the road.
(cid:129) General—this section regroups all the general parameters for the road:

i. Speed limits—deﬁne a default speed limit as well as the unit used for

speeds;

ii. Friction—deﬁnes a default friction between 0 and 1 for the entire road.

468

7 Creating Virtual Road Infrastructure

Fig. 7.6 AVL Road Importer—Parameters

(cid:129) Road—this section regroups two options:

i. Datum for conversion to UTM coordinates—you may choose the datum
used to convert the GPS data. The datum has a different precision depending
on the country;

ii. Default data precision—this value allows the user

the data
depending on the distance between two points. If this value is set to 5, it will
only keep points that are lower than 5 m apart and the minimum value is set
to 0.1 m.

to ﬁlter

(cid:129) Altitude—this section contains all options relative to the altitude:

i. Maximum allowed slope—choose the datum used to convert the GPS data.

The datum has a different precision depending on the country;

ii. Smoothing effect—this deﬁnes the applied smoothing to altitude. The used
algorithm is a moving average. If None is set, no smoothing is applied. If
low, medium, or strong is set the moving average applied once, twice, or
three times respectively.

7.1 AVL Road Importer

469

(cid:129) Algorithm—this section contains all options that only concern the algorithm:

i. Road width—this is the only parameter deﬁning the road. This value is used
to determine if the points will be removed or not depending on if the turn is
doable. The larger the value the harder it is to make the turn, hence more
values will be removed from the data.

ii. Loop circuit—this parameter is still experimental. It enables the creation of
a closed track. Activating this option will not only reconnect the endpoint to
the ﬁrst point but it will also try to correct the altitude to fully connect the
three dimensions of the road.

Execute—this is how to start the algorithm. Depending on the ﬁle size this step
may take some time. Once the algorithm ﬁnishes a ﬁle appears in the data explorer
(Fig. 7.7) [1]. This ﬁle should contain:
(cid:129) The original data in the measurement key O;
(cid:129) The parameter used for the algorithm in the measurement key P;
(cid:129) The results of the algorithm in the measurement key R.

To save this ﬁle, the user must right click on it and export it as a CTF, ATF, or

ATF-XML (Fig. 7.8).

Fig. 7.7 Result ﬁle

470

7 Creating Virtual Road Infrastructure

Fig. 7.8 Export the result ﬁle

7.1.4 Plot Submenu

The Plot submenu is accessible by clicking on the button Plot in the command bar.
In the submenu there are the following possibilities (Fig. 7.9) [1].
(cid:129) Elevation proﬁle—clicking on this button, will access the elevation proﬁle page
(Fig. 7.10). The purpose of this page is to verify the quality of the altitude.

Fig. 7.9 AVL Road Importer—Plot submenu

7.1 AVL Road Importer

471

Fig. 7.10 Elevation proﬁle

(cid:129) Speed limits—by clicking this button,

the speed limits page is accessed
(Fig. 7.11). On this page, the speciﬁc speed limits for all parts of the road are
deﬁned.
The user can deﬁne the speed limits using the band cursor to select a portion of
the road, and then click on a speed to be applied on this portion. By default the user
may choose between 50, 70, 90, or 110 (km/h). The used unit is the one that the
user speciﬁed in parameters submenu [1].

If the default values are not enough, the user can deﬁne own values in the

textbox on the right and click on Apply.

The graphs on the bottom left of the page allow the user to see the set speed

limits and it is updated every time a change is made.

The speed limits can be set up by automatic deﬁnition. In this section several
methods are available to try and automatically deﬁne the speed limit based on the
input vehicle speed coming from the data [1]. These methods are:

i. Method percentage—this algorithm will create speed limit zones based on the
maximum vehicle speed witnessed in the data. Four zones will be identiﬁed as:
25, 50, 75, and 100 % of the maximum vehicle speed (Fig. 7.12);

ii. Method-speciﬁc country—this algorithm will determine the speed limits to
apply based on the vehicle speed and thresholds deﬁned by the user. To deﬁne
the thresholds type them in the popup window (Fig. 7.13);

iii. Method max speed break down every X—this algorithm will determine the
cut-off vehicle speed into zones depending on the distance traveled X where X

472

7 Creating Virtual Road Infrastructure

Fig. 7.11 Speed limits

Fig. 7.12 Speed limits—Method percentage

7.1 AVL Road Importer

473

Fig. 7.13 Speed limits—Method speciﬁc country

can be either 5, 10, or 50 m. The algorithm will then apply the maximum of
the vehicle speed in the deﬁned zones as the speed limits for the road
(Fig. 7.14).

For each algorithm above, there will be a detection of zero values for the vehicle
speed. Every time a vehicle stop is detected there will be a stop panel added to the
road automatically that will be the duration of the stop event.

7.1.5 Export Submenu

The Export submenu is accessible by clicking on the button Export in the command
bar. In the submenu there are the following options (Fig. 7.15) [1].
(cid:129) InMotion test run—when clicking on InMotion test run,

the user will be
prompted for a directory to save the test run. The extension is ROAD, and this
test run only contains information linked to the road. It cannot be used as a
standalone in InMotion. It can, however, be imported directly in the Road menu
of InMotion. (this test run is not a digitalized road, the user has to import the
road segments it contains);

(cid:129) AVL CRUISE way ﬁle—when clicking on AVL CRUISE way ﬁle, the user will
be prompted for a directory to save the way ﬁle. The extension is WAY, and this
ﬁle contains only the altitude proﬁle versus the distance for now.

474

7 Creating Virtual Road Infrastructure

Fig. 7.14 Speed limits—Method max speed breakdown every X

Fig. 7.15 AVL Road Importer—Export submenu

7.1 AVL Road Importer

475

Fig. 7.16 HTML Google Map preview

(cid:129) HTML Google Map preview—when the original data is in GPS coordinates
(latitude, longitude) there is an HTML ﬁle generated automatically along with
the AVL CRUISE way ﬁle or the InMotion test run. To view their content, they
must be opened by using an Internet browser (Fig. 7.16).

Fig. 7.17 Google Earth section

476

7 Creating Virtual Road Infrastructure

Fig. 7.18 Google Map section

7.1.6 Going Online

It is possible to go online to be able to visualize the data in a friendlier manner.
Because Google Maps and Google Earth are great tools for this, AVL Road
Importer will connect to this software to offer the best visual experience. Also, the
user can go online and access those functionalities by clicking on the Google Earth
and Google Maps buttons.

When clicking on the Google Earth button (Fig. 7.17), Google Earth will be
opened and the data will be automatically displayed. There are two kinds of dis-
plays. The ﬁrst is to display only one point at a time. This point will be represented
as a car in Google Earth.

When clicking on the Google Maps button (Fig. 7.18), an Internet page will be
automatically opened with a Google Maps display of your selection. Each click on
this button will create a new Internet page.

Reference

1. AVL Road Importer (2013) User manual version 1.7, AVL France Technical Documentation

Chapter 8
Loop Powertrain Simulation

8.1 IPG CarMaker

8.1.1 Virtual Vehicle Environment

A virtual vehicle is a computer modeled representation of an actual vehicle with a
behavior that matches that of its real world counterpart. With CarMaker, the virtual
vehicle is made up of mathematical models that contain equations of motion or
kinematics along with other mathematical formulas that deﬁne the multibody sys-
tem. The model is parameterized with data that relates directly to the vehicle to be
studied [1].

By this approach it is possible to use CarMaker to test any vehicle with a
validated parameter set, and to easily switch between virtual vehicles by changing
the parameter data that are used in the vehicle model. The virtual vehicle contains
all parts of a real vehicle, including powertrain, tires, chassis, brakes, etc. It is also
easy to integrate real automotive controllers (ABS, ESP, ACC) or software modeled
controllers into the virtual vehicle by using hardware or software in the loop [2].
A virtual road is a digitized or computer-modeled representation of a road, track,
or course which simulates a real course or one that is generated speciﬁcally for
testing. With CarMaker, the road can be generated in two ways:
(cid:129) By combining individual road segments, such as straights and curves, to form a
larger road. For each road section there is a speciﬁc length, width, angle, slope,
pitch, friction coefﬁcient, etc., deﬁned that can be speciﬁed;

(cid:129) By using digitized data of an existing road that has been collected. With this
approach, the measured data that are taken by survey or some other method is
contained in a data ﬁle that is read by CarMaker and used as the road or a test
track during simulation [2].

A virtual driver is computer software, which simulates the actions of a real driver.
Everything that would normally be controlled by a real driver, such as turning the

© Springer International Publishing Switzerland 2015
B.O. Varga et al., Electric and Plug-In Hybrid Vehicles,
Green Energy and Technology, DOI 10.1007/978-3-319-18639-9_8

477

478

8 Loop Powertrain Simulation

steering wheel, stepping on the gas, brake and clutch pedals, shifting gears in a
manual transmission vehicle, etc., are controlled by the virtual driver. There are two
approaches that can be taken into account to perform the driver actions:
(cid:129) Simple control—with simple control, the actions are performed by specifying in

advance what will happen at a certain time or distance;

(cid:129) IPGDriver—the course is controlled by a smart computer driver, which tries to
maintain a course on a test track and can also plan ahead. The driver can be
modiﬁed to operate within speciﬁed limits. For example, a driver may have a
fast or slow reaction time, he may want to maintain a certain speed, and he could
be trying to go as fast as possible [3].

When the virtual vehicle, virtual road, and virtual driver are taken together, it can
refer to it as the Virtual Vehicle Environment (VVE), since the virtual vehicle
“drives” on the virtual road and is “driven” by the virtual driver (Fig. 8.1).

The CIT (CarMaker Interface Toolbox) consists of a number of tools (applica-

tions and utilities) that run on a host computer. The CIT includes the following:
(cid:129) The CarMaker GUI—this is the main Graphical User Interface which is used to
control the actions of the VVE, select the virtual vehicle parameter data, deﬁne
or select the virtual road, set the virtual driver parameters, deﬁne or load
maneuvers;

(cid:129) The Vehicle Data Set Editor—edit any parameter of the vehicle with a conve-
nient user interface. Each individual submodel class is editable in a separate tab;
(cid:129) The IPGControl—visualization and analysis tools IPGControl can be used to
view selected output quantities in real-time, load post-simulation data ﬁles, and
plot and analyze the results;

Fig. 8.1 Virtual Vehicle Environment (VVE)

8.1 IPG CarMaker

479

(cid:129) The IPGMovie—real-time 3D animation of the VVE. The virtual vehicle is
shown performing the speciﬁed driving maneuvers (performed by the virtual
driver) on the virtual road;

(cid:129) The Instruments—display the most important instruments, dials, and informa-
tion about the vehicle driving conditions like: pedal position, steering wheel
angle, gear selection, ignition, speedometer, tachometer, ESP and ABS warning
lamps, brake light, etc.;

(cid:129) DVA (Direct Variable Access) allow simulation quantities to be read and

modiﬁed interactively through a user-friendly graphical interface;

(cid:129) ScriptControl—test automation utility that allows scripts to be deﬁned, edited,
and executed. All the functions of the CIT can be controlled automatically using
ScriptControl;

(cid:129) TestManager—another utility for test automation. A mixture of script and GUI-

based creation and execution of test series [2].

8.1.2 CarMaker Main GUI

To start CarMaker under windows press the Start button and select Programs—IPG
—CarMaker.

The CarMaker main GUI pops up and automatically loads the project folders
where the user was working before last shut down of the program. Nonetheless, it
can easily switch the project folder by selecting File—Project Folder and select the
one project for work [2].

The main window of CarMaker is called the main Graphical User Interface GUI

(Fig. 8.2).

Fig. 8.2 Main GUI of CarMaker

480

8 Loop Powertrain Simulation

Car subsections describe all parameters required to parameterize the vehicle
model using the Vehicle Editor. In the excel tables by clicking once in a cell, their
position can be moved to another cell by using the keyboard arrows [2].

The functionalities that can be found under ﬁle intend to manage the vehicle data

set library. Below it can ﬁnd functionalities that are available:
(cid:129) To use a data set which is already built, corresponding vehicle ﬁle must be

loaded via the vehicle editor;

(cid:129) The user can also create a new vehicle data set from scratch. In this case, be
aware that even if this option is chosen, the Vehicle Editor is ﬁlled with default
values (the exception is the vehicle picture). If the vehicle parameterization not
ﬁnished before closing, a comment should be added;

(cid:129) Once the vehicle data set is parameterized, the changes can be saved or alter-

natively save them to a new ﬁle;

(cid:129) Note that there is the possibility to import a part of the vehicle from another

(cid:129) The Vehicle Generator gives the possibility to generate a vehicle model with

vehicle data set;

basic data only;

(cid:129) The Vehicle Data Set Generator can generate a vehicle with basic data. This can
be extremely useful if the work is dedicated on a new regulation system and on
the exact vehicle parameterization itself [2].

Bodies are the masses of the vehicle models and can be described in the Vehicle
Body tabs (Fig. 8.3) and Bodies (Fig. 8.4). According to the selected vehicle model
(ﬂexible or rigid), a different number of bodies can be parameterized. In case of a

Fig. 8.3 Vehicle data set

8.1 IPG CarMaker

481

Fig. 8.4 Bodies

ﬂexible body mode, the main body is split into two bodies. The main body/bodies
include all sprung mass of the vehicle [4].

Engine Mount: CarMaker offers the possibility to simulate an elastically
mounted engine. By activating this feature, an additional mass is added to the
model which needs to be connected to the main body by a joint. The required
settings can be speciﬁed in the Engine of the Vehicle Data Set Editor tab (Fig. 8.5).
The Engine Body is parameterized similar to the vehicle body. The position of
the center of gravity in the design frame is required, as well as the moments and
products of inertia [2].

Joint Engine section, the connection point from the engine mass to the vehicle
body is speciﬁed. Mounting generalized Joint Force Mode, each of the ﬁve force
elements Force X, Force Y, Force Z, Torque X, and Torque Y are made of a spring
and damper element. The ampliﬁcation factor can be used to easily manipulate the
spring and damper characteristics by a multiplication factor given in this ﬁeld.

The Characteristic Value description: the linear spring and damper characteristic
deﬁned by a single coefﬁcient in (N/m) for the spring stiffness and in (Ns/m) for the
damping.

1D look-up table description: nonlinear spring and damper characteristic deﬁned
the map requires the force in (N) over

by a look-up table. For the spring,

482

8 Loop Powertrain Simulation

Fig. 8.5 Engine mount

compression in (m); the damper element is speciﬁed by force in (N) over velocity in
(m/s).

Suspensions for a given axle: the spring characteristics are the same for both
sides of the vehicle. The Spring is modeled as a component that generates a force
when it is compressed or stretched (Fig. 8.6).

Fig. 8.6 Suspensions—spring

8.1 IPG CarMaker

483

Fig. 8.7 Suspensions—secondary spring

For each front and rear axle, the stiffness of the Secondary Spring can be deﬁned
with a simple coefﬁcient if the secondary spring force is a linear function of the
wheel travel variation (Fig. 8.7). If the mode not speciﬁed is selected, the secondary
spring is deactivated [2].

The stiffness parameter is either a simple coefﬁcient or a table according to the

selected parameter Mode.

Ampliﬁcation parameter enables to scale the stiffness of the secondary spring
very quickly for test purposes, instead of modifying the whole table. It can also use
this parameter to convert the values to ﬁt to the units required by CarMaker. The
default value is 1.0. If the value is 0.0, the secondary spring is deactivated [2].

For a given axle, the Damper characteristics are the same for both sides of the
vehicle (Fig. 8.8). The damper is modeled as a component that generates a force
when being compressed or deﬂected (reaction to the change of velocity) [2].

For each front and rear axle, the damper characteristic is deﬁned either by a

coefﬁcient or by a table of values according to the selected mode.

The characteristics of the damper are split into two domains: push and pull. For
each domain a different damping can be deﬁned. The push domain corresponds to a
positive damper speed, which means that the damper is being compressed.

For a given axle, the Buffer characteristics are the same for both sides of the
vehicle (Fig. 8.9). The buffers are used to limit the wheel travel in one direction or
in both up and down. If the wheel traveled far enough to hit one of the buffers, the
buffer acts like an additional spring [2].

That is why the user has to parameterize two buffers per axle (four in total),
stiffness for each buffer, and the wheel travel from which the buffers are activated in
both positive and negative directions.

The buffer stiffness can be parameterized by a coefﬁcient (mode Characteristic

Value) or by a table of values (mode look-up table 1D).

For each front and rear axle, the buffer stiffness are deﬁned either by a coefﬁcient

or by a table of values according to the selected mode.

484

8 Loop Powertrain Simulation

Fig. 8.8 Suspensions—damper

The characteristics of the buffer are split into two domains: push and pull, where

the push domain corresponds to a positive wheel travel.
In the Stabilizer tab, only the properties of

the single Anti Roll Bar
(ARB) element are speciﬁed. Its angle or length variation is deﬁned in the kine-
matics of the model [2].

Various Kinematics models are available (Fig. 8.10). The kinematics of the

model has to be speciﬁed or each of the front and rear axles separately.

The Compliance model takes into account the transition of the wheel when

forces are applied due to elasticity effects of the suspension (Fig. 8.11).

The user can choose between the following compliance descriptions that are
available in the model option on the compliance tab, for others the user has to select
the mode not speciﬁed and deﬁne them in an external kinematics ﬁle [2].

Wheel Bearing friction activates or deactivates the effect of friction at the wheel
bearings. The wheel bearing friction is characterized by a single coefﬁcient μ, which
deﬁnes the friction force on the bearing. The bearing radius R enables to evaluate
the friction torque on the bearing based on the friction force. Using the ampliﬁ-
cation factor amp the friction coefﬁcient can be scaled very quickly instead of
modifying the parameter itself [2].

External Forces are calculated by an external model and can be added to the
spring, damper, or stabilizer forces calculated by CarMaker. The model can be
generated by a C code or using MATLAB®/Simulink™.

8.1 IPG CarMaker

485

Fig. 8.9 Suspensions—buffer

Fig. 8.10 Suspensions—kinematics

Steering System consists of a mechanical module which deﬁnes the ratio
between the steering wheel angle and the steering rack displacement (Fig. 8.12).
Optionally, a power steering unit can be added by selecting the Pfeffer Steering
model which also regards friction losses in the steering system [2].

486

8 Loop Powertrain Simulation

Fig. 8.11 Suspensions—compliance

Fig. 8.12 Steering gear ratio

The Pfeffer Steering model

is a very detailed model of a steering system

including effects caused by friction losses, elasticity, and power steering.

The Mechanical module (Fig. 8.13) includes all mechanical components which

transfer torque from the steering wheel to the tie rods.

The Power Assistance module can be of the following modes: hydraulic (HPS),

electrical (EPSc and EPSapa), or user deﬁned (Fig. 8.14).

Because the power steering is a high-frequency system, the calculation of all
quantities once in the simulation cycle might not be sufﬁcient to reach correct
results. For this, the integration time can be enhanced to x-times of one simulation
cycle using the option integration sub-steps [2].

8.1 IPG CarMaker

487

Fig. 8.13 Mechanical module

Fig. 8.14 Power assistance module

488

8 Loop Powertrain Simulation

Fig. 8.15 Tires

The hydraulic power steering unit supports the steering wheel motion on the

base of hydraulic pressure generated by an engine-driven pump.

Using the DVA mechanism the user can implement his own assistance model or

a steering without assistance.

Tires are parametrized within the vehicle data set (Fig. 8.15). The purpose of the
tire models is to calculate the slips and the stress applied to the contract point on the
road (patch point) and then to convert them into stresses applied to the wheel center,
since the rest of the vehicle model directly uses those efforts.

Brake model determines the ratio between the forces at the brake pedal to the
braking torque at each wheel (Fig. 8.16). The brake system consists of hydraulic
models and does not contain any controller model.

Fig. 8.16 Brake

8.1 IPG CarMaker

489

Fig. 8.17 Powertrain—general

Powertrain module is a torque transmission model which transfers a torque
from the engine to the wheels. In reaction to that, the wheel speeds are modiﬁed and
the rotation speed of the different components of the driveline are calculated sub-
sequently (Fig. 8.17).

The engine is seen as a torque source producing its output depending on the
throttle position and on its speed (its speed is imposed by the wheel speeds) [2].
The Generic Powertrain typically consists of the engine, the clutch, the gearbox
and the driveline, which represents a classical powertrain with a combustion engine.
The way to parameterize the engine torque map is to use the engine mapping
model look-up table 1D drag and full load (Fig. 8.18). The mapping model look-up

Fig. 8.18 Powertrain—engine mapping

490

8 Loop Powertrain Simulation

Fig. 8.19 Powertrain—Fuel Consumption Map

table 2D engine speed and gas may be used instead if the user wishes to deﬁne the
torque values at mid-loads on his own. This is only necessary if you have a
complete and accurate torque map of an engine and if the tests require a very
accurate engine response [2].

For this model two characteristics have to be parameterized: the maximum
engine torque and the drag torque characteristics (at a given speed the gas pedal is
completely released). CarMaker interpolates the mid-load characteristics automat-
ically, depending on the speciﬁed exponent.

A Fuel Consumption Map can only be added using the engine model look-up
table (Fig. 8.19). Fuel tank parameters relating to the fuel and fuel tank can be
carried out on this tab [2].

The Clutch model enables the transfer of all or none of the torque produced by

the engine to the driveline part (Fig. 8.20).

Fig. 8.20 Powertrain—clutch

8.1 IPG CarMaker

491

The following clutch models are available:

(cid:129) Friction model for a conventional mechanical clutch;
(cid:129) Converter model for a vehicle equipped with an automatic transmission;
(cid:129) DVA model where the user must deﬁne the torque transmitted by the DVA

quantity.
The integrated lock-up table gives the possibility to deﬁne the speed at which the
converter is locked or unlocked for each gear in dependence on the throttle position.
The clutch is locked if the reference speed over-runs the lock speed limit and is
unlocked if the gear number changes or the reference speed under-runs the unlock
speed limit [2].

The gearbox module enables to convert the rotation speed of the shafts as well as

the transferred torque just like a real gearbox would (Fig. 8.21).

For the automatic model an automated shifting unit can be modeled (Fig. 8.22).
With driveline models the user can choose the type of torque distribution
(Fig. 8.23). The differential model transfers the torque from the input shaft to each
wheel or for a differential to each axle. On the other hand the speeds coming from
both output shafts are converted to a mid-speed imposed to the input shaft [2].

The differential models are exactly the same for the front and rear differential.
Concerning the models for the center or hang-on differentials, only a few param-
eters differ from the other differential (Fig. 8.24).

When a wheel, respectively a shaft, is slipping, the differential is able to transfer

a part of the torque to the wheel or shaft without slip, within a given limit.

The coupling model represents the differential models, which show how both

output sides of the differential are linked together.

The aerodynamic model applies additional variable forces to the vehicle body,
according to the vehicle speed. The adaptation of the map by accurate values is
low
often not required as the aerodynamic model

is of minor importance at

Fig. 8.21 Powertrain—gearbox

492

8 Loop Powertrain Simulation

Fig. 8.22 Powertrain—gearbox automatic model (gears and shifting limits)

Fig. 8.23 Powertrain—driveline

8.1 IPG CarMaker

493

Fig. 8.24 Powertrain—driveline differential model

speeds [2]. Under about 100 km/h the inﬂuence of the aerodynamic forces is so
small that the user can afford to leave the default values (Fig. 8.25).

In the Sensors tab, there is the possibility to deﬁne four types of sensors: Sideslip
Angle Sensors, Body Sensors, Driving Assistance Sensors, and Road Property
Sensors (Fig. 8.26).

Sideslip Angle Sensors are located in the vehicle center of gravity by default.
A Body Sensor is an inertial sensor that can be positioned anywhere on the vehicle
to measure the position, velocity, rotational velocity, acceleration and rotational
acceleration. Up to 10 body sensors can be placed on the vehicle [2].

Driving Assistance Sensors (DASensor) can be parameterized independently,
just by selecting the sensor in the general area. The parameters that are speciﬁc to
the selected sensor are displayed under the graphical representation of the vehicle.
The Free Space Sensor Module (FSSensor) is an extended DASensor module,
whose sensor beam is subdivided in equiangular horizontal and vertical segments.
The Trafﬁc Sign Sensor (TSSensor) detects all or preselected trafﬁc sign which
falls within its deﬁned range and horizontal/vertical aperture angles. The sensor
cross-checks if the sign faces the sensor and then sorts all detected signs in
ascending order with distance.

The Line Sensor module is used to detect lines and barriers that have been
deﬁned by the user on the road dialog using the road marking and/or trafﬁc barrier
options as a new bump or marker. It can be compared to an idealized camera.

494

8 Loop Powertrain Simulation

Fig. 8.25 Aerodynamic

Fig. 8.26 Sensors

8.1 IPG CarMaker

495

The Road Property Sensor collects road information at a user deﬁned point
ahead of the vehicle. Several attributes like the road bend and its deviation, road
marker attributes (speed limit), or the longitudinal and lateral slope are detected.

This sensor can give information about the relative position: deviation distance,
deviation angle, and current driving lane are calculated. This data can be important
for various applications such as lane keeping assistance, lane departure warning,
autonomous driving; sign detection, energy management, pre-scanning, and opti-
mization of fuel consumption or detection of wheel lift [2].

In the Miscellaneous module the user can create his own vehicle graphics.
Supported ﬁle types are PNG images (Fig. 8.27). Using PNG pictures, any photo
can be imported.

A picture of the vehicle in top view and another one in side view is required. To
create a PNG using IPGMovie, the picture needs to be scaled to the length of the
vehicle (1 m = 100 pixel) and saved as a PNG image. Using the graphical tool,
everything around the vehicle needs to be deleted to create a transparent
background.

Then, select all and paste it to another ﬁle of the size of 560 × 226 pixels (72
dpi). Move the picture to the left side of the window (in case of a side view
additionally align it vertically to the bottom). The top view should be saved in the
same folder and ﬁnally the pictures can be selected in the CarMaker GUI [2].

Loads: The following section will present informations about the additional
loads (Fig. 8.28). With the so-called trim loads there is the possibility to add some
extra loads in order to simulate passengers, luggage, and heavy measurement
equipment. Check if the static position of the vehicle using ModelCheck, the effects

Fig. 8.27 Miscellaneous

496

8 Loop Powertrain Simulation

Fig. 8.28 Loads

of trim, loads will be included in the height of the vehicle’s center of gravity or the
wheel positions at the start of the conﬁguration.

For some speciﬁc simulation purposes, the user may want to simulate a TestRun
with an additional load on the vehicle, but still want to check the static state of the
vehicle without it. The picture represents the vehicle body, deﬁned loads (this is
illustrated by a point) [2].

Maneuver is the concept of CarMaker for the driving scenario (Fig. 8.29) and it
into several maneuver steps

is following maneuver deﬁnition, which is split
(acceleration, braking, etc.).

2

3

4

1

Fig. 8.29 Maneuver menu: 1 list of the maneuver steps, 2 speciﬁcation of a maneuver step, 3
longitudinal dynamics, 4 lateral dynamics

8.1 IPG CarMaker

497

These maneuver steps are called mini-maneuvers. Each mini-maneuver is

composed of:
(cid:129) Longitudinal dynamic actions: accelerating, braking, gear shifting, etc.;
(cid:129) Lateral dynamic actions: steering;
(cid:129) Additional actions, deﬁned by a very easy script language.

CarMaker offers a convenient GUI to build a great diversity of driving scenarios.
To build a driving scenario how to add and parameterize successive and various
maneuver steps it is necessary to control the vehicle as the user wants. The list of
the maneuvers steps is displayed and can be built in box 1.

The ﬁrst entry in the maneuver list serves to specify starting conditions. Possible
settings are the initial speed, the gear number, the steering wheel angle, and track
offset.

A new maneuver step is added by using the New button at the bottom of box 1.
The maneuver steps are always inserted ahead of the one selected. A maneuver step
can be selected by clicking on the maneuver list in box 1; it is then highlighted in
blue. To add a step to the end of the list, click on the entry “ ==== END ==== ” to
select it, and then click on the New button.

Maneuver steps can also be copied and pasted, deleted, or imported from another
TestRun. You can ﬁnd the same functionality Import by clicking with the right
mouse button anywhere in the Maneuver GUI [5].

After creating a maneuver step,

the actions need to be deﬁned. Each
mini-maneuver consists of duration (box 2) and a description of the driver’s task,
separated in longitudinal and lateral dynamics (box 3 and 4).

On the speciﬁcation of a maneuver step (box 2) the user can deﬁne an end
condition for each maneuver step using real-time expressions. The classical end
conditions—time or distance—can be directly entered in the duration ﬁelds.

Longitudinal dynamics (box 3) are available to fully automate and detailed speed
and pedal control. To accelerate and brake the vehicle according to its dynamic
limits, the option IPGDriver should be chosen (closed loop maneuver). This option
activates the driver model for the longitudinal dynamics.

Possible speciﬁcations of lateral dynamics (box 4) are available to control the

steering wheel [5].

Simulation the whole control of the VVE, and with this of the CarMaker
simulation, is done via the CarMaker main GUI. The status of the simulation can be
observed in the simulation box.

Storage of Results mode collects only selected data and it is temporarily stored
in a ring buffer without being saved to the disk automatically. For mode saves all is
selected, all data is continuously and automatically saved to the disk.

If one of the history modes is selected, the data is temporarily stored in a ring
buffer. The saving process is started manually at the end of the simulation by clicking
the Save button. The amount of saved data depends on the history mode that has
been selected. If the mode history 10 s is selected, clicking on save at the end of the
simulation will save simulation results for the last 10 s of the simulation [6].

498

8 Loop Powertrain Simulation

8.1.3 CarMaker Main Parameters

IPGRoad, the road model of CarMaker, enables to calculate the position of any
point on the road surface, including its coefﬁcient of friction (Fig. 8.30). IPGRoad
describes the centerline of the road (x, y, z), which is symbolized by the white
stripes on the picture above.

Once the road geometry is deﬁned, the track width counting from the centerline
to both sides of the road has to be parameterized, too. The same goes for the friction
coefﬁcient of the road surface. In addition to that, it can redeﬁne the width and
friction coefﬁcient only for a certain section of the road. Once the TestRun has
started, the road deﬁnition is automatically linked to IPGMovie.

The IPGRoad dialog box can be accessed from the main GUI by selecting
Parameters—Road. The ﬁrst tab that appears shows the general settings of the road
(Fig. 8.31). The global settings are [5]:
(cid:129) Start coordinates x, y, z (m) deﬁnes the origin of the road;
(cid:129) Start direction (deg) deﬁnes the angle offset from the ﬁrst segment regarding the

x-axis;

(cid:129) Car starts at (m) deﬁne at which distance the car should start;
(cid:129) Driving lane should be used: the left or the right one;
(cid:129) Country is option for the visualization and availability of the trafﬁc signs;
(cid:129) Track width (m) is deﬁned on both sides of the centerline;
(cid:129) Margin width (m) the margins are basically longitudinal stripes on both sides of

the entire road length;

(cid:129) Friction stripe (m) in order to have a variable friction coefﬁcient along the track

width up to two stripes can be deﬁned.

The deﬁnition of the road geometry with a segment-based approach consists of a
succession of various segments (straight lines, curve left, or right) with correctly

Fig. 8.30 Road in IPGMovie

8.1 IPG CarMaker

499

Fig. 8.31 Road—general settings

parameterized properties in order to build a complete road. To use this method,
move to the second tab of the IPGRoad dialog box called Segments (Fig. 8.32).

To duplicate a segment, select the respective segment, click on “Copy”, select

the segment “ ==== END ==== ”, and ﬁnally click on the button “Insert” [7].

The segment list is displayed and can be built in the box at the bottom left of the
road GUI. At this point, segments can be added or deleted. Once the geometry of

Fig. 8.32 Road—segments

500

8 Loop Powertrain Simulation

Fig. 8.33 Road—Bird’s-Eye
view

the road is deﬁned either using digitized road data or the segment-based approach
the user can check it with the Bird’s-Eye view (Fig. 8.33).

An IPGMovie interface tab in the road dialog deﬁnes a road in terms of seg-

ments, bumps, markers, vehicle start position, etc. (Fig. 8.34).

CarMaker offers the possibility to use real measurements to deﬁne the maneu-

vers (Fig. 8.35).

Fig. 8.34 Road—IPGMovie interface

8.1 IPG CarMaker

501

Fig. 8.35 Input From File

Several data may be read from a ﬁle: vehicle speed, steering wheel angle,
steering torque, pedal position, gear number, park brake position, and the pressure
in the master brake cylinder.

This functionality is referred to as Input From File (IFF), and its corresponding

GUI can be reached via the CarMaker GUI—Parameters—Input From File.

By clicking on the GUI using the right mouse button, a context menu opens. The
user can choose between Reset, Load, Save Conﬁguration, Import, and Edit Aliases.
The conﬁgurations can be loaded from the project, shared and central directory
folder SimInput/Settings, whereas the saving of the conﬁgurations is possible only
within the project directory folder SimInput/Settings.

The ﬁle containing the measurement loads is the Input File tab. Only one ﬁle can
be chosen, thus if the measurements are split into several ﬁles, the user should
gather them into a single one.

This ﬁle must be a text ﬁle without commas or other punctuation marks and
should consider the following syntax: each column is referred to as a channel. Tabs
are allowed to separate the columns of each channel: the ﬁrst line speciﬁes the
channel names. In an optional second line, the unit and/or a factor for each channel
can be speciﬁed [8].

502

8 Loop Powertrain Simulation

Any input ﬁle requires a Time Channel. Without this channel, the IFF func-
tionality cannot work properly. It can be selected from the available channels using
a drop-down menu on the right side of the Channel in File. It is also possible to
deﬁne channel aliases for an automatic selection of a channel. This is possible by
clicking the right mouse button on the GUI and choosing Edit Aliases.

In the Starting Conditions tab the conditions for gear step, velocity, and maxi-

mum gas are used as initial values at the start of the maneuver.

In order to have a steady situation at the start of the maneuver, CarMaker starts a
procedure to reach these values. The parameterized maneuver does not start and the
simulation status in the CarMaker GUI remains on Preparation as long as the
Starting Conditions are not reached.

Selecting and formatting the Quantities to overwrite are the list of the quantities
that may be overwritten. In fact, it cannot be overwritten by the IFF functionality.
This channel is used by functionality, the option Speed Proﬁle for the deﬁnition of
the longitudinal dynamics in the maneuver GUI.

The four last quantities are referred to as user deﬁned. This means that the user
can link other quantities to the IFF functionality via the C-interface of CarMaker.
IPGDriver calculates a static desired course at the beginning of the simulation.
During this calculation the driver is able to optimize the path with respect to corner
cutting [5]. IPGDriver is a controller for following a course and a speed controller
on a given track (Fig. 8.36).

IPGDriver enables you to add the control actions of a human driver to your
complete vehicle simulation. These actions include the steering, braking, throttle
position, gear shifting, and clutch operation. To sum up, the driver actions are:
(cid:129) Choice of driving course within the lane borders (corner cutting);
(cid:129) Steering;
(cid:129) Choice of the driving speed according to the course and the vehicle behavior;
(cid:129) Inﬂuence on the speed over the accelerator and brake pedal, as well as over the

clutch pedal and gear selection;
(cid:129) Regard trafﬁc objects and follow.

CarMaker includes two versions of IPGDriver:

(cid:129) User parameterized driver: this model is part of every version of CarMaker. The
user parameterized driver can perform a driver adaptation to automatically learn
about the vehicle limits by performing a preset sequence of maneuvers;

(cid:129) Racing driver: this model is available in the pro version of CarMaker and
enables the optimization of the lap time in function of the speed and to perform a
driver adaptation procedure to automatically ﬁnd these limits.

The option User parameterized Driver allows parameterization of the driver

model in the tab Standard Parameters.

IPGDriver is able to recognize trafﬁc objects driving ahead. If the check box

Trafﬁc is activated, the driver will follow the trafﬁc objects (Fig. 8.37).

Using the Environment GUI (Fig. 8.38), it is possible to deﬁne environmental
conditions like the temperature, the time of day, or the wind velocity for the

8.1 IPG CarMaker

503

Fig. 8.36 IPGDriver—standard parameters

Fig. 8.37 IPGDriver—trafﬁc

504

8 Loop Powertrain Simulation

Fig. 8.38 Environment

simulation [6]. If the model takes these parameters into account, they can inﬂuence
the results of the simulation.

The generic model uses a simpliﬁed approach to calculate the environmental air
temperature, pressure, and density. Other environmental parameters are kept con-
stant. It is possible to deﬁne temperature offsets depending on the time of day
and/or distance. Both offsets can be deﬁned via the look-up tables.

8.1.4 Start Simulation

To start the ﬁrst simulation (Fig. 8.39) open TestRun (File—Open—Examples—
Vehicle Dynamics—Training). Start the simulation by hitting the green Start button
in the CarMaker GUI. Open the Instruments (File—Instruments) and open
IPGMovie (File—IPGMovie).

When the user starts the simulation for the ﬁrst time, the CarMaker GUI con-
nects itself to the application. If all preparations are completed, the program is really
performing the simulation of the TestRun. It normally remains in this state until the
TestRun ends or is aborted because of some error condition or manual intervention
of the user [9].

IPGControl is a tool that displays diagrams (Fig. 8.40). To use IPGControl
online load the work model and start a simulation. A diagram is created by choosing
the Quantities (Car.ax, DM.Brake, DM.Steer.Ang, etc.) and the Reference Quantity
(Time).

8.1 IPG CarMaker

505

Fig. 8.39 Simulation—IPGMovie and Instruments

To use IPGControl ofﬂine, perform a simulation and select save to the store of
results. In IPGControl load the File—Load File—SimOutput—NameOfPC—Date
—model_name.erg. After selecting the result ﬁle to be loaded, it appears in the list
of available data sets [2].

Session log window is opened automatically if errors occur. It can be opened

manually over main menu from: Simulation—session log (Fig. 8.41).

Session log is found in the Simulation menu and that is a record of events for
each simulation in a log ﬁle. Indeed, it is useful to keep a history of important or
unusual situations and events during the simulation of a TestRun that does not
disappear when the simulation is ﬁnished or the user turns off the computer. This
might be of particular interest for test automation, as the user can trace any potential
errors that might have during a given session.

By pressing the Analyze button the user will proceed to the system analysis. Its

results will be displayed and classiﬁed according to the following criteria [2]:

506

8 Loop Powertrain Simulation

Fig. 8.40 Simulation—IPGControl

(cid:129) Project: a list of all projects (deﬁned with Settings > Result Folder) that displays

the total simulation time and distance for each project.

(cid:129) User: all users that have run simulations on the system are listed in this section.

Total simulation time and distance for each project are shown as well.

(cid:129) TestRun: TestRun ﬁles that have been loaded and played in the deﬁned time

frame appear in this section with total simulation time and distance.

8.2 CRUISE—CarMaker Co-Simulation

507

Fig. 8.41 Opening session log window

8.2 CRUISE—CarMaker Co-Simulation

8.2.1 General Settings

The AVL CRUISE simulation tool is developed by the Advanced Simulation
Technologies (AST) team of the AVL List GmbH. AVL CRUISE is software for
vehicle’s driving performance, fuel consumption, emissions, and driving quality
simulation.

Although AVL CRUISE is able to simulate the whole vehicle, the focus is on the

simulation of the powertrain.

AVL CRUISE reduces the analysis effort with a ready-to-use vehicle analysis
platform. Vehicle modeling of any powertrain topology with scalable ﬁdelity is
done with a unique sub-system layer concept. This approach enables the reuse of
models or any of its sub-systems, exactly matching the application needs in dif-
ferent development phases of a consistent vehicle development process [10].

AVL CRUISE allows the simulation of vehicle driving performance, fuel con-
sumption, and emissions. This concept can be used for modeling all vehicle con-
ﬁgurations with scalable ﬁdelity. This approach allows the reuse of models or
sub-systems in different optimization phases of a process in order to improve
vehicle performances.

508

8 Loop Powertrain Simulation

Fig. 8.42 Creating working directory

If a AVL CRUISE powertrain is chosen in the vehicle data set CarMaker starts the
AVL CRUISE simulation program during the initialization phase of the TestRun
simulation.

A CarMaker working directory is created over main menu File—Project Folder—

Create Project (Fig. 8.42).

Select (Fig. 8.43).

Selecting CarMaker working directory over main menu: File—Project Folder—

Fig. 8.43 Selecting working directory

8.2 CRUISE—CarMaker Co-Simulation

509

Fig. 8.44 Stand-alone simulation

After creating and selecting the working directory, CarMaker is supposed to be
ready to run. To test CarMaker stand-alone simulation open one of the examples
over File—Open—Examples—VehicleDynamics—Road_Hockenheim_R8
and
then press Start button and the simulation should run (Fig. 8.44).

8.2.2 CRUISE—CarMaker Interfaces

Preparing a AVL CRUISE powertrain for CarMaker co-simulation requires the
introduction of several new components in AVL CRUISE (CM-Car and Hub
component) as well as usage of system GUI feature and SAM calculation task.
On AVL CRUISE side the preparation for co-simulation are [11]:
(cid:129) Building model with speciﬁc components—modules for co-simulation (CM-Car

and Hub module);

(cid:129) Using system/sub-system to switch between AVL CRUISE stand-alone simu-

lation and co-simulation with CarMaker;
(cid:129) Setup SAM calculation task of co-simulation;
(cid:129) Some special modules needed for AVL CRUISE stand-alone simulation must be

excluded in co-simulation model (Vehicle, Cockpit, etc.);

On CarMaker side the preparation for co-simulation are:

(cid:129) Creating CRUISE working directory inside a directory CarMaker;

510

8 Loop Powertrain Simulation

(cid:129) Copying and renaming the calculation kernel ﬁle (CRUISE\bin\CRUISE_m.dll

in CarMaker\lib\CRUISENT.dll) inside directory of CarMaker;

(cid:129) Selecting AVL CRUISE powertrain and Project Folder for co-simulation.
(cid:129) On both AVL CRUISE and CarMaker the preparations for co-simulation are:
(cid:129) Harmonizing SimParameters and Memory Management.

The CM-Car component deﬁnes the interface in co-simulation between
AVL CRUISE powertrain models calculated by SAM calculation task and
CarMaker simulation package (Fig. 8.45) [12].

The interface component is exchanging the information between AVL CRUISE

and CarMaker and there must be one CM-Car module in the vehicle model.

At every time step, AVL CRUISE data will go to the CarMaker application
through Data Bus input channels CRUISE to CarMaker, and from there, the data
comes back to AVL CRUISE through output channels CarMaker to CRUISE which
can be connected with AVL CRUISE components [11].

This interface allows the user to easily establish a working AVL CRUISE
powertrain model for CRUISE—CarMaker co-simulation. The main settings to be
entered in the CM-Car interface are the following:

Fig. 8.45 CM-Car component in AVL CRUISE

8.2 CRUISE—CarMaker Co-Simulation

511

(cid:129) Manual or Automatic Shift Mode—information about using gearbox in vehicle

model and it is needed by the IPGDriver;

(cid:129) Transmission Ratio—the complete transmission ratio between the gearbox

output speed and wheel speed and it is needed by the IPGDriver;

(cid:129) Idle Speed—the value has to be consistent with the engine idle speed inside the

engine module;

(cid:129) Gear Ratio Table—value of the transmission ratio for complete gearbox and
supposed to be consistent with transmission ratio values in gear ratio table of
gearbox module;

(cid:129) Body—the drive torque is supported by the car chassis;
(cid:129) Wheel carrier—the drive torque is supported by the wheel carrier.

The component hub is a combination of a brake and a virtual wheel (Fig. 8.46).
It is used in models with an interface to a co-simulating program which simulates
the environment, the vehicle, and the wheel [11].

The component has the Data Bus inputs braking torque and (wheel) resistance
torque which can be connected with an interface component like AVL CRUISE
interface or CM-Car.

Inertia moment input is actually not necessary because this value is overwritten

with the wheel inertia given in the vehicle data set of CarMaker.

To avoid problems with slightly rotating wheels during standstill it is recom-
mended to uncheck the dynamic mode. dynamic mode is deactivated by default.
Deactivation may be done in modeling a sticking brake in kinematic mode. When

Fig. 8.46 Hub component in AVL CRUISE

512

8 Loop Powertrain Simulation

set to dynamic, the brake calculation always stays dynamic and never switches to a
kinematic connection.

The most important aspect is that there are exactly the same numbers of Hub
modules as wheels in the model and they are properly connected or positioned like
in the AVL CRUISE stand-alone model. The hub location change is done in the
properties dialog by choosing a proper location from the pull-down menu.

SAM (System Analysis Mode) folder with system analysis task is added in the

calculation task by default (Fig. 8.47).

The system analysis simulation is used to analyze the parts of the driveline or
components in sub-system. It is switched on/off with a check box on the Calculation
Center application form.

There is no need to deﬁne standard vehicle speciﬁc tasks such as Cycle Run, Full
Load Acceleration, etc. Components Cockpit, Vehicle and task components Driver,
Course and Proﬁle are also not required.

SAM Task will be used in AVL CRUISE powertrain model for calculation of
powertrain quantities which are required and transferred to CarMaker application
[11].

The model with the interface for co-simulation developed in AVL CRUISE will
be saved in the working folder CarMaker/CRUISE, where it will be loaded and
launched as project work in the application CarMaker [11].

Choose the powertrain folder in the vehicle data set from CarMaker. In the

pull-down menu choose AVL_CRUISE (Fig. 8.48).

To include the AVL CRUISE powertrain in the CarMaker simulation environ-
ment, click on the Browse button to select the desired AVL CRUISE powertrain.
Select Open and AVL CRUISE powertrain will be integrated into the CarMaker
simulation environment as shown in the following ﬁgure.

In order to really include AVL CRUISE powertrain in CarMaker simulation
environment, press folder button to select desired AVL CRUISE powertrain. In the
Project input ﬁeld there must be a path to the AVL CRUISE PRJ ﬁle. Select Open
and AVL CRUISE powertrain will be integrated into CarMaker Simulation
Environment (Fig. 8.49).

Fig. 8.47 SAM (System Analysis Mode) folder

8.2 CRUISE—CarMaker Co-Simulation

513

Fig. 8.48 CRUISE—CarMaker interface

For the purposes of this manual a AVL CRUISE powertrain model will be
constructed from scratches, using only one standard AVL CRUISE model.
Therefore, select that model using the Start AVL CRUISE command.

8.2.3 Model for Co-Simulation

In order to make the ﬁnal step toward including AVL CRUISE powertrain in
CarMaker environment is, enough to select already prepared AVL CRUISE pow-
ertrain model through CarMaker File Explorer and press Open.

AVL CRUISE will open and when selecting Vehicle Model, the user can view

and extract it from the AVL CRUISE GUI screen (Fig. 8.50).

This AVL CRUISE model consists of one system and one sub-system, i.e., all
model components are contained in one sub-system of the model. In order to
prepare AVL CRUISE powertrain model for CarMaker co-simulation the user has
to create two systems, each with three sub-system.

514

8 Loop Powertrain Simulation

Fig. 8.49 AVL CRUISE powertrain integrated into CarMaker

Fig. 8.50 Vehicle Model in AVL CRUISE

8.2 CRUISE—CarMaker Co-Simulation

515

Fig. 8.51 Adding a new sub-system

First step is to add two sub-system in the current system. Right click on
sub-system 001 in sub-system window part and select add new sub-system options
as shown in Fig. 8.51.

Repeat this procedure to create another sub-system in system 001. The result of
this procedure should be one system with three sub-systems (sub-system 001,
sub-system 002, and sub-system 003) [11].

In order to distinguish all further actions in system and sub-system structure
rename the current system into AVL CRUISE, sub-system 001 into Vehicle,
sub-system 002 into Powertrain, and sub-system 003 into CarMaker. After that,
select all components that are not part of the powertrain and right click somewhere in
the Vehicle Model area and then select sub-system—Vehicle. All selected compo-
nents will be added to the Vehicle sub-system of the AVL CRUISE system [11].

Additionally, the powertrain components of Aut FWD model must be added to
the Powertrain sub-system of AVL CRUISE system. To do so, select all remaining
components in Vehicle Model window again, right click somewhere in Vehicle
Model area and then select sub-system—Powertrain (Fig. 8.52).

The selected components for the Vehicle sub-system are: Vehicle, Wheels,

Brakes, Catalyst, Cockpit, Monitor, and ASC.

Hence that CarMaker sub-system of AVL CRUISE system contains no com-
ponents so far. Therefore, we added already mentioned components CM-Car and
hub to the CarMaker sub-system (Fig. 8.53). CM-Car and hub components can be
found in Modules—Special Modules section. Select CarMaker sub-system in
AVL CRUISE system and use drag&drop technique to add one CM-Car component
and four hub components to that sub-system. Since the hub component in fact
represents brake and virtual wheel, mechanical connection must be made so that
front axle hub components are connected to the differential.

Complete CarMaker Sub-System can be loaded with corresponding modules.
With a right mouse button click on sub-system area and from sub-systems popup

516

8 Loop Powertrain Simulation

Fig. 8.52 Adding selected components to the Vehicle sub-system

Fig. 8.53 CarMaker sub-system

menu load CM-Car.sub from directory data\sub_system. After, rename and arrange
CarMaker sub-system, select each component and adjust it with move and stretch to
gain position and shape/look of the current model.

Next step is to make a distinction between AVL CRUISE simulation model and
CarMaker speciﬁc AVL CRUISE powertrain model. Therefore, we will ﬁrst create

8.2 CRUISE—CarMaker Co-Simulation

517

a copy of the built system. Right click on AVL CRUISE system, select duplicate
and rename the created system into something more intuitive CarMaker PT.

Deselect activation and visibility of AVL CRUISE sub-system, while it is not
part of the CarMaker PT system and establish missing mechanical connection from
the differential to each of the front hubs.

There are now two systems (AVL CRUISE and CarMaker PT), each with three
sub-systems (Vehicle, Powertrain, and CarMaker). Next step is to group some of
the sub-systems into each system: AVL CRUISE System includes Vehicle and
Powertrain (Fig. 8.54), CarMaker PT system and includes Powertrain and
CarMaker (Fig. 8.55).

The connections in the data bus for CarMaker sub-system are described in

Table 8.1 and in Fig. 8.56.

Table 8.2.

The connections in the data bus for the drivetrain sub-system are described in

After all necessary connections have been established go to Calculation Center
of AVL CRUISE and activate SAM Task and adjust parameters with the following
values:
(cid:129) End Time: check Inﬁnite option;
(cid:129) Time Step: 0.001 (s);
(cid:129) Simulation 5: FSS Heun.

Fig. 8.54 AVL CRUISE system

518

8 Loop Powertrain Simulation

Fig. 8.55 CarMaker PT system

Table 8.1 Data Bus connection for CarMaker sub-system

Component Requires

Input Information

Component Delivering Output Information

CarMaker

Hub Front Right

Hub Rear Right

Hub Front Left

Hub rear left

Differential
Drive Torque FL
Differential
Drive Torque FR
Engine
Engine On/Off
Engine
Engine Speed
Engine
Engine Torque
Braking Torque
CarMaker
Resistance Torque CarMaker
Braking Torque
CarMaker
Resistance Torque CarMaker
Braking Torque
CarMaker
Resistance Torque CarMaker
CarMaker
Braking Torque
Resistance torque
CarMaker

Output Torque 1
Output Torque 2
Operation Control
Engine Speed
Engine Torque
Braking Torque FR
Resistance Torque FR
Braking Torque RR
Resistance Torque RR
Braking Torque FL
Resistance Torque FL
Braking Torque RL
Resistance Torque RL

8.2 CRUISE—CarMaker Co-Simulation

519

Fig. 8.56 Data Bus connection for CarMaker

Table 8.2 Data Bus connection for drivetrain sub-system

Component Requires
Engine

Gearbox
Gearbox Control

Gearbox Program

Component Delivering Output Information
CarMaker
CarMaker
Gearbox Control
Gearbox
CarMaker

Input Information
Load Signal
Start Switch
Desired Gear
Current Gear
Desired Gear Cockpit
Desired Gearbox Program Gearbox Program
Operation Control
Reference Speed
Velocity
Current Gear
Load Signal
Speed

Engine
Torque Converter
CarMaker
Gearbox
CarMaker
Gearbox

Load Signal
Engine Start Switch
Desired Gear
Current Gear
Desired Gear
Desired Gear
Operation Control
Turbine Speed
Vehicle Velocity
Current Gear
Load Signal
Output Speed

520

8 Loop Powertrain Simulation

8.3 Running the Simulation for Electric Model

To run the simulation, ﬁrst the model must be connected with AVL CRUISE,
(connection with the desired model must be checked), and then the road must be
loaded, with the desired maneuvers.

To check the connection with AVL CRUISE, the model must be opened like

shown in Fig. 8.57.

After pressing the start button, like shown in Fig. 8.39, the simulation starts. In
the IPGControl data window, the user can monitor any parameters by selecting
them from the quantities tab.

For the electric model the four main monitored properties are: the Current [A],
the Voltage [V], Energy [kJ], and Energy Stored [kJ]. They are selected from
Quantities—AVL.CRUISE.efg like shown in Fig. 8.58 and monitored in real time,
as seen in Fig. 8.59.

If the user is interested in the powertrain, the parameters that can be monitored
are shown in Fig. 8.60 or if the interest in the Driver, the parameters are shown in
Fig. 8.61.

In order to see the whole variation of the parameters, total ﬁt must be selected

from the display tab.

After the simulation stops, and after pressing total ﬁt, the recorded variations can
be exported either as a. csv ﬁle and post-processed further like in Figs. 8.62, 8.63
and 8.64, or they can be saved as they were recorded and printed (Fig. 8.65).

By exporting the Current [A], the Voltage [V], Energy [kJ] and Energy Stored
[kJ], the user can analyze the state of the battery, the recovered energy either versus
elapsed time, or by the track. Basically, the user can conclude which is the optimal
track for recovered energy or underline the optimal range.

Fig. 8.57 Connection to AVL CRUISE check (electric model)

8.3 Running the Simulation for Electric Model

521

Fig. 8.58 Selecting the desired properties to monitor

Fig. 8.59 Monitoring the electric model in the IPGControl data window

522

8 Loop Powertrain Simulation

Fig. 8.60 Monitoring the Powertrain properties

Fig. 8.61 Monitoring the Driver properties

8.3 Running the Simulation for Electric Model

523

Fig. 8.62 Export of the
recorded data: Voltage

322.2

322.1

322

]

V

[
 
e
g
a
t
l
o
V

321.9

321.8

321.7

321.6

321.5

]
J
k
[
 
y
g
r
e
n
E

1.20E+04

1.00E+04

8.00E+03

6.00E+03

4.00E+03

2.00E+03

0.00E+00

-2.00E+03

]

A

[
 
t
n
e
r
r
u
C

500
450
400
350
300
250
200
150
100
50
0
50-

0

50

100

150

200

250

300

350

Time [s]

0

50

100

150

200

250

300

350

Time [s]

0

50

100

150

200

250

300

350

Time [s]

Fig. 8.63 Export of the
recorded data: Energy

Fig. 8.64 Export of the
recorded data: Current

524

8 Loop Powertrain Simulation

Fig. 8.65 Export of the
recorded data: Energy Stored

]
J
k
[
 
d
e
r
o
t
S
 
y
g
r
e
n
E

4.00E+00

3.50E+00

3.00E+00

2.50E+00

2.00E+00

1.50E+00

1.00E+00

5.00E-01

0.00E+00

-5.00E-01

0

50

100

150

200

250

300

350

Time [s]