The thermal characteristic of automobile air conditions is very important
to improve comfort. The efﬁcient heating, ventilating, and air conditioning (HVAC)
systems for automotive applications have determined a great impulse in the research
to predict the thermal performance. Limitations of the measurement data and
reduction in design cycles have driven the demand for numerical simulation.
Computational ﬂuid dynamics (CFD) is an effective technology by providing
valuable data which experimental methods cannot measure. This chapter presents
the basic numerical theory and method of CFD for heat transfer in passenger
compartment.

Keywords Computational ﬂuid
compartment

dynamics

(cid:129) 3D modeling (cid:129) Passenger

1.1 Introduction

Thermal comfort is one of the most important factors of comfort inside the passenger
compartment. Limitations of the measurement data and reduction in design cycles
have driven the demand for numerical simulations. The rapid development of the
computational ﬂuid dynamics (CFD) technique has become an attractive way to
analyze the ﬂuid ﬂows and thermal characteristics of passenger compartments.

During the past few decades, some efforts have been made to study the ﬂuid
ﬂows and the passenger compartment’s comfort. Han et al. [1] conducted the
simulation on compartment cooling by solving the reynolds-averaged navier-stokes
equations and energy equation, they found that overall ﬂow information such
as the propagation of cold air fronts, turbulent jet penetration and buoyance-
included recirculating ﬂows. Wan et al. [2] calculated the contaminant concentration
and air ﬂow in a passenger vehicle, they selected the best solutions to ﬁnd the
most comfortable indoor climate with respect to temperature and contaminant
concentration. Currle [3] calculated the ﬂow ﬁeld and temperature distribution in
a passenger compartment by using the commercial CFD program STAR-CD, they
optimized the ventilation of the front and rear legroom. Brown et al. [4] presented
a new transient passenger thermal comfort model, the advantage of this mode was
that it can accurately predict the human thermal sensation response during transient
vehicle warm-up and cooldown conditions. Kataoka et al. [5] predicted the thermal
comfort in an automobile with numerical simulation, the ﬂow ﬁeld and temperature
distribution were solved with a grid system based on many small cubic elements.
Hsieh et al. [6] analyzed the 3-D heat transfer and ﬂuid ﬂow of air over a radiator
and engine compartment. The effects of different inlet airﬂow angles of the grill and
bumper were investigated in detail. Ivanescu et al. [7] simulated the distribution of
the temperature and the air ﬂow ﬁelds of passengers’ compartment starting from
the body’s energy balance, they found that thermal comfort was reached faster in
the case where the air ﬂow rate was bigger, but keeping the same air temperature.
Singh et al. [8] studied the effect of dynamic vents, they found that faster cooling
of the cabin and maintaining a uniform temperature distribution inside the cabin is
possible at a particular vent angle. Shaﬁe et al. [9] investigated the effects of using
different ventilation setups on the air ﬂow velocity and temperature distributions
inside a passenger bus, the results of CFD simulations show that the displacement
ventilation setup resulted in more uniform distribution of air ﬂow velocity and air
temperature inside the passenger compartment.

The purpose of this study is to present the basic theory and numerical methods of
ﬂuid ﬂows in passenger compartment. In the following presentation, the governing
equations will ﬁrst be introduced, followed by the turbulence model. Then mesh and
discretization methods are presented. In addition, the accuracy and convergence of
numerical simulation are discussed.

1.2 Governing Equations

In order to simulate ﬂuid ﬂow and heat transfer in a passenger compartment, it
is necessary to describe the associate physics in mathematical terms. The set of
governing equations consists of the mass, momentum and energy equations. These
equations are presented as follows.

1 CFD-Based Modeling of Heat Transfer in a Passenger Compartment

5

1.2.1 The Mass Conservation Equation

The law of mass conservation states that mass cannot be created in a ﬂuid system,
nor can it disappear from one. For unsteady compressible ﬂows, the mass equation
can be written as follows:

(cid:3)

(cid:2)
(cid:3)(cid:3)!
V

D 0

C r(cid:2)

@(cid:3)
@t

where (cid:3) is the density,

(cid:3)!
V denotes the velocity.

For a Cartesian coordinates system, it becomes

@(cid:3)
@t

@
@x

@
@y

@
@z

C

.(cid:3)u/ C

.(cid:3)v/ C

.(cid:3)w/ D 0

(1.2)

where u, v, and w are the velocity components in the x, y, and z directions,
respectively.

For incompressible ﬂows density has a known constant value. Hence, Eq. (1.2)

can be written as

@
@x

@
@y

.(cid:3)u/ C

.(cid:3)v/ C

.(cid:3)w/ D 0

@
@z

1.2.2 The Momentum Equation

According to the Newton’s second law, the momentum equations in x, y, and z
directions can be expressed as:

(cid:3) Du
Dt

D

@ .(cid:3)p C (cid:4)xx/
@x

C

@(cid:4)yx
@y

(cid:3) Dv
Dt

D

C

@(cid:4)xy
@x

(cid:4)

@

(cid:5)

(cid:3)p C (cid:4)yy
@y

@zx
@z

@zy
@z

C

C SMx

C

C SMy

(cid:3) Dw
Dt

D

@(cid:4)xz
@x

C

C

@yz
@y

@ .(cid:3)p C (cid:4)zz/
@z

C SMz

where p is a compressive stress, (cid:4) xx, (cid:4) yy, and (cid:4) zz are normal stresses. (cid:4) xy, (cid:4) xz are
shear stresses. For example, (cid:4) xy is the stress in the y-direction on x-plane. SM is a
source term.

(1.1)

(1.3)

(1.4)

(1.5)

(1.6)

6

T. Sun et al.

1.2.3 The Energy Equation

The energy equation is based on the ﬁrst law of thermodynamics, which implies
sum of the net added heat to a system and the net work done on it equally increases
the system energy. The general form of this equation is

(cid:6)

(cid:3)

@h
@t

(cid:3)(cid:7)

(cid:2)
(cid:3)!
V
h

C r(cid:2)

Dp
Dt

D (cid:3)

C r(cid:2) .krT/ C (cid:5)

(1.7)

where h is the speciﬁc enthalpy which is related to speciﬁc internal energy; (cid:5) is the
dissipation function representing the work done against viscous forces; and k is the
thermal conductivity.

1.3 Turbulence Models

The ﬂuid ﬂow in the passenger compartment can be considered as incompressible
turbulent ﬂow. The choice of an appropriate turbulence model inﬂuences the
computational results and the required computation resource, because not every
model can predict precisely unsteady ﬂow. CFD offers a user-friendly platform with
a range of ﬂow models which can be used individually as per the requirement of the
end result. Turbulent ﬂows could be solved using several different approaches. The
main approaches of turbulence modeling include Reynolds average Navier–Stokes
(RANS) models, large Eddy simulation (LES), and direct numerical simulation
(DNS).

Figure 1.1 shows the prediction methods of these three approaches. The DNS
and LES approaches resolve shorter length scales than RANS. However they have
a demand of much greater computer power than those models applying RANS
method. RANS models offer the most economic approach for computing complex
turbulent industrial ﬂows, the classical models based on the RANS equations are
discussed in the next section.

1.3.1 K-Epsilon Turbulence Model

The k (cid:3) " model has become one of the most widely used turbulence models.
Reasonable accuracy, robustness, and economy for a wide range of turbulent ﬂows
explain its popularity in general ﬂow and heat transfer simulations. The original
model was initially proposed by Launder and Spalding [11]. For the standard k (cid:3) "
turbulence model, the turbulence kinetic energy k and dissipation rate " are obtained
by the following equations:

1 CFD-Based Modeling of Heat Transfer in a Passenger Compartment

7

Injection of energy

Dissipation of 
energy

Large-scales eddies

l

Resolved

Flux of energy

Dissipating eddies

Modeled

h= l/ReL

3/4

Reynolds averaged Navier-Stokes equations(RANS)

D 

RANS

Resolved

Large eddy simulation (LES)

D 

LES

Resolved

Modeled

Direct numerical simulation(DNS)

D 

DNS

Fig. 1.1 Prediction methods of DNS, LES, and RANS approaches [10]

C Gk C Gb (cid:3) (cid:3)" (cid:3) YM C Sk

(1.8)

@ .(cid:3)k/
@t

(cid:4)

@

(cid:5)

(cid:3)kuj
@xj
(cid:5)

C

(cid:4)

@

(cid:6)(cid:8)

(cid:9)

(cid:7)

D

@
@xj
(cid:6)(cid:8)

(cid:6) C

(cid:6)t
(cid:7)k
(cid:9)

@k
@xj
(cid:7)

@ .(cid:3)"/
@t

C

(cid:3)"uj
@xj

D

@
@xj

(cid:6) C

(cid:6)t
(cid:7)"

@"
@xj

"

k

C C1"

.Gk C G3"Gb/ (cid:3) C2"(cid:3)

"2

k

C S"

(1.9)

where Gk represents the generation of turbulent kinetic energy arises due to mean
velocity gradients, Gk is the generation of turbulent kinetic energy that arises due to
buoyancy. Sk and S" are source terms deﬁned by the user. The constant coefﬁcients
are given with C"1 D 1:44, C"2 D 1:92, (cid:7)k D 1:0, (cid:7)" D 1:2, C(cid:6) D 0:09, (cid:7) k, and (cid:7) ",
respectively, with the turbulence kinetic energy and dissipation rate corresponding
to the Prandtl number.

The turbulence eddy viscosity is deﬁned as:

(cid:6)t D C(cid:6)(cid:3)m

k2
"

(1.10)

where C(cid:6) is a constant.

1.3.2 SST Turbulence Model

The shear stress transport (SST) turbulence model was developed by Menter using
the k-epsilon model and k-omega model [12]. The blending function triggers the
k-epsilon model in areas away from the surface, and triggers the standard k-omega
model near wall regions. These features of the SST model make it perform more

8

T. Sun et al.

accurate prediction for the ﬂow separation problem under the condition of adverse
pressure gradient. The transport equations for turbulence kinetic energy k and
speciﬁc dissipation rate ! are given by:

@ .(cid:3)k/
@t

C

@
@xj

(cid:6)(cid:8)

(cid:9)

(cid:7)

@

xj
(cid:6)(cid:8)

(cid:6)t
(cid:7)k
(cid:9)

@k
@xj
(cid:7)

.(cid:3)uik/ D

(cid:6) C

C QGk (cid:3) Yk C Sk

(1.11)

@ .(cid:3)!/
@t

C

@
@xj

.(cid:3)ui!/ D

@
@xj

(cid:6) C

(cid:6)t
(cid:7)!

@!
@xj

C G! (cid:3) Y! C D! C S!

(1.12)

where QGk is the generation of turbulence kinetic energy that arises due to mean
velocity gradients. Yk and Y! represent the dissipation of k and ! due to turbulence.
Sk and S! are source terms deﬁned by the user

The term for production of turbulence kinetic energy, QGk, is deﬁned as:
(cid:4)
Gk; 10(cid:3)ˇ(cid:2)k!

QGk D min

(cid:5)

The turbulent viscosity is given by:

(cid:6)t D

(cid:3)k
!

1

h

i

max

1
˛

; SF2
˛1!

where S is the strain rate magnitude. The turbulent Prandtl numbers which were
constant in standard model are shown below and incorporate the blending functions
F1 and F2. The blending functions are given by:

(cid:7)k D

(cid:7)! D

1
F1=(cid:7)k;1 C .1 (cid:3) F1/ =(cid:7)k;2
1
F1=(cid:7)!;1 C .1 (cid:3) F1/ =(cid:7)!;2

(1.13)

(1.14)

(1.15)

(1.16)

1.4 Numerical Methods

1.4.1 Mesh Terminology and Types

Mesh generation is usually considered as the most time consuming and important
part of CFD analysis. The computational domain is discretized by meshing and
gridding. Element or cell is the fundamental unit of the mesh. The mesh terminology
shown in Fig. 1.2 is used to describe our meshes. A cell is surrounded by faces,
which connected through nodes or vertices, and the face is a surface surrounded by
edges.

1 CFD-Based Modeling of Heat Transfer in a Passenger Compartment

9

Fig. 1.2 Mesh terminology

a

Block

b

Cell 
centroid

Cell 

Face

Node
(Vertex)

Cell

Vertex

Block-Structured Mesh

Unstructured Mesh

Fig. 1.3 Typical mesh. (a) Block-structured mesh. (b) Unstructured mesh

Mesh generation is very important for the accuracy of the numerical solution.
A typical mesh is shown in Fig. 1.3. Figure 1.3a shows a block-structured mesh,
here, the mesh is divided into blocks, and the mesh within each block is structured.
Methods for generating high quality structured meshes for hexahedra have existed
for a long time, but are widely used in simple or regular geometries. As CFD is
becoming more widely used for analyzing industrial ﬂows, unstructured meshes
are becoming advanced to deal with complex geometries. Figure 1.3b shows an
unstructured mesh. Here, each vertex is connected to an arbitrary number of
neighbor vertices. Unstructured grid generation usually takes less time structured
grid generation. However, structured grid can generate quickly when the geometry
is based on a previously existing geometry with a structured grid.

Figure 1.4 shows an example of mesh generation for a passenger compartment.
The advantage of unstructured grid methods is that they are generated automatically
and, therefore, require little user time.

10

T. Sun et al.

Fig. 1.4 Mesh generation in
passenger compartment [7]

1.4.2 Discretization Methods

In the numerical solutions technique, there are several CFD numerical solutions
that have been developed in the discretization of governing equations. The CFD
discretization method can be classiﬁed into three branches, namely ﬁnite difference
method (FDM), ﬁnite element method (FEM), and ﬁnite volume method (FVM).
The differences between them are the way in which the ﬂow variables are approxi-
mated and the discretization processes are done.

FDMs approximate the derivatives in the governing differential equation using
truncated Taylor series expansions. Through FDMs, the partial derivatives of
governing (PED) are replaced with ﬁnite, algebraic difference quotients at the
corresponding nodes. However, FDM is not as convenient as FEM or FVM for it
requires the deﬁnition of complex conditions.

FEM is one of the most frequently used methods by engineering sciences of ﬂuid
mechanics and thermodynamic to describe the behavior of physical systems in the
form of partial differential equations. FEM uses the simple piecewise functions valid
on elements to describe the local variations of unknown ﬂow variables. However,
compared to FDM and FVM, it is not widely applied.

The FVM is the numerical algorithm calculation process involving the use of
ﬁnite volume cells, i.e., small volume surrounding each node point on a mesh. The
volume integrals in a partial differential equation that contains a divergence term are
converted to surface integrals, using the divergence theorem. The FVMs are mainly
employed for numerical solution of problems in ﬂuid mechanics. The main CFD
code packages using the FVM approach involve Fluent, CFX, Phoenics, Star-CD,
Flow 3D, etc. FVE is currently the most suitable method for the CFD process as it
enjoys an advantage in memory use and speed for very large problems, source term
dominated ﬂows, and turbulence ﬂows.

1 CFD-Based Modeling of Heat Transfer in a Passenger Compartment

11

1.5 Accuracy and Convergence

Accuracy is related to the difference between the numerical solution and the
exact solution. Actually, in most cases, we do not know the exact solution.
Numerical solutions of ﬂuid ﬂow and heat transfer problems are only approximate
solutions. Numerical solutions always include three kinds of errors: modeling errors,
discretization errors, and iteration errors. In the ﬁrst kind, the errors are deﬁned as
the difference between the actual solution and the exact ﬂows. They are usually
inﬂuenced by the assumptions made in deriving the transport equations for the
variables, and they also introduced by simplifying the domain geometry, boundary
conditions. The discretization errors are deﬁned as the difference between the t
solution of the algebraic system of equations and the solution of the conservation
equations. Iteration errors are usually called convergence errors, which are deﬁned
as the iterative and exact solutions.

Generally speaking, convergence is typically represented by the diminishing
residuals of the numerical solution and is the achievement of a limiting behavior
in the solution of the equations. Typically, the basic criteria of residual values and
solution imbalances should be satisﬁed for CFD analysis. The residual is one of
the most important criterions of an iterative solution’s convergence, as it directly
quantiﬁes the error in the numerical solution of the solved equations. CFD analysis
is solving conservation equations of mass, momentum, energy, etc., we must try our
best to obtain a good solution does indeed conserve these quantities.

1.6 Summary

In this chapter, a brief review of the numerical theory and method for heat
transfer in the air conditioning system was presented. A number of literature
related to the passenger compartment’s comfort have been presented. The basic
governing equations and numerical solution procedure were discussed. The k-
epsilon turbulence model and the SST turbulence model are widely used in the
numerical simulation. Unstructured grid generation is usually selected to be used
in the passenger compartment as it can handle complex geometries. The FVM is
currently the most suitable method for the CFD process as it enjoys an advantage in
memory use and speed for very large problems, source term dominated ﬂows, and
turbulence ﬂows. The accuracy and convergence properties should be concerned
when we use the numerical method to solve the differential equations.
This chapter presents a modelling approach for the air conditioning (AC)
system in heavy duty trucks. The presented model entails two major elements: a
mechanical compressor model and a thermal AC model. The compressor model
describes the massﬂow of the refrigerant as well as the mechanical power requested
from the combustion engine. The thermal AC model predicts how ambient air ﬂow
cools down when it passes the AC system. This model also includes the latent heat
emerging from water condensation. Both elements of the model have been validated
with experimental data. The compressor parameters follow from hardware-in-the-
loop experiments where the AC compressor is measured under various load proﬁles.
Validation of the thermal AC model is done by climate chamber testing with a DAF
XF heavy duty truck on a roller dynamometer.

Keywords Lumped-parameter modeling (cid:129) Air conditioning system (cid:129) Automotive

2.1 Introduction

Heavy duty long haul trucks are typically equipped with an air conditioning (airco)
system to offer a comfortable cabin climate to the driver. The airco system fulﬁlls
two elementary functions: cooling down the cabin temperature (when the ambient
temperature is too high) and dehumidifying the air (in rainy conditions or winter
weather). Both functions request mechanical power which is ultimately delivered
by the internal combustion engine (ICE). This chapter presents a modeling approach
for the mechanical power consumption of the airco compressor. Furthermore, it also
presents a model for the thermal behavior of the airﬂow when it is cooled down by
the airco system. These models can be used to develop advanced control strategies
for improving the energy efﬁciency of the airco system, see, for example, [4, 5].
More speciﬁcally, an energy management strategy can incorporate these models to
optimize the power demand of the airco system such that:

(cid:129)

(cid:129)

the airﬂow towards the cabin receives exactly enough cooling power to establish
the desired temperature and humidity for the driver;
regenerative braking energy is stored in the thermal buffer capacity of the airco
system.

This research is carried out within the EU collaborative project CONVENIENT1
(Complete Vehicle Energy-saving Technologies for Heavy-Trucks, [2]). In this
project a suite of technologies is developed to maximize the fuel economy of long
haul trucks. In total three prototype trucks are developed to demonstrate these
technologies. DAF Trucks N.V. is responsible for the development of the DAF
XF tractor with semi-trailer, suitable for long haul applications, see Fig. 2.1. For
this prototype truck with hybrid electric powertrain, smart auxiliaries are developed
by means of a Smart Vehicle Powernet control concept [7]. The airco system of
the truck is one of the auxiliaries considered in the Smart Vehicle Powernet. This
chapter describes the underlying airco model for developing the Smart Vehicle
Powernet [7].

1This work has received funding from the European Union’s Seventh Framework Programme for
research, technological development, and demonstration under grant agreement no [312314].

2 Model Development for Air Conditioning System in Heavy Duty Trucks

15

Legend R134a

High pressure, gas
High pressure, liquid
Low pressure, liquid
Low pressure, gas

Compressor

Clutch

Ambient air

Condensor

Ambient air

Evaporator

Dryer

Exp.
valve

Cooled air for cabin

Fig. 2.2 Overview of air conditioning system in heavy duty truck

2.2 System Overview

The basic principles of an air conditioning system are explained by thermodynam-
ics, see, for example, [1]. A schematic overview of the air conditioning system in
the truck is depicted in Fig. 2.2. This system circulates refrigerant R134a using the
following hardware:

(cid:129) Compressor: The compressor increases the pressure of the refrigerant. The
compressor is belt driven and receives power from the ICE. A mechanical clutch
is installed to (dis-)connect the compressor (from)/to the belt.

(cid:129) Condensor: The condensor operates as a heat exchanger. It cools down the high
pressure refrigerant and releases its heat to the airﬂow through the condensor.
Cooling down the refrigerant leads to condensation of the refrigerant. The
condensor is placed in the engine bay directly behind the grill to receive sufﬁcient
airﬂow.

(cid:129) Expansion valve: The expansion valve releases the refrigerant towards the
evaporator. This is a sensitive task because the inﬂux should be balanced with the
heat exchanged in the evaporator. Only gaseous refrigerant is allowed to leave the
evaporator. Therefore the expansion valve monitors the refrigerant output from
the evaporator to decide if more/less refrigerant has to ﬂow into the evaporator.
(cid:129) Evaporator: The evaporator is mounted in the Heating Ventilation and Air Condi-
tioning (HVAC) system. The evaporator exchanges heat between the refrigerant

16

J.T.B.A. Kessels and P.P.J. van den Bosch

Ext. inputs

Controller

Clutch position [0/1]

Engine speed [rpm]

Compressor
model

Compr. torque [Nm]

Airflow [m3/h]

Tamb[K]

Rel. humidity [%]

Ext. inputs

Pressure
model

Pcompr_in [Bar]

Pcompr_out [Bar]

Pevap_in [Bar]

Pevap_out [Bar]

Refrigerant flow [kg/s]

Tw [K]

Thermal
AC model

Fig. 2.3 Cascade model structure for AC system

and the airﬂow which is used for cabin heating and ventilation. Refrigerant that
ﬂows through the evaporator absorbs heat from the airﬂow. The airﬂow cools
down (and possibly also dehumidiﬁes) and the refrigerant expands from liquid to
gaseous phase. The airﬂow is directed further to the cabin for climate control.

The model developed in this work for the air conditioning system consists of two
parts:

(cid:129) Compressor model: A mechanical model for the compressor is constructed. This
model translates mechanical power (delivered by the ICE) into cooling power
(delivered to the refrigerant).

(cid:129) Thermal AC model: This model describes the thermodynamic behavior of the air
conditioning (AC) system. The main focus of this model is to describe the heat
transfer in the evaporator. The evaporator is located in the HVAC system. The
refrigerant in the evaporator will absorb heat from the air that ﬂows through the
HVAC. The main output from this model is an estimate of the temperature of the
airﬂow downstream the evaporator.

Both models can be connected in a cascade structure, as visualized in Fig. 2.3.
The underlying idea is to construct a simulation environment which is suitable for
developing advanced HVAC controls. The output from the thermal AC model is
used to evaluate driver comfort, whereas the compressor torque yields insight in the
power demand of the airco system. A missing element in the model is the pressure
model. This is planned for future research, but the interested reader could examine
[10] for an example in passenger car application.

2 Model Development for Air Conditioning System in Heavy Duty Trucks

17

2.3 Compressor Model

The compressor model is based on two key parameters: volumetric efﬁciency and
isentropic efﬁciency. The volumetric efﬁciency will be used to estimate the ﬂow
of the refrigerant through the compressor. The isentropic efﬁciency is used to
estimate the mechanical power demand of the compressor. Both parameters have
been measured by the supplier of the compressor on a hardware-in-the-loop (HIL)
test bench for various pressure levels.

2.3.1 Calculation of Refrigerant Flow

The volumetric efﬁciency (cid:8)vol [-] is deﬁned as the ratio of the actual measured ﬂow
(cid:5)a [m3/s] (measured at the suction side of the compressor at a certain pressure) and
the theoretical ﬂow (cid:5)t [m3/s]

(cid:8)vol D

(cid:5)a
(cid:5)t

(cid:5)t D

N
60 Vp

(2.1)

(2.2)

(2.3)

The theoretical ﬂow (cid:5)t [m3/s] of a compressor can be calculated by multiplying its
displacement volume Vp [m3] with its rotational velocity N [rpm]

Given the density (cid:3) [kg/m3] of the refrigerant at the suction side of the compressor,
the actual refrigerant massﬂow PmR [kg/s] is calculated as

PmR D (cid:3) (cid:5)a D (cid:3) (cid:8)vol

N
60

Vp

2.3.2 Calculation of Compressor Power

The enthalpy of the refrigerant changes when it passes the compressor. This
enthalpy change is used to deﬁne the isentropic efﬁciency. Considering an isentropic
compressor, the theoretical work Wisen [J] done by the compressor is deﬁned as

Wisen D (cid:3)

Vdp

(2.4)

Z

pd

ps

18

J.T.B.A. Kessels and P.P.J. van den Bosch

where refrigerant is compressed from pressure ps [Pa] to pd [Pa] (i.e., from the
compressor suction side to the discharge side). The analytical solution for this
integral is well known from literature, see, e.g., [9]

Wisen D

mR RR Ts

(cid:9)
(cid:9) (cid:3) 1

"(cid:8)

(cid:9) (cid:9) (cid:2)1
(cid:9)

#

(cid:3) 1

pd
ps

with Ts [K] the temperature of the refrigerant at the suction side of the compressor.
(cid:9) = 1.2 [-] is the heat capacity ratio; RR [J kg(cid:3)1 K(cid:3)1] is the speciﬁc gas constant of
the refrigerant and mR [kg/mol] is the molecular weight of the refrigerant.

The isentropic efﬁciency (cid:8)isen [-] is deﬁned as the ratio between the isentropic

compressor work and the actual compressor work

(cid:8)isen D

Wisen
Wactual

Given the isentropic efﬁciency, the actual mechanical energy demand from the
compressor is calculated

Wactual D

mR RR Ts

1
(cid:8)isen

(cid:9)
(cid:9) (cid:3) 1

"(cid:8)

(cid:9) (cid:9) (cid:2)1
(cid:9)

#

(cid:3) 1

pd
ps

The mechanical compressor power PAC [W] follows by replacing the refrigerant
weight with the massﬂow from (2.3). This substitution holds for steady state
conditions and results in

PAC D

1
(cid:8)isen

(cid:9)
(cid:9) (cid:3) 1 PmR RR Ts

pd
ps

"(cid:8)

(cid:9) (cid:9) (cid:2)1
(cid:9)

#

(cid:3) 1

Finally, the compressor torque (cid:4)AC [Nm] is calculated with help of the rotational
speed N [rpm]

(cid:4)AC D PAC

60
2(cid:10) N

2.4 Thermal AC Model

The thermal AC model describes the transfer from AC cooling power into cold air
out of the HVAC. The evaporator in the HVAC takes a central role here. Based on
ﬁrst principles of conduction and convection, its thermal behavior will be derived.
There should be noted, however, that the humidity of the ambient air also plays an

(2.5)

(2.6)

(2.7)

(2.8)

(2.9)

2 Model Development for Air Conditioning System in Heavy Duty Trucks

19

Refrigerant

PAC_cool

Evaporator
wall

Tamb

Airflow in:
Qair_in
Water vapor in:
Qwater_vap_in

Tr

Tw

Ri

Tw

Airflow out:
Qair_out
Water vapor out:
Qwater_vap_out

HVAC
airpath

Condensated water out:
Qwater_liq_out

Fig. 2.4 Thermal AC model

important role. After all, cold air can hold less water so cooling down ambient air in
the HVAC easily results in condensation of water. This water drops out of the HVAC
and incorporates the so-called latent heat which needs to be taken into account too.

2.4.1 Thermal Model Structure

The basic thermal model structure is depicted in Fig. 2.4. It is decided to model the
heat exchanger of the evaporator as a lumped thermal mass with temperature Tw [K]
(which refers to the wall temperature of the evaporator). Besides the temperature
of the evaporator, the thermal model incorporates also the temperature of the
refrigerant inside the evaporator: Tr [K]. The model injects cooling power PAc_cool
[W] directly in the refrigerant. Furthermore, a thermal resistance Ri [K/W] is
introduced to model the heat transfer Qw2r [W] from evaporator to refrigerant

Qw2r D

Tw (cid:3) Tr
Ri

Altogether, the thermal AC model resembles two thermal buffers

Cw PTw D Qair_in C Qwater_vap_in (cid:3) Qair_out (cid:3) Qwater_vap_out

C Qlatent (cid:3) Qw2r

Cr PTr D Qw2r (cid:3) PAC_cool

(2.10)

(2.11)

(2.12)

20

J.T.B.A. Kessels and P.P.J. van den Bosch

with Cw [J/K] and Cr [J/K] the lumped heat capacity of the evaporator and
refrigerant, respectively. The other terms will be described in the text below.

Ambient air with temperature Tamb [K] enters the HVAC with ﬂow (cid:5)air [m3/s],
speciﬁc heat cair D 1005 J/kg K, and density (cid:3)air D 1:25 kg/m3. This leads to the
heatﬂow Qair_in [W]

Qair_in D (cid:3)air cair (cid:5)air Tamb

(2.13)

It is noted that the coefﬁcients in (2.13) correspond to dry air. According to the
relative humidity, however, the airﬂow will be a mixture of air and water vapor. This
water vapor will result into an additional inﬂux Qwater_vap_in [W] for the HVAC

Qwater_vap_in D cwater_vap (cid:5)air Xair_in Tamb

(2.14)

with cwater_vap [J/kg K] the speciﬁc heat of water vapor and Xair_in [kg/m3] the
absolute humidity of ambient air. Further details on the calculation of Xair_in will
be provided in Sect. 2.4.2.

The airﬂow through the HVAC ﬂows through the evaporator and cools down.
It is assumed that the air temperature downstream the evaporator equals the wall
temperature of the evaporator deﬁned as Tw [K]. The corresponding heatﬂow
Qair_out [W] of output air (dry) is equal to

Qair_out D (cid:3)air cair (cid:5)air Tw

(2.15)

Similar as with the air–water mixture for the input ﬂow, the heatﬂow corresponding
to the water vapor leaving the HVAC is modeled as Qwater_vap_out [W]

Qwater_vap_out D cwater_vap (cid:5)air Xair_out Tw

(2.16)

with Xair_out [kg/m3] the absolute humidity of the airﬂow leaving the HVAC. Note
that this absolute humidity is equal or lower than the humidity of the input air. This
is a side effect of cooling down the airﬂow. The underlying model equations for
Xair_in and Xair_out will be provided in Sect. 2.4.2. A lower output humidity results in
water condensation. Water droplets will ﬂow out of the HVAC. The corresponding
heatﬂow from liquid water leaving the HVAC is deﬁned as Qwater_liq_out [W]

Qwater_liq_out D cwater_liq (cid:5)air .Xair_in (cid:3) Xair_out/ Tw

(2.17)

with cwater_liq [J/kg K] the speciﬁc heat of liquid water. Condensation of water vapor
results in substantial heat. This so-called latent heat is also taken into account by
means of Qlatent [W]

Qlatent D Hvap (cid:5)air .Xair_in (cid:3) Xair_out/

(2.18)

with Hvap D 2257e3 J/kg the speciﬁc heat of vaporization of water.

2 Model Development for Air Conditioning System in Heavy Duty Trucks

21

Fig. 2.5 Psychrometric chart with visualization how air dehumidiﬁes in HVAC

2.4.2 Air Humidity and Latent Heat

One aspect of an air conditioning system is that it cools down the air towards the
cabin. A second aspect of the air conditioning system is that it also reduces the
humidity of the air. This is because cold air cannot hold as much water vapor as
warm air. How the model calculates the amount of water condensation in the HVAC,
as well as the related heatﬂow Qlatent, is described in this section.

The psychrometric chart in Fig. 2.5 visualizes how the relative humidity changes
under variation of temperature. As an illustrative example, consider a warm but
rainy day with ambient temperature Tamb D 25 ıC and relative humidity RH D 70 %
(point A). By cooling down, the relative humidity increases up to RH D 100 % when
reaching temperature T D 19 ıC (point B). Remark: point B is called dewpoint
because below this point, the air cannot contain more water vapor. Cooling down
further will result in water condensation. Suppose that the air is further cooled down
to T D 10 ıC (point C). When this air is re-heated back to T D 25 ıC, the relative
humidity becomes approx. RH D 40 % (point D), which is substantially lower than
the original humidity (point A) and helps preventing a foggy windscreen.

The report from Vaisala [6] is used as starting point for collecting the model
equations for humidity conversion. The relative humidity RH [%] of air is deﬁned
as the ratio of the water vapor pressure Pw [Pa] to the saturation water vapor pressure
Pws [Pa]

RH D

(cid:4) 100

Pw
Pws

(2.19)

22

J.T.B.A. Kessels and P.P.J. van den Bosch

The saturation water vapor pressure Pws typically relates to the situation where the
air reaches RH D 100 %. The following approximation is proposed in [6]

Pws D A (cid:4) 10

(cid:2)

.T(cid:2)273:15/ m
.T(cid:2)273:15/CTn

(cid:3)

with temperature T [K] and constants A D 611:6, m D 7:591, and Tn D 240:7
taken from [6]. The substitution of (2.20) in (2.19) allows to calculate Pw under the
condition that RH is known.

From Pw the absolute humidity is calculated. The absolute humidity AH [g/m3]

is deﬁned as the mass of water vapor in a volume of 1 m3 and calculated by [6]

with constant C D 2:167 gK/J and T [K] the air temperature. Calculation of AH is
done for point A and point C

AH D

C (cid:4) Pw
T

AHA D

AHC D

C (cid:4) Pw.TA; RHA/
TA
C (cid:4) Pw.TC; RHC/
TC

(2.20)

(2.21)

(2.22)

(2.23)

with TA D Tamb and RHA measured from ambient air. The wall temperature
from (2.11) is used for TC D Tw and RHC D 100 %.

The difference between AHA and AHC deﬁnes the amount of water condensation.
Returning back to the Eqs. (2.14)–(2.18) the following substitution is done for the
absolute humidity

Xair_in D AHA = 103

and Xair_out D AHC = 103

(2.24)

2.5 Model Validation

Experiments are done to collect measurement data for model validation. The
experiments fall apart into two parts:

(cid:129) HIL compressor measurements: A HIL test setup is used to characterize the
model parameters of an isolated AC compressor. The preferred items to be
measured are the pressure, temperature, and ﬂow of the refrigerant when enter-
ing/leaving the compressor. Also the compressor speed and torque is measured
to determine its mechanical power.

(cid:129) Rollerdyno measurements: A climate chamber with heavy duty roller
dynamometer is used to estimate the model parameters of the complete AC
system. A picture of the climate chamber test setup (with DAF XF EuroVI truck)
is shown in Fig. 2.6.

2 Model Development for Air Conditioning System in Heavy Duty Trucks

23

Fig. 2.6 Validation of AC
system with DAF test truck in
climate chamber

The pressure and the temperature of the refrigerant are measured at six locations:
compressor in/out, condensor in/out, expansion valve in, and evaporator out. The
torque and speed of the compressor are measured to determine its mechanical
power. The temperature of the airﬂow is measured before and after the evap-
orator as well as the condensor. Different experiments are done with ambient
conditions: 10 (cid:5) Tamb (cid:5) 30 ıC; 50 (cid:5) RH (cid:5) 70 %.

2.5.1 Validation of Compressor Model

The compressor measurements with the HIL test setup offer insight into the
volumetric efﬁciency (cid:8)vol and the compressor efﬁciency (cid:8)isen. Both parameters
are measured and stored in a look-up-table as function of compressor speed and
charge/discharge ratio. Validation of the compressor torque in (2.9) is done with
help of the rollerdyno measurements in the climate chamber. From the measurement
data, the following information is used:

(cid:129) Speed: The speed of the ICE is available and will be used to determine the AC

compressor speed (by means of a ﬁxed ratio determined by the pulley).

24

14

12

10

8

6

4

2

0

]

m
N

[
 

e
u
q
r
o
T

-2
2105

J.T.B.A. Kessels and P.P.J. van den Bosch

Measured torque
Simulated torque

Measured torque
Simulated torque

14

12

10

8

6

4

2

0

-2

]

m
N

[
 

e
u
q
r
o
T

2110

2115

2120

2125

2130

390

395

400

405

420

425

430

435

415
410
Time [s]

Time [s]

Fig. 2.7 Validation of compressor torque: Tamb D 25 ıC (left) and Tamb D 30 ıC (right)

(cid:129) Torque: A dedicated torque sensor is installed to measure the torque of the AC

(cid:129) Pressure: Two pressure sensors are applied to measure the charge and discharge

compressor.

pressure of the compressor.

The compressor torque from (2.9) is plotted against measurement data in Fig. 2.7.
Two different use cases are considered for the compressor torque: the left picture
shows the situation with ambient temperature 25 ıC; the right picture shows the
situation with ambient temperature 30 ıC. The model achieves the best accuracy
when the compressor clutch is completely closed (error smaller than 10 %). Less
accuracy is achieved during closing and opening of the clutch. This is because the
model does not take into account slipping of the clutch.

2.5.2 Validation of Thermal AC Model

This section describes the validation of the thermal AC model as derived in Sect. 2.4.
A comparison will be made between the air temperature downstream the evaporator
and the temperature Tw estimated by the model (2.11). Before the model validation
can start, ﬁrst an explanation is needed about the measured temperatures in the
HVAC.

During the rollerdyno experiments, the temperature downstream the evaporator
is measured with nine temperature sensors. These sensors are all mounted on the
back-wall of the evaporator, distributed on a 3 (cid:4) 3 grid. This allows to measure
the temperature behind the evaporator at nine different locations in the air channel.
For one experiment (Tamb D 25 ıC) these sensor measurements are visualized in
Fig. 2.8. It is observed that the air temperature behind the evaporator does not respect
a homogenous distribution. For validation of (2.11) only one temperature proﬁle can
be used. It is decided to use the temperature sensor with comes closest to the average
temperature of all nine sensors.

2 Model Development for Air Conditioning System in Heavy Duty Trucks

25

]

C
g
e
d
[
 
t
u
o
 
p
a
v
e
 

r
i
a

T

11

10

9

8

7

6

5

4

3

0

10

20

30

40

60

70

80

90

100

50
Time [s]

Fig. 2.8 Measured air temperature downstream evaporator; nine sensors measure temperature
distribution over air channel

The next step will be the identiﬁcation of the model parameters. The rollerdyno
experiments are used to identify the model parameters from the thermal equa-
tions (2.10)–(2.12). The parameters which will be identiﬁed are the heat capacities
Cw and Cr and the thermal resistance Ri. The experiment that has been selected
to identify these parameters entails a low ambient temperature and low humidity.
This ensures that water condensation is avoided in the HVAC and its impact on the
heat balance from (2.11) can be neglected (i.e., Qwater_liq_out D 0 and Qlatent D 0).
The identiﬁcation toolbox from Matlab is used to ﬁnd the parameters of interest.
In particular, a gray-box identiﬁcation is done by constructing an Output-Error OE
model structure. The Matlab function Idgrey is ﬁnally used to calculate Cw, Cr,
and Ri.

Now that the model parameters are identiﬁed, the ﬁnal validation of the thermal
model is done. Recall that in this work a pressure model is lacking for the refrigerant
R134a. To overcome this problem, the cooling input power PAC_cool in (2.12) is
calculated from the enthalpy change in the evaporator, see also [3]. With help of the
experimental data, the following approximation has been chosen:

PAC_cool (cid:6) .hevap_in (cid:3) hevap_out/ PmR134a

(2.25)

where PmR134a is determined by Eq. (2.3) from the compressor model. The pressure
sensors, which are installed before the expansion valve and after the evaporator,
are used to estimate the enthalpy hevap_in [J/kg] and hevap_out [J/kg], respectively.
Conversion from pressure to enthalpy is done according to the standard pressure-
enthalpy diagrams available from literature. In Fig. 2.9 this conversion is visualized

26

J.T.B.A. Kessels and P.P.J. van den Bosch

Fig. 2.9 Static relation
between pressure and
enthalpy for R134a

R134a vapor
R134a liquid

0

0

5

10

25
20
15
Pressure [Bar]

30

35

40

Measurement
Model

Measurement
Model

350

300

250

200

150

100

50

]
g
k
/
J
k
[
 
y
h
p
a
h
t
n
E

l

7.5

]

C
g
e
d
[
 

w

T

6.5

8

7

6

5.5

45

]

C
g
e
d
[
 

w

T

7.5

6.5

5.5

8

7

6

5

4

4.5

3.5

3
45

50

55

60

70

75

80

85

50

55

60

65

70

65
Time [s]

Time [s]

Fig. 2.10 Validation of evaporator wall temperature: Tamb D 15 ıC (left) and Tamb D 25 ıC
(right)

for refrigerant R134a (data taken from [8]). The refrigerant is assumed to be in
liquid phase before the expansion valve, whereas after the evaporator the refrigerant
must be in gas form. This way, hevap_in relies on the liquid graph and hevap_out uses
the vapor graph.

The ﬁnal validation of the thermal AC model is done with experiments at a
higher temperature to include the veriﬁcation of the latent heat model. In particular,
the experiments with ambient temperature 15 and 25 ıC are selected to show the
validation results in Fig. 2.10. One can observe that the temperature cycles between
ﬁxed boundaries. The exact behavior of these cycles relates to the on/off strategy of
the compressor clutch. The compressor clutch strategy, however, is not investigated
in this work. Nonetheless, a higher ambient temperature results in a higher load for
the AC system and the cycle frequency goes up.

Figure 2.10 also reveals that the AC model, in particular Eq. (2.11), is able
to predict the temperature downstream the evaporator. During the on-time of the
compressor (where the temperature decreases) as well as during the off-time (where
the temperature increases) the model achieves an error smaller than 0.5 ıC.

There should be noted that the accuracy of Tw highly depends on the accuracy of
the cooling input PAC_cool. A mismatch in cooling power deﬁned in (2.12) results in
drift for the estimated temperature Tw.

2 Model Development for Air Conditioning System in Heavy Duty Trucks

27

2.6 Concluding Remarks

This chapter develops a model for the airco system in heavy duty long haul trucks.
Two aspects of the airco model are considered in detail:

(cid:129) Compressor model: The airco system requests mechanical power, ultimately
delivered by the diesel engine of the truck. The compressor model calculates
the mechanical power for the situation that the compressor clutch is closed.
This model also predicts the massﬂow of the refrigerant through the compressor,
which is used to determine the cooling power in the thermal part of the airco
model.

(cid:129) Thermal AC model: Ambient air cools down when it passes the evaporator.
This part of the model estimates the airﬂow temperature directly behind the
evaporator. The model also estimates the humidity of the output air, as well as
the amount of water condensation.

Both elements of the model are veriﬁed by means of experimental validation. A
HIL test-setup is used to collect speciﬁc measurement data of the compressor:
the volumetric efﬁciency and the isentropic efﬁciency. Next, a DAF XF prototype
truck is placed in a climate chamber on a roller dynamometer. Experiments at
different ambient conditions are done to validate the model. A comparison between
the measurement data and the model outputs learns that the following accuracy is
established:

(cid:129) Compressor model: The compressor torque is calculated within 10 % of the
measured torque signal. Slipping of the compressor clutch is not considered.
During transient situations (i.e., when the clutch closes/opens and the compressor
switches on/off) the model looses validity.

(cid:129) Thermal AC model: The temperature of the airﬂow leaving the evaporator
resembles the measurement data. The temperature of the model deviates less than
0.5 K from the measurement data (considering various ambient conditions).

Future research for this airco model should address the development of a pressure
model. Once the model includes a pressure model for the refrigerant, it can be used
to develop advanced energy management strategies.
Abstract In this chapter, we propose an aggregation-based model reduction
method for nonlinear building thermal models. The full-order model, which is
already a lumped-parameter approximation, quickly grows in state-space dimension
as the number of zones increases. An advantage of the proposed method, apart from
being applicable to the nonlinear thermal models, is that the reduced model obtained
has the same structure and physical intuition as the original model. The key to the
methodology is an analogy between a continuous-time Markov chain and the linear
part of the thermal dynamics. A recently developed aggregation-based method of
Markov chains is employed to aggregate the large state space of the full-order
model into a smaller one. Simulations are provided to illustrate tradeoffs between
modeling error and computation time.

Keywords Model order reduction (cid:129) Air conditioning system (cid:129) Building

3.1 Introduction

A typical heating, ventilation, and air conditioning (HVAC) system consists of
AHUs, supply ducts, and terminal boxes. The air handling unit (AHU) supplies
conditioned air to terminal boxes at the so-called leaving-air temperature and
humidity. Each terminal box delivers air to one or more zones. Using reheat coil,
the supply air temperature can be increased beyond the AHU leaving temperature.
In a variable-air-volume (VAV) system, the terminal box can vary the supply air
mass ﬂow rate through dampers. A controller at each terminal box can be used to
maintain the temperature of a zone at a speciﬁed value by controlling the mass ﬂow
rate of air supplied to the zone. The dynamics of the building with its HVAC system
includes AHU dynamics and the zone thermal dynamics.

Interests in methods for controlling building HVAC systems to reduce their
energy usage or cost have been on the increase in recent years; particularly in
advanced model-based approaches such as model predictive control (MPC) [1–3].
Accurate models of building zone temperature evolution are required for advanced
control algorithms with the computational complexity taking into account. This is
because the model complexity is a major issue for implementing the optimization-
based control schemes, particularly if the optimization is to be performed with
a day-long prediction horizon to take advantage of slow thermal responses of
buildings as well as daily variations in environment and energy prices [2]. The focus
of this chapter is on model reduction of multi-zone building thermal dynamics.

A thermal resistor–capacitor (RC) network model is used to construct dynamic
models of multi-zone buildings with nodes representing zones or internal surface
points. Due to the nonlinear nature of model, the number of available techniques for
model reduction is limited. Balanced truncation methods for nonlinear systems use
controllability and observability energy functions of a system to ﬁnd the reduced
realizations [4–6]. Lall et al. in [7] use empirical Gramians to determine the
importance of a particular subspace in terms of its contribution to the input–output
behavior. These energy functions or empirical Gramians, however, are difﬁcult to
compute in practice [8]. Moreover, the reduced models generated by truncation
methods do not retain the physical intuition of the full model, i.e., truncated states
of the reduced model usually have no physical meanings.

In this chapter, we propose an aggregation-based model reduction method
that preserves the RC-network structure of the nonlinear building thermal model.
This is achieved by obtaining super-nodes via aggregation of building nodes. The
aggregation-based approach proposed in this chapter is based on model reduction
method of Markov chains that has recently been developed in [9]. The main idea
here is to connect the linear part of building thermal model to a continuous-time
Markov chain (CTMC), and apply the aggregation method of Markov chains to
systematically ﬁnd optimal coordination of aggregation and the optimal linear
dynamics. The nonlinear model part is then aggregated accordingly based on the
same optimal coordination. The major advantage of the proposed aggregation-based
method compared to truncation-based methods is the structure-preserving property
in the sense that the reduced model is still an RC-network with parameters and
nodes maintaining the same physical meaning as the full building model. The other
advantage is that it does not suffer from the computational difﬁculties of empirical
Gramians or energy functions.

3 Aggregation-Based Thermal Model Reduction

31

This chapter extends the aggregation method proposed in [10] to a more realistic
nonlinear building thermal model, and assesses the performance and computa-
tional complexity of reduced-order models through numerical simulations. The
aggregation-based method proposed here is related to model reduction techniques
for grey-box models [11, 12], where the model structure and parameters are obtained
through the physical insights. The aggregated building model can be thought as
a grey-box model and coordination of aggregation speciﬁes the model structure.
The aggregation-based method described here can also be used to create zoning
approximations for building models by combining zones together [13]. In a very
recent work [14], a Koopman operator approach is proposed to systematically create
zoning approximation for buildings, where the dominant modes of thermal behavior
are extracted from the building simulations. Then modes information is used to
combine multiple zones into single zones. The major difference is that our method is
directly based on the knowledge of building descriptions, while the method in [14]
is mainly based on data from building simulations.

The rest of the chapter is organized as follows. In Sect. 3.2, the full-order model is
described and the model reduction problem is stated. In Sect. 3.3, the Markov chain
analogy of the building thermal dynamics is presented. In Sect. 3.4, the aggregation-
based methodology is applied to reduce the building thermal model. In Sect. 3.5,
theoretical results are illustrated by numerical simulations. The conclusions appear
in Sect. 3.6.

3.2 Full-Order Building Thermal Model

The focus of this chapter is on model reduction of the building zone thermal
dynamics, which suffer more of modeling complexity than the AHU dynamics [10].
As a result, the AHU dynamics are replaced by static gains in this chapter
without signiﬁcant loss of accuracy. A lumped-parameter model of resistances
and capacitances is constructed to describe the thermal dynamics of a multi-zone
building, with current and voltage being analogous to heat ﬂow and temperature,
respectively. We only consider the interzone conductive heat transfer but ignore
the convective heat transfer that occurs through the open windows, doors, and
hallways. The 3R2C models of surface elements (e.g., walls, windows, ceilings, and
ﬂoors) are inter-connected to construct an RC-network model for building thermal
dynamics [15]. The set V WD f1; : : : ; n C 1g denotes the set of nodes of the network.
The nodes are assumed to be re-indexed so that the ﬁrst N nodes correspond to
1; : : : ; N physical zones, and the next .n (cid:3) N/ nodes correspond to the points
internal to the surfaces that appear due to the 3R2C models. The last .n C 1/th
node corresponds to the outside.

For each node i 2 V, the associated temperature and thermal capacitance
are denoted as Ti and Ci, respectively. Let E denote the set of all edges of the
RC-network, where edges represent pathways for conductive heat transports. For
any nodes i; j 2 E, the thermal resistance between i and j is represented as a

32

K. Deng et al.

lumped parameter Rij, with Rji D Rij by convention. The inputs to the building
i denotes the mass ﬂow rate of the supply air, PQr
model are summarized here: Pmin
i
denotes the heat gain due to reheating that may occur at the VAV box, PQint
i denotes
the internal heat gain (i.e., the rate of heat generated by occupants, equipments,
lights, etc.), and PQext
i denotes the external heat gain (i.e., the rate of solar radiation).
It is assumed that (1) the values of Ci and Rij are known parameters obtained based
on building structures and materials, (2) the supply air temperature T s is assumed
to be a constant here, and (3) the (estimation of) the outside temperature To and the
heat gains PQr; PQint; PQext are available based on historical data, weather forecast, and
sensor measurements.

In the following, a compact state-space representation is presented for building
thermal dynamics. To establish a Markov chain analogy in the next section, the
outside temperature is also taken as a “virtual state” TnC1 to the building system.
We assign a very large “virtual capacitance” to the outside node: CnC1 (cid:7) Ci, for
i D 1; : : : ; n. Letting CnC1 ! 1, the dynamic equations are derived from the
energy balance laws:

dT
dt

D AT C L.T; U; PQ/

where the state vector T
Œ Pmin
The transition rate matrix A is an .n C 1/ (cid:4) .n C 1/ matrix with entries given by

the control vector U WD
; 0; : : : ; 0(cid:11)T , and the heat gain vector PQ WD Œ PQ1; : : : ; PQN; 0; : : : ; 0(cid:11)T .

1 ; : : : ; Pmin
N

WD ŒT1; : : : ; TnC1(cid:11)T ,

(3.1)

(3.2)

Aij WD

8
<

:

0;
1=.CiRij/;
P
k¤i Aik;
(cid:3)

if j ¤ i; .i; j/ … E
if j ¤ i; .i; j/ 2 E
if j D i; .i; j/ 2 E

and the nonlinear function:

8

ˆˆˆˆ<
ˆˆˆˆ:

Li.T; U; PQ/ D

CpaUi.T s (cid:3) Ti/ C PQi
Ci

;

Li.T; U; PQ/ D 0;

i D N C 1; : : : ; n

Li.T; U; PQ/ D (cid:8);

i D n C 1

i D 1; : : : ; N

where (cid:8).t/ 2 R is chosen such that (cid:8).t/ D PTo.t/.

3.3 Markov Chain Analogy and Aggregation

In this section, it is shown that the linear part of the building thermal model (3.1) is
analogous to a continuous-time Markov chain. The linear dynamics of the building
thermal model (3.1) are given by:

3 Aggregation-Based Thermal Model Reduction

dT
dt

D AT:

Due to the special structure of the matrix A [see (3.2)], the linear thermal model (3.3)
is conservative. Speciﬁcally, a scalar-valued function V.t/ WD
i2V CiTi.t/ is
.t/ D 0 for all t (cid:8) 0. We denote V0 WD V.0/ D
conserved for all time, i.e., dV
P
dt

i2V CiTi.0/ as the invariant quantity of the linear thermal model (3.3).

P

3.3.1 Analogy to a Markov Chain

Based upon the conservative property of the linear thermal model (3.3), deﬁne the
thermal distribution as a row vector, denoted by f , where

fi D

Ci
V0

Ti;

i 2 V:

P

Note that

i2V fi.t/ (cid:9) 1 for all t (cid:8) 0.

On differentiating fi with respect to t, and using (3.3),

By substituting (3.2) in (3.4), we have

dfi
dt

D

Ci
V0

dTi
dt

D

X

j2V

Aij

Ci
V0

Tj:

dfi
dt

D Aii

Ti C

Ci
V0

Ci
V0

X

j¤i
X

CiRij

1

1

CjRji

j¤i

Ci
V0

Cj
V0

Tj

Tj

D Aii

Ti C

D

fjAji

X

j2V

33

(3.3)

(3.4)

(3.5)

(3.6)

where the fact that Rij D Rji is used in deriving the equality (3.5). Using matrix
notation for representing (3.6), we obtain the dynamics of the thermal distribution
and its solution

df
dt

D fA

)

f .t/ D f .0/eAt; 8t (cid:8) 0:

The Markov chain analogy is now clear. Note that each row sum of A is zero,
its diagonal entries are negative, and its non-diagonal entries are non-negative
(see (3.2)). Thus, the transition rate matrix A is the inﬁnitesimal generator of a
transition semigroup feAtgt(cid:4)0: For any t; s (cid:8) 0, (1) eA0 D I, (2) eAt is a stochastic

34

K. Deng et al.

matrix (that is, eAt is a non-negative matrix whose row sums are equal to one), and
(3) eA.tCs/ D eAteAs.

Consider now a CTMC fX.t/gt(cid:4)0 on the state space V with the transition

semigroup feAtgt(cid:4)0 [16]. Let g.t/ denote the probability distribution at time t, i.e.,

gi.t/ D Pr.X.t/ D i/;

i 2 V:

Using the transition semigroup property, we have

gi.t/ D

Pr.X.0/ D j/Pr.X.t/ D i j X.0 D j// D

gj.0/.eAt/ji:

X

j2V

X

j2V

If f .0/ is the initial distribution of fX.t/gt(cid:4)0, i.e., g.0/ D f .0/, then

g.t/ D g.0/eAt D f .0/eAt D f .t/:

(3.7)

Thus, starting from the same initial distribution, the probability distribution of
the CTMC fX.t/gt(cid:4)0 is equal to the thermal distribution of the linear thermal
model (3.3). For more details on CTMC, we refer the reader to [16, 17] and the
references therein.

For any ergodic Markov chain, there exists a unique stationary distribution (cid:10)

(obtained as a solution to (cid:10)A D 0), whereby starting from any initial distribution

g.t/ D (cid:10):

lim
t!1

For linear thermal model (3.3), the associated Markov chain is shown to be ergodic
in [10], and the stationary distribution is given by:

CiP

(cid:10)i D

j2V Cj

;

i 2 V:

(3.8)

3.3.2 Discretization of the Continuous-Time Markov Chain

In practice, it is more convenient to work with discrete-time Markov chains (DTMC)
instead of CTMC. The DTMC fX.k(cid:12)t/gk(cid:4)0 is obtained by discretizing the CTMC
fX.t/gt(cid:4)0 with a step-size (cid:12)t. Let (cid:13).k/ denote the probability distribution of the
DTMC at kth time step, i.e., (cid:13)i.k/ D Pr.X.k(cid:12)t/ D i/ for i 2 V. Using (3.7),

(cid:13).k/ D (cid:13).0/Pk.(cid:12)t/;

k (cid:8) 0

where the transition matrix is deﬁned as

P.(cid:12)t/ WD eA(cid:12)t:

(3.9)

3 Aggregation-Based Thermal Model Reduction

35

For any t (cid:8) 0, there exists an integer k (cid:8) 0 such that k(cid:12)t (cid:5) t < .k C 1/(cid:12)t and
eAt (cid:6) eAk(cid:12)t for small enough (cid:12)t. Thus the CTMC fX.t/gt(cid:4)0 with the transition
semigroup feAtgt(cid:4)0 is approximated by the DTMC fX.k(cid:12)t/gk(cid:4)0 with the transition
matrix P.(cid:12)t/ as (cid:12)t ! 0. One can verify that (cid:10) given in (3.8) is also the stationary
distribution of the DTMC, i.e., limk!1 (cid:13).k/ D (cid:10).

3.3.3 Aggregation of Markov Chain

Let .(cid:10); P/ denote a DTMC deﬁned on the state space V D f1; : : : ; n C 1g with the
transition matrix P and the stationary distribution (cid:10). The model reduction problem
is to ﬁnd an optimal aggregated Markov chain, denoted by . N(cid:10); NP/, deﬁned on the
state space NV D f1; : : : ; m C 1g, where m (cid:5) n, such that the KL divergence rate
R(cid:5).Pk NP/ between two Markov chains is minimized.

The m-partition problem is to ﬁnd a partition function (cid:5) W V 7! NV and an

aggregated transition matrix NP that solves the following optimization problem:

R(cid:5).Pk NP/

min
(cid:5); NP
s:t:

NP1 D 1; NP (cid:8) 0:

As shown in Theorem 2 of [9], for a ﬁxed (whether optimal or not) partition function
(cid:5), the optimal aggregated Markov chain . N(cid:10).(cid:5)/; NP.(cid:5)// is given by:

NPkl.(cid:5)/ D

P

P

i2(cid:5)(cid:2)1.k/
P

j2(cid:5)(cid:2)1.l/ (cid:10)iPij

i2(cid:5)(cid:2)1.k/ (cid:10)i

;

k; l 2 NV

(3.10)

where the stationary distribution of NP.(cid:5)/ is given by

N(cid:10)k.(cid:5)/ D

(cid:10)i;

k 2 NV:

(3.11)

X

i2(cid:5)(cid:2)1.k/

As a result, the m-partition problem reduces to ﬁnding only an optimal partition
function (cid:5)(cid:2) W V ! NV such that

(cid:5)(cid:2) 2 arg min

R(cid:5).Pk NP.(cid:5)//:

(cid:5)

(3.12)

It is shown in [9] that solving the optimization problem (3.12) exactly is difﬁcult for
m > 2, but a sub-optimal solution for m D 2 can be easily computed. This leads
to a sub-optimal solution for arbitrary m (cid:8) 2 through the recursive bi-partition
algorithm [9].

36

K. Deng et al.

3.3.4 Analogy to Thermal Dynamics

Based on the Markov chain analogy for the linear thermal dynamics (see Sect. 3.3.1),
the model reduction framework for Markov chains is extended to building thermal
models:

(cid:129) Metric for comparing thermal distributions: The KL divergence is employed as a
metric to compare two thermal distributions f and g deﬁned on the same building
node set V:

D.f kg/ D

fi log.fi=gi/:

X

i2V

For the model reduction problem, it is of interest to compare two thermal
distributions deﬁned on building graphs of different cardinalities. Let f and Nf
denote two thermal distributions deﬁned on V and NV, respectively. The low-
dimensional distribution Nf is lifted to a high-dimensional distribution Of deﬁned
on V by using partition function (cid:5) and lifting distribution (cid:6):

.(cid:6)/
Of
i

.(cid:5)/ D

(cid:6)iP

k2 .i/ (cid:6)k

Nf(cid:5).i/;

i 2 V:

(3.13)

The lifting may be viewed as a linear transformation that conserves the total heat.
The KL metric is then used to compare the two thermal distributions f and Of on
the same node set V.

(cid:129) Metric for comparing thermal models: The KL divergence rate is used as a
measure to compare two building thermal models. In particular, suppose full-
order model is simulated starting from an initial distribution f .0/. Denote the
resulting trajectory of the thermal distribution as ff .k(cid:12)t/g0(cid:5)k(cid:5)N. Now, suppose
the reduced-order model is also simulated starting from the initial distribution

Nfl.0/ D

fi.0/;

l 2 V:

X

i2(cid:5)(cid:2)1.l/

Denote the resulting trajectory of thermal distribution as fNf .k(cid:12)t/g0(cid:5)k(cid:5)N, which
evolves over reduced graph NV. The trajectory fNf .k(cid:12)t/g0(cid:5)k(cid:5)N is lifted to the
full building graph by using (3.13), and denoted by f Of .k(cid:12)t/g0(cid:5)k(cid:5)N. The KL
divergence rate between full- and reduced-order models is given by,

1

N

NX

kD1

D.f .k(cid:12)t/k Of .k(cid:12)t//:

(3.14)

Thus, the KL divergence rate is a measure of average distance between trajecto-
ries generated from simulating two thermal models.

3 Aggregation-Based Thermal Model Reduction

37

(cid:129) Bi-partition: An optimal bi-partition of a given model produces a 2-state reduced-
order model that is closest to the full-order model in the sense of distance (3.14).
Since the distance is a time average, discrepancies between two models at the
slow(est) time-scales contribute more to the error compared to the fast transients.
The choice of metric thus leads to a 2-state model that approximates the full-order
model on the slowest time-scale.

(cid:129) Recursive bi-partition: The recursive application of bi-partition algorithm pro-
duces a reduced-order model that progressively captures multiple time-scales
in the problem. The ﬁrst bi-partition results in splitting of the graph into two
clusters, and a 2-state model that captures the slowest time-scale. The next
bi-partition further splits one of the two clusters so as to capture the slowest time-
scale in that cluster, and so on. In effect after m-applications of the algorithm, the
reduced-order model describes the m slowest time-scales of the full-order model.

3.4 Aggregated Building Thermal Model

In this section, the aggregation methodology is applied to obtain a reduced-order
model for building thermal model (3.1). We ﬁrst describe the reduced-order model
for the linear part of the building thermal model (3.1), and then the reduced-order
model for the nonlinear part of (3.1).

3.4.1 Aggregated Linear Thermal Dynamics

is to aggregate the node set
For the linear thermal model (3.3),
NV D f1; : : : ; m C 1g where
V D f1; : : : ; n C 1g into a smaller super-node set
m (cid:5) n. For each super-node k 2 NV, we introduce the super-temperature NTk, super-
capacitance NCk, and super-resistance NRkl. For a given partition function (cid:5), the
reduced-order model for (3.3) has the form:

the goal

d NT
dt

D NA.(cid:5)/ NT;

(3.15)

where NT D Œ NT1; : : : ; NTmC1(cid:11)T denotes the super-temperature vector, and NA.(cid:5)/ denotes
the .m C 1/ (cid:4) .m C 1/ super-transition-rate matrix. The Markov chain analogy
also works for the reduced-order model with the associated transition semigroup
fe NA.(cid:5)/tgt(cid:4)0. Discretizing with a small step-size (cid:12)t, one obtains the transition matrix
for the aggregated Markov chain deﬁned on NV:

NP.(cid:12)t/ WD e NA.(cid:5)/(cid:12)t:

38

K. Deng et al.

Recall that the transition matrix for the DTMC associated with the full-order linear
thermal dynamics is denoted by P.(cid:12)t/ (see (3.9)). The goal is to choose NA.(cid:5)/
so that the aggregated Markov chain with the transition matrix NP.(cid:12)t/ optimally
approximates the original Markov chain with the transition matrix P.(cid:12)t/. The
aggregation method described in Sect. 3.3.3 is employed to determine the formula
for the optimal aggregated transition matrix NA.(cid:5)/. According to (3.10), the formula
for the optimal aggregated Markov transition matrix is given by:

NPkl.(cid:12)t/ D

P

P

i2(cid:5)(cid:2)1.k/

P

j2(cid:5)(cid:2)1.l/ (cid:10)iPij.(cid:12)t/
i2(cid:5)(cid:2)1.k/ (cid:10)i

;

k; l 2 NV:

(3.16)

By expressing P.(cid:12)t/ and NP.(cid:12)t/ in the form

P.(cid:12)t/ D I C A(cid:12)t C O.(cid:12)t2/;
NP.(cid:12)t/ D I C NA.(cid:5)/(cid:12)t C O.(cid:12)t2/;

the equation (3.16) becomes

1fkDlg C NAkl.(cid:5)/(cid:12)t C O.(cid:12)t2/ D

P

P

i2(cid:5)(cid:2)1.k/

j2(cid:5)(cid:2)1.l/ (cid:10)i.1fiDjg C Aij(cid:12)t C O.(cid:12)t2//

P

P

D 1fkDlg C

i2(cid:5)(cid:2)1.k/
P

i2(cid:5)(cid:2)1.k/ (cid:10)i
P
j2(cid:5)(cid:2)1.l/ (cid:10)iAij

i2(cid:5)(cid:2)1.k/ (cid:10)i

(cid:12)t C O.(cid:12)t2/:

(3.17)

By matching terms on both sides of (3.17), we obtain the formula for the optimal
super-transition-rate matrix

P

P

NAkl.(cid:5)/ D

i2(cid:5)(cid:2)1.k/
P

j2(cid:5)(cid:2)1.l/ (cid:10)iAij

i2(cid:5)(cid:2)1.k/ (cid:10)i

;

k; l 2 NV:

(3.18)

By substituting (3.2) and (3.8) into (3.18), one can verify that NA.(cid:5)/ is indeed a
transition-rate matrix for any partition function (cid:5), i.e., the row sums of NA.(cid:5)/ are
zeros, diagonal entries are negative, and non-diagonal entries are non-negative:
P

P

8

ˆˆˆˆ<
ˆˆˆˆ:

NAkl.(cid:5)/ D

i2(cid:5)(cid:2)1.k/
P

j2(cid:5)(cid:2)1.l/ 1=Rij

i2(cid:5)(cid:2)1.k/ Ci

;

k ¤ l 2 NV

NAkk.(cid:5)/ D (cid:3)

NAkl.(cid:5)/;

k 2 NV

X

l¤k

(3.19)

3 Aggregation-Based Thermal Model Reduction

39

The super-capacitances and super-resistances can also be expressed in terms of Ci
and Rij:

(cid:129) According to (3.8), the stationary distribution of the aggregated Markov chain

has the form:

N(cid:10)k.(cid:5)/ D

P

NCk.(cid:5)/
l2 NV NCl.(cid:5)/

;

k 2 NV

(3.20)

where NCk.(cid:5)/ denotes the super-capacitances for the kth node. By substitut-
ing (3.8) into (3.11), we obtain formula for the optimal stationary distribution:
P

N(cid:10)k.(cid:5)/ D

(cid:10)i D

P

;

k 2 NV:

(3.21)

X

i2(cid:5)(cid:2)1.k/

i2(cid:5)(cid:2)1.k/ Ci
P

l2 NV

j2(cid:5)(cid:2)1.l/ Cj

By comparing (3.20) and (3.21), we obtain the formulae for the super-
capacitances:

NCk.(cid:5)/ D

Ci;

k 2 NV:

(3.22)

X

i2(cid:5)(cid:2)1.k/

(cid:129) By using (3.19) and (3.22), we obtain the formulae for the super-resistances:

NRkl.(cid:5)/ D

1
NCk.(cid:5)/ NAkl.(cid:5)/

P

D

i2(cid:5)(cid:2)1.k/

1
P
j2(cid:5)(cid:2)1.l/ 1=Rij

;

k ¤ l 2 NV:

(3.23)

Thus, the reduced-order linear model (3.15) corresponds to a reduced RC-network
with super-capacitances and super-resistances given by (3.22) and (3.23), respec-
tively. The super-capacitance NCk.(cid:5)/, given in (3.22), is the equivalent capacitance
of parallel conﬁguration of all capacitors in the kth partition. Similarly, the super-
resistance NRkl.(cid:5)/ given in (3.23) is the equivalent resistance of parallel conﬁguration
of all resistors connecting the kth partition and the lth partition. These observations
also serve to provide an intuitive justiﬁcation of the aggregation approach.

Similar to the full-order model (3.1), the reduced-order model (3.15) is also
conservative because of the fact that NA.(cid:5)/ is a super-transition-rate matrix. The
invariant quantity for the reduced-order model is given by

NV0 WD

NCk NTk.0/:

X

k2 NV

If one chooses the initial condition for the reduced-order model (3.15) as

NTk.0/ D

.Ci= NCk.(cid:5)//Ti.0/;

k 2 NV;

(3.24)

X

i2(cid:5)(cid:2)1.k/

K. Deng et al.

(3.25)

(3.26)

(3.28)

40

then

NV0 D

CiTi.0/ D

CiTi.0/ D V0:

X

X

k2 NV

i2(cid:5)(cid:2)1.k/

X

i2V

This implies that the invariant quantity of the linear thermal dynamics is unchanged
after the aggregation. The aggregated thermal distribution is deﬁned as

Nfk D

NTk;

k 2 NV:

NCk
NV0

Of i D

Ci
V0

OTi;

i 2 V

Recall that we introduce the lifting technique to compare the low- and high-
dimensional distributions. The lifted thermal distribution is deﬁned as

where OTi is called the lifted temperature for the node i. Using (3.13) and choosing
the lifting distribution as (cid:6) D (cid:10), we obtain
(cid:10)iP

(3.27)

Of i D

Nf(cid:5).i/:

j2 .i/ (cid:10)j

Substituting (3.8) and (3.25) into (3.27), we have

where we use the fact that NC(cid:5).i/ D
and (3.28), we have the explicit expression for the lifted temperature

j2 .i/ Cj and NV0 D V0. By comparing (3.26)

CiP

Of i D

j2 .i/ Cj
P

NC(cid:5).i/
NV0

NT(cid:5).i/ D

NT(cid:5).i/

Ci
V0

bT i D NT(cid:5).i/;

i 2 V:

Note that the lifted temperature bT i of the node i is indeed a temperature quantity
for the corresponding aggregated node (cid:5).i/. Thus, we can compare the full and
reduced-order models by directly comparing Ti and NT(cid:5).i/ for each node i.

3.4.2 Aggregated Building Thermal Model

Recall that the outside node is taken as a virtual .n C 1/th node in the full-order
building thermal model (3.1), and the outside temperature is denoted as TnC1. We
also take the outside node as a virtual .m C 1/th node in the reduced-order model
and we denote its temperature as NTmC1. That is, for any given partition function (cid:5),
the building node set f1; : : : ; ng is aggregated into the super-node set f1; : : : ; mg,

3 Aggregation-Based Thermal Model Reduction

41

and the .n C 1/th outside node has a one-to-one correspondence to the .m C 1/th
super-node.

Due to the current source interpretation of nonlinear thermal dynamics
L.T; U; Q/, the current sources connecting to the same group of the aggregated
nodes are directly added up to form a super-current source for the corresponding
super-node:
(cid:129) For k D 1; : : : ; m, the aggregated nonlinear thermal dynamics is given by:

eLk.T; U; PQ/ D

CiLi.T; U; Q/= NCk.(cid:5)/

X

i2(cid:5)(cid:2)1.k/

D .Cpa.T s NUk.(cid:5)/ (cid:3) eW k.(cid:5)// C PNQk.(cid:5)//= NCk.(cid:5)/

(3.29)

where

NUk.(cid:5)/ WD

Ui;

PNQk.(cid:5)/ WD

PQi; eW k.(cid:5)/ WD

X

i2(cid:5)(cid:2)1.k/

X

i2(cid:5)(cid:2)1.k/

X

i2(cid:5)(cid:2)1.k/

UiTi:

(3.30)

(cid:129) For k D m C 1, the aggregated nonlinear thermal dynamics is given by:

eLmC1.T; U; PQ/ D (cid:8)

where (cid:8).t/ D PTo.t/ and To.t/ denotes the outside temperature. The construction
here is to make sure NTmC1.t/ D To.t/ for all t (cid:8) 0 in the reduced-order
model (3.32) described later.

Since U and Q are external inputs to the full-order model, we can also take NU.(cid:5)/ and
PNQ.(cid:5)/ deﬁned in (3.30) as the super-inputs to the reduced-order model. One problem
is that the term eW.(cid:5)/ deﬁned in (3.30) depends on T, which is the state vector of the
full-order model. We use NTk (the temperature of the kth super-node) to approximate
Ti (the temperature of the ith node that belongs to the kth group) in eW k.(cid:5)/:

NWk.(cid:5)/ WD

Ui NTk D NUk.(cid:5)/ NTk;

k D 1; : : : ; m:

X

i2(cid:5)(cid:2)1.k/

Replacing eW k.(cid:5)/ by NWk.(cid:5)/ in (3.29), we approximate eLk.T; U; PQ/ by

NLk. NT; NU.(cid:5)/; PNQ.(cid:5)// D

(cid:2)
Cpa NUk.(cid:5)/.T s (cid:3) NTk/ C PNQk.(cid:5)/

(cid:3)

= NCk.(cid:5)/

(3.31)

for k D 1; : : : ; m and NLmC1. NT; NU.(cid:5)/; PNQ.(cid:5)// D (cid:8). Note that the aggregated nonlinear
thermal dynamics in (3.31) only depends on super-quantities for the reduced-order
model.

By combining the aggregated linear thermal dynamics (3.15) with the aggregated
nonlinear thermal (3.31), we obtain the state-space representation of the reduced-
order building thermal model:

42

K. Deng et al.

d NT
dt

D NA.(cid:5)/ NT C NL. NT; NU.(cid:5)/; PNQ.(cid:5)//:

(3.32)

The model reduction method proposed in this chapter preserves the RC-network
structure of the original building model, that is, the reduced-order model (3.32)
is still an RC-network deﬁned with super-nodes with super-edges connecting these
super-nodes. According to state-space representation (3.32), the aggregated building
thermal dynamics can be also expressed by the following coupled differential
equations: For each k D 1; : : : ; m,

NCk.(cid:5)/ d NTk
dt

X

l2 NNk

.t/ D

. NTl.t/ (cid:3) NTk.t//= NRkl.(cid:5)/ C PNQk.(cid:5)/.t/ C (cid:12) NHk.(cid:5)/.t/

(3.33)

NNk (cid:10) NV denotes the set of
where NTk is the temperature of the kth super-node,
neighbors of the kth super-node, PNQk.(cid:5)/ denotes the heat gain for the kth super-node,
and the ventilation heat exchange (cid:12) NHk.(cid:5)/ for the kth super-node is given by

(cid:12) NHk.(cid:5)/.t/ D Cpa PNmin
k

.(cid:5)/.t/.T s (cid:3) NTk.t//

with the mass ﬂow rate entering the kth super-node given by PNmin
P
k

.(cid:5)/ D
i . The initial condition of the reduced-order model (3.33) is chosen

i2(cid:5)(cid:2)1.k/ Pmin

as (3.24).

The reduced-order model so far depends on the choice of the partition function
(cid:5). The sub-optimal partition function (cid:5)(cid:2) is obtained by using the recursive bi-
partition algorithm. However, one can also directly choose a sub-optimal (cid:5)(cid:2) based
on physical intuition (e.g., ﬂoor plans in a multi-zone building), or some other kinds
of expert-based heuristics.

3.5 Simulation and Discussion

3.5.1 Simulation Setup

In this section, we apply the aggregation-based model reduction method to the
downstream part of the four-zone building HVAC system shown in Fig. 3.1, where
each zone is serviced by a single terminal box. The layout of the four-zone building
is shown in Fig. 3.1a. Each of the four rooms/zones has an equal ﬂoor area of 5(cid:4)5 m
and each wall is 3 m tall, which provides a volumetric area of 75 m3 for each room.
Room 1 has a small window (5 m2) on the north facing wall, whereas rooms 2 and
4 have larger windows (7 m2 each) on the east facing wall. Room 3 does not have a
window.

3 Aggregation-Based Thermal Model Reduction

43

a

Window 1

1
 
r
o
o
D

2
 
r
o
o
D

4
4
 
 
r
r
o
o
o
o
D
D

Room 1

Room 2

Door 3

Room 3

Room 4

i

W
n
d
o
w
2

 

i

W
n
d
o
w
4

 

Outside

b

Q + ΔH
1

1

Q + ΔH
2

2

T33 T29

T1

T2

T30 T34

Rwindow,1

T21 T25

T26 T22

Rwindow,2

T5 T7

T37

T37

T14

T18

T20

T16

T8

T12

T6

T9

T13

T17

T19

T15

T23 T27

T28 T24

T10 T11

Rwindow,4

T35 T31

T3

Q + ΔH
3

3

T37

T4

T32 T36

Q + ΔH4

4

Fig. 3.1 (a) The layout of the four-zone building of the HVAC system, and (b) its RC-network
representation

The HVAC system used for simulation is designed to supply maximal mass
ﬂow rate of 0:25 kg/s per room. The supplied air temperature is ﬁxed at T s D
12:8 ıC. Here we assume that there is no return air and 100% of the outside
air is sent to the AHU. The number of occupants in each room is uniformly
generated as a random integer between 0 and 4. Outside temperature and outside
solar radiation data is obtained for a summer day (05=24=1996) of Gainesville,
FL [18]. Numerical results presented here are simulated using ode45 function in
Matlab for 24 hours with the time step-size chosen as 10 min. All temperatures are
initialized at 24 ıC, respectively. The mass ﬂow rates entering four zones are given
4 D 0 kg=sec. There are two inputs:
by Pmin
3 D Pmin
outside temperature T0 and the heat gains PQi.

1 D 0:15 kg=sec, and Pmin

2 D Pmin

3.5.2 Recursive Bi-partition of Building Graph

The RC-network representation of the four-zone building is shown in Fig. 3.1b.
There are total 36 building nodes plus 1 outside node for the model of this four-zone
building: 4 zone nodes f1; : : : ; 4g, 8 internal-wall nodes f5; : : : ; 12g, 8 internal-
ﬂoor nodes f13; : : : ; 20g, 8 internal-ceiling nodes f21; : : : ; 28g, 8 external wall
nodes f29; : : : ; 36g, and 1 outside node f37g. Each node is assigned with a thermal
capacitance, and two adjacent nodes are connected with a thermal resistance. The
windows are modeled as single resistors since they have relatively little capacitance.
The values of capacitances and resistances used for simulation are obtained from
commercially available software Carrier Hourly Analysis Program [19]. The outside
node is assumed to have a very large capacitance C37 D 1010 KJ=.m2K/.

44

K. Deng et al.

Fig. 3.2 Modeling error
(KL divergence rate) in
aggregating the linear thermal
dynamics vs. number of
partitions

e
t
a
r
 
e
c
n
e
g
r
e
v
d
 
L
K

i

3.5

2.5

3

2

1

0

1.5

0.5

2

7

12

17

22

27

32

37

m

The recursive bi-partition algorithm is used to ﬁnd sub-optimal partitions of
the building graph based on the analysis of the linear thermal dynamics. The ﬁrst
iteration of the algorithm divides the node set into two groups: the ﬁrst group
contains all building nodes: f1; 2; : : : ; 36g, and the second group contains only
the outside node: f37g. Such a 2-partition result makes sense since it captures the
slowest time-scale of building thermal dynamics.

The second iteration of the algorithm leads to a 3-partition, which divides
the nodes into three groups: the ﬁrst group consists of all (zone, wall, ceiling,
window, and ﬂoor) nodes associated with the room 3, the second group contains
all other building nodes associated with the rooms 1; 2; 4, and the third group
contains only the outside node: f37g. Compared with the 3-partition results, the
4-partition identiﬁes a new group containing all nodes associated with room 1.
For the 5-partition, the algorithm returns ﬁve groups of nodes with clear physical
intuition: group i contains all nodes corresponding to room i, for i D 1; : : : ; 4, and
group 5 consists of the single outside node f37g! For m > 5, the m-partition further
partitions the nodes associated with individual rooms. The largest possible m is 37,
which corresponds to no reduction in model order.

Recall that the KL divergence rate (3.14) is used as a measure of the modeling
error for aggregating the linear thermal dynamics. Figure 3.2 depicts the KL
divergence rate with respect to the number of partitions m for 2 (cid:5) m (cid:5) 37. We
observe from Fig. 3.2 that the modeling error monotonically decreases to the zero as
the number of partitions increases to the dimension of the full-order model, and that
there is little additional improvement beyond a model order of around 18. Although
the KL divergence rate is only applicable to the linear part of the model, one can
still use it as a conservative guideline for the reduction of the nonlinear model. In
that case, we can guess that for good prediction accuracy, the reduced-order model
should have about 18 states. This is veriﬁed by simulations we report next.

3 Aggregation-Based Thermal Model Reduction

45

3.5.3 Simulation of Full- and Reduced-Order Models

The full-order model (3.1) is used to describe the full building thermal dynamics,
with 36 building nodes plus 1 outside node. The multiple partition results obtained
in Sect. 3.5.2 are used to construct the reduced-order models through aggregation of
building nodes into groups, where each group of nodes is represented by a super-
node. For k D 1; : : : ; 36, the kth-order reduced model (3.32) is used to describe
the reduced building thermal dynamics with k super-nodes plus 1 outside node. For
comparison, we lift the reduced model to one with 36 building nodes plus 1 outside
node (see Sect. 3.4.1 for more details), which allows direct comparison between the
temperature of a zone predicted by the full- and reduced-order models.

2 D Pmin

3 D Pmin

1 D 0:15 kg=sec and Pmin

All simulations reported here are open-loop simulations: the same mass ﬂow
4 D 0 kg=sec) are used as inputs
rates ( Pmin
in conducting simulations for both full and reduced-order models. Note that the
inputs are aggregated accordingly to obtain the super-inputs for the reduced-order
model (see Sect. 3.4.2 for more details). To test the goodness of the reduced-order
models, we compare the four zone temperatures simulated by the full- and reduced-
order models. When simulated by the full-order model, the temperature of room i is
denoted by Ti. When simulated by the reduced-order model, the lifted temperature

1st-order reduced model

4th-order reduced model

18th-order reduced model

Fig. 3.3 Four zone temperature simulation errors are given by ei D bTi (cid:3)Ti for i D 1; : : : ; 4, where
Ti is the temperature simulated by the full-order model and bT i is the lifted temperature simulated
by the (1st-order, 4th-order, and 18th-order) reduced models

46

K. Deng et al.

of room i is denoted by bT i (see Sect. 3.4.1 for more details). The ith zone temperature
prediction error is denoted by ei D bT i (cid:3) Ti.

Figure 3.3 shows the temperature prediction errors corresponding to reduced-
order models with varying degree of reduction: (1) 1st-order reduced model
(1 super-node corresponding to all building nodes), (2) 4th-order reduced model
(4 super-nodes corresponding to 4 groups of nodes associated with 4 zones), and
(3) 18th-order reduced model. Note that a kth-order reduced model corresponds
to the .k C 1/-partition described in Sect. 3.5.2 with k super-building nodes and 1
outside node.

We observe from Fig. 3.3 that, as expected, prediction errors decrease as the order
of the reduced model increases. In addition, the conjecture based on KL divergence
rate that the 18th-order model will have predictions close to that of the full-order
model turns out to be true. In the 18th-order model, the prediction error for the zone
with the maximum error (zone 1 here) has a mean of 1:30 ıC and standard deviation
of 0:46 ıC.

We also observe from the Fig. 3.3 that except for zone 1, temperature prediction
with even the fourth-order model (middle plot), which represents a ninefold
reduction in model order, is quite accurate, where the prediction error for the zone
with the maximum error (zone 4 here) has a mean of (cid:3)0:77 ıC and the standard
deviation of 0:44 ıC. However, the mean and standard deviation of prediction error
for zone 1 with the fourth-order model are 2:14 ıC and 0:37 ıC, which is much
larger. Thus, large reduction in the model order is not likely to be useful for control
design and analysis studies. However, we expect such low order models to be still
useful in preliminary building and HVAC system design studies.

The higher error in the temperature prediction of zone 1 could be due to
the method’s inability to accurately approximate enthalpy dynamics due to the
ventilation (note that zone 1 is the only one with the ventilation), or due to the
error introduced in lifting the reduced model to a full-order model for purposes of
comparison. Future work will examine these factors in greater detail.

The computation time for executing the Matlab simulation code increases as the
order of the reduced model increases. For the case considered in this chapter, the
computation times for simulation are 6.829, 6.988, 7.623, 349.86 s for the 1st-order,
4th-order, 18th-order, and full 36th-order models, respectively. In practice, one can
make a tradeoff between the accuracy and complexity of the reduced-order model
by choosing an appropriate order of the reduced model.

3.5.4 Simulation of Super-Zone Models

In a building with a large number of zones, one may want to further reduce the
number of zones as well. The aggregation method presented in this chapter can also
be used to reduce a large number of zones into as few super-zones as a practitioner
wants.

3 Aggregation-Based Thermal Model Reduction

47

If zone nodes are aggregated into a smaller number of super-zone nodes, there
does not exist one-to-one correspondence between a zone node to a single super-
zone node. We can’t directly compare the zone temperature for the full-order
model with the super-zone temperature for the reduced-order model. To compare
the full- and reduced-order models, we adopt the following method. Recall that
the exogenous inputs for the reduced model can be computed from the exogenous
inputs for the full model as described in (3.30), irrespective of what the order of the
reduced model is. We do this only for the outside temperature and heat gains for the
rooms. The mass ﬂow rate inputs of the reduced model are computed as follows.
The desired temperature for the kth super-zone is chosen to be the following linear
combination of the desired temperatures all zones of the kth group:

NT set
k

.t/ D

.Ci= NCk.(cid:5)//T set

.t/:

i

X

i2(cid:5)(cid:2)1.k/

This choice is made to take into account the difference in the heat capacity of the
zones, which lead to different energy requirements from the air conditioning system.
The same PI controller that was used to compute the mass ﬂow rate for each of the
zones in the full-order model is now applied to each super-zone. We then compare
the mass ﬂow rates obtained for a super-zone in the reduced-order model with the
sum of the mass ﬂow rates for the corresponding zones in the full-order model.

For the four-room building considered here, we aggregate the four zone nodes
into three super-zone-nodes: The ﬁrst super-zone node corresponding to the ﬁrst
zone node, the second super-zone node corresponding to the third zone node, and
the third super-zone node corresponding to the aggregation of the second and fourth
zone nodes. Then, by ﬁxing the partition assignments for the zone nodes, we can
further aggregate the building internal nodes into super-internal-nodes using the
recursive bi-partition algorithm.

As before, we consider two reduced-order models: (1) with 18 super-nodes
(3 super-zone nodes plus 15 super-internal nodes) and (2) with 24 super-nodes (3
super-zone nodes plus 21 super-internal nodes). By applying the PI controller, we

a

0.4

0.3

0.2

0.1

0
0

min
1
min
1

b

0.4

0.3

0.2

0.1

min
3
min
2

c

0.8

0.6

0.4

0.2

+min
4

min
2
min
3

5

10

15
Time (hour)

20

24

0
0

5

10

15
Time (hour)

20

24

0
0

5

10

15
Time (hour)

20

24

Fig. 3.4 Comparison results of mass ﬂow rates (kg/sec) for (a) zone-1 compared with super-zone-
1, (b) zone-3 compared with super-zone-2, and (c) zone-2 and zone-4 compared with super-zone-3,
between the full-order model and the reduced 18th-order model

48

a
0.4

0.3

0.2

0.1

0
0

min
1
min
1

b
0.4

0.3

0.2

0.1

min
3
min
2

c
0.8

0.6

0.4

0.2

K. Deng et al.

+min
4

min
2
min
3

5

10

15
Time (hour)

20

24

0
0

5

10

15
Time (hour)

20

24

0
0

5

10

15
Time (hour)

20

24

Fig. 3.5 Comparison results of mass ﬂow rates (kg/sec) for (a) zone-1 compared with super-zone-
1, (b) zone-3 compared with super-zone-2, and (c) zone-2 and zone-4 compared with super-zone-3,
between the full-order model and the reduced 24th-order model

ﬁnd that all zone or super-zone temperatures track the desired temperatures well for
both full- and reduced-order models. We omit the temperature plots here since these
are similar to plots shown in the last section. The mass ﬂow rates obtained from
the PI controllers for full- and reduced-order models are shown in Fig. 3.4 (for the
18th-order model) and Fig. 3.5 (for the 24th-order model). We observe that:
(cid:129) For k D 1; 2; 3, the mass ﬂow rate PNmk for the kth super-zone corresponds well
to the sum of mass ﬂow rates of all zones in the kth group. Since the mass ﬂow
rate is the important indicator of the power consumption of the building, the
reduced-order model can be used to estimate the power consumption with less
complexity.

(cid:129) The prediction errors of mass ﬂow rates for the 24th-order model is smaller than
those for the 18th-order model. In practice, one can make a tradeoff between the
accuracy and complexity of the reduced-order model.

3.6 Conclusions and Future Directions

We proposed a method to reduce the order of a multi-zone building thermal model
via aggregation of states. We ﬁrst establish a Markov chain analogy to the linear
part of the building model. A recently developed Markov aggregation method is
then applied to obtain the optimal aggregation of the state space. Extension of the
aggregation method to the nonlinear part of the model is carried out by aggregating
inputs accordingly into the super-inputs. A key advantage of the proposed method
is that the reduced model is still an RC-network model with the same structure as
the original model but with less number of nodes and less parametric information.
This makes the reduced model useful not only for simulation and analysis but also
for building design iterations.
Robust H1 Switching Control of Polytopic
Parameter-Varying Systems via Dynamic
Output Feedback
Abstract The problem of designing a globally optimal robust output-feedback
controller for time-varying polytopic uncertain systems is a well-known non-convex
optimization problem. In this paper, new sufﬁcient conditions for robust H1 output-
feedback control synthesis are proposed in terms of a special type of bilinear matrix
inequalities (BMIs), which can be solved effectively using linear matrix inequality
(LMI) optimization plus a line search. In order to reduce the conservatism of robust
output-feedback control methods based on single quadratic Lyapunov function,
we utilize multiple Lyapunov functions. The associated robust output-feedback
controller is constructed as a switching-type full-order dynamic output-feedback
controller, consisting of a family of linear subcontrollers and a min-switching
logic. The proposed approach features the important property of computational
efﬁciency with stringent performance. Its effectiveness and advantages have been
demonstrated through numerical studies.

Keywords Parameter-varying system (cid:129) Switched control (cid:129) Robust control

4.1 Introduction

During the past decades, a great deal of attention was devoted to the study of systems
with time-varying parametric uncertainties, due to their theoretical importance in
control theory and widespread applications in practical engineering problems. Both
issues of stability and control design for these types of systems have been examined
extensively in the literature (see, e.g., [1–5] and the references therein). A typical
robust control strategy is to construct a single linear time-invariant (LTI) controller
for norm-bounded uncertain systems using a single quadratic Lyapunov function
[4, 6]. Some classical works along this line are worth to be mentioned. Different
tools for both robustness analysis and controller design for systems subject to
structured uncertainties can be found in [4, 7–9], while [2, 10–12] considered similar
problems for systems with unstructured uncertainties. One potential drawback of
these classical methods lies in the conservatism due to the use of a single quadratic
Lyapunov function. In recent years, more advanced robust control approaches were
proposed to achieve better controlled performance. In particular, originated from
the pioneering works [13, 14], different switching-type robust controllers have been
proposed for various systems with different types of uncertainties, such as [15, 16]
on linear fractional transformation (LFT) systems and [7, 17] for polytopic uncertain
systems, both of which utilized the multiple Lyapunov function technique from the
switching control context [18]. A comprehensive review of the literature on robust
control of uncertain systems, including some recent results from either deterministic
or probabilistic perspective, can be found in [5].

Different from the state-feedback control case, the problem of designing a
robust output-feedback controller for linear uncertain systems is known to be
difﬁcult. The main source of difﬁculty stems from the non-convex nature of the
problem itself. Speciﬁcally, the associated robust control synthesis problem is
typically represented as a bilinear matrix inequality (BMI) optimization problem
for most design objectives. This type of non-convex optimization problems is NP-
hard, even under the single quadratic Lyapunov function framework (see, e.g.,
[4, 6, 19–21]). Various approaches have been reported to tackle the non-convexity
issue. Some rely on heuristic optimization algorithms to attain a locally optimal
solution [19, 22], which could be very involved and time-consuming; some resort
to certain mathematical relaxations to arrive at a convex synthesis condition but of
more conservatism [20]. As such, developing an effective robust output-feedback
control synthesis framework that simultaneously renders stringent performance and
computational efﬁcacy is urgently desirable but still remains as an open problem.

In this paper, we propose a new robust switching output-feedback (RSOF) control
scheme for a class of polytopic parameter-varying uncertain systems. Different
from the classical robust output-feedback control techniques, the proposed RSOF
controller consists of a family of full-order dynamic LTI subcontrollers and a min-
switching logic that governs the switching among them, which therefore results
in a switched closed-loop system with time-varying polytopic uncertainties. The
basic idea applied here for switching stability analysis and controller design is
borrowed from the switching control literature (see, for instance, [17, 18, 23–28]).
In particular, motivated by the methodologies from [17] on switched state-feedback
control of polytopic uncertain systems, [29] on asynchronous switching output-
feedback controller synthesis, and [30] on stabilization of switched linear systems
via min-switching control, we will ﬁrst derive the analysis conditions for robust
H1 stability of the resulting switched closed loop by using piecewise switched
Lyapunov functions. Then, based on the analysis conditions, the associated robust
switching control synthesis problem is formulated as a special type of BMIs,
which can be solved effectively in terms of LMIs plus a line search. The proposed

4 Robust H1 Switching Control of Polytopic Parameter-Varying Systems. . .

55

switching control design scheme advances existing methods for robust output-
feedback control synthesis in two important ways: better achievable controlled
performance in terms of H1 criterion due to the adoption of piecewise switched
Lyapunov functions; reduced computational complexity by solving a convex LMI-
based optimization coupled with a single line search. Numerical examples are given
to illustrate the effectiveness and advantages of the proposed design approach.

The rest of the paper is organized as follows. The problem statement and the form
of RSOF controller are presented in Sect. 4.2. Sections 4.3 and 4.4 contain the main
results of this paper including the robust analysis and control synthesis conditions,
respectively. Simulation results are provided in Sect. 4.5. Conclusions are ﬁnally
drawn in Sect. 4.6.

Notation R stands for the set of real numbers and RC for the positive real
numbers. The set of non-negative integers is denoted by NC. Rm(cid:6)n is the set of
real m (cid:4) n matrices, and Rn represents the set of real n (cid:4) 1 vectors. The transpose
of a real matrix M is denoted by MT . The Hermitian operator Hef(cid:2)g is deﬁned
as HefMg D M C MT for real matrices. The identity matrix of any dimension
is denoted by I. Sn and Sn
C are used to denote the set of real symmetric n (cid:4) n
matrices and positive deﬁnite matrices, respectively. If M 2 Sn, then M > 0
(M (cid:8) 0) indicates that M is a positive deﬁnite (positive semi-deﬁnite) matrix
and M < 0 (M (cid:5) 0) denotes a negative deﬁnite (negative semi-deﬁnite) matrix.
A block diagonal matrix with matrices X1; X2; : : : ; Xp on its main diagonal is
denoted by diagfX1; X2; : : : ; Xpg. Furthermore, we use the symbol ? in LMIs to
denote entries that follow from symmetry. For x 2 Rn, its norm is deﬁned as
kxk WD .xT x/1=2. The space of square integrable functions is denoted by L2, that
(cid:5)1=2 < 1. For two integers k1 < k2,
is, for any u 2 L2, kuk2 WD
we denote IŒk1; k2(cid:11) D fk1; k1 C 1; : : : ; k2g. The set of Metzler matrices M consists
of all matrices ˘ 2 RN(cid:6)N with elements (cid:10)ji, such that (cid:10)ji (cid:8) 0 for all i; j 2 IŒ1; N(cid:11)
with i ¤ j and

jD1 (cid:10)ji D 0 for all i 2 IŒ1; N(cid:11).

1
0 uT.t/u.t/dt

P

(cid:4)R

N

4.2 Problem Statement

Consider the following linear system with uncertain time-varying parameters:

3

5 D

2

4

2

4

Pxp.t/
e.t/
y.t/

Ap.(cid:13).t// Bp1.(cid:13).t// Bp2.(cid:13).t//
Cp1.(cid:13).t// Dp11.(cid:13).t// Dp12.(cid:13).t//
Cp2.(cid:13).t// Dp21.(cid:13).t// Dp22.(cid:13).t//

3

2

5

4

3

5

xp.t/
d.t/
u.t/

(4.1)

where the vectors xp 2 Rnx ; u 2 Rnu; d 2 Rnd ; y 2 Rny, and e 2 Rne denote the
plant state, control input, exogenous disturbance, measurement output, and error
(performance) output, respectively. The system matrices are uncertain and time-
varying, they are given by the convex combination

56

2

4

Ap.(cid:13).t// Bp1.(cid:13).t// Bp2.(cid:13).t//
Cp1.(cid:13).t// Dp11.(cid:13).t// Dp12.(cid:13).t//
Cp2.(cid:13).t// Dp21.(cid:13).t// Dp22.(cid:13).t//

3

5 D

2

4

NpX

iD1

(cid:13)i.t/

Ap;i Bp1;i Bp2;i
Cp1;i Dp11;i Dp12;i
Cp2;i Dp21;i Dp22;i

3

5

C. Yuan et al.

(4.2)

where the constant matrices at the polytope vertex, i.e., .Ap;i; Bp1;i; Bp2;i; Cp1;i; Dp11;i,
Dp12;i; Cp2;i, Dp21;i; Dp22;i/ for all i 2 IŒ1; Np(cid:11), are known for controller design. The
vector (cid:13).t/ WD Œ(cid:13)1.t/ : : : (cid:13)Np
.t/(cid:11)T 2 RNp represents the time-varying parametric
uncertainty which is not measurable in real time, and belongs to the unitary simplex
(cid:14) deﬁned by

8
<

:

NpX

iD1

9
=

;

(cid:14) D

(cid:15) 2 RNp W

(cid:15)i D 1; (cid:15)i (cid:8) 0; 8i 2 IŒ1; Np(cid:11)

(4.3)

To ease the notation and whenever the context is clear, the explicit time dependence
of vector (cid:13).t/ 2 (cid:14) will be dropped. Furthermore, for simplicity of presentation, we
have the following assumptions regarding system (4.1):
Assumption 1. .Ap;i; Bp2;i; Cp2;i/ is stabilizable and detectable for any i 2 IŒ1; Np(cid:11).
Assumption 2. Matrices .Bp2;i; Cp2;i; Dp12;i/ D .Bp2; Cp2; Dp12/ are constant
matrices, and Dp22;i D 0 for all i 2 IŒ1; Np(cid:11).

We stress that these two assumptions are made without losing any generality.
Assumption 1 is necessary to guarantee the existence of an output-feedback sta-
bilizing controller from y to u for each subsystem of (4.1) on the polytope vertices.
In the second assumption, Dp22;i D 0 can be relaxed using the well-known loop
transformation technique [4], while the assumptions on matrices .Bp2;i; Cp2;i; Dp12;i/
can also be satisﬁed by adding stable pre- and post-ﬁlters to the input and output
channels, respectively [31]. An illustrative example will be given in Sect. 4.5
(Example 1) to show how to satisfy this assumption.

Keeping in mind that the time-varying uncertainty (cid:13) 2 (cid:14) is not available for
feedback control use, the objective of this work is to design an RSOF control
law such that the overall closed-loop system is asymptotically stable and achieves
certain performance level from the disturbance d to the error output e for all
uncertain parameter (cid:13) 2 (cid:14).

To fulﬁll

this objective, we will construct

the following dynamic RSOF

controller:

(cid:6)

(cid:7)

(cid:6)
Pxc.t/
u.t/

D

Ac;(cid:7) .xc.t// Bc;(cid:7) .xc.t//
Cc;(cid:7) .xc.t// Dc;(cid:7) .xc.t//

(cid:7) (cid:6)

(cid:7)

xc.t/
y.t/

(4.4)

where xc 2 Rnc is the controller state with its dimension nc to be determined.
(cid:7).xc.t// is a switching rule of controller that selects a particular sequence of
LTI subcontrollers among Np available ones deﬁned by .Ac;j; Bc;j; Cc;j; Dc;j/ with
j 2 IŒ1; Np(cid:11). Its value is determined by the min-switching strategy as shown in

4 Robust H1 Switching Control of Polytopic Parameter-Varying Systems. . .

57

(cid:11)T .
Fig. 4.1, where jq is the current active controller index, and xcl
Matrices Pjq 2 SnxCnc
are positive deﬁnite. The matrices Pj together with matrices
.Ac;j; Bc;j; Cc;j; Dc;j/ (8j 2 IŒ1; Np(cid:11)) of compatible dimensions are subject to design.
The closed-loop system formed by interconnecting the controlled plant (4.1) and
the RSOF controller (4.4) can be written in the following switched polytopic form:

WD ŒxT

p xT
c

C

(cid:6)

(cid:7)

(cid:6)
Pxcl.t/
e.t/

D

Acl;(cid:13)(cid:7) Bcl;(cid:13)(cid:7)
Ccl;(cid:13)(cid:7) Dcl;(cid:13)(cid:7)

(cid:7) (cid:6)

(cid:7)

xcl.t/
d.t/

(4.5)

where xcl D ŒxT

p xT
c

(cid:11)T and

Ap.(cid:13)/ C Bp2Dc;(cid:7) Cp2 Bp2Cc;(cid:7)

Acl;(cid:13)(cid:7) D

Bc;(cid:7) Cp2

Bcl;(cid:13)(cid:7) D

Bp1.(cid:13)/ C Bp2Dc;(cid:7) Dp21.(cid:13)/
Bc;(cid:7) Dp21.(cid:13)/

;

(cid:7)

;

Ac;(cid:7)
(cid:7)

(cid:6)

(cid:6)

(cid:10)

Ccl;(cid:13)(cid:7) D

Cp1.(cid:13)/ C Dp12Dc;(cid:7) Cp2 Dp12Cc;(cid:7)

(cid:11)

;

Dcl;(cid:13)(cid:7) D Dp11.(cid:13)/ C Dp12Dc;(cid:7) Dp21.(cid:13)/:

Moreover, we deﬁne for all i; j 2 IŒ1; Np(cid:11),
(cid:7)

(cid:6)

Acl;ij D

Ap;i C Bp2Dc;jCp2 Bp2Cc;j

Bc;jCp2

Ac;j

(cid:10)

; Bcl;ij D
(cid:11)

(cid:6)

(cid:7)

Bp1;i C Bp2Dc;jDp21;i
Bc;jDp21;i

Ccl;ij D

Cp1;i C Dp12Dc;jCp2 Dp12Cc;j

; Dcl;ij D Dp11;i C Dp12Dc;jDp21;i:

Then, we have

Acl;(cid:13)j D

(cid:13)iAcl;ij; Bcl;(cid:13)j D

(cid:13)iBcl;ij;

Ccl;(cid:13)j D

(cid:13)iCcl;ij; Dcl;(cid:13)j D

(cid:13)iDcl;ij:

NpX

iD1

NpX

iD1

NpX

iD1

NpX

iD1

for all j 2 IŒ1; Np(cid:11).

In this paper, the robust H1 control problem will be considered. More precise

descriptions about this problem is given as follows:
Problem 4.1. Given the uncertain system (4.1). The robust H1 control design
objective is to determine matrices .Ac;j; Bc;j; Cc;j; Dc;j; Pj/ subject to (4.4) and the
switching strategy in Fig. 4.1, such that the switched closed-loop system in (4.5)
is robustly asymptotically stable and achieves a minimal worst-case H1 norm (cid:9)1
deﬁned by

58

C. Yuan et al.

Stay at current active controller jq 

Yes

xT
cl Pjq xcl ≤ mini  I [1,Np]

   xT

cl Pi xcl

Is

?

No

Switch to controller

jq+1 = arg mini  I[1,Np] xT
Set  jq = jq+1  

cl Pi  xcl

Fig. 4.1 Min-switching strategy

max
(cid:13)2(cid:14)

sup
kdk2¤0

kek2
kdk2

< (cid:9)1:

(4.6)

With respect to the H1 control problem, the following sections will be devoted
to studying the robust stability property of the switched closed-loop system (4.5)
under the min-switching logic in Fig. 4.1, and subsequently deriving computation-
ally tractable conditions for the RSOF controller synthesis.

4.3 Robust Analysis via Min-Switching

In this section, we will ﬁrst present the analysis conditions for robust H1
performance of the time-varying switched polytopic system (4.5) by using multi-
ple quadratic Lyapunov functions and parameter-dependent Metzler matrix [23].
Speciﬁcally, we will utilize the parameter-dependent Metzler matrix ˘.(cid:13)/ W (cid:14) !
RNp(cid:6)Np with elements given by

(cid:12)

(cid:10)ij.(cid:13)/ WD

(cid:4)j(cid:13)i;

i ¤ j
(cid:4)j.(cid:13)j (cid:3) 1/; i D j

(4.7)

where (cid:4)j (cid:8) 0 for all j 2 IŒ1; Np(cid:11). It can be easily veriﬁed through the same arguments
as in [23] that ˘.(cid:13)/ 2 M for all (cid:13) 2 (cid:14).

Then, we have the following theorem summarize the H1 analysis conditions:
Theorem 4.1. Given a scalar (cid:9)1 2 RC, the RSOF controller (4.4) with the min-
switching strategy as shown in Fig. 4.1 globally asymptotically stabilizes the time-
varying polytopic uncertain system (4.1) and renders an H1 performance level less

4 Robust H1 Switching Control of Polytopic Parameter-Varying Systems. . .

59

than (cid:9)1, if there exist matrices Pj 2 SnxCnc
2

C

, and scalars (cid:4)j (cid:8) 0 such that
3

4

HefPjAcl;ijg C (cid:4)j.Pi (cid:3) Pj/
BT
cl;ijPj
Ccl;ij

?
?
(cid:3)(cid:9) 2
1I ?
Dcl;ij (cid:3)I

5 < 0

hold for all i; j 2 IŒ1; Np(cid:11).

Proof. Consider the closed-loop system (4.5), we deﬁne the following piecewise
Lyapunov function:

(4.8)

(4.9)

V.xcl/ WD xT

clPjqxcl

C

where Pjq 2 SnxCnc
and jq 2 IŒ1; Np(cid:11) are the current active subcontroller index
determined by the min-switching strategy in Fig. 4.1. Then, multiplying (cid:13)i to both
sides of inequality (4.8) and summing up from i D 1 to i D Np, it yields
PNp

2

3

6
4

HefPjAcl;(cid:13)jg C (cid:4)j
BT
cl;(cid:13)jPj
Ccl;(cid:13)j

iD1 (cid:13)i.Pi (cid:3) Pj/

?
?
(cid:3)(cid:9) 2
1I ?
Dcl;(cid:13)j (cid:3)I

7
5 < 0

(4.10)

We ﬁrst examine the stability property for the closed-loop system (4.5) with
d (cid:9) 0. In light of the deﬁnition in (4.7), the min-switching strategy in Fig. 4.1, and
since (cid:4)j; (cid:13)i (cid:8) 0 (8i; j 2 IŒ1; Np(cid:11)), we have

(cid:4)jq

NpX

iD1

(cid:13)ixT
cl

.Pi (cid:3) Pjq

/xcl D

(cid:10)ijq

.(cid:13)/xT

clPixcl (cid:8)

(cid:10)ijq

.(cid:13)/xT

clPjqxcl D 0

(4.11)

NpX

iD1

NpX

iD1

Therefore, the .1; 1/ element of condition (4.10) ensures

PV.xcl/ D xT
cl

.AT

cl;(cid:13)jq

Pjq C PjqAcl;(cid:13)jq

/xcl < 0

for xcl ¤ 0. Let t(cid:3)
jqth subcontroller and tC
subcontroller. Then, at t(cid:3)
that is,

q denote the time when the controller switched out from
q be the time when the controller switched to the next
q , condition xT
clPixcl must be violated,

clPjqxcl (cid:5) mini2IŒ1;Np(cid:11) xT

min
i2IŒ1;Np(cid:11)

xT
cl

.t(cid:3)
q

/Pixcl.t(cid:3)
q

/ < xT
cl

.t(cid:3)
q

/Pjqxcl.t(cid:3)
q

/

Since the min-switching strategy determines jqC1 D arg mini2IŒ1;Np(cid:11) xT

clPixcl, that is,

xT
cl

.tC
q

/PjqC1xcl.tC
q

/ D min
i2IŒ1;Np(cid:11)

xT
cl

.t(cid:3)
q

/Pixcl.t(cid:3)
q

/

60

C. Yuan et al.

.tC
q

/PjqC1xcl.tC
q

// <
/PjqxT
Then, we have xT
cl
cl
V.xcl.t(cid:3)
//, and V.xcl/ thus satisﬁes the monotonically non-increasing condition.
q
According to the Theorem 2.3 in [32], the switched system (4.5) is globally
asymptotically stable.

/, which implies V.xcl.tC
q

/ < xT
cl

.t(cid:3)
q

.t(cid:3)
q

Now, we examine the closed-loop H1 performance. Through Schur comple-

ment, condition (4.10) with (4.11) gives

"

#

"

#

HefPjAcl;(cid:13)jg

?
cl;(cid:13)jPj (cid:3)(cid:9) 2
BT
1I

C

CT
DT

cl;(cid:13)j

cl;(cid:13)j

(cid:10)
Ccl;(cid:13)j Dcl;(cid:13)j

(cid:11)

< 0

Multiplying ŒxT
right, it yields

cl dT (cid:11) from the left of the above condition and its transpose to the

PV.xcl/ C eT e (cid:3) (cid:9) 2

1dT d < 0

Integrating both sides of the above condition from t D 0 to 1 and taking into
account that under zero initial condition V.xcl.0// D 0 and V.xcl.1// (cid:8) 0, we can
conclude that kek2 < (cid:9)1kdk2.

Remark 4.1. Compared with classical results on robust stability analysis of linear
parameter-varying (LPV) systems [4], we have adopted a piecewise switched
Lyapunov function instead of using a single quadratic Lyapunov function, which
is motivated from the context of switching control [18, 23]. The resulting conditions
Theorem 4.1 for H1 control improve classical results in the sense that quadratic
stability of each system matrix Acl;ij with i; j 2 IŒ1; Np(cid:11) and i ¤ j is not necessarily
required to guarantee feasibility.

4.4 RSOF Controller Synthesis

Based on the analysis results in the previous section, we are in the position to
study the H1 control synthesis problem for the RSOF controller (4.4). The RSOF
control synthesis problem requires the determination of the coefﬁcient matrices
.Ac;j; Bc;j; Cc;j; Dc;j/ in the controller dynamics (4.4) and Pj with respect to the min-
switching strategy in Fig. 4.1, for all j 2 IŒ1; Np(cid:11). However, since the plant state xp
is not always available for feedback control use, and in order to make the switching
logic in Fig. 4.1 implementable, we will specify the Lyapunov matrices with a
prescribed structure so as to structurally incorporate switching rules that depend
only on available information, i.e.,

(cid:6)

(cid:7)

;

S N
NT Xj

Pj D

(4.12)

4 Robust H1 Switching Control of Polytopic Parameter-Varying Systems. . .

61

; N 2 Rnx(cid:6)nc , and Xj 2 Snc

where S 2 Snx
C, for all j 2 IŒ1; Np(cid:11). We aim to
C
derive computationally tractable conditions, such that all these controller coefﬁcient
matrices can be jointly synthesized through convex optimization. To this end, we
ﬁrst introduce the following lemma, which is useful in the subsequent derivation for
our main results.
Lemma 4.1. Given a symmetric matrix (cid:16)0 and matrices (cid:16)1; (cid:16)2 with compatible

(cid:6)

(cid:7)

< 0 holds if and only if the following

dimensions, condition (cid:16)0 C
condition holds for some positive number (cid:17).

0
?
2 (cid:16)1 0
(cid:16) T

(cid:6)

2
4(cid:16)0 (cid:3)

(cid:7)

3

(cid:17)(cid:16) T
1 (cid:16)1
0
(cid:17)(cid:16)1 (cid:16)2

(cid:10)

?
1
2 (cid:16)2
(cid:17) (cid:16) T
(cid:11)

?

5 < 0

(cid:3)(cid:17)I

(4.13)

Proof. Through Schur complement, condition (4.13) is equivalent to
(cid:6)

(cid:7)

(cid:7)

(cid:6)

(cid:6)

(cid:7)

‡0 (cid:3)

(cid:17)‡ T
1 ‡1
0

?
1
2 ‡2
(cid:17) ‡ T

C

(cid:17)‡ T
‡ T

1 ‡1
2 ‡1

?
1
2 ‡2
(cid:17) ‡ T

D ‡0 C

0
?
‡ T
2 ‡1 0

< 0:

Then, using this lemma and the analysis results in Theorem 4.1, we have the
following theorem solve the robust H1 control synthesis problem in terms of
matrix inequalities.
Theorem 4.2. Given tunable scalars (cid:4)j (cid:8) 0, if there exist positive deﬁnite matrices
Rj; OS 2 Snx
C, symmetric matrices Tij 2 Snx , rectangular matrices OAc;j 2 Rnx(cid:6)nx ; OBc;j 2
Rnx(cid:6)ny ; OCc;j 2 Rnu(cid:6)nx ; ODc;j 2 Rnu(cid:6)ny , and positive scalars O(cid:17); O(cid:9)1 2 RC such that for
all i; j 2 IŒ1; Np(cid:11), the following conditions hold:

2

6
6
6
6
6
4

HefAp;iRj C Bp2 OCc;jg C (cid:4)jTij (cid:3) 2Rj C O(cid:17)I
p;i C CT
p21;i

OAc;j C O(cid:17)AT
O(cid:17)BT

p2 ODT
c;jBT
p2
ODT
p1;i C DT
c;jBT
p2
Cp1;iRj C Dp12 OCc;j
Rj

?
Hef OSAp;j C OBc;jCp2g C O(cid:17)I
OS C DT
OBT
BT
c;j
O(cid:17)Cp1;i C Dp12 ODc;jCp2
.Ap;i (cid:3) Ap;j/T OS
3

p21;i

p1;i

?
?
(cid:3) O(cid:9) 2
1I

? ?
? ?
? ?
O(cid:17)Dp11;i C Dp12 ODc;jDp21;i (cid:3)I ?
0 (cid:3)O(cid:17)I

0

7
7
7
7
7
5

< 0;

(4.14)

(4.15)

2

4

Tij C Rj ? ?
Ri ?
O(cid:17)I OS

Rj
O(cid:17)I

3

5 (cid:8) 0;

(cid:7)
(cid:6)
Rj ?
O(cid:17)I OS

> 0:

62

C. Yuan et al.

Then, the time-varying polytopic uncertain system (4.1) is globally asymptotically
stabilized by the RSOF controller (4.4) of order nc D nx, and the closed-loop H1
performance level is less than (cid:9)1 D O(cid:9)1
O(cid:17) under the min-switching strategy with the
condition in Fig. 4.1 replaced by

xT
c Xjxc (cid:5) min
i2IŒ1;Np(cid:11)

c Xixc;
xT

(4.16)

where Xj D (cid:3)NT RjM(cid:3)T
j
matrices of the RSOF controller are given by

, MjNT D I (cid:3)RjS, and S D 1

O(cid:17)2 OS. Furthermore, the coefﬁcient

(cid:6)

Ac;j Bc;j
Cc;j Dc;j

(cid:7)

(cid:6)

D

O(cid:17)N O(cid:17)SBp2
0

I

(cid:7)(cid:3)1 (cid:6)

OAc;j (cid:3) O(cid:17)SAp;jRj OBc;j
ODc;j

OCc;j

0
MT
j
Cp2Rj O(cid:17)I

(cid:7) "

#(cid:3)1

:

(4.17)

for all j 2 IŒ1; Np(cid:11).

Proof. According to Theorem 4.1, and using the partitions in (4.12), we deﬁne for
all j 2 IŒ1; Np(cid:11),

such that PjZ1;j D Z2 and MjNT D I (cid:3) RjS, which implies Xj D (cid:3)NT RjM(cid:3)T
Moreover, we specify

j

.

"

#

Rj I
0
MT
j

Z1;j D

;

Z2 D

(cid:7)

;

(cid:6)

I S
0 NT

"

#

O(cid:17)I
0

Rj
MT
j

QZ1;j D

;

OZ2 D

(cid:6)

(cid:7)

;

O(cid:17)S
I
0 O(cid:17)NT

(4.18)

(4.19)

which gives Pj QZ1;j D QZ2. The deﬁnition of O(cid:17) > 0 will be given later. Based on

condition (4.15), it can be veriﬁed that QZT

1;jPj QZ1;j D

> 0, in turn, Pj > 0 as

(cid:7)

(cid:6)
Rj O(cid:17)I
O(cid:17)I
OS

QZ1;j is nonsingular.

Then, by performing congruence transformation with matrix diagf QZ1;j; O(cid:17)I; Ig on

condition (4.8), we obtain the following results:

1;jPjAcl;ij QZ1;j D QZT
QZT

2 Acl;ij QZ1;j D
h

(cid:6)

Ap;iRj C Bp2 OCc;j
OAc;j C O(cid:17)S.Ap;i (cid:3) Ap;j/Rj

O(cid:17)Ap;i C Bp2 ODc;jCp2
OSAp;i C OBc;jCp2

(cid:7)

;

O(cid:17)BT

cl;ijPj QZ1;j D O(cid:17)BT
cl;ij

QZ2 D

O(cid:17)BT

p1;i C DT

p21;i

ODT

c;jBT

p2 BT

p1;i

(cid:10)
Cp1;iRj C Dp12 OCc;j O(cid:17)Cp1 C Dp12 ODc;jCp2

;

Ccl;ij QZ1;j D
O(cid:17)2(cid:9) 2

1 D O(cid:9) 2

1

;

i

OBT
c;j

p21;i

;

OS C DT
(cid:11)

(4.20)

4 Robust H1 Switching Control of Polytopic Parameter-Varying Systems. . .

63

where

OAc;j D O(cid:17)SAp;jRj C O(cid:17)SBp2Dc;jCp2Rj C O(cid:17)NBc;jCp2Rj C O(cid:17)SBp2Cc;jMT
OBc;j D OSBp2Dc;j C O(cid:17)2NBc;j;

j C O(cid:17)NAc;jMT

j

;

OCc;j D Dc;jCp2Rj C Cc;jMT
j

;

ODc;j D O(cid:17)Dc;j;

OS D O(cid:17)2S:

On the other hand, we have

QZT
1;j

.Pi (cid:3) Pj/ QZ1;j D QZT
1;j

(cid:6)

(cid:7)

0
0
0 Xi (cid:3) Xj

"

QZ1;j D

Mj.Xi (cid:3) Xj/MT
j
0

#
0
0

Since MjNT D I (cid:3) RjS, it can be shown that Xj D NT .S (cid:3) R(cid:3)1
matrix inversion lemma [4], and through algebraic manipulations, we obtain

/(cid:3)1N > 0. Using the

j

Mj.Xi (cid:3) Xj/MT

j D S(cid:3)1 (cid:3) Rj C .Rj (cid:3) S(cid:3)1/.Ri (cid:3) S(cid:3)1/(cid:3)1.Rj (cid:3) S(cid:3)1/:

(4.22)

Moreover, through Schur complement, condition (4.15) implies

Tij (cid:8) S(cid:3)1 (cid:3) Rj C .Rj (cid:3) S(cid:3)1/.Ri (cid:3) S(cid:3)1/(cid:3)1.Rj (cid:3) S(cid:3)1/

(cid:5) (cid:4)jTij. Therefore,
which together with (4.22) concludes that (cid:4)j
after the congruence transformation, condition (4.15) can be deduced. Moreover,
condition (4.8) becomes

(cid:2)
Mj.Xi (cid:3) Xj/MT
j

(cid:3)

2

4

‡0 C

0
(cid:6)
O(cid:17)S.Ap;i (cid:3) Ap;j/
0

(cid:7)

Rj 0

3
0
5 < 0:

where

‡0 WD
2

6
6
6
4

HefAp;iRj C Bp2 OCc;jg C (cid:4)jTij
OAc;j C O(cid:17)AT
p;i C CT
O(cid:17)BT
p21;i

p2 ODT
c;jBT
ODT
p1;i C DT
c;jBT
p2
Cp1;iRj C Dp12 OCc;j

?

p2 Hef OSAp;i C OBc;jCp2g
OBT
OS C DT
c;j

?
?
?
BT
O(cid:17)Cp1;i C Dp12 ODc;jCp2 O(cid:17)Dp11;i C Dp12 ODc;jDp21;i (cid:3)I
(cid:10)
(cid:11)
O(cid:17).Ap;i (cid:3) Ap;j/T S 0

?
?
(cid:3) O(cid:9) 2
1I

p21;i

p1;i

Then, by setting ‡1 D Rj; ‡2 D
, invoking Lemma 4.1, to
guarantee the satisfaction of condition (4.23), it is equivalent to have the following

(4.21)

(4.23)

3

7
7
7
5

64

C. Yuan et al.

condition for some positive number (cid:17) D 1
O(cid:17) ,

(cid:13)

(cid:12)

2

(cid:12)

6
6
6
6
6
6
6
6
6
4

OAc;j C O(cid:17)AT

p;i C CT

HefAp;iRj C Bp2 OCc;jg
C(cid:4)jTij (cid:3) (cid:17)RjRj
p2 ODT
ODT
p1;i C DT
c;jBT
p2
Cp1;iRj C Dp12 OCc;j
(cid:17)Rj

p21;i

O(cid:17)BT

c;jBT
p2

?

(cid:13)

Hef OSAp;i C OBc;jCp2g
(cid:3)O(cid:17)3S.Ap;i (cid:3) Ap;j/.Ap;i (cid:3) Ap;j/T S
OS C DT
OBT
BT
c;j
O(cid:17)Cp1;i C Dp12 ODc;jCp2
O(cid:17).Ap;i (cid:3) Ap;j/T S

p21;i

p1;i

?
?
(cid:3) O(cid:9) 2
1I

? ?
? ?
? ?
O(cid:17)Dp11;i C Dp12 ODc;jDp21;i (cid:3)I ?
0 (cid:3)(cid:17)I

0

3

7
7
7
7
7
5

< 0;

Consequently, perform congruence transformation with matrix diagfI; I; I; I; O(cid:17)Ig on
the above condition, and based on the fact that (cid:3)ZT W (cid:3)1Z (cid:5) (cid:3)ZT (cid:3) Z C W holds for
any pair of W > 0 and Z, we have (cid:3)(cid:17)RjRj (cid:5) (cid:3)2Rj C O(cid:17)I and (cid:3)O(cid:17)3S.Ap;i (cid:3) Ap;j/.Ap;i (cid:3)
Ap;j/T S (cid:5) (cid:3)Hef OS.Ap;i (cid:3) Ap;j/g C O(cid:17)I. This yields exactly condition (4.14). Moreover,
the controller formula (4.17) can be veriﬁed by inverting the relations in (4.21).

Due to the product of scalar variables (cid:4)j and matrix variables Tij, condition (4.14)
in Theorem 4.2 is non-convex by nature. For this special type of BMIs, one can
resort to LMI optimization technique coupled with a multi-dimensional search over
the scalar variables. When the number of Np is large, a possible way to reduce
computational cost of the synthesis problem is by enforcing (cid:4)j D (cid:4) (cid:8) 0 for all
j 2 IŒ1; Np(cid:11). Although the resulting conditions are more conservative, they can be
solved relatively easier via LMI optimization with a single line search parameter.
The following corollary formally presents this result for the robust H1 control
problem.
Corollary 4.1. Given a tunable scalar (cid:4) (cid:8) 0, the result of Theorem 4.2 remains
valid whenever inequalities (4.14) are replaced by

2

6
6
6
6
6
4

HefAp;iRj C Bp2 OCc;jg C (cid:4)Tij (cid:3) 2Rj C O(cid:17)I
p;i C CT
p21;i

OAc;j C O(cid:17)AT
O(cid:17)BT

p2 ODT
c;jBT
p2
ODT
p1;i C DT
c;jBT
p2
Cp1;iRj C Dp12 OCc;j
Rj

?
Hef OSAp;j C OBc;jCp2g C O(cid:17)I
OS C DT
OBT
BT
c;j
O(cid:17)Cp1;i C Dp12 ODc;jCp2
.Ap;i (cid:3) Ap;j/T OS

p21;i

p1;i

4 Robust H1 Switching Control of Polytopic Parameter-Varying Systems. . .

65

?
?
(cid:3) O(cid:9) 2
1I

? ?
? ?
? ?
O(cid:17)Dp11;i C Dp12 ODc;jDp21;i (cid:3)I ?
0 (cid:3)O(cid:17)I

0

3

7
7
7
7
7
5

< 0:

(4.24)

for all i; j 2 IŒ1; Np(cid:11).

The results of Theorem 4.2 and Corollary 4.1 then can be used to pose the
following optimization problem for the robust H1 control problem, such that the
RSOF controller that renders the closed loop a suboptimal H1 performance level
can be designed. As mentioned above, this type of optimization problem can be
solved through a line search over (cid:4) with LMIs.

min
Rj; OS;Tij; OAc;j; OBc;j; OCc;j; ODc;j;O(cid:17);(cid:4); 8i;j2IŒ1;Np(cid:11)

O(cid:9) 2
1

s.t.

(4.15) and (4.24):

(4.25)

4.5 Numerical Examples

In this section, two examples will be used to illustrate the design procedure and
effectiveness of the proposed RSOF control scheme. The ﬁrst example aims to
design a robust output-feedback H1 controller for a system with sensor outages.
Moreover, it will be demonstrated via the second example that the proposed design
scheme based on using a piecewise switched Lyapunov function is indeed capable
of rendering a better L2-gain performance for the closed-loop system than that
obtained under the single quadratic Lyapunov function framework.

Example 1. Consider a fourth order two-input two-output system subject to sensor
outages, which is borrowed from [33] and also considered in [20]. The system can
be described as the following polytopic uncertain system:

8
ˆˆ<

ˆˆ:

G W

Px.t/ D Ax.t/ C B1d.t/ C B2u.t/
e.t/ D C1x.t/ C D11d.t/ C D12u.t/
y.t/ D C2.(cid:13).t//x.t/ C D21d.t/

(4.26)

where

66

C. Yuan et al.

2

4

A
B1 B2
C1 D11 D12
C2.(cid:13)/ D21 0

3

5 D

2

6
6
6
6
6
6
6
6
6
4

1 1 0 0
1
(cid:3)2 1
3
2 0 1 0
0
0
(cid:3)1 0 (cid:3)2 (cid:3)3 1 0 0
(cid:3)2 (cid:3)1 2 (cid:3)1 0 0 1
0 (cid:3)1 0 0 0 0
1
c1 0
0 0 0 0
0 c2 0 0 0 0
0

0

3

7
7
7
7
7
7
7
7
7
5

where two unknown parameters c1 and c2 both take values from f0; 1g. Speciﬁcally,
ci D 0 with i D 1; 2 indicates the ith measurement experiences an outage. We
assume as in [33] and [20] that there always exists at least one measurement working
for feedback control use, i.e., c1 and c2 will not be simultaneously equal to zero. This
will results in a polytope of Np D 3 vertices with
(cid:7)

(cid:7)

(cid:6)

(cid:6)

(cid:6)

(cid:7)

C2;1 D

0 0 0 0
0 0 1 0

; C2;2 D

; C2;3 D

1 0 0 0
0 0 0 0

1 0 0 0
0 0 1 0

:

(4.27)

To apply the proposed RSOF control scheme to solve the H1 control problem,
we observe that the output matrix C2.(cid:13)/ does not satisfy Assumption 2. Neverthe-
less, following the methodology from [31], the original plant can be transformed
to a new system that ﬁts into the proposed design framework by concatenating a
stable LTI ﬁlter to the measurement channel (as depicted in Fig. 4.2). The state-
space model of the LTI ﬁlter is chosen as

(cid:6)

(cid:7)

(cid:6)

(cid:7) (cid:6)

(cid:7)

Gy W

D

Pxy
Qy

Ay By
Cy 0

;

xy
y

where xy 2 Rna is the ﬁlter state, and Qy 2 Rny is the ﬁltered output that will serve
as the controller input. Then, the resulting augmented system can be written in the
form of (4.1) with

Fig. 4.2 Augmented system
structure (Example 1)

d

G

u

RSOF

Gaug

e

Gy

y

4 Robust H1 Switching Control of Polytopic Parameter-Varying Systems. . .

67

8

ˆˆˆˆˆ<
ˆˆˆˆˆ:

(cid:7)

(cid:6)

A

0
ByC2;i Ay
(cid:11)
(cid:10)
C1 0
(cid:11)
(cid:10)
0 Cy

Ap;i D

Cp1 D

Cp2 D

Gaug W

; Bp1 D

; Bp2 D

(cid:6)

(cid:7)

B1
ByD21

(cid:6)

(cid:7)

B2
0

;

; Dp11 D D11; Dp12 D D12;

; Dp21 D 0; Dp22 D 0:

(4.28)

For controller synthesis, we specify the ﬁlter with

(cid:6)

(cid:7)

(cid:6)

Ay By
Cy 0

D

(cid:3)100I2 I2
100I2 0

(cid:7)

Therefore, based on the augmented system data, we solve the optimization prob-
lem (4.25) to yield a suboptimal value of (cid:9)1 D 1:7415, which signiﬁcantly
improves those obtained by using the methods in [33] and [20] for all scenarios
discussed therein (see Tables 1 and 2 in [20]). Furthermore, the corresponding
RSOF controller in the form of (4.4) contains three subcontrollers with the order
nc D 4 C 2 D 6.

With the synthesized RSOF controller, we run the time-domain simulation by
applying a pulse disturbance input of magnitude 1 starting from t D 0 and ending
at t D 1 sec The closed-loop responses, including four plant states (Fig. 4.3a), the
uncertain time-varying vector (cid:13).t/ (Fig. 4.3b), two control inputs (Fig. 4.3c), and
the controller switching signals (Fig. 4.3d), are presented. According to (4.27), in
Fig. 4.3b, (cid:13).t/ D Œ1 0 0(cid:11)T corresponds to the case of sensor failure on y1, while
(cid:13).t/ D Œ0 1 0(cid:11)T is with respect to the case when the second output y2 fails. As
can be seen, for this simulation study, only one output measurement is available
at each time instant. Nevertheless, from Fig. 4.3a, c, it is observed that in spite of
the sensor outages, the designed RSOF controller is still capable of stabilizing the
overall closed-loop system with reasonable control input efforts.

Example 2. This example aims to further demonstrate the effectiveness and advan-
tages of the proposed switching control scheme based on piecewise switched
Lyapunov functions. We consider a two-disk H1 control problem as discussed in
[34]. The uncertain dynamics of the two-disk model is given in the following form:

3

7
7
7
7
7
5

2

6
6
6
6
6
4

Px1.t/
Px2.t/
Px3.t/
Px4.t/
y.t/

2

6
6
6
6
6
4

T(cid:3) W

D

0
0
(cid:3)1.t/ (cid:3) k
M1
(cid:3) k
M2
0

0
0
(cid:3) k
M1
(cid:3)2.t/ (cid:3) k
M2
1

1
0
0
1
0
(cid:3) b
M1
0 (cid:3) b
M2
0
0

0 0 0
0 0 0
0:1
1
0
M1
M1
0 0 0:1
M2
0 0 0

3

7
7
7
7
7
5

3

7
7
7
7
7
7
7
7
7
5

2

6
6
6
6
6
6
6
6
6
4

x1.t/
x2.t/
x3.t/
x4.t/
u.t/
d1.t/
d2.t/

68

a

0.5

0.4

0.3

0.2

0.1

0

−0.1

−0.2

−0.3

0

c

1

0.5

0

−0.5

−1

−1.5

−2

0

1

2

3

6

7

8

9

10

4

5
time (sec)

1

2

3

6

7

8

9

10

4

5
time (sec)

C. Yuan et al.

1

2

3

4

5

6

7

8

9

10

1

2

3

4

5

6

7

8

9

10

x
p1
x
p2
x
p3
x
p4

u
1
u
2

b

1

ξ

0.5

2

ξ

0.5

3

ξ

0.5

1

0

0

1

0

0

1

0

0

d

3

2.8

2.6

2.4

2.2

2

1.8

1.6

1.4

1.2

1

0

1

2

3

6

7

8

9

10

4

5
time (sec)

1

2

3

6

7

8

9

10

4

5
time (sec)

Fig. 4.3 H1 RSOF control (Example 1). (a) Plant states, (b) uncertain parameter (cid:13).t/, (c) control
input, (d) switching signal

eu

Wu

ea

Wa

ref

y

uc

Act

u

Tp

er

We

e

d1,2

dn

Wn

n

Fig. 4.4 Weighted open-loop plant interconnection of the two-disk problem [34] (Example 2)

with M1 D 1; M2 D 0:5; b D 1; k D 200 and two uncertain parameters (cid:3)1.t/ 2
Œ0; 9(cid:11), (cid:3)2.t/ 2 Œ0; 25(cid:11) yielding a polytope of Np D 4 vertices. For robust H1 control
synthesis, we adopt the same performance weighting functions as in [34] to form a
weighted open-loop plant as depicted in Fig. 4.4, where the weighting functions are
speciﬁed as

4 Robust H1 Switching Control of Polytopic Parameter-Varying Systems. . .

69

We.s/ D

0:3s C 1:2
s C 0:04

; Wu.s/ D

Wa.s/ D 0:00001; Wn.s/ D

;

s C 0:1
0:01s C 125
s C 0:4
0:01s C 400

:

The actuator dynamics is assumed to be Act.s/ D 1

0:01sC1 .

Based on such a system setup, we solve the optimization problem (4.25) with
(cid:4) D 1. The RSOF control synthesis yields a suboptimal L2 gain (cid:9)1 D 1:1139. To
demonstrate the effectiveness of the proposed RSOF control approach, this result is
compared with that obtained by using (cid:6)-type synthesis method [4, 6]. Speciﬁcally, a
robust controller consisting of a single LTI output-feedback control law is designed
by using a single quadratic Lyapunov function. It should be pointed out that the
robust output-feedback control synthesis problem is known to be non-convex. For
fairness of comparison, we utilize a global optimization technique, namely the
Branch and Bound algorithm [22], to yield a globally optimal solution. After
extensive search over the solution space, we are able to obtain the corresponding
global optima as (cid:9)1 D 1:55, which is larger than our result by 28:14%. The gain
of performance can be attributed to the adoption of piecewise switched Lyapunov
functions in the proposed design framework. Further comparisons are conducted
through time-domain simulations. The closed-loop system responses with a step
reference input by using, respectively, the single LTI controller and the proposed
RSOF controller are plotted in Fig. 4.5. As can be seen from Fig. 4.5a, consistent
with the calculated H1 norm, the RSOF controller indeed outperforms the LTI
controller with less overshoot, faster settling time, less steady-state error, as well as
less control efforts (see Fig. 4.5b) during the transient period.

4.6 Conclusions

A new RSOF control scheme has been proposed for a class of linear systems with
time-varying polytopic uncertainties. The proposed RSOF controller is constructed
in a switching fashion, which consists of a set of linear dynamic output-feedback
controllers and a switching rule (namely the min-switching strategy) that governs
the switching among them. The novelty of the proposed control design scheme lies
in that: (1) no online measurements of the uncertain time-varying parameters are
required for controller implementation; (2) the robust control synthesis conditions
are cast as a special type of BMIs, which can be solved via LMI optimization
plus a line search; (3) owing to the use of piecewise switched Lyapunov functions,
better controlled performance can be achieved comparing with those obtained by
using a single quadratic Lyapunov function. The effectiveness and advantages of the
proposed control design scheme have been demonstrated through numerical studies.

70

C. Yuan et al.

RSOF Control
LTI Control
Reference

RSOF Control
LTI Control

1

2

3

6

7

8

9

10

4

5
time (sec)

1.4

1.2

1

0.8

0.6

0.4

0.2

0

0

25

20

15

10

5

0

−5

−10

0

1

2

3

6

7

8

9

10

4

5
time (sec)

Fig. 4.5 Step response of the two-disk system (Example 2). (a) Tracking output, (b) control input
Abstract This chapter presents an application of robust control theory to an
automotive air conditioning (A/C) system. A control-oriented model built using
moving-boundary method is validated against experimental data collected on a
vehicle chassis dynamometer, at constant engine speeds as well as on driving cycles.
Next, an H1 controller is synthesized by formulating an optimization problem
whose solution requires appropriate weighting functions selection. Singular per-
turbation method is utilized to remove states associated with fast dynamics in
both model and controller. Both full-order and reduced-order H1 controllers are
veriﬁed by simulation results obtained using the nonlinear A/C system model. It is
demonstrated that the designed controller is capable of tracking the reference output
trajectories while rejecting disturbances introduced on the boundary conditions of
the heat exchangers. Furthermore, a preliminary study is performed to reveal the
opportunity of designing a gain-scheduled H1 controller for global output tracking.

Keywords Air conditioning system (cid:129) H inﬁnity synthesis (cid:129) Moving-boundary
method (cid:129) Automotive (cid:129) Singular perturbation method

5.1 Introduction

The automotive industry is striving to improve fuel economy in vehicles, under
considerable pressures dictated by the increasing fuel prices, and the mandates to
reduce CO2 emissions globally. Several engineering solutions have been introduced
to production in the past years to improve the energy conversion efﬁciency of
the powertrain components, such as the engine and transmission [1]. Substantial
improvements can also be achieved through the use of advanced control techniques,
for instance, to optimize the use of the A/C system based on the engine and
drivetrain operations [2]. Reducing the impact of automotive air conditioning
systems on vehicle fuel consumption is a challenging control problem, which could
be addressed by adopting supervisory energy management strategies (overseeing
the system operations and optimizing the power consumption without affecting the
cabin comfort), as well as low-level feedback control schemes for tracking targeted
set-points.

Generally, applications of control theory to A/C systems and refrigeration
systems involve the formulation of a tracking control problem for the evaporator
pressure and superheat temperature [3, 4]. In details, the superheat temperature
should be maintained higher than a speciﬁc threshold to avoid liquid refrigerant
ﬂowing into the compressor. At the same time, the evaporator pressure should be
controlled to a desired target to carefully balance the ability of the heat exchanger
to extract heat from the cabin air without reaching the moisture freezing point.
Although the control inputs are different depending on the actuator conﬁgurations,
the controllers should track the two controlled outputs and reject disturbances to
the A/C loop caused by varying ﬂow rates and air temperature at the condenser and
evaporator [5, 6].

The modeling of the dynamics of the A/C system with accuracy and computa-
tional efﬁciency is critical to the design of robust model-based control algorithms.
However, modeling the system dynamics requires accurate characterization of phase
change processes, as the working ﬂuids absorb and reject heat in the evaporator
and condenser. The most common approach to control-oriented modeling of heat
exchangers for refrigeration cycles is based on the moving-boundary method
(MBM) [7–12]. An A/C system model based on the MBM characterizes the pressure
and enthalpy dynamics in the evaporator and condenser starting from a detailed
description of the phase transitions within the heat exchangers.

In order to reduce the difﬁculty of performing control design when using the
aforementioned models, a common approach is to start from low-order, linear
models obtained from the NDAEs through system identiﬁcation or model order
reduction [13]. For instance, [14] presents a discrete-time state variable model
for indirect adaptive control recursively identiﬁed using a multi-input multi-output
(MIMO) parameter estimation algorithm. A linear quadratic regulator (LQR) was
then implemented for reference tracking and disturbance rejection. A local model
network based on Youla parameterization was developed in [3], and Lyapunov-
based methods were used to stabilize a tracking controller with respect to different
local linear models. Similarly, a low-order nonlinear evaporator model was devel-
oped for backstepping design of a nonlinear adaptive controller [15]. A model
predictive control (MPC) algorithm was applied to compute an optimal command
proﬁle of each actuator by formulating a multiple criterion including cycle efﬁciency
and technological constraints [16], based on a low-order nonlinear model of a vapor
compression cycle proposed in [17]. A linear-quadratic Gaussian(LQG) controller
was designed together with a state observer of the Kalman ﬁlter type for controlling
the evaporator feeding and for matching the cooling capacity [18]. Recently,
advanced techniques tackling model uncertainty and external disturbances are
preliminary investigated, such as sliding mode control [19] and robust control [4].

5 Output Feedback Control of Automotive Air Conditioning System: : :

75

One important aspect in control design for A/C systems and refrigeration systems
is related to robustness, which is critical to ensure the ability of the controller to
reject model uncertainties introduced by the system identiﬁcation and disturbances
on the boundary conditions to the heat exchangers. Mitigating the inﬂuence of
model uncertainties and disturbances on tracking performance is a problem typically
solved in the framework of robust control. In the automotive ﬁeld, robust control has
been demonstrated for several practical applications, e.g., boost pressure control in
turbocharged diesel engines [20, 21]. On the other hand, there is a lack of systematic
studies on the application of robust control theory to the control design of A/C
systems and compression refrigeration systems [5, 22].

Therefore, this chapter presents a robust control design for output tracking and
disturbance rejection of the A/C system. Section 5.2 explains the modeling approach
based on the MBM, and the resulted model is calibrated and validated against
experimental data collected on a vehicle chassis dynamometer in Sect. 5.3. An
overview of control objective formulation and H1 synthesis procedure is given in
Sect. 5.4. The design process is detailed in Sect. 5.5 with validations on the nonlinear
MBM A/C model.

5.2 Automotive A/C System Description

For this study,
the production air conditioning system of a Minivan, whose
plant diagram is shown in Fig. 5.1, was instrumented to allow for experimental
characterization. In particular, two ball valves were inserted to isolate the lines
feeding the rear evaporator, hence simplifying the characterization of the circuit.
Two pressure transducers and two thermocouples were then positioned at the suction
and discharge side of the compressor. The clutch current was also measured through
an inductive sensor. Additional thermocouples (not shown in ﬁgure) were ﬁnally
inserted to measure the temperature of the air at the inlet of the evaporator and
condenser. The air ﬂow velocity was controlled by varying the PWM signal of the

Fig. 5.1 Schematic of the air conditioning system in the experimental setup

76

Q. Zhang and M. Canova

Fig. 5.2 Block diagram of the A/C system model

fan and blower, and measured by a Pitot tube. The test vehicle was instrumented with
an ETAS ES1000 system interfaced with the ECU to allow for acquisition of engine
torque and speed, and to control the radiator fan and cabin blower. Finally, the
vehicle was installed on a chassis dynamometer, allowing for the characterization
of the system at steady state conditions or during driving cycles.

The vehicle air conditioning system model follows the plant layout and includes
four primary components, namely evaporator, compressor, condenser, and expan-
sion valve. A causality diagram of the complete model is shown in Fig. 5.2, and
illustrates how the physical variables, such as enthalpy, mass ﬂow rate, and pressure,
are exchanged by the four components. In general, the heat exchangers set the
pressures of the system, while the compressor and expansion valve determine the
mass ﬂow rates at the evaporator and condenser. The model structure and equations
for each component will be described in detail sequentially.

The compressor and expansion valve are generally modeled as static components,
in consideration that their transient response is typically much faster than the heat
exchangers. The compressor model is based on [23], where the outputs are com-
puted starting from the characteristic maps provided by the manufacturer. The mass
ﬂow rate Pmc and outlet enthalpy h2 of the compressor are deﬁned, respectively, as:

Pmc D (cid:8)vVd(cid:3)1!c;

h2 D

h2s (cid:3) h1
(cid:8)s

C h1

(5.1)

where Vd is the compressor displacement, (cid:3)1; h1 the refrigerant density and enthalpy
at the compressor inlet, !c the compressor speed, and h2s (cid:3) h1 is the isentropic
enthalpy difference. The volumetric efﬁciency (cid:8)v and isentropic efﬁciency (cid:8)s of
the compressor are modeled as algebraic nonlinear functions of the pressure ratio
PR D p2=p1 and the dimensionless Mach index Z, which accounts for the effects
of the compressor speed [23, 24]. Figure 5.3 shows the predicted volumetric and
isentropic efﬁciency predicted by the model, overlapped by the manufacturer data.

5 Output Feedback Control of Automotive Air Conditioning System: : :

77

a

v

η

1

0.8

0.6

0.4

0.2

0
0

b

s

η

0.6

0

1

0.8

0.4

0.2
0

0.05

0.1

Z

0.15

0.2

0.25

10

0.05

0.1

Z

0.15

0.2

0.25

10

2

4

Pr

6

8

2

4

6

Pr

8

Fig. 5.3 Performance maps of the A/C compressor. (a) Volumetric efﬁciency, (b) Isentropic
efﬁciency

The thermostatic expansion valve (TEV) is modeled by the oriﬁce equation for

incompressible ﬂuids:

p

Pmv D Cd;vAv

2(cid:3)3 .p3 (cid:3) p4/

(5.2)

where Av is the valve curtain area and Cv is the discharge coefﬁcient. The outlet
enthalpy is obtained by assuming an ideal throttling process, hence h4 D h3.

The dynamics of heat exchangers where the ﬂuid undergoes phase changes have
been generally modeled in the MBM framework [8, 12, 25], where the refrigerant
inside the heat exchanger is lumped according to its phase (liquid, superheated
vapor, or two-phase), and the boundary position between two adjacent lumping
regions is dynamically moving. In short, MBM is used to derive a control-oriented
model, whose differential equations are detailed in [26] and not given here for
brevity.

5.3 Model Calibration and Validation

The evaporator and condenser models are physically based, hence they require
speciﬁcation of the main geometric parameters, thermodynamic properties of the
working ﬂuids (R134a and air), and heat transfer coefﬁcients. The geometric
parameters were obtained from drawings provided by the heat exchangers manu-
facturers, while the refrigerant properties were imported into the models from the
thermodynamic tables (available with commercial software, such as REFPROP).
During the calibration phase of the model, speciﬁc correlations for single- and
two-phase ﬂow in microchannels have been adopted from literature to determine
the heat transfer coefﬁcients for the refrigerant. In the single phase regions, the
heat transfer correlation includes two parts [27]. For evaporation, the correlation

78

Q. Zhang and M. Canova

proposed in [28] combines the nucleating boiling and convective boiling effects,
˛tp D S˛nb C F˛sp. For condensation, the correlation given by Koyama et al.
[29] combines the inﬂuences of the forced convection NuF and gravity controlled
/1=2. On the
convection NuB using an asymptotic expression Nu D .Nu2
external air side, speciﬁc heat transfer coefﬁcients are deﬁned for compact heat
exchangers with louvers and ﬁns, as noted by Chang and Wang [30] and Kim and
Bullard [31].

F C Nu2

B

In order to compensate for modeling errors and uncertainties in the heat
transfer coefﬁcients correlations, a calibration was conducted on the complete A/C
system model, leveraging upon the available experimental setup. Speciﬁcally, the
calibration was limited to applying multipliers correcting the values of the heat
transfer coefﬁcients predicted by the empirical correlations found in literature.

Experimental data were collected on the test vehicle located in a thermally
controlled chassis dynamometer room, so that the air ﬂow rate and temperature at
the evaporator and condenser could be controlled to constant and known values. For
each tested condition, the vehicle was operated at constant speed (corresponding
to engine speed of 700 rpm (idle), 1500, and 2500 rpm), and the air conditioning
system was activated, letting the A/C system control operating the compressor
clutch. The model was calibrated using the data collected during the test at
1500 rpm, and veriﬁed for the other two conditions. The model parameters (heat
transfer multipliers) were calibrated by minimizing a cost function that accounts
for the RMS error between the measured condenser and evaporator pressure,
and the model prediction. Note that the calibration was focused on matching
the model response when the A/C system is fully active, thereby neglecting the
startup and shutdown phase. Figure 5.4 compares the pressures at the two heat
exchangers and the evaporator exit temperature predicted by the model with the
corresponding experimental data for the test conducted at 700 rpm (idle speed). As
shown in Fig. 5.4a, b, the model appears to accurately predict the system behavior,
in particular capturing the dynamics induced on the condenser and evaporator
pressures by the compressor clutch cycling operations. The simulations for 1500
and 2500 rpm are not shown here for brevity.

A further veriﬁcation of the A/C system model is conducted with reference to
the SC03 air conditioning cycle, which is a test conducted under highly dynamic
conditions. The vehicle speed trace for this regulatory driving cycle is shown in
Fig. 5.5a. The cycle represents a 3:6 miles route during which the A/C system
is active. Figure 5.5 compares the outputs of the model with the corresponding
experimental data. During the SC03 test, the compressor speed (related to the engine
speed) changes considerably, causing signiﬁcant variations in the refrigerant ﬂow
rate that affect the pressure dynamics in the heat exchangers. This is particularly
evident by observing the ﬂuctuations of the condenser pressure, as shown in
Fig. 5.5b. The model captures the dynamics induced by the compressor speed and
the on–off cycling of the clutch.

Finally, Table 5.1 summarizes the RMS error for all the calibration and validation
cases considered. Note that the average pressure in the heat exchangers is set
to different values based on the engine speed. The condenser pressure error is

5 Output Feedback Control of Automotive Air Conditioning System: : :

79

a

1100

1000

900

800

700

600

500

]

a
P
k
[
 

e
r
u
s
s
e
r
P

b

600

500

400

300

200

]
a
P
k
[
 
e
r
u
s
s
e
r
P

c

100

100

40

30

20

10

0
100

100

200

300

400

500

600

Time [s]

200

300

400

500

600

Time [s]

MBM
Data

MBM
Data

MBM
Data

200

300

400

500

600

Time [s]

Fig. 5.4 Comparison of experimental data and model prediction (N D 700 rpm). (a) Condenser
pressure, (b) Evaporator pressure, (c) Evaporator exit temperature

within 6 % of its average value, and the evaporator pressure error is around 8 %.
Their relative accuracy can be improved by adding weighting factors into the RMS
deﬁnition. Nevertheless, the model appears quite accurate in capturing the pressure
dynamics at the condenser and evaporator, which are essential for predicting the
compressor power consumption.

80

Q. Zhang and M. Canova

a

]
h
p
m

[
 
d
e
e
p
S
 
e
c
h
e
V

l

i

60

50

40

30

20

10

0

0

b

]
a
P
k
[
 
e
r
u
s
s
e
r
P

1600

1400

1200

1000

800

600

0

c

]
a
P
k
[
 
e
r
u
s
s
e
r
P

700

600

500

400

300

200

100

d

]

C

[
 

e
r
u

t

a
r
e
p
m
e
T

40

30

20

10

0

0

100

200

300

400

500

600

Time [s]

100

200

300

400

500

600

Time [s]

MBM
Data

MBM
Data

MBM
Data

0

100

200

300

400

500

600

Time [s]

100

200

300

400

500

600

Time [s]

Fig. 5.5 Veriﬁcation of MBM model for the SC03 driving cycle. (a) Vehicle speed proﬁle,
(b) Condenser pressure, (c) Evaporator pressure, (d) Evaporator exit temperature

5 Output Feedback Control of Automotive Air Conditioning System: : :

81

Table 5.1 Pressure errors
between measurement and
prediction (in kPa)

Engine speed
700 rpm
1500 rpm
2000 rpm
SC 03 Cycle

MBM model
Condenser pressure
44.1 (7.3 %)
50.6 (8.4 %)
56.4 (8.4 %)
63.5 (10.6 %)

Evaporator pressure
32.6 (5.5 %)
29.6 (4.9 %)
30.6 (5.1 %)
38.6 (6.4 %)

5.4 Control Design Overview

Before delving into the design process, it is beneﬁcial to justify the choice of the
synthesis technique, namely H1 synthesis.

5.4.1 Control Objective

The control problem is a multi-objective optimization problem. Physically, it
requires a vapor compression cycle not only to provide a cooling capacity for
regulating the cabin temperature, but also to ensure a desirable energy conversion
efﬁciency. The controller designed for a chiller system in [16] was used as a baseline
controller, where a multi-objective optimization problem was formulated using a
weighted sum of quadratic partial criteria, namely deviations from the desired
refrigerating capacity, the reciprocal of coefﬁcient of performance (COP), and a
smooth command proﬁle. Meanwhile, the superheat temperature is independently
dealt by a PID controller actuating the valve. The water ﬂow rate at the evaporator
is treated as a disturbance during chiller partial optimization.

In the aforementioned formulation, although MPC, as an advanced control
technique, was adopted to solve the online optimization problem, it still belongs to
rudimental single-input-single output (SISO) control technique, because the super-
heat temperature is regulated only by the expansion valve opening, independent
of compressor speed. The strong coupling in the system, as quantiﬁed in [32]
using relative gain array (RGA), needs the application of advanced MIMO control
techniques.

There, a variety of forthcoming control designs in the areas related to vapor
compression cycles formulate the optimization problem as an optimal LQR design
[18], by casting the objective function into

Z

1

(cid:10)

J D

0

yT .t/ (cid:2) Q (cid:2) y.t/ C uT.t/ (cid:2) R (cid:2) u.t/

dt

(5.3)

(cid:11)

where the weighting matrices Q and R are constant real and symmetric. Q is
assumed to be positive semi-deﬁnite and R as positive deﬁnite. y include all the
outputs and u all the inputs. Hence, the outcome of solving the above formulation

82

Q. Zhang and M. Canova

Fig. 5.6 Plant and controller
in H2 and H1 synthesis

using Riccati equations is a MIMO controller. Some variants are noticed between the
LQR controller and the baseline controller: (1) the requirement of cooling capacity
is converted into the deviation from the desired evaporator pressure, because in
majority of the time, the refrigerant circuit, instead of the cabin module, is of inter-
est; (2) the COP constraint is equivalent to the threshold of superheat temperature,
because a monotonic relationship between COP and superheat temperature exists
according to an analysis in [5, 6].

A stochastic implementation of LQR in noisy condition is known as a LQG
regulator, and the latter technique, in robust control theory, is equivalent to an H2
optimization problem. The H2 control problem is to ﬁnd a proper, real rational
controller K that stabilizes plant P internally and the minimizes the H2 norm of
the transfer function Tde between the disturbance d and the controlled output e, as
shown in Fig. 5.6. According to a counterexample from [33], there are no guaranteed
stability margins for an H2 controller. However, signiﬁcant external disturbances
exist on the air sides of heat exchangers of an automotive A/C system, which might
cause unstable closed-loop performance if a LQG controller, or an H2 controller, is
implemented. For example, the condenser in the A/C loop is installed in parallel to
the radiator in the engine cooling system in order to share a radiator fan mounted
in the right front of a vehicle, which is electrically driven mainly for the purpose
of regulating a desirable engine temperature. Although it is a controllable input to
the engine cooling system, the radiator fan is an uncontrollable external disturbance
entering the A/C system through the condenser. Moreover, the evaporator blower
is controlled either manually by a driver or automatically by an intelligent cabin
control module, both of which are dependent on the air temperature dynamics in the
cabin but independent on the refrigerant dynamics. Therefore, a robust control with
guaranteed stability margin, such as an H1 controller, is indispensable to a local
controller speciﬁcally developed for the A/C loop.

5 Output Feedback Control of Automotive Air Conditioning System: : :

83

5.4.2 H1 Synthesis Background

Using the same interconnection in Fig. 5.6, the H1 synthesis is to ﬁnd a controller
K such that the closed-loop system is asymptotically stable and the H1 norm of
the transfer function between the disturbance ! and controlled output z, kT!zk1, is
as small as possible [34]. Note that H1 norm is used instead of H2 norm; besides,
output feedback is considered instead of state feedback on the form u D Kx.

The H1 synthesis framework is compatible with the multi-objective optimization
problem proposed in [16, 17], as it enables the controller output z to incorporate all
the partial criteria listed. For instance, the deviation from desirable cooling capacity,
or deviation from desirable evaporator pressure, can be expressed a pressure error
term and treated as an element of z vector. Similarly, the efﬁciency constrain, or the
superheat temperature limit, can be expressed as a term characterizing the deviation
from superheat set-point and stored into another element. The framework also grants
the ﬂexibility of adding the energy consumption of the compressor, or the amplitude
of the control input, into the z vector. The inﬂuence of external disturbances on the
air side of the heat exchangers can be tailored into the ! vector to ﬁt the framework.
Therefore, the H1 synthesis framework is capable of describing the multi-objective
optimization problem as well as LQG/H2 techniques.

The solution for system matrices of the H1 controller resorts to the help of
the Bounded Real Lemma, which states: T is internally asymptotically stable and
satisﬁes kT!zk1 < (cid:9) is and only if the largest singular value of D is less than (cid:9) ,
and there exists a positive deﬁnite matrix X D XT such that either the condition in
Riccati equation or the one in linear matrix inequality (LMI) is satisﬁed

1. Riccati equation condition

XA C AT X C XBclR(cid:3)1BT

clX C CT
cl

.I C DclR(cid:3)1DT
cl

/ D 0

(5.4)

2. LMI condition

2

4

XAcl C AclX XBcl CT
cl
(cid:3)(cid:9) I DT
cl
Dcl (cid:3)(cid:9) I

BT
clX
Ccl

3

5 < 0

(5.5)

where Acl; Bcl; Ccl; Dcl are system matrices of the closed-loop system, A D .Acl C
BclR(cid:3)1DT

clCcl/, and R D (cid:9) 2I (cid:3) DT

The controller system matrices .Ac; Bc; Cc; Dc/ are embedded in the closed-
loop system matrices. In the full-order controller case, it is possible to extract the
controller system matrices explicitly by splitting the conditions into two Riccati
equations and LMIs, respectively.

clDcl.

84

Q. Zhang and M. Canova

5.5 Design Process

In the A/C system, the robust H1 controller shown in Fig. 5.7 is designed to track
prescribed trajectories of two output variables, namely the pressure difference (cid:12)p
between the condenser and the evaporator, and the superheat temperature SH at the
evaporator. The reference values for the tracked variables are indicated with (cid:12)pr and
SHr, respectively. At the same time, the controller should reject disturbances caused
by air mass ﬂow rate at the condenser, Pmca, and the evaporator, Pmea. Because there
are no sensors mounted on vehicles for the two variables, the two disturbances are
not measurable. They typically vary considerably in operation, due to the presence
of fans and blowers, and the relative wind speed when the vehicle is in motion. In
addition, noise n1 and n2 is present in the measured signals of measured superheat
temperature SH and pressure difference (cid:12)p.

5.5.1 Full-Order H1 Controller Design

The controlled output vector z and the disturbance vector ! in the A/C loop are
clariﬁed as follows.

The six elements in the output vector z to be minimized are selected as

(cid:10)

e(cid:12)p eSH Ncmp ˛ (cid:12)p SH

(cid:11)T

(5.6)

, and the reasons of choosing each variable are given below:

Fig. 5.7 Typical A/C conﬁguration

5 Output Feedback Control of Automotive Air Conditioning System: : :

85

(cid:129)

(cid:129)

(cid:129)

the errors e(cid:12)p D (cid:12)pr(cid:3)(cid:12)p and eSH D SHr (cid:3)SH on the output evaporator pressure
and superheat should be minimized to achieve good tracking performance;
the compressor rotation speed Ncmp and the valve opening ˛ should be varied as
little as possible, resulting in less deviation from the nominal operating point of
the A/C system and minimum control effort;
the ﬂuctuations in the pressure difference (cid:12)p and superheat temperature SH
during transients should be limited to ensure stability of the A/C system model.

Since the H1 controller design focuses on the frequency domain responses,
weighting functions are added for improving the closed-loop performance. In
particular, two weighting functions .We; Wy/ are used to shape the control input
and output:

(cid:129) Weighting for static performance of the closed-loop system, We,

(cid:129) Weighting for limiting the system bandwidth and tracking performance, Wy,

After adding the weighting functions,

the closed-loop output vector z is

deﬁned as:

We D

Ke
s C (cid:17)

Wy D

Kys
(cid:17)s C !y

z1 D We1e1 D

.(cid:12)pr (cid:3) (cid:12)p/

z2 D We2e2 D

.(cid:18)e1;r (cid:3) (cid:18)e1/

Ke1
s C (cid:17)e1
Ke2
s C (cid:17)e2
z3 D Wu1u1 D Ncmp
z4 D Wu2u2 D ˛

z5 D Wy1y1 D

z6 D Wy2y2 D

Ky1s
(cid:17)y1s C !y1
Ky2s
(cid:17)y2s C !y2

(cid:12)p

(cid:18)e1

(5.7)

(5.8)

(5.9)

(5.10)

(5.11)

(5.12)

(5.13)

(5.14)

where the parameters of the weighting functions are selected as Ke1 D 200; Ke2 D
100; (cid:17)e1 D 400; (cid:17)e2 D 800; Ky1 D Ky2 D 1; (cid:17)y1 D (cid:17)y2 D 0:1; !y1 D !y2 D 1 [33].

The reference pressure difference (cid:12)pr and superheat temperature SHr are time-
varying and regarded as additional disturbances besides the unknown disturbances
Pmca and Pmea, as well as the noises. Therefore, the disturbance vector is deﬁned as:

! D Œ(cid:12) Pmea; (cid:12) Pmca; (cid:12)pr; SHr; n1; n2(cid:11)

(5.15)

86

Q. Zhang and M. Canova

After deﬁning the output vector and disturbance vector, the augmented state

space equation of the A/C model is represented by:

8
ˆˆ<

ˆˆ:

Pxa.t/ D Aaxa.t/ C Ba;!!.t/ C Ba;uu.t/
z.t/ D Ca;zxa.t/ C 06(cid:6)6!.t/ C Da;zu.t/
y.t/ D Ca;yxa.t/ C Da;y!.t/ C 02(cid:6)2u.t/

(5.16)

where the input u, disturbance !, controlled output z, and measured output y have
already been deﬁned above, and the state vector of the augmented model now
includes the states of the MBM A/C model as well as parts of the output vector,
or xa D

x z1 z2 z5 z6

(cid:11)T

(cid:10)

.

The rank conditions are satisﬁed by choosing appropriate structure of the
disturbance and output vector [33]. The controller Kyu is derived by solving Riccati
equations associated with the augmented system matrices according to methods
provided in [35].

5.5.2 Model and Controller Order Reduction

The dynamics A/C system possess different time scales due to the difference
response time of mass transport and heat transfer. For instance, two different time
scales exist in the heat exchanger models for the tube wall and the refrigerant,
because of the different orders of heat transfer coefﬁcients at the air side and
refrigerant side [13, 17]. Hence, it is desirable to exploit the possibility of order
reduction. The underlying principle is the singular perturbation theory, which
substituting fast dynamics by its equivalence. However, the descriptor form of
A/C model cannot be used directly for singular perturbation method as it is not
in standard form. Instead, the A/C model is transformed into a speciﬁc form, on
which the theory also works as proved in [36, 37]. Speciﬁcally, if the time-factor
exists on the right-hand side of the system dynamical equations as follows:

the above can be converted into the stand singular perturbed form

(cid:12)

Px D f .x/ C g.x/u C 1
y D h.xs; xf /

(cid:17) b.x/k.x0

8
<

:

Pxs D gs.xs; xf ; u; (cid:17)/
(cid:17)Pxf D gf .xs; xf ; u; (cid:17)/

y D h.xs; xf /

(5.17)

(5.18)

through an (cid:17) independent nonlinear coordinate change T.x/, if and only if
1. Lbk.x/ is nonsingular.
2. the distribution b.x/ D spanb1.x/; : : : ; bp.x/ is involutive.

5 Output Feedback Control of Automotive Air Conditioning System: : :

87

The coordinate change T(x) is a nonlinear transformation
(cid:6)

(cid:7)

(cid:7)

(cid:6)

xs
xf

D T.x/ D

(cid:5).x/
k.x/

(5.19)

where (cid:5).x/ is found to meet Lb.x/(cid:5).x/ = 0.

The above theory was applied to the model order reduction of the evaporator
model in [19] by choosing the scaling factor as the reciprocal of the heat transfer
coefﬁcient of the refrigeration side of the two-phase region, k.x/ as the temperature
difference between the refrigerant and the wall at the two-phase region, as well as
b.x/ the terms left in the term of heat transfer rate.

1
(cid:17) D ˛i1
b.x/ D (cid:10)DoLe1
k.x/ D Tw1 (cid:3) Tr1

(5.20)

The transformation described by (cid:5).x/ is a function of Z.x/ matrix as solved in [19].
Based on the above choice of state transformation, two necessary conditions are
satisﬁed. In the standard form, the fast dynamics is represented by the temperature
difference. To this extent, it is found the two temperatures, namely wall temperature
Tw1 and refrigerant temperature Tr1 at two-phase region, are close to each other. The
above analysis arises from the fact that the heat transfer coefﬁcient of refrigerant in
the two-phase region is signiﬁcantly larger than for the other regions (superheated
and subcooled).

5.5.3 Simulation Results

The H1 control design presented above was applied to the nonlinear MBM and
veriﬁed in simulation at different operating conditions. The results and analysis
address the ability of the controller to minimize the tracking errors, z1 and
z2, in presence of time-varying reference signals (cid:12)pr and SHr, while rejecting
disturbances in the air velocities Pmca and Pmea

In particular, two scenarios are considered. Firstly, the reference pressure is
varied by imposing step changes, while the reference superheat temperature is
maintained constant as shown in Fig. 5.8. The simulation results show that the H1
controller is effective in matching the evaporator pressure to the reference value. The
actual pressure and superheat temperature both achieve the target set-points after
the initial transient. In Fig. 5.8, the steady state errors between the reference output
and actual output are very small and the transition time is less than 50 s. During the
transient, the superheat temperature is always higher than 10 C, hence the evaporator

88

Q. Zhang and M. Canova

reference
Full−order
Reduced−order

50

100

150

200

300

350

400

450

500

250
Time [sec]

256

254

252

]
a
P
k
[
 
e
r
u
s
s
e
r
P

250

0

22

21

20

]

C

[
 
e
r
u
t
a
r
e
p
m
e
T

19

0

50

100

150

200

300

350

400

450

500

250
Time [sec]

Fig. 5.8 System outputs during pressure tracking

outlet temperature is in vapor phase all the time. Besides, the compressor rotation
speed Nc and valve opening percentage ˛ are within the range of 20 % deviations.
Secondly, a disturbance rejection test is conducted to evaluate the ability of
the H1 control to mitigate the effects of changes in the evaporator air velocity.
The disturbance shown is added before and after the step change of the reference
pressure signal. When the disturbance signal is added into the case of evaporator
pressure tracking (Fig. 5.8), the simulation results of the reference outputs are shown
in Fig. 5.9. As expected, the ripples caused by the disturbance are compensated by
actuator modulations.

In both Figs. 5.8 and 5.9, the full-order controller and the reduced-order con-
troller achieve the objectives of output tracking and disturbance rejection. Besides
mathematical complexity, the main difference between the two controllers occurs
during transient. Speciﬁcally, the inﬂuence of the fast dynamics in the closed-
loop system with the reduced-order controller is not as signiﬁcant as the one
with the full-order controller. This conclusion is also supported by a frequency
analysis of closed-loop system responses, namely from the reference pressure Per
and the reference superheat temperature SHr to the actual pressure Pe and the actual
superheat temperature SH. In Fig. 5.10, both controllers achieve the same steady
state performance from the fact that the static gain from the reference signal to the
corresponding actual variable is one, and the cross static gain is negligible. The main
difference exists at high frequency region, meaning that discrepancy occurs between
the performances of two controllers during transient in time domain.

5 Output Feedback Control of Automotive Air Conditioning System: : :

89

reference
Full−order
Reduced−order

50

100

150

200

250

300

350

400

450

500

Time [sec]

Disturbance Added
at T = 100 sec

Disturbance Added
at T = 300 sec

50

100

150

200

250

300

350

400

450

500

Time [sec]

Fig. 5.9 System outputs during disturbance rejection

Bode Diagram

From: Per

From: SHr

256

254

252

250

248

]
a
P
k
[
 
e
r
u
s
s
e
r
P

246

0

]

C

[
 
e
r
u
t
a
r
e
p
m
e
T

23

22

21

20

19

18

0

50

e
P

 
:
o
T

0

)

B
d
(
 
e
d
u

t
i

n
g
a
M

H
S

 
:

o
T

−50

60

40

20

0

−20

−40

Full Order
Reduced Order

−2

10

0
10

−2

10

0
10

Frequency  (rad/s)

Fig. 5.10 Performance comparison of the full-order and reduced-order closed-loop systems

90

Q. Zhang and M. Canova

Bode Diagram

From: Pe

From: SH

50

0

c
N

 
:
o
T

)

B
d
(
 
e
d
u
t
i
n
g
a
M

−50

−100

50

α

:
o
T

0

−50

−100

low
med
high

−2

10

0
10

−2

10

0
10

Frequency  (rad/s)

Fig. 5.11 Controller variation due to different cooling loads

Although the above design H1 controller is proved to realize the objective of
output tracking and disturbance rejection locally, it is difﬁcult to expand the feasible
working region of a single H1 controller globally. In fact, in order to achieve the
same level of closed-loop performances, the H1 controllers designed at different
cooling loads have signiﬁcant dynamics variations. Three scenarios corresponding
to low, medium, and high cooling loads are considered, and the open-loop responses
of the resulted H1 controllers are plotted in Fig. 5.11. Clearly, the gains at low
frequency region change at different cooling loads, indicating the demand of a gain-
scheduled H1 controller.

In this work, a simple interpolation approach is adopted to adaptively change
the H1 controller at different working point. The simple gain-scheduled H1
controller is also validated using the above two scenarios, namely output tracking
without/with external disturbances. Figure 5.12 shows a global output tracking over
the entire working region. The reference evaporator pressure, starting from medium
cooling load, switches to low cooling load ﬁrst and back to high cooling load
ﬁnally. Due to the fast responses of the controller over evaporator pressure, the
actual evaporator pressure almost overlaps the reference values. On the other hand,
the actual superheat temperature shows noticeable transitions as the cooling load
changes, and its maximum deviation is always within the safety threshold.

5 Output Feedback Control of Automotive Air Conditioning System: : :

91

500
time [sec]

1000

0

0

500
time [sec]

1000

500
time [sec]

1000

30

0

500
time [sec]

1000

Fig. 5.12 System inputs and outputs during global tracking without disturbance

500
time [sec]

1000

0

0

500
time [sec]

1000

40

30

20

10

50

45

40

35

40

30

20

10

60

50

40

]

C

[
 
t
a
e
h
r
e
p
u
s

]

%

[
 
n
o
i
t
i
s
o
p
 
e
v
a
v

l

]

C

[
 
t
a
e
h
r
e
p
u
s

]

%

[
 
n
o
i
t
i
s
o
p
 
e
v
a
v

l

300

250

200

]
a
P
k
[
 
e
r
u
s
s
e
r
p

150

0

3000

2000

1000

0

0

]

m
p
r
[
 
d
e
e
p
s
 
r
o
s
s
e
r
p
m
o
c

300

250

200

]
a
P
k
[
 
e
r
u
s
s
e
r
p

150

0

3000

2000

1000

0

0

]

m
p
r
[
 
d
e
e
p
s
 
r
o
s
s
e
r
p
m
o
c

500
time [sec]

1000

30

0

500
time [sec]

1000

Fig. 5.13 System inputs and outputs during global tracking with disturbance added

In order to demonstrate the robustness of the designed controller over external
disturbance. The variation of the air mass ﬂow rate at the evaporator exterior surface
is modeled as a pulse with period 100 s and width 50 s. Figure 5.13 shows the
tracking performance over the same reference signals after disturbances are added
into the nonlinear A/C model. As expected, the controller designed is proved to
maintain its capability of tracking the evaporator pressure very well. Due to the
existence of external disturbance, the variation of the actual superheat temperature

92

Q. Zhang and M. Canova

becomes more frequently than before, but still within the safety threshold. There-
fore, it is demonstrated that tracking and robustness are both achieved over the entire
working region.

Appendix

LTI A/C Model

The MBM A/C is linearized at multiple working points with different cooling loads
on the A/C system. The linear system matrices, as proved in [4], are related to
matrices in the original descriptor system by:
A WD Z.xo/(cid:3)1 @f
@x
B WD Z.xo/(cid:3)1 @f
@u

ˇ
ˇ
ˇ
ˇ
xo;uo
ˇ
ˇ
ˇ
ˇ

(5.21)

xo;uo

The LTI plant at design point is given by

0

B
B
B
B
B
@

A D

0

195

1:821 (cid:3)2:226

(cid:3)28:12
0:1828 (cid:3)1:364
0:0025
(cid:3)1:823 0:04938 20:83 (cid:3)25:45 (cid:3)56:36
0:2378 (cid:3)1:864 0:02361 (cid:3)0:02886 (cid:3)0:1698

(cid:3)0:0733 0:02245

6:144
0
0

0

0

1

C
C
C
C
C
A

0

B
B
B
B
B
@

(cid:3)0:2037 134:7

0
0

0
0

(cid:3)0:221 53:26
(cid:3)0:00264 10:88

B D

1

C
C
C
C
C
A

0
0:2767
0:1106
0
0

(cid:9)

(cid:8)

C D

1

0
0 0
(cid:3)0:1121 0 0 1:144 0

0

(5.22)

Full-Order and Reduced-Order Controller

The resulted full-order H1 controller is given as follows:

5 Output Feedback Control of Automotive Air Conditioning System: : :

4:427e5 1:701e5

2549
0:1743 (cid:3)1:364

0
(cid:3)0:07325
0
1:74e5
6:688e4
3:583e4 1:377e4

0
0

7:008e6 2:692e6
5:187e6
1:35e7
0
0

2:548e (cid:3) 3
1011
208:9
0
0
4:083e4
7:86e4
(cid:3)0:02367

0
0

0
0

0
0

0
0

(cid:3)2:201e4 (cid:3)2186

(cid:3)5:583e4 (cid:3)5561 (cid:3)1:013e4 (cid:3)48:84 (cid:3)2909

0
0
(cid:3)3982 (cid:3)20:56 (cid:3)1150
(cid:3)4521 (cid:3)450:2 (cid:3)820:2 (cid:3)3:821 (cid:3)234:9
0
(cid:3)0:001

485:1
(cid:3)4:037e (cid:3) 4
0:01155
166:1
39:45
0
0
7718
(cid:3)8:832e5 (cid:3)8:806e4 (cid:3)1:604e5 (cid:3)842:8 (cid:3)812:1 1:769e6
1:486e4 (cid:3)1:703e6 (cid:3)1:696e5 (cid:3)3:089e5 (cid:3)1430 (cid:3)9:843e4 3:406e6
(cid:3)0:25

1:117e5
0:05534
0:02213
4:391e4
9044
0
0

(cid:3)0:01
0

(cid:3)4:199e (cid:3) 3

0
0

0
0

0
0

0

0

0

0

0

AK D

BK D

0

B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
@

0

B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
B
@

 

0
0

1

C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
A

0:01531

(cid:3)0:4261
(cid:3)0:06253 (cid:3)0:002588
(cid:3)0:007535 (cid:3)0:06985
(cid:3)0:02836 (cid:3)0:02514
0:08724
0:02427
0
7:324
7:324
0
0
0
0
0

(cid:3)0:1765 (cid:3)0:02692

CK D

5:444 934:3 359
2:62 449:9 172:9 0:4955 (cid:3)56:76 (cid:3)5:653 (cid:3)10:3 (cid:3)0:04765 (cid:3)2:946 113:5

1:029 (cid:3)117:8 (cid:3)11:74 (cid:3)21:38

1:221

!

The resulted reduced-order H1 controller is given as follows:
1

0

@

AR D

(cid:3)0:001084 0:0009316 (cid:3)7:376e (cid:3) 5
0:001646 (cid:3)0:01216 (cid:3)0:06382
0:006088 (cid:3)0:01624 (cid:3)0:4687

A

0

@

BR D

1

A

5:804 58:52
(cid:3)56:15 5:281
(cid:3)3:346 0:1396

(cid:8)

CR D

(cid:3)0:1279

0:09375

1:537

(cid:3)4:558e (cid:3) 5 3:618e (cid:3) 5 0:000733

(cid:9)

(cid:8)

DR D

(cid:9)

0:1662
0:00039 (cid:3)0:007264

(cid:3)2:14

93

1

C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
C
A

(5.23)

(5.24)
Abstract In order to improve the performances of air conditioning systems, it is
desirable to track time-varying trajectories generated by optimization algorithms,
which H1 synthesis techniques have been proved to successfully solve. However,
the control-oriented models of vapor compressor cycles used for algorithm develop-
ment, even if built from ﬁrst-principles, suffer from model uncertainties introduced
by modeling assumptions, calibration inaccuracies, and linearization errors. The
differences between the actual plant and the control-oriented model, mainly in
the form of unmodeled dynamics and parameter uncertainty, undermine the stable
margin as well as the performance of the closed-loop system with H1 controllers.
In order to solve the problem, the concept of the structured singular value (cid:6) is
used to analyze the inﬂuences of model uncertainties on robust stability and robust
performance. Based on (cid:6) analysis results, (cid:6) synthesis techniques, compared to H1
methods, achieve better stability and performance margins over the same set of
uncertainties. Furthermore, simulation results show that the (cid:6) controller achieves
better performances of output tracking and disturbance rejection than the H1
controller for the automotive air conditioning system studied.

Keywords (cid:6) Synthesis (cid:129) Robust control (cid:129) Automotive (cid:129) Air conditioning system

Nomenclature

Air
Condenser

a
c
cmp Compressor
e
Evaporator
g
Gas
h
Enthalp
In automotive air conditioning (A/C) system, the industry usually uses PID con-
trollers to maintain system performance, requiring signiﬁcant calibration efforts on
gain tuning. In contrast, model-based control methods might be applied in order
to explore the opportunity for system optimization through coordinated control of
available actuators. Generally, the application of control theory to the A/C system
involves the formulation of a tracking control problem for the evaporator pressure
and the superheat temperature [1]. To enable the use of the model-based control
method, a dynamic model of the A/C system with limited complexity is necessary
to accurately predict the pressure and the enthalpy change in the evaporator and
condenser. Speciﬁcally, the moving boundary method (MBM) is the most popular
technique to model the pressure dynamics in the heat exchangers in presence of
refrigerant phase change [2, 3].

In order to reduce the difﬁculty of performing control design when using
the aforementioned models in the form of high-order nonlinear differential and
algebraic equations (NDAEs), a general approach is to start from low-order, linear
models obtained through system identiﬁcation or model order reduction [4, 5]. For
instance, [6] presents a discrete-time state-space model for indirect adaptive control
that is recursively identiﬁed using a multi-input multi-output (MIMO) parameter
estimation algorithm. A linear quadratic regulator (LQR) was then implemented for
reference tracking and disturbance rejection. A local model network based on Youla
parameterization was developed in [1], and a Lyapunov-based method was used to
stabilize a tracking controller with respect to different local linear models. Similarly,
a low-order nonlinear evaporator model was developed for backstepping design of
a nonlinear adaptive controller [7]. Recently, advanced control methods have been

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

99

preliminarily applied to the output tracking problem of the automotive A/C system,
such as sliding mode control (SMC) [8] and H1 control [9].

Besides the requirement on tracking performance of evaporator pressure and
superheat temperature, another important aspect in control design for the A/C sys-
tem is the controller’s robustness to model uncertainties. Due to the simpliﬁcation
of the two-phase ﬂow occurring in the heat exchanger, modeling and calibration of
the MBM A/C model inevitably introduce uncertainties in the form of parameter
uncertainty (volume uncertainty and heat transfer coefﬁcient uncertainty), as well
as unmodeled dynamics (mean void fraction uncertainty and actuator uncertainty).
All the aforementioned model uncertainties are hardly touched in previous work.
For instance, the LQR/LQG controller in [6] performs perfect only when the linear
model matches the real plant after the fast convergence of the parameter estimation
algorithm. The MIMO approach in [1] is proved to robust stable to certain varying
rate of the schedule variables, excluding the inﬂuences of model uncertainties.

Mitigating the inﬂuences of parameter uncertainty and unmodeled dynamics on
tracking performance of the closed-loop A/C system is a problem typically solved
in the framework of robust control, such as H1 control in [10, 11] and (cid:6) synthesis
in [12–14]. In the automotive ﬁeld, robust control has been demonstrated for several
practical applications, in particular turbocharged diesel engines [15–17]. However,
it lacks a systematic study on the application of robust control theory to the control
design of the A/C system. In the HVAC ﬁeld, robust control has been demonstrated
for the air path of a building HVAC system [18], while the refrigerant dynamics in
the heat exchangers is not fully exploited. To this extent, it presents an application
of a (cid:6) analysis and synthesis to an automotive A/C system, with the objective of
tracking desired superheat temperature and evaporator pressure, as well as rejecting
disturbances due to unknown time-varying boundaries conditions at the air side of
the condenser and evaporator.

This chapter is organized as follows. Section 6.2 brieﬂy describes the MBM A/C
model and the H1 controller designed without uncertainties considered. Section 6.3
models a variety of uncertainties that might exist in A/C system, and evaluate
the performance of the closed-loop A/C system with the H1 controller when
uncertainties emerge. Then, a (cid:6) synthesis is performed in Sect. 6.4 to ﬁnd a
controller without severe performance deterioration under uncertainties.

6.2 A/C Model and H1 Control

In this section, the mathematical equations describing the dynamics of the auto-
motive A/C system are presented, whose calibration procedure and validation test
are available in [19]. Since the interest is in control algorithm development, the
input–output relationship and the thermodynamic states of the MBM A/C model are
focused in order to achieve a high-level representation. A benchmark controller is
designed following the framework of H1 synthesis, which requires an augmentation
of the control-oriented model with additional external disturbances and performance
criteria. The tedious mathematical solution for control design is available in [19] as
well.

100

Q. Zhang and M. Canova

Fig. 6.1 Layout of the A/C system

6.2.1 A/C System Modeling

The refrigerant loop of an automotive A/C system includes a ﬁxed-displacement
rotary piston compressor, a condenser with a fan, a receiver/drier, an evaporator with
a blower, and a thermal expansion valve. The interconnection of the four primary
components (evaporator, compressor, condenser, and expansion valve) is illustrated
in Fig. 6.1. The vapor compression cycle removes heat from the air ﬂowing into
the cabin through the evaporator, as the refrigerant evaporates from two-phase (TP)
status into superheated (SH) status, and rejects heat to the air ﬂowing through the
condenser, as the refrigerant condenses from superheated (SH) status into subcooled
(SC) status through two-phase (TP) status. In a well-established modeling frame-
work, the compressor and valve are modeled as static components. The dynamics
related to the heat and mass transfer inside the heat exchangers are described using
the MBM method [2, 3], where Reynolds transport theorem describing the mass
and energy conservation for transient one-dimensional ﬂow is applied to each phase
region of the condenser and evaporator with boundary conditions and refrigerant
properties speciﬁed in Fig. 6.1. The detailed derivations [19] are omitted here for
brevity and only the ﬁnal mathematical equations describing system dynamics are
summarized.

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

101

In compressor, the mass ﬂow rate

:
mc and outlet enthalpy h2 are deﬁned,

respectively, as:

:
mc D (cid:8)vVd(cid:3)1!c;

h2 D

h2s (cid:3) h1
(cid:8)s

C h1

(6.1)

where Vd is the compressor displacement, (cid:3)1, h1 the refrigerant density and enthalpy
at the compressor inlet, !c the compressor speed, and h2s (cid:3) h1 is the isentropic
enthalpy difference. The ﬁrst control input is the compressor rotation speed Nc in
the unit of rpm.

The mass ﬂow rate through the expansion valve is modeled by the oriﬁce ﬂow

equation, approximated by assuming constant ﬂuid density:

p

mv D Cd;vAv

2(cid:3)3 .pe (cid:3) pr/

(6.2)

where Av is the valve curtain area and Cv is the discharge coefﬁcient. The outlet
enthalpy is typically found by assuming an ideal throttling process, hence h4 D h3.
The second control input is the valve position ˛ in percentage, determining the
effective ﬂow area of the valve.

The mass and energy balance equations for the two-phase region and superheated
region of the evaporator are given directly in Eqs. (6.3a, 6.3b) and (6.4a, 6.4b),
respectively. In these differential equations, the left hands represent the variation
of independent states of the refrigerant, and the right hands the exchanges of mass
and energy at the inlet and outlet of individual phase region, as well as the heat
transfer along the wall of corresponding region. The terms multiplying the state
variations depend on the refrigerant inherent thermodynamic properties, hence are
state-dependent.
(cid:8)
(cid:3)e;TP (cid:3) (cid:3)g
(cid:3)e;TP

:
mv
(cid:3)e;TPVe

@(cid:3)e;TP
@pe

@(cid:3)e;TP
@(cid:9)

1
(cid:3)e;TP

1
(cid:3)e;TP

d(cid:9)
e
dt

d(cid:18)1
dt

dpe
dt

(cid:2) (cid:18)1 D

(cid:2) (cid:18)1C

C

(cid:3)

(cid:9)

e

(cid:2)

(cid:3)g.he;TP(cid:3)hg/
(cid:3)e;TP
:
mv
(cid:3)e;TPVe

D

d(cid:18)1
dt C

@he;TP
@pe

.h4 (cid:3) he;TP/ (cid:3)

(cid:3) 1
(cid:3)e;TP
:
m12
(cid:3)e;TPVe

dpe
dt

@he;TP
(cid:2) (cid:18)1 C
@(cid:9)
(cid:5)
e

hg (cid:3) he;TP

C

d(cid:9)
e
dt
:
QTP
(cid:3)e;TPV

(cid:2) (cid:18)1

(cid:3)

(cid:4)

(cid:2)

(cid:3)

(cid:3)

(cid:3)e;SH(cid:3)(cid:3)g
(cid:3)e;SH

d(cid:18)1
dt C 1
(cid:3)e;SHP

@(cid:3)e;SH
@pe

dpe
dt

(cid:2) .1 (cid:3) (cid:18)1/ C 1
(cid:3)e;SH
:
:
mc
m12
(cid:3)e;SHVe
(cid:3)e;SHVe

D

(cid:3)

@(cid:3)e;SH
@he;SH

dhe;SH
dt

(cid:2) .1 (cid:3) (cid:18)1/

(6.4a)

:
m12
(cid:3)e;TPVe
(6.3a)

(6.3b)

(cid:3)

(cid:3)g.hg(cid:3)he;SH/
(cid:3)e;SH
(cid:4)
:
m12
(cid:3)e;SHVe

d(cid:18)1
dt C 1
(cid:3)e;SH
(cid:5)
hg (cid:3) he;SH

D

dpe
dt
(cid:3)

(cid:2) .1 (cid:3) (cid:18)1/ (cid:3) dheSH
dt
:
mc
(cid:3)e;SHVe

.h1 (cid:3) he;SH/ C

(cid:2) .1 (cid:3) (cid:18)1/
:
QSH
(cid:3)e;SHVe

(6.4b)

102

Q. Zhang and M. Canova

The mass and energy balances for the subcooled, two-phase, and superheated
region of the condenser are similar to these of the evaporator. Besides, the wall
temperatures, which are not uniform along the tube, are modeled as ﬁrst order
systems. None of these differential equations are presented here for brevity. The
MBM A/C model after integrating all the component models is in the descriptor
form,

:
x D f .x; u; v/

Z.x/
y D g.x/

(6.5)

(cid:10)

(cid:11)T

Nc ˛

Because the A/C system performance is mainly related to the variables in the
evaporator model, the following discussion focuses on the evaporator model in
descriptor form. The inputs are the compressor rotation speed and expansion valve
. The boundary conditions are the variables describing
opening percentage,
the air side of the heat exchangers, and could be treated as unknown disturbances,
:
d D
mea. The state vector describing the evaporator status includes ﬁve states as:
(cid:10)
xe D
. Finally, the outputs are the pressures and superheat
. The Z matrix and f vector are complex expressions
temperature, y D
of refrigerant properties, heat transfer coefﬁcients, and geometric parameters. The
MBM A/C model has been calibrated and validated using experimental data in both
nominal steady state and drive cycle, according to the procedure outlined in [19].
The inputs and outputs of the MBM A/C model is illustrated in Fig. 6.2.

(cid:11)T
(cid:18)e1 pe he2 Te1w Te2w
(cid:11)T
pe SH

(cid:10)

The MBM A/C model is linearized at multiple working points with different
cooling loads on the A/C system, ranging from low to medium and to high. The
cooling load is regulated by changing the inlet air temperature of the evaporator.
For consistency, the superheat temperature is kept around 200 ıC by cooperation of
the compressor speed Nc and expansion valve position ˛; however, the evaporator
pressure Pe is allowed to vary according to the cooling load as a gain scheduling
parameter. Speciﬁcally, the boundary conditions, controlled inputs, and steady-state
refrigeration states are summarized in Table 6.1.

The system matrices of the linearized A/C model corresponding to the medium

cooling load are

Fig. 6.2 A/C system inputs and outputs

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

103

Table 6.1 A/C operating
points

:
Ta (ıC)
Qa
Low
25
Medium 30
40
High

Nc (rpm)
450
1000
2500

˛ (%)
25
40
55

Pe (kpa)
302.2
251.2
204.6

1:821 (cid:3)2:226

(cid:3)28:12
195
0:1828 (cid:3)1:364
0:0025
(cid:3) 1:823 0:04938
20:83 (cid:3)25:45 (cid:3)56:36
0:2378 (cid:3)1:864 0:02361 (cid:3)0:02886 (cid:3)0:1698

0
0 (cid:3)0:0733 0:02245

6:144
0
0

0

3

7
7
7
7
7
5

A D

B D

2

6
6
6
6
6
4

2

6
6
6
6
6
4

(cid:6)

3

7
7
7
7
7
5

(cid:3)0:2037 134:7

0

0
0

0 0:2767
0 0:1106

(cid:3) 0:221 53:26
(cid:3) 0:00264 10:88

0
0
(cid:7)

c D

1

0 0
0 0
(cid:3) 0:1121 0 0 1:144 0

(6.6)

(6.7)

which, as proved in [9], are related to matrices in the original descriptor system by:

A WD Z.x0/(cid:3)1 @f
@x

ˇ
ˇ
ˇ
ˇ

x0;u0

B WD Z.x0/(cid:3)1 @f
@u

ˇ
ˇ
ˇ
ˇ
x0;u0

6.2.2 H1 Synthesis

For the MIMO A/C model shown in Fig. 6.2, a widely investigated problem is
to track prescribed trajectories of two output variables, namely the evaporator
pressure pe and the superheat temperature SH. Meanwhile, the controller should
:
mea, which is
reject disturbances caused by air mass ﬂow rate at the evaporator,
not measurable and unknown on vehicles. Among a variety of control methods,
H1 control has been ﬁrstly proposed in [9] and proved to successfully realize the
control objectives. In robust control theory, H1 synthesis is to ﬁnd a controller K
for a plant model P such that the closed-loop system is asymptotically stable and
the H1 norm of the transfer function between the disturbance d and the controlled
output e, kTdek1, is as small as possible [10], as shown in Fig. 6.3.

In order to ﬁt the H1 synthesis framework, the performance criteria e and
unknown disturbances d in Fig. 6.3 should be clariﬁed for automotive A/C systems,
resulting in the entries of the augmented vectors listed sequentially in Fig. 6.4.
Mathematically, the six elements in the vector of weighted performance criterion
are selected as

104

Q. Zhang and M. Canova

Fig. 6.3 General H1 control
scheme

Fig. 6.4 A/C System H1 control scheme

(cid:10)

epe eSH Ncmp ˛ pe SH

(cid:11)T

(6.8)

where epe D pe; r (cid:3) pe and eSH D SHr (cid:3) SH are errors on the output evaporator
pressure and superheat temperature, Ncmp the compressor rotation speed and ˛ the
valve opening percentage, pe evaporator pressure and SH superheat temperature.
The weighting functions are selected following the suggestions in [20] and their
speciﬁc mathematical forms and parameters are given in [9].

The reference evaporator pressure pr and superheat temperature SHr are time-
varying and regarded as additional disturbances besides the unknown disturbances
:
mea, as well as the noises. Therefore, the disturbance vector is deﬁned as:

(cid:10)

(cid:12) :

mea pe;r SHr n1 n2

(cid:11)T

(6.9)

The original A/C model in state-space form is augmented with the output vector
and disturbance vector deﬁned, and an H1 controller is found by solving linear
matrix inequalities (LMIs) associated with the augmented system according to
methods provided in [11]. The above design procedure is detailed in previous work

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

105

in [19], where simulation results are provided to support the validity of the controller
during output tracking and disturbance rejection. The full-order H1 controller
has the same number of states as the augmented A/C model. After analyzing the
“energy” of individual state, the ﬁrst three states dominate the main dynamics in
the system. Hence, the ﬁnal H1 controller after model order reduction [19] is given
below:

2

4

2

4

(cid:6)

(cid:6)

AC1 D

BC1 D

CC1 D

DC1 D

(cid:3)0:001084 0:0000316 (cid:3)7:376 (cid:4) 10(cid:3)5
(cid:3)0:06382
0:001646 (cid:3)0:01216
(cid:3)0:4687
0:006088 (cid:3)0:01624

3

5

3

5

5:804 58:52
(cid:3) 56:15 5:281
(cid:3) 3:346 0:1396

(cid:3)0:1270

1:537
(cid:3) 4:558 (cid:4) 10(cid:3)5 3:618 (cid:4) 10(cid:3)5 0:0007333
(cid:7)

0:00375

(cid:7)

0:1662
(cid:3)2:14
0:00030 (cid:3)0:007264

(6.10)

6.3 Robust Analysis of H1 Controller

In automotive A/C system, the existence of parameter uncertainties and unmodeled
dynamics affect the closed-loop stability and performance. The synthesis process of
a controller over a plant with uncertainty is different from an H1 synthesis based on
a plant without uncertainty. When model uncertainties emerge, the robust stability
and robust performance of the closed-loop system with an H1 controller are not
satisﬁed. Hence, it is desirable to pursue an advanced control technique named (cid:6)
synthesis targeted for plants with uncertainties.

Ideally, an implementable algorithm is expected to ensure system stable as
well as maintain performance requirements when uncertainties are noticeable.
Mathematically, a controller K is supposed to achieve both stability and performance
under uncertainty (cid:12) for a plant P as shown in Fig. 6.5, where the plant P is an
open-loop interconnection that contains all of the known elements including the
nominal plant model in Fig. 6.2 and weighted performance criteria in Fig. 6.4.
Speciﬁcally, three types of inputs enter P: perturbation outputs z, disturbances d,
and control u. Three sets of outputs are generated: perturbation inputs !, errors e,
and measurements y. The (cid:12) block is the uncertain element parameterizing all the
assumed model uncertainty in the problem.

In this section, the focus is to illustrate the internal structure of the (cid:12) block
in Fig. 6.5. Those blocks representing parameter uncertainties and unmodeled
dynamics are inserted into the simulator of the MBM A/C model developed, over

106

Q. Zhang and M. Canova

Fig. 6.5 General (cid:6) synthesis
scheme

which the robust stability and robust performance of the H1 controller are veriﬁed
in both frequency domain and time domain.

6.3.1 Uncertainty Implementation

The model used for control design is inevitably different from the actual dynamics
of the plant due to practical factors categorized into unmodeled dynamics and
parameter uncertainty. For example, the sources of modeling uncertainty in a
vapor compression system might exist in compressor volumetric efﬁciency and
isentropic efﬁciency, valve discharge coefﬁcient, pipe pressure and heat losses, and
the total refrigerant charge in the A/C loop. However, a thorough study of the
above uncertainties is not practical, because a sequential identiﬁcation of individual
uncertainty is not an easy task, and the solution process is mathematically intractable
as the number of the uncertainties increases. For current investigation, the model
uncertainties that are closely related to the model type adopted (MBM A/C model)
are of interest, namely parameter uncertainties of the volume of the heat exchanger
and the heat transfer coefﬁcients, as well as unmodeled dynamics of mean void
fractions and compressor mass ﬂow rates, all of which are generated when some
fundamental assumptions are adopted to facilitate development of MBM A/C
model.

Before exploring the generation mechanism of considered model uncertainties,
an overview of their implementations in an MBM A/C model might be helpful.
Since the MBM A/C model is in descriptor form as discussed, its implementation in
Matlab/Simulink, at the highest level, is structured as in Fig. 6.6. The actuator inputs
u are converted into thermodynamic properties (mainly mass ﬂow rates) that are
fed into the right-hand sides of the differential equations of the MBM A/C model,
f (x, u, v). The system matrix Z(x) is built by looking up thermodynamic properties
(density and enthalpy) given current system state x. The integral of the ratio of the

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

107

Fig. 6.6 Implementation of parameter uncertainty and unmodeled dynamics in simulator

f vector over Z matrix generates the current state x, which is used to calculate
the output y algebraically. The two parameter uncertainties and two unmodeled
dynamics are implemented sequentially in corresponding locations of the simulator,
as labeled in the bottom four blocks in Fig. 6.6. For parameter uncertainty, an
uncertain unit scalar block ı with amplitude k is added in parallel to parameter
gain; for unmodeled dynamics, an uncertain unit system block (cid:12) with frequency
distribution W(s) is added in parallel to the main signal path. Because both the
parameter uncertainty and unmodeled dynamics are at the lowest level, those blocks
linked to them are omitted in Fig. 6.6 for brevity. However, all model uncertainties
change local dynamics that further affects global dynamics of the MBM A/C model.

Now, the generation mechanisms of the two parameter uncertainties and the two
unmodeled dynamics are explained sequentially by analyzing the main assumptions
adopted by the methodology of the MBM modeling approach.

A fundamental assumption at the beginning of the modeling process is to treat a
heat exchanger as a ﬁctitious long horizontal tube whose thermal mass, heat transfer
area, and mass ﬂux are equivalent to the actual component. This simpliﬁcation
neglects the axial conduction, thermal resistance, etc. [6]. Although the equivalent
tube length is calculated to guarantee the volumes before and after the assumption
are ﬁxed, the modeling assumption inevitably introduces discrepancy between the
estimated and “actual” equivalent length. The conclusion still holds for micro-
channel heat exchangers, where the equivalent long horizontal single pass tube is

108

Q. Zhang and M. Canova

assumed to have a reduced mass ﬂow rate by a factor of 1/n, where n is the number
of parallel-passes. Besides, relevant physical parameters, such as heat exchanger
mass and air-ﬂow cross-sectional area, are reduced by the same factor [3]. This
simpliﬁcation further neglects refrigerant maldistribution due to the parallel-passes
as well as the headers of the heat exchangers. In both scenarios, a parameter
uncertainty is added to the volume of the heat exchanger, L D z (cid:4) P C (cid:12)(L).

B

(cid:4)

(cid:5)1=2

Nu2

During the calibration phase of the model, speciﬁc correlations for single and
two-phase ﬂow in micro-channels have been adopted from literature to determine
the heat transfer coefﬁcients for the refrigerant. In the single phase regions, the
heat transfer correlation includes two parts [21]. For evaporation, the correlation
proposed in [22] combines the nucleating boiling and convective boiling effects,
˛tp D S˛nb C F˛sp. For condensation, the correlation given by [23] combines the
inﬂuences of the forced convection NuF and gravity controlled convection NuB using
F C Nu2
an asymptotic expression Nu D
. On the external air side, speciﬁc
heat transfer coefﬁcients are deﬁned for compact heat exchangers with louvers and
ﬁns, as noted by [24, 25]. The above heat transfer correlations are obtained by ﬁtting
experimental data of massive heat exchangers with a variety of geometries (e.g.,
tube or micro-channel diameter) and ﬂow conditions (e.g., turbulent or laminar
ﬂow). Although the heat transfer multipliers scaling the heat transfer coefﬁcients
are capable of matching actual system responses with guaranteed accuracy, its
accuracy deteriorates when the plants are not uniform. A common situation is
that at leat 10 % deviation exits for two-phase correlations due to the liquid-
laminar and gas-turbulent ﬂow. A rigorous treatment of parameter uncertainties in
all these correlations is to specify uncertainty bounds for each correlation, leading
to a sophisticated high-order uncertainty vector. Instead, a practical approach is to
lump all the uncertainties together into the heat transfer coefﬁcients of the two-
phase region on refrigerant side that dominates the process of heat transfer and
refrigerant dynamics. To this extent, the actual heat transfer coefﬁcient is bounded,
˛e;act D ˛e;cor C (cid:12)˛.

Mean void fraction uncertainty is inherent in the modeling of two-phase ﬂow in
the heat exchanger. The mean void fraction is dependent on not only the current
refrigerant pressure, but also the inlet and outlet refrigerant quality, namely (cid:9) D
f .P; xin; xout/. A speciﬁc correlation arises from the averaging of local void fraction
distribution. For instance, a distribution of local void fraction over vapor quality is
in the form of

(cid:9) .x; P/ D

(cid:8)

(cid:6)
1 C ˛0

1 (cid:3) x
x

(cid:9)˛1

(cid:8)

(cid:9)˛2

(cid:8)

(cid:9)˛3

(cid:7)(cid:3)1

(cid:3)g
(cid:3)f

(cid:6)f
(cid:6)g

(6.11)

where ˛i are ﬁtting parameters. The mean void fraction is an integral of local
void fraction along the two-phase region of the heat exchanger. The dependency
of vapor quality on location might be any appropriate relationship, and one simple
treatment is linear [26]. The speciﬁc form of local void fraction distribution assumes
two-phase ﬂow in equilibrium; besides, the linear mapping between vapor quality

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

109

and location is an idealized simpliﬁcation. Hence, both assumptions introduce
uncertainty if the dependence of void fraction on pressure is modeled, especially
when mode switching occurs during A/C system starting-up and shutting-down.

In previous work, the treatment of mean void fraction is either assuming it
a constant or allowing it varying according to the corresponding heat exchanger
pressure, both of which introduce uncertainty. For instance, the ﬂow in two-phase
region can be further divided into different regimes (bubble ﬂow, slug ﬂow, churn
ﬂow, etc.). The complicated phenomenon is averaged by a variety of mean void
fraction correlations simply correlating mean void fraction with the pressure under
equilibrium-ﬂow assumption which implicitly neglecting the time lag between the
two dynamics of mean void fraction and pressure. During the large transition,
a ﬁrst order approximation is made in [3] to help tuning the changing rates of
the actual mean void fraction (cid:9) with respect to the ideal mean void fraction (cid:9)

tot

ı(cid:9)

tot
dp

dp
dt

D

d(cid:9)
dt

D K .(cid:9) (cid:3) (cid:9)

/

tot

(6.12)

So far, it is difﬁcult to identify the errors introduced by the choice of local void
fraction correlation, the linear mapping between two-phase spatial location and
corresponding refrigerant quality, as well as the lag between the actual and ideal
mean void fraction. To this extent, a uniﬁed approach is adopted to treat all the
above errors into multiplicative unmodeled dynamics,
ˇ
ˇ
ˇ
ˇ (cid:5) jWu .j!/j
ˇ

QG .j!/ (cid:3) G .j!/
G .j!/

M .G; Wu/ WD

(6.13)

QG W

ˇ
ˇ
ˇ
ˇ
ˇ

(

)

where G(s) is the nominal A/C model and Wu is a multiplicative uncertainty
weighting functions.

Finally, the assumption of static compressor model might also introduce uncer-
tainty if its dynamics affects the response speed of the vapor compression cycle.
For instance, a ﬁrst order dynamic is added to the refrigerant circulating across the
compressor into the overall refrigeration loop,

:
mcmp D

:
mcmp;static (cid:3)

:
mcmp

(cid:4)

(6.14)

where the time constant (cid:4) is chosen to be 40 s [3]. Therefore, it is reasonable to add
an unmodeled compressor dynamics into the actuator model of the automotive A/C
system.

110

Q. Zhang and M. Canova

6.3.2 Uncertainty Analysis

Theoretically, the ratio of output variations over uncertainties variations is depen-
dent on working points as well as plant structure. Hence, a uniﬁed approach
of characterizing these uncertainties is desirable. The corresponding uncertainty
structure (cid:12) is not a simple stack of all the above uncertainties but depends on their
deﬁnition sequence. Deﬁning the structure of (cid:12) involves specifying three thins:
the type of each block, the total number of blocks, and their dimensions. From the
above analysis of parameter uncertainty and unmodeled dynamics, there are two
types of blocks: repeated scalar and full blocks for two parameter uncertainties and
two ﬁrst order unmodeled dynamics, respectively. Hence, the structure of (cid:12) for the
automotive A/C system is the form of

(cid:10)

(cid:4)

(cid:5)

(cid:12) D

diag

ı1 ı2 A1 A2

W ıi 2 C; Aj 2 C1(cid:6)1

(cid:11)

(6.15)

Linear fraction transformations (LFTs), a powerful and ﬂexible approach to
represent uncertainty in matrices and systems, is used to pull out the uncertainties
in Fig. 6.6 systematically [20]. Let M be a complex matrix partitioned as

(cid:6)

(cid:7)

M11 M12
M21 M22

M D

(6.16)

and let (cid:12)l and (cid:12)u be two other complex matrices. Then a lower LFT with respect to
(cid:12)l is formally deﬁned as the map Fl .M; (cid:12)l/ WD M11 CM12(cid:12)l.I (cid:3) M22(cid:12)l/(cid:3)1
M21; an
upper LFT with respect to (cid:12)u as Fu .M; (cid:12)u/ WD M22 C M21(cid:12)u.I (cid:3) M11(cid:12)u/(cid:3)1
M12.
A useful interpretation of an LFT is that it has a nominal mapping, M11, and is
perturbed by (cid:12), with a prior knowledge as to how the perturbation affects the
nominal map. In order to write the plant P into an LFT in terms of (cid:12), it is required
to label the inputs and outputs of the ı’s as y’s and u’s, respectively, and write z
and y’s in terms of ! and u’s with all ı’s taken out [20]. Figure 6.7 illustrates these
extra entries connected to the uncertainty block (or perturbation) after the pulling-
out process.

The inﬂuences of model uncertainties on system performance are of inter-
est. A comprehensive quantitative study of the sensitivities of the A/C system
outputs, namely evaporator pressure and superheat temperature, over parameter
uncertainties, and unmodeled dyanmcis, has been performed in [27], where these
model uncertainties are treated as unknown faults to detect. An alternative method
of sensitivity study is to analytically differentiate the outputs over the model
uncertainties using the MBM A/C model, which is mathematically formidable
given the fact of strong nonlinearities and high-orders. Thus, a qualitative study
is performed here to identify the main contributors of variations of response time
and static gains.

After implementation of parameter uncertainty in the nonlinear MBM A/C
model, its open-loop responses are shown in Fig. 6.8 by sampling the uncertainty

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

111

parameters with postive/negative one-tenth parameter uncertainties. From the dif-
ferent rising and setting times of the step response proﬁles, parameters uncertainties
are found mainly affect the response time of the A/C system.

After implementation of unmodeled dynamics in the nonlinear MBM A/C
model, its open-loop responses are shown in Fig. 6.9 by sampling the uncertainty
parameters with postive/negative one-tenth unmodeled dynamics. From the different
static gains, rising and setting times of the step response proﬁles, unmodeled
dynamics is found affect both the amplitude and response time of the A/C system.

6.3.3 Robust Stability and Robust Performance

After the uncertain plant model P, structured uncertainty (cid:12) and the H1 controller
in Fig. 6.5 have been speciﬁed, two criteria are of interest: robust stability test
and robust performance test, because they reveal the properties of the controller
in frequency domain.

Robust stability test refers to whether the closed-system is stable under uncer-
tainties. From Fig. 6.5, the plant P and the controller K are grouped through lower
LFT, M WD Fl .M; K/, as indicated in Fig. 6.10a. Herein, the new system matrix M
is built by connecting an uncertain system P with a feedback controller K. Since
the structure of the perturbation matrix (cid:12) has already been deﬁned in Eq. (6.15),
the size of perturbations to which the system is robustly stable is only dependent on
certain kind of property of system matrix M.

Fig. 6.7 A/C system (cid:6) synthesis scheme

Q. Zhang and M. Canova

112

250

249.5

249

248.5

]
a
P
k
[
 
e
r
u
s
s
e
r
P

248

0

21.5

21

]

C

[
 

H
S

20.5

20

253

252.5

252

251.5

251

250.5

]
a
P
k
[
 
e
r
u
s
s
e
r
P

250

0

20

19.5

19

18.5

]

C

[
 

H
S

20

40

60

80

100

20

40

60

80

100

compressor

Valve

− 10 %
+ 10 %
0 %

19.5

0

20

80

100

18

0

20

60
40
Time [sec]

60
40
Time [sec]

80

100

Fig. 6.8 Responses of uncertain A/C system to parameter uncertainty

Robust performance test refers to whether the output performance is satisﬁed
under uncertainties. A good performance of MIMO control system is characterized
using H1 norms of the weighted closed-loop transfer function T from disturbance
d to performance variables e, noted as T WD Fu .M; (cid:12)/ through upper linear
fractional transformation. A transfer function T is small, which is equivalent to the
fact that the performance is good, if and only if T can tolerate all possible stable
feedback perturbation (cid:12)F without leading to instability, as shown in Fig. 6.10b.
Hence, a robust performance test could be determined using a robust stability test
by introducing a ﬁctitious uncertainty block across the disturbance/error channels.
(cid:6)

(cid:7)

AP D

A 0
0 AF

(6.17)

As indicated in above discussions, in order to analyze the robust stability and
robust performance of uncertainty system, certain kind property of the uncertain
closed-loop M corresponding to a speciﬁc uncertain structure (cid:12) should be deﬁned.
In [20], a matrix function, denoted by (cid:6)((cid:2)) and named structured singular value, is
deﬁned as

(cid:6)A.M/ WD

1
min f(cid:7) .(cid:12)/ W det .I (cid:3) M(cid:12)/ D 0g

(6.18)

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

113

− 10 %
+ 10 %
0 %

20

40

60

80

100

20

40

60

80

100

compressor

Valve

250

249.5

249

248.5

248

247.5

]
a
P
k
[
 
e
r
u
s
s
e
r
P

247

0

21

20.8

20.6

20.4

20.2

20

19.8

0

]

C

[
 

H
S

253

252.5

252

251.5

251

250.5

]
a
P
k
[
 
e
r
u
s
s
e
r
P

250

0

20

19.5

19

18.5

18

17.5

0

]

C

[
 

H
S

20

40

60

80

100

20

40

60

80

100

Time [sec]

Time [sec]

Fig. 6.9 Responses of uncertain A/C system to unmodeled dynamics

Fig. 6.10 Test schemes. (a) Robust stability. (b) Robust performance

114

Q. Zhang and M. Canova

An intuitive interpretation of the deﬁnition of structured singular value is that
(cid:6)(cid:12)(M) is a measure of the smallest structured (cid:12) that causes instability. In general,
there is no direct computation method of structured singular value. However, an
inequality can assist numerical software calculating lower and upper bounds of
structured singular value over the frequency of interest [20].

The deﬁnition of structured singular value allows to formulate the two criteria of

testing robust stability and robust performance.

Robust stability: let ˇ > 0. The closed-loop is well posed and internally stable for

(cid:10)

(cid:11)

all (cid:12) .(cid:2)/ 2 M.A/ with k(cid:12)k/ (cid:5) 1

ˇ if and only if sup
!2R
Robust performance: let “ > 0. For all (cid:12) .(cid:2)/ 2 M.A/ with k(cid:12)k/ (cid:5) 1

Mp .j!/

(cid:5) ˇ.

(cid:6)AF

(cid:4)

(cid:14)
(cid:14)Fu

Mp; (cid:12)

(cid:5)(cid:14)
(cid:14)

ˇ , the
< ˇ if and only if

(cid:11)

(cid:10)

Mp .j!/

cloop is well posed, internaly stable, and
(cid:5) ˇ.
sup
!2R

(cid:6)AF
Note that for the discussion of robust stability and robust performance afterwards,
a default setting is chosen, ˇ D 1. In other words, if ˇ < 1, the criterionis satisﬁed;
otherwise, it is unsatisﬁed.

1

The robust stability and robust performance of the closed-loop A/C system
with the H1 controller designed are shown in Fig. 6.11a, b, respectively. From
Fig. 6.11a, the upper and lower bounds of the structured singular value representing
robust stability is very close. The peak is about 0.51 and occurs at ! D 0.175 rad/s.
Hence, stability is guaranteed for all perturbations with appropriate structure, and
max ! (cid:7) Œ(cid:12) .j!/(cid:11) < 1 (cid:6) 1:96. Figure 6.11b, the upper and lower bounds of the
structured singular value representing robust performance has discrepancy at low
frequency domain. The peak value of both lower and upper bounds is about 1.95. In
other words, for every perturbation (cid:12) D 1:95 Œdiag .ı1; ı2; (cid:12)1; (cid:12)2 /(cid:11) satisfying
max ! (cid:7) Œ(cid:12) .j!/(cid:11) < 1, the stability is guaranteed and FU .M; (cid:12)/ (cid:5) 1:95. Moreover,
there is a perturbation (cid:12) D Œdiag .ı1; ı2; (cid:12)1; (cid:12)2/(cid:11) satisfying max ! (cid:7) Œ(cid:12) .j!/(cid:11) (cid:6)
1=1:95 < 1, such that FU .M; (cid:12)/ (cid:6) 1:95 > 1, implying that robust performance is
not quite achieved.

6.3.4 Reference Tracking and Disturbance Rejection

Using uncertain A/C plant models selected from uncertainty structure with 3 %, 6 %,
10 % deviations from the nominal plant, the inefﬁciency of achieving robust perfor-
mance becomes prominent from responses of the closed-loop system to reference
evaporator pressure and superheat temperature, especially when disturbances arising
from the evaporator air side are added. The tracking performance of evaporator
pressure and superheat temperature is shown in Fig. 6.12a, b, respectively. Starting
from a nominal working point around (Pe, SH) D (250 kPa, 20 ıC) corresponding to
a medium cooling load, step changes are added at 10 s into the reference evaporator
pressure (5 kPa) and reference superheat (5 ıC), respectively. Although different
overshoot, rising time and setting time exist, the actual responses of all uncertain
closed-loop A/C models are proved to track the step-up changes of the reference

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

115

a

0.6

0.5

0.4

0.3

0.2

)
s
b
a
(
 
e
d
u

t
i

n
g
a
M

b

)
s
b
a
(
 
e
d
u
t
i
n
g
a
M

2

1.9

1.8

1.7

1.6

0.1

10-1

100

101
Frequency [rad/sec]

Robust Stability

102

1.5

10-1

100

101

102

Frequency [rad/sec]

Robust Performance

Fig. 6.11 Analysis of closed-loop A/C system with H1 controller. (a) Robust stability. (b) Robust
performance

signals as expected, indicating robust stability is guaranteed. The performance
deterioration is distributed evenly for individual tracking objective. Comparing
Fig. 6.12a to Fig. 6.12b, the differences among the responses of sampled uncertain
A/C system to superheat temperature are not as signiﬁcant as these to evaporator
pressure.

The inconsistency of closed-loop responses becomes even worse when tracking
performance is evaluated under disturbances, when a 5 % variation is added
into the evaporator air side at 10 s and removed after 50 s. The disturbance

116

Q. Zhang and M. Canova

3%

6%

10%

20

40

60

80

100

Time [Second]
Evaporator Pressure

a

]

a
P
k
[
 

e
r
u
s
s
e
r
P

255

254

253

252

251

250

0

b

]

C

[
 

H
S

26

25

24

23

22

21

3%

6%

10%

80

100

20

0

20

60
40
Time [Second]

Superheat Temperature

Fig. 6.12 Tracking performance of H1 controller under uncertainty. (a) Evaporator pressure.
(b) Superheat temperature

rejection of the actual evaporator pressure and superheat temperature are shown
in Fig. 6.13a, b. From both ﬁgures, the actual two outputs are ﬁnally maintained
around the nominal working point (Pe, SH) D (250 kPa, 20 ıC) after transition, as
suggested by the H1 controller design requirements. However, the overshoot of the
two actual outputs of sampled uncertain A/C models varies signiﬁcantly, namely
1–4 kPa for evaporator pressure and 0.5(cid:3)3 ıC for superheat temperature. Hence,
the performance deterioration is more signiﬁcantly demonstrated using simulation
under the scenario of disturbance rejection, compared to reference tracking.

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

117

a

]
a
P
k
[
 
e
r
u
s
s
e
r
P

255

254

252

250

248

246

0

b

]

C

[
 

H
S

23

22

21

20

19

18

0

20

40

60

80

100

Time [Second]
Evaporator Pressure

3%

6%

10%

3%

6%

10%

20

40

60

80

100

Time [Second]
Superheat Temperature

Fig. 6.13 Disturbance rejection of H1 controller under uncertainty. (a) Evaporator pressure.
(b) Superheat temperature

6.4 (cid:2) Synthesis

From the simulation results of the closed-loop A/C system with an H1 controller,
the designed controller K is not capable of achieving both stability and performance
under uncertainty (cid:12) for a plant P in Fig. 6.5. In order to develop a controller
providing improved reference tracking and disturbance rejection for A/C plant
with uncertainty, an advanced control technique, (cid:6) synthesis, is adopted, whose
theoretical foundation is built upon the analysis of robust stability and robust
performance discussed before.

118

Q. Zhang and M. Canova

6.4.1 Robust Stability and Robust Performance

Literally, the goal of (cid:6) synthesis is to ensure the performance of all sampled uncer-
tain models uniform. Mathematically, it minimizes over all stabilizing controllers
K, the peak value of (cid:6)(cid:12)((cid:2)) of the closed-loop transfer function FL(P, K). More
formally,

min
K

max
!

(cid:6)(cid:12) ŒFL .P; K/ .j!/(cid:11)

(6.19)

where the uncertainty is consistent with the one deﬁned in Eq. (6.17) consisting of
both actual uncertainty and ﬁctitious uncertainty. For tractability of the (cid:6) synthesis
problem, it is necessary to replace (cid:6)(cid:12) ((cid:2)) with its upper bound. After some
mathematical iterations, the ﬁnal optimization problem becomes

(cid:14)
(cid:14)
(cid:14)bDFL .P; K/ bD

(cid:3)1

(cid:14)
(cid:14)
(cid:14)

1

min
K

min
bDs2D(cid:12)

(6.20)

where D(cid:12) is a real-rational, stable, and minimum-phase transfer function. This
optimization is currently solved using an iterative approach by ﬁnding optimal
solution when D and K are ﬁxed sequentially. The detail of D–K iteration is given
in [20].

The calculated (cid:6) controller has more than 20 states, and the ﬁrst three states
contain the majority of “energy” compared to the rest. Hence, balanced model order
reduction technique is applied to ﬁnd a low-order (cid:6) controller described as

2

4

2

4

(cid:6)

A(cid:6) D

BC1 D

CC1 D

3

5

(cid:3)0:011634 (cid:3)0:05728 (cid:3)0:0289
(cid:3) 0:01911 (cid:3)1:247 (cid:3)0:8841
(cid:3) 0:005893 (cid:3)0:8549 (cid:3)0:7394
3
0:601 4:429
10:03 2:679
5:583 0:4171
(cid:3)4:482

(cid:3)11:26 (cid:3)5:598
(cid:3) 0:001746 (cid:3)0:001392 0:003263

5

(cid:7)

(6.21)

The robust stability and robust performance of the closed-loop A/C system with
(cid:6) controller integrated are shown in Fig. 6.14a, b, respectively. From Fig. 6.14a,
the upper and lower bounds of the structured singular value representing robust
stability is very close, too. The peak is about 0.82 and occurs at ! D 0.15 rad/s,
which is higher than the one of the H1 controller. Hence, stability is guaranteed
for all perturbations with appropriate structure. Hence, the robust stability margin
of the (cid:6) controller is less than the one of the H1 controller. Figure 6.14b, the upper
and lower bounds of the structured singular value representing robust performance
has discrepancy over the entire frequency domain. The peak value of both lower

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

119

a

1

)
s
b
a
(
 
e
d
u
t
i
n
g
a
M

0.8

0.6

0.4

0.2

b

0.95

)
s
b
a
(
 
e
d
u
t
i
n
g
a
M

0.9

0.85

0.8

0
10-1

100

101

102

Frequency [rad/sec]

Robust Stability

0.75

10-1

100

101

102

Frequency [rad/sec]

Robust Performance

Fig. 6.14 Analysis of closed-loop A/C system with (cid:6) controller. (a) Robust stability. (b) Robust
performance

and upper bounds is about 0.91. In other words, for every perturbation (cid:12) D
Œdiag .ı1; ı2; (cid:12)1; (cid:12)2/(cid:11) satisfying the stability is guaranteed and FU .M; (cid:12)/ (cid:5) 0:91.
Moreover, there is a perturbation (cid:12) D Œdiag .ı1; ı2; (cid:12)1; (cid:12)2/(cid:11) satisfying such that
FU .M; (cid:12)/ (cid:6) 0:91 < 1, implying that the requirement of robust performance is
satisﬁed.

120

Q. Zhang and M. Canova

6.4.2 Reference Tracking and Disturbance Rejection

Integrating the designed (cid:6) controller with the uncertain A/C plant models selected
from uncertainty structure with 3 %, 6 %, 10 % deviations from the nominal plant,
we will prove the capability of the controller in achieving robust performance from
the responses of the closed-loop system to the changes of the reference evaporator
pressure and superheat temperature, especially when disturbances arising from the
evaporator air side are added. The tracking performance of evaporator pressure and
superheat temperature is shown in Fig. 6.15a, b, respectively. With the same nominal

a

]
a
P
k
[
 
e
r
u
s
s
e
r
P

255

254

253

252

251

250

0

b

]

C

[
 

H
S

26

25

24

23

22

21

20

0

20

40

60

80

100

Time [Second]

Evaporator Pressure

3%
6%
10%

3%
6%
10%

20

40

60

80

100

Time [Second]

Superheat Temperature

Fig. 6.15 Tracking performance of (cid:6) controller under uncertainty. (a) Evaporator pressure.
(b) Superheat temperature

6 Improving Tracking Performance of Automotive Air Conditioning System. . .

121

working point and step signals as before, the actual responses of all uncertain closed-
loop A/C models are proved to track the step-up changes of the reference signals
as expected, indicating robust stability is guaranteed. The tracking performances,
such as overshoot, rising time and setting time, are improved from the fact that
the deviation amplitude of these responses of sampled uncertain A/C system to
reference evaporator pressure in Fig. 6.15a is reduced by half compared to those
in Fig. 6.12a. Similar conclusion could be drawn from the comparison between
responses to reference superheat temperature in Fig. 6.15b and these in Fig. 6.12b,
though the reduction of deviation amplitude is not very obvious.

a

]
a
P
k
[
 
e
r
u
s
s
e
r
P

255

254

252

250

248

246

0

b

]

C

[
 

H
S

23

22

21

20

19

18

0

3%
6%
10%

20

40

60

80

100

Time [Second]
Evaporator Pressure

3%
6%
10%

20

40

60

80

100

Time [Second]
Superheat Temperature

Fig. 6.16 Disturbance rejection of (cid:6) controller under uncertainty. (a) Evaporator pressure.
(b) Superheat temperature

The consistency of closed-loop responses becomes much better when tracking
performance is evaluated under the same disturbances as before. The disturbance
rejection of the actual evaporator pressure and superheat temperature is shown
in Fig. 6.16a, b. From both ﬁgures, the actual two outputs are ﬁnally maintained
around the nominal working point after transient, as suggested by the (cid:6) controller
design requirements. However, the performance criteria, such as overshoot, rising
time and setting time, of both actual outputs of sampled uncertain A/C models are
very consistent, compared to the signiﬁcant variation in Fig. 6.13a, due to the fact
the stability performance margin of the (cid:6) controller is much larger than the one of
H1 controller.
Abstract In this chapter, we describe a mean-ﬁeld control method to improve
energy efﬁciency for operating the heating, ventilation, and air conditioning (HVAC)
systems. To illustrate the idea of this method, we consider a distributed set-
point temperature regulation problem for building HVAC systems. With a large
number of zones in large buildings, the problem becomes intractable with standard
control approaches due to the large state space dimension of the dynamic model.
To mitigate complexity, we apply the mean-ﬁeld control approach to large-scale
control problems in buildings. The mean-ﬁeld here represents the net effect of the
entire building envelope on any individual zone. Rather than solving the large-scale
centralized problem, we explore distributed game-theoretic solution approaches that
work by optimizing with respect to the mean-ﬁeld. The methodology is illustrated
with a numerical example in a simulation environment.

Keywords Temperature control (cid:129) Air conditioning system (cid:129) Building

7.1 Introduction

Buildings are one of the primary consumers of energy. In the USA, buildings are
responsible for 30 % of energy consumption, and 71 % of electricity consumption,
while accounting for 33 % of CO2 emissions [1]. A large amount of the energy
consumed in buildings is wasted. A major reason for this wastage is inefﬁciencies
in the building technologies, particularly in operating the heating, ventilation, and
air conditioning (HVAC) systems. According to a study commissioned by the US
Department of Energy, the current building systems are only 20–30 % efﬁcient in
energy usage [2]. These inefﬁciencies are in turn caused by the manner in which
HVAC systems are currently operated. The temperature in each zone is controlled by
a local controller, without regards to the effect that other zones may have on it or the
effect it may have on others. Substantial improvement may be possible if inter-zone
interactions are taken into account in designing control laws for individual zones.

In fact, there is a growing interest in optimal control methods to minimize
building-wide energy consumption based on dynamic models [3–7]. Such control
techniques require a model of the transient thermal dynamics of the building that
relates the control signals to the space temperature of each zone. A challenge in
developing such techniques is the complexity of the underlying models due to large
dimension of state space and a large number of control objectives. A model based
on the ﬁrst-principles will be a large set of coupled PDEs, which is intractable in
general. Even the so-called reduced-order models that rely on a lumped resistor–
capacitor analogy of walls and windows lead to models with large state space. Such
a reduced order model for a medium-size commercial building with about 100 zones
will have a state dimension close to 1000 [8].

In this chapter, we describe a decentralized optimal control strategy for the
zones of a multi-zone building where model complexity is mitigated by using
a two pronged approach. First, we use recently developed aggregation-based
model reduction techniques [9] to construct a reduced-order model of the multi-
zone building’s thermal dynamics. Second, we use the mean-ﬁeld intuition from
statistical mechanics so that the effect of other zones on a particular zone is captured
through a mean-ﬁeld model [10]. Then the whole model (even the reduced model)
does not have to be used in computing the controls for short-time scales.

By using the mean-ﬁeld idea, we cast the control problem as a game, whereby
each zone has its own control objective modeled as set-point tracking of the local
(zonal) temperature. In general, the control problem quickly becomes intractable for
even a moderate number of competing objectives. In order to mitigate complexity,
we employ the Nash certainty equivalence (NCE) principle to obtain a mean-ﬁeld
description [11]. The mean-ﬁeld here represents the net effect of the entire building
envelope on any individual zone. A local optimal zonal control is designed based
on the local model of thermal dynamics and its interaction with the building via the
mean-ﬁeld (mass inﬂuence). A consistency relationship is used to enforce the mean-
ﬁeld in a self-consistent manner. The methodology is shown to yield distributed
control laws that can easily be implemented on large-scale problems.

We compare the performance of the proposed controller with that of a PI
controller. Controllers currently used in commercial buildings use a combination of
discrete logic and PID type controllers. Simulations show that the proposed scheme
achieves comparable temperature tracking performance while reducing energy
consumption by reducing the mass-ﬂow rates entering the zones. The outline of
this chapter is as follows: In Sect. 7.2, we describe the baseline and reduced models
of building thermal dynamics. In Sect. 7.3, the mean-ﬁeld control methodology is

7 Mean-Field Control for Improving Energy Efﬁciency

127

described for the building temperature regulation problem. In Sect. 7.4, we describe
the mean-ﬁeld control for linearized building model. The simulation results and
comparisons with PI control appear in Sect. 7.5.

7.2 Building Thermal Model

7.2.1 Conﬁguration of HVAC System

A typical multi-zone HVAC system used in modern buildings is the variable-
air-volume (VAV) system. Such a system supplies air at a constant temperature.
The airﬂow to the zones is controlled based on room thermal load requirements.
Figure 7.1 depicts the conﬁguration of a four-zone building equipped with a VAV
system: Upstream, an air handling unit (AHU) conditions air by passing it across the
cooling coil. A series of ducts is used to supply the cold and dry air to VAV boxes
for each of the downstream zones. Each VAV box contains a local controller, tasked
with maintaining the zone temperature at a speciﬁed value, by controlling the mass
ﬂow rate of air supplied to the zone using dampers. The total air ﬂow rate of the
entire system therefore varies with time. Zonal controllers at VAV boxes may also
apply “reheat” (adding heat) or “pre-cooling” (removing heat) to the conditioned air
before supplying it to the zone.

7.2.2 Baseline Building Thermal Model

A building thermal model is constructed by combining elemental models of
conductive interaction between two zones separated by a solid surface (e.g., walls,
windows, ceilings, and ﬂoors). A lumped parameter model of conduction across a
surface is assumed to be an RC-network, with current and voltage being analogs of
heat ﬂow and temperature [12].

Fig. 7.1 The conﬁguration of
a four-zone building HVAC
system

128

S. Li et al.

The resulting model can be described by an undirected graph G D .V0; E/, where
V0 WD f0g[V denotes the set of nodes of the graph. The node f0g denotes the outside
and the set V WD f1; : : : ; ng denotes the building nodes. The nodes are so indexed
that the ﬁrst N nodes of V correspond to the zones 1; : : : ; N, and these are called the
zone nodes. The next .n (cid:3) N/ nodes of V correspond to the internal points of the
surfaces. These are called the internal nodes. An edge .i; j/ exists between nodes
i and j if there is a resistance connecting them directly. The set E (cid:10) V0 (cid:4) V0 is
the set of all edges. Therefore each edge .i; j/ has an associated thermal resistance
Rij 2 RC. Since the graph is undirected, Rji D Rij by convention. Each node i 2 V
has an associated thermal capacitance Ci.

The states and inputs of the building thermal model are summarized below:

States W T1; : : : ; TN; TNC1; : : : ; Tn

Inputs W T0; T sI Pmin
i

; PQr
i

; PQint
i

; PQext
i

; i D 1; : : : ; N

where T1; : : : ; TN denote the space temperature of the zones, TNC1; : : : ; Tn denotes
the temperature of the points internal to the surface elements, T0 denotes the outside
temperature, T s denotes the temperature of the air supplied by the AHU, Pmin
i denotes
the mass-ﬂow rate of the supply air entering the ith zone, PQr
i denotes the rate of heat
due to reheat, PQint
i denotes the rate of heat generated by occupants, equipments, and
lights in the ith zone, and PQext
denotes the rate of solar radiation entering the ith
zone.

i

The supplied air temperature T s is usually constant for a VAV system, at least of
short intervals of time. All other inputs are time varying. In this chapter, we assume
; PQint
that (estimates of) the outside temperature T0 and the heat gains PQr
are
i
i
available based on historical data, weather predictions, and various sensors.

; PQext
i

The thermal dynamics of a multi-zone building, described by a graph G, is

represented by the following coupled differential equations: for each i 2 V,

Ci PTi.t/ D PQi.t/ C (cid:12)Hi.t/ C

.Tj.t/ (cid:3) Ti.t//=Rij

(7.1)

X

j2Ni

where Ni WD fj 2 V0 W j ¤ i; .i; j/ 2 Eg denotes the set of neighbors of the node
i. The heat gain PQi is the rate of thermal energy entering the node i from external
sources, other than ventilation air and conduction from neighboring nodes:

PQi.t/ D PQr
i
PQi.t/ D 0;

.t/ C PQint
i

.t/ C PQext

.t/;

i

i D 1; : : : ; N

i D N C 1; : : : ; n:

The ventilation heat exchange (cid:12)Hi is the rate of thermal energy entering the node i
due to ventilation:

(cid:12)Hi.t/ D Cpa Pmin
i
(cid:12)Hi.t/ D 0;

.t/.T s (cid:3) Ti.t//;

i D 1; : : : ; N
i D N C 1; : : : ; n

7 Mean-Field Control for Improving Energy Efﬁciency

129

where Cpa is the speciﬁc heat capacitance of the supplied air at constant pressure. In
the following, we also call the mass-ﬂow rate Pmin as the control input u to building,
i.e., ui D Pmin

i for i D 1; : : : ; N.

The coupled ordinary differential equation model (7.1) is bilinear in T and Pmin.
In practice, we can measure the zone temperatures, which are usually treated as the
output of the building thermal model. The model (7.1) can be expressed equivalently
using a state space representation:

PT D AT C B.T/u C d

Y D KT

the control vector u WD
the output vector Y WD ŒY1; : : : ; YN(cid:11)0, and the load vector

1 ; : : : ; Pmin
N

where the temperature vector T WD ŒT1; : : : ; Tn(cid:11)0,
Œ Pmin
d WD Œd1; : : : ; dN; 0; : : : ; 0(cid:11)0 where for i D 1; : : : ; N,
(cid:12)

(cid:11)0,

di WD

.T0=Ri0 C Qi/=Ci;
Qi=Ci;

if .i; 0/ 2 E
if .i; 0/ … E:

The matrix A 2 Rn(cid:6)n is given by

(7.2)

(7.3)

Aij WD

8
<

:

0;
1=.CiRij/;
P
k¤i Aik;
(cid:3)

if j ¤ i; .i; j/ … E
if j ¤ i; .i; j/ 2 E
if j D i; .i; j/ 2 E:

The matrix B.T/ 2 Rn(cid:6)N is deﬁned as

(cid:12)

Bij.T/ WD

Cpa.T s (cid:3) Ti/=Ci;
0;

if i D j D 1; : : : ; N
otherwise:

The matrix K 2 RN(cid:6)n is given by

K D ŒIN(cid:6)N 0N(cid:6).n(cid:3)N/(cid:11):

We assume that the pair .A; B.T// is controllable for any T (cid:8) 0, and the pair .A; K/
is observable.

7.2.3 Reduced Building Thermal Model

For a building with N zones, the number of states for the baseline model (7.1) is of
the order of 7N, usually much more [8]. A medium-sized commercial building may
have around 100 zones and a larger one could have several hundreds. The dimension

130

S. Li et al.

of the building model can thus be quite large. In this section, we describe a reduced-
order building thermal model by using an aggregation technique [9]. The reduced
models will be used in Sect. 7.3 to develop the mean-ﬁeld control strategies.

To obtain the reduced model, we aggregate a subset of nodes into super-nodes.
Mathematically, suppose we want to reduce the state space dimension from n to
m, where m (cid:5) n is the (user-speciﬁed) number of super-nodes. The ﬁrst step is to
determine a partition function (cid:5) W V ! NV, where NV WD f1; : : : ; mg such that (cid:5) is
onto but possibly many-to-one. The elements of NV are the super-nodes, and for every
k 2 NV, the node set (cid:5)(cid:3)1.k/ (cid:10) V includes the nodes in the baseline model that are
aggregated into the kth super-node. Similar to the baseline model, we let f0g denote
the outside node and deﬁne the set NV0 WD f0g [ NV.

Given a ﬁxed m-partition function (cid:5), we introduce the following quantities for

the reduced model:

(cid:129) The super-capacitance of the kth partition is the combination of all capacitances

of the nodes in kth partition:

NC

.(cid:5)/
k

WD

X

i2(cid:5)(cid:2)1.k/

Ci;

k 2 NV:

(cid:129) The super-resistance between kth and lth partitions is the parallel-equivalence of

all resistances connecting the nodes between two partitions:

NR

.(cid:5)/
kl

P

WD

1
P
j2(cid:5)(cid:2)1.l/ 1=Rij

;

i2(cid:5)(cid:2)1.k/

k ¤ l 2 NV:

(cid:129) The super-load of the kth partition is the combination of all thermal loads for the

zones in the kth partition:

PNQ

.(cid:5)/
k

.t/ WD

PQi.t/;

k 2 NV:

X

i2(cid:5)(cid:2)1.k/

The reduced-order model is also an RC-network deﬁned on super-nodes with super-
edges connecting these super-nodes. Its thermal dynamics is represented by the
following coupled differential equations: for each k 2 NV,

NC

.(cid:5)/
k

PNTk.t/ D PNQ

.t/ C (cid:12) NH

.(cid:5)/
k

.t/

C

. NTl.t/ (cid:3) NTk.t//= NR

.(cid:5)/
kl

(7.4)

.(cid:5)/
k
X

l2 NNk

NNk (cid:10) NV0 denotes the set of
where NTk is the temperature of the kth super-node,
neighbors of the kth super-node, and the ventilation heat exchange for the kth super-
node is given by

7 Mean-Field Control for Improving Energy Efﬁciency

131

(cid:12) NH

.(cid:5)/
k

.t/ W D

X

(cid:12)Hi.t/

i2(cid:5)(cid:2)1.k/\f1;:::;Ng
X

i2(cid:5)(cid:2)1.k/\f1;:::;Ng

D

Cpa Pmin
i

.t/.T s (cid:3) Ti.t//:

The initial condition of the reduced model (7.4) at initial time t0 is deﬁned as

NTk.t0/ D

.Ci= NC

.(cid:5)/
k

/Ti.t0/;

k 2 NV:

X

i2(cid:5)(cid:2)1.k/

Note that the reduced model (7.4) requires for its inputs: the mass-ﬂow rate Pmin
i and
the zone temperature Ti for i D 1; : : : ; N. These are assumed to be available, or are
measured.

We can represent the reduced model (7.4) using the state space representation:

PNT D NA.(cid:5)/ NT C NB.(cid:5)/.T; u/ C PNQ.(cid:5)/

(7.5)

where NT WD Œ NT1; : : : ; NTm(cid:11)0 denotes the super-temperature vector, the terms NA.(cid:5)/ and
NB.(cid:5)/ are deﬁned accordingly.

The reduced model described so far depends on the choice of the partition
function (cid:5). We should note that any m-partition function (cid:5) induces a reduced model
with m super-states. In [9], we proposed a recursive bi-partition algorithm to search
for the sub-optimal m-partition function (cid:5)(cid:2). However, one can also directly choose a
sub-optimal (cid:5)(cid:2) based on physical intuition (e.g., ﬂoors in a multi-zone building), or
some kind of expert-based heuristics. The goodness of the reduced model (7.4) with
(cid:5)(cid:2) can be veriﬁed in practice. In this chapter, we will not discuss the algorithms for
choosing the optimal partition function (cid:5)(cid:2). In the following, we assume that (cid:5)(cid:2) has
already properly speciﬁed, and we mainly focus on how to design optimal control
laws by taking advantage of the reduced building model.

Example 1 (Reduced Model with One Super-Node). For the reduced model (7.4),
one may pick any number of super-nodes (less than n) to reduce the complexity.
In the extreme case, with m D 1, we only have one super-node to represent the
entire building thermal dynamics. The thermal dynamics of this single super-node
is represented by the following differential equation:

NC PNT.t/ D PNQ.t/ C (cid:12) NH.t/ C .T0 (cid:3) NT.t//= NR0

(7.6)

where two super-quantities are deﬁned as

NC WD

Ci;

NR0 WD

P

1

;

1=Ri0

i2N0

nX

iD1

132

S. Li et al.

and two super-inputs are given by

PNQ.t/ D

NX

iD1

PQi.t/; (cid:12) NH.t/ D Cpa

Pmin
i

.t/.T s (cid:3) Ti.t//:

NX

iD1

The initial condition of (7.6) is given by

NT.t0/ D

.Ci= NC/Ti.t0/:

nX

iD1

The single super-node model described by (7.6) is an extremely simpliﬁed
version of the building thermal dynamics described by (7.1). The dynamics are very
slow due to the very large capacitance NC. The input of (7.6) requires the combination
of mass ﬂow rates of all zones. In this chapter, we use the reduced model (7.6) to
describe the mass-behavior of the building.

7.3 Mean-Field Control

In this section, we propose a distributed control law wherein each zone regulates
its own temperature by only using the information of the local zone temperature
and the mass-behavior of building system. The idea is that the local control of zone
temperature is fast dynamics, while the mass-behavior of building is slow dynamics.
In short-time scales, each zone designs the local optimal controller based on its own
temperature, its own temperature set-point, and the super-temperature obtained from
the reduced building model (7.4), but ignores the thermal interaction from all other
building nodes. In long-time scales, the resulting control of all zone will collectively
affect the mass-behavior of building system. See Fig. 7.2 for a conceptual illustration
of the mean-ﬁeld control idea.

a

Mass influence

Individual influence

i

Zone

Building

b

set

Ti

*
ui

T

Ti

*
uj

……

*
uk

Ri

Ti

Ci

Zone

T
C

Building

Fig. 7.2 Conceptual illustration of mean-ﬁeld control: (a) individual (zone) playing with mass
(whole building); (b) mean-ﬁeld control diagram, where the whole building thermal dynamics is
represented by a reduced model with one super-node

7 Mean-Field Control for Improving Energy Efﬁciency

133

We consider N zones, each with its local set-point tracking control objective. The

dynamics of the ith zone is given by

PTi D lı
i

.TiI T(cid:3)i/ C bi.Ti/ui C di

(7.7)

where

where

X

lı
i

.TiI T(cid:3)i/ W D (cid:3)

.Ti (cid:3) Tj/=.CiRij/;

j2Ni
bi.Ti/ W D Cpa.T s (cid:3) Ti/=Ci;

di WD PQi=Ci;

with T(cid:3)i WD .Tj/j¤i. The control problem for the ith zone is to minimize the ﬁnite-
horizon cost function

Jı
i

.uiI u(cid:3)i/ D

c.Ti; ui/dt

Z

t1

t0

c.Ti; ui/ WD

(cid:12)T 2

i C

1
2

1
2

ru2
i

(7.8)

(7.9)

i

P

.uiI u(cid:2)
(cid:3)i
We denote Ri WD .

/ for i D 1; : : : ; N.
j2Ni

with the tracking error (cid:12)Ti WD Ti (cid:3) T set
A Nash equilibrium in control policies is given by fu(cid:2)
Jı
i

, and a given scalar r > 0 as control penalty.
i minimizes

iD1 such that u(cid:2)

1=Rij/(cid:3)1 and deﬁne the time constant for the ith zone
as (cid:4)i
WD CiRi. The individual zones are distinguished by their initial conditions
Ti.0/, set-point T set
, loads di, and the time constants (cid:4)i. We introduce a parameter
! WD .T.0/; T set; (cid:4); d/, and consider a large number N of zones, where ! is sampled
from a given distribution (cid:3).!/. For each zone i, the parameter !i is assumed to be
i.i.d., with common distribution !i (cid:11) (cid:3).!/.

i gN

i

We seek a control solution that is decentralized and of the following form: for
each i 2 V and t0 (cid:5) t (cid:5) t1, the control input ui.t/ depends only on local information
fTi.s/ W t0 (cid:5) s (cid:5) tg, and perhaps some aggregate information. This amounts to a
dynamic game, whose exact solution is infeasible for large N.

Instead we construct an approximation of the form described in [13]. This
approximation is based on the aggregated models described in Sect. 7.2.3 with the
following steps:

(i) We identify a small number of super-nodes that describe the slow evolution
of the thermal dynamics of the building. To simplify the introduction of the
mean-ﬁeld control method, we consider here only the simplest case: we use a
single super-node to represent the entire building. The aggregated model (7.6)
is used to describe the evolution of the super-temperature.

134

S. Li et al.

(ii) We consider an approximation of the interaction between a single zone
and the entire building. Motivated by the consideration of the physics of
thermal interactions (large time constants for interactions) and the separable
nature of the control objectives (e.g., (7.8)), we consider an approximation
based on replacing T(cid:3)i.t/ by F.t/, a known function of time. In particular,
lı
i

.Ti.t/I T(cid:3)i.t// in (7.7) is replaced by

Nli.Ti.t/I F.t// WD (cid:3)

Ti.t/ (cid:3) F.t/
(cid:4)i

:

Comparison of lı

i and Nli suggests the following approximation:

F.t/ (cid:6) NT.t/:

(7.10)

(iii) For the local model (7.7) with lı
i

.TiI T(cid:3)i/ replaced by Nli.TiI F/, the game
reduces to decentralized optimal control problems. The individual zones are
“oblivious” to the state of the entire system and make their control decisions
based only on local state variables.

(iv) A form of self-consistency is required: oblivious actions of individual zones

reproduce the evolution of NT as described by the aggregated model.

In the following section we develop the “oblivious” solution described in (iii). We
then turn to the self-consistent aggregated model in (i) that deﬁnes the approximate
interaction (7.10) in (ii). Mathematically, we obtain a ﬁxed-point problem.

7.3.1 Local Optimal Control of a Single Zone

Suppose the interaction function F.t/ is given, possibly in a time-dependent form
for t 2 Œt0; t1(cid:11). We consider the following dynamics for the single zone:

PTi D Nli.TiI F/ C bi.Ti/ui C di

(7.11)

where Nli is given by (7.10).

The control problem for single zone model is to choose the control law ui so as

to minimize the ﬁnite-horizon cost function

Ji.uiI F/ D

c.Ti; ui/dt:

(7.12)

Z

t1

t0

The solution of the optimal control problem with the cost function Ji.uiI F/ is

standard. It is given in terms of the optimal cost-to-go function or value function:
(cid:12) Z

(cid:13)

J(cid:2)
i

.Ti; t/ D min
ui

ci.Ti; ui/dt

:

t1

t

7 Mean-Field Control for Improving Energy Efﬁciency

135

The value function J(cid:2)
i
equation

is known to satisfy the Hamilton–Jacobi–Bellman (HJB)

(cid:12)

(cid:8)

(cid:9)(cid:13)

@J(cid:2)
i
@t

C min

Hi

ui

Ti; ui;

@J(cid:2)
i
@Ti

D 0

(7.13)

with the boundary condition J(cid:2)
i
for (cid:15) 2 R

.Ti; t1/ D 0. The Hamiltonian in (7.13) is deﬁned

Hi.Ti; ui; (cid:15)/ WD ci.Ti; ui/ C (cid:15) .li.TiI F/ C bi.Ti/ui/

with

li.TiI F/ WD Nli.TiI F/ C di:

The optimal control in (7.13) is explicitly obtained as

u(cid:2)
i

.TiI F/ D (cid:3)

bi.Ti/
r

(cid:8)

@J(cid:2)
i
@Ti

(cid:9)

.TiI F/

:

Substituting (7.14) into (7.13), we obtain the HJB equation for J(cid:2)
i

.Ti; t/:

@J(cid:2)
i
@t

D

1
2

b2
i

.Ti/
r

(cid:8)

(cid:9)2

@J(cid:2)
i
@Ti

(cid:3) li.TiI F/

(cid:8)

(cid:9)

@J(cid:2)
i
@Ti

(cid:3)

(cid:12)T 2
i

:

1
2

(7.14)

(7.15)

7.3.2 Coupled Model

We now provide a complete description of the coupled model that is intended to
approximate the game model for large N. This model is based on the interaction
function F.t/ introduced in the preceding section. A value function J(cid:2).T; tI !/ for
the large N model is deﬁned by the following differential equation identical to the
HJB equation (7.15) for the single zone model.

(cid:8)

(cid:9)2

@J(cid:2)
@t

D

1
2

b2.T/
r

@J(cid:2)
@T

(cid:3) l.TI F/

(cid:8)

(cid:9)

@J(cid:2)
@T

(cid:3)

(cid:12)T 2:

1
2

The associated optimal feedback control law is then deﬁned by

u(cid:2).TI F/ D (cid:3)

(cid:8)

b.T/
r

@J(cid:2)
@T

(cid:9)

.TI F/

:

(7.16)

Given the feedback control law (7.16), the differential equation that deﬁnes the
evolution of the super-temperature NT is given by

NC PNT.t/ D .T0.t/ (cid:3) NT.t//= NR0 C NU.t/

(7.17)

S. Li et al.

(7.18)

(7.19)

(7.20)

136

where

Z

NU.t/ D N

. PQ.tI !/ C Cpau(cid:2).T.tI !/I F/.T s (cid:3) T.tI !///(cid:3).!/d!:

The only difference thus far is notational: J(cid:2)
i

.T; t/ is the value function for a
single zone with parameter !i, and J(cid:2).T; tI !/ is the value function for a large
number (continuum) of zones, distinguished by their own !. Such is the case
because we have assumed F.t/ is a known deterministic function that is furthermore
consistent across the population.

All that remains is to specify F.t/ in a self-consistent manner. The consistency
enforced here is inspired by the approximation given in (7.10). The two PDEs are
coupled through this integral that deﬁnes the relationship between the interaction
function F and the mean temperature NT:

F.t/ D NT.t/:

In summary, the coupled PDE model is given by: for t 2 Œt0; t1(cid:11),
(cid:8)

(cid:9)

(cid:8)

(cid:9)2

@J(cid:2)
@t

D

1
2

b2.T/
r

@J(cid:2)
@T

(cid:3) l.TI F/

@J(cid:2)
@T

(cid:3)

(cid:12)T 2

1
2

NC PNT.t/ D .T0.t/ (cid:3) NT.t//= NR0 C NU.t/

F.t/ D NT.t/

with boundary conditions

J(cid:2).T; t1I !/ D 0;

NT.t0/ D

.Ci= NC/Ti.t0/:

nX

iD1

Numerically, the optimal control may be obtained by iteratively solving the
backward–forward equations (7.18) and (7.19) over a given (sufﬁciently long) time-
horizon. A waveform relaxation algorithm for solving such equations appears in our
earlier paper [14]. In the following, we describe an approximate solution based on
the observation that the value function is known to approximately become a constant
for large terminating times [15]. One of the attractive features of the proposed
algorithm is that it yields a simple state-feedback law.

7.3.3 Approximate Local Optimal Control

In this section, we propose an approximation approach to the solution of coupled
PDE (7.18)–(7.20) by considering the equilibrium solutions.

7 Mean-Field Control for Improving Energy Efﬁciency

137

By setting @J(cid:2)=@t (cid:6) 0 and letting F D NT in (7.18), we consider the equilibrium

solution to (7.18):

(cid:8)

(cid:9)2

@J(cid:2)
@T

k.T/

(cid:8)

(cid:9)

@J(cid:2)
@T

(cid:3) 2m.T; NT/

(cid:3) n.(cid:12)T/ D 0

(7.21)

where we deﬁne

k.T/ WD b2.T/; m.T; NT/ WD rl.TI NT/; n.(cid:12)T/ WD r(cid:12)T 2:

Since T s (the temperature of supplied air) is always strictly less/more than T (the
temperature of zone) when cooling/heating, then we always have

k.T/ D .Cpa.T s (cid:3) T/=C/2 > 0:

Thus (7.21) is always a second order equation, which can be solved with two well-
deﬁned solutions:
(cid:8)

p

(cid:9)

@J(cid:2)
@T

D

˙

m.T; NT/
k.T/ ˙

m2.T; NT/ C k.T/n.(cid:12)T/
k.T/

:

For any T, (cid:12)T, and NT, we can check

(cid:8)

(cid:9)

@J(cid:2)
@T

(cid:8) 0;

C

(cid:8)

(cid:9)

@J(cid:2)
@T

(cid:5) 0:

(cid:3)

We would like to construct a “value function” bJ(cid:2) such that it is approximately
convex with respect to T with minimum achieved at (cid:12)T D T (cid:3) T set D 0. One
possible choice is

(cid:12)

@bJ(cid:2)
@T

D

.@J(cid:2)=@T/
C
.@J(cid:2)=@T/

(cid:3)

;
;

if (cid:12)T (cid:8) 0
if (cid:12)T < 0:

(7.22)

However, such a choice of .@bJ(cid:2)=@T/ is not a smooth function of T, and neither is
the associated control law (7.16). But the mass-ﬂow rate (the control) is usually
varied continuously to regulate the zone temperature for building system. To obtain
a smooth control law, here we consider a smooth approximation to the sign function,

sgn.x/ (cid:6) tan h.cx/ D

for

c (cid:7) 1:

(7.23)

1 (cid:3) e(cid:3)2cx
1 C e(cid:3)2cx

;

p

Then we modify (7.22) to obtain the following smooth approximation:

@bJ(cid:2)
@T

D

m.T; NT/
k.T/

C tan h.c(cid:12)T/

m2.T; NT/ C k.T/n.(cid:12)T/
k.T/

138

The approximate local optimal control law is chosen as

Ou(cid:2).TI NT/ D (cid:3)

 

@bJ(cid:2)
@T

b.T/
r

!

.TI NT/

:

By setting PNT (cid:6) 0 in (7.19) and substituting (7.24) into (7.19), we can obtain the
equilibrium solution NT s > 0 by solving a second order equation (we omit the details
here). Finally, the stationary local optimal control law is given by

Ou(cid:2);s.T/ D (cid:3)

 

@bJ(cid:2)
@T

b.T/
r

!

.TI NT s/

:

S. Li et al.

(7.24)

(7.25)

7.4 Mean-Field Control of Linearized System

In this section, we describe an optimal control law based on linearizing the building
model along its nominal trajectory. Note that the nominal values of state (the zone
temperatures) and control (the mass-ﬂow rates) can be directly measured in practice.
By assuming the nominal state and the control values T o and uo, we lin-

earize (7.11) and obtain the following linearized model: for i D 1; : : : ; N,

PTi D QaiTi C Qbiui C Qli.F/ C di

where we deﬁne the following quantities:

Qai WD (cid:3)1=(cid:4)i (cid:3) Cpauo
i

=Ci;

Qbi WD Cpa.T s (cid:3) T o
i

/=Ci;

Qli.F/ WD F=(cid:4)i C CpaT o

i uo
i

=Ci:

We consider the same cost function (7.12) for each zone node. The local optimal
control for the ith zone is explicitly obtained as:

where Qpi is the positive solution to the Ricatti differential equation

u(cid:2)
i

.TiI F/ D (cid:3)

.QpiTi (cid:3) Qgi/

Qbi
ri

PQpi D (cid:3)2Qpi Qai C Qb2

i Qp2

i

=r (cid:3) 1

with the boundary condition Qpi.t1/ D 0, and Qgi is the solution of the linear
differential equation

PQgi D (cid:3).Qai (cid:3) Qb2

i Qpi=r/Qgi (cid:3) T set

i C Qpi.Qli.F/ C di/

with the boundary condition Qgi.t1/ D 0.

Similarly to Sect. 7.3.2, we can obtain the coupled PDE model by letting F.t/ (cid:6)
NT.t/. We consider the case that zone parameters are drawn from certain distribution

7 Mean-Field Control for Improving Energy Efﬁciency

139

(cid:3).!/ and consider the reduced model (7.17) to evolve NT. As before, we can also ﬁnd
the approximate local optimal control by considering the equilibrium solutions:

0 D (cid:3)2QpQa C Qb2 Qp2=r (cid:3) 1;
0 D (cid:3).Qa (cid:3) Qb2 Qp=r/Qg (cid:3) T set C Qp.Ql. NT/ C d/;

which leads to the following equilibrium solutions
p

r Qa C

Qps D

r2 Qa2 C r Qb2
Qb2

;

Qgs. NT/ D

Qps.Ql. NT/ C d/ (cid:3) T set
Qa (cid:3) Qb2 Qps=r

:

The approximate local optimal control is then chosen as:

Ou(cid:2).TI NT/ D (cid:3)

(cid:4)
QpsT (cid:3) Qgs. NT/

(cid:5)

:

Qb
r

By substituting (7.26) into (7.19), we can obtain the equilibrium solution NT s, and
therefore the stationary local optimal control law Ou(cid:2);s.T/.

7.5 Simulation and Discussion

7.5.1 Basic Setup

Simulations are carried out for the four-zone building shown in Fig. 7.1: All four
zones/rooms have an equal ﬂoor area of 5 m (cid:4) 5 m and each wall is 3 m tall, which
provides a volumetric area of 75 m3 for each room. Room 1 has a small window
(5 m2) on the north facing wall, whereas rooms 2 and 4 have larger windows (7 m2
each) on the east facing wall. Room 3 does not have a window.

The RC-network representation of the four-zone building has totally 36 building
nodes plus 1 outside node [9]. Each building node is assigned with a thermal
capacitance, two adjacent nodes are connected with a thermal resistance. The
windows are modeled as single resistors since they have relatively little capacitance.
The values of the capacitances and resistances are obtained from Carrier’s Hourly
Analysis Program [16]. The HVAC system used for simulation is designed to
supply maximal mass ﬂow rate of 0:25 kg/s per zone. The mass-ﬂow rate min
for
i
i D 1; : : : ; 4 for four zones can be adjusted based on designed control laws. The
supplied air temperature is ﬁxed at T s D 12:8ıC. Here we assume there is no
return air and 100 % of the outside air is sent to chiller. Number of people in
each zone is uniformly generated as a random integer ranging between 0 and 4.
Outside temperature and outside solar radiation data is obtained for a summer day
(05=24=1996) of Gainesville, FL [17]. The outside temperature and the heat gain
(due to solar radiation and people occupancy) of each zone are depicted in Fig. 7.3a,
b, respectively.

S. Li et al.

Q1
Q2
Q3
Q4

140

a

i

)
s
u
c
e
c
(

l

 
0
T

34

32

30

28

26

24

22

a

i

)
s
u
c
e
C

l

(
 

T

24

22

1

20

i

)
s
u
c
e
C

l

(
 

T

21

3

24

23

22

20

19

Tset
1
TPI
1
TMF
1

Tset
3
TPI
3
TMF
3

b

)
c
e
s
/
J
K

(
 

Q

4

3

2

1

b

)
c
e
s
/
g
K

(
 

m

0.25

0.2

0.15

n
1i

0.1

0.05

0.25

0.2

0.15

)
c
e
s
/
g
K

(
 

m

n
3i

0.1

0.05

0

5

10

15
Time (hour)
Outside temperature.

20

24

0

0

5

20

24

10

15
Time (hour)
Heat gains.

Fig. 7.3 Exogenous inputs for a 24-h period in Gainesville, FL: (a) outside temperature and
(b) heat gains of each zone

18

0

5

20

24

18

0

5

15

10
Time (hour)

15

10
Time (hour)

20

24

0

0

5

15

10
Time (hour)

20

24

0

0

5

15

10
Time (hour)

20

24

PI control
MF control

PI control
MF control

Tset
2
TPI
2
TMF
2

Tset
4
TPI
4
TMF
4

24

22

i

)
s
u
c
e
C

l

(
 

T

2

20

i

)
s
u
c
e
C

l

(
 

T

21

4

24

23

22

20

19

PI control
MF control

PI control
MF control

0.25

0.2

0.15

)
c
e
s
/
g
K

(
 

m

n
2i

0.1

0.05

0.25

0.2

0.15

)
c
e
s
/
g
K

(
 

n
4i

m

0.1

0.05

0

5

20

24

0

5

15

10
Time (hour)

15

10
Time (hour)

20

24

0

0

5

15

10
Time (hour)

20

24

0

0

5

15

10
Time (hour)

20

24

Fig. 7.4 Comparison results of (a) zone temperatures and (b) zone mass-ﬂow rates for using PI
control law and mean-ﬁeld control law with r D 10

Numerical results presented in the following are obtained using ode45 function
in Matlab for 24 h with the time step size chosen as 10 min. All temperatures of the
building nodes are initialized at 24ıC, respectively. The desired zone temperatures
for i D 1; : : : ; 4 are varying with time and are depicted as solid lines in Figs. 7.4
T set
i
and 7.5. In the following, we apply the mean-ﬁeld and PI control laws to regulate
zone temperatures to track the desired values.

7.5.2 Simulation Results

To compare performance of the proposed controller with existing control algorithms
commonly used in commercial buildings, we consider the following decentralized
PI control law: for i D 1; : : : ; 4,

min
i

.t/ D Kp(cid:12)Ti.t/ C Ki

(cid:12)Ti.s/ds

(7.26)

Z

t

0

7 Mean-Field Control for Improving Energy Efﬁciency

141

a

i

)
s
u
c
e
C

l

(
 

T

24

22

1

20

i

)
s
u
c
e
C

l

(
 

T

24

23

22

20

19

21

3

Tset
1
TPI
1
TMF
1

Tset
3
TPI
3
TMF
3

Tset
2
TPI
2
TMF
2

Tset
4
TPI
4
TMF
4

24

22

i

)
s
u
c
e
C

l

(
 

2
T

20

i

)
s
u
c
e
C

l

(
 

T

24

23

22

20

19

21

4

b

)
c
e
s
/
g
K

(
 

m

n
1i

0.1

0.25

0.2

0.15

0.05

0

0

0.25

0.2

0.15

0.05

0

0

)
c
e
s
/
g
K

(
 

m

n
3i

0.1

PI control
MF control

PI control
MF control

0.25

0.2

0.15

)
c
e
s
/
g
K

(
 

m

n
2i

0.1

0.05

0.25

0.2

0.15

)
c
e
s
/
g
K

(
 

n
4i

m

0.1

0.05

18

0

5

10
Time (hour)

15

20

24

18
0

5

10
Time (hour)

15

20

24

5

15

10
Time (hour)

20

24

0

0

5

15

10
Time (hour)

20

24

PI control
MF control

PI control
MF control

0

5

10
Time (hour)

15

20

24

0

5

10
Time (hour)

15

20

24

5

15

10
Time (hour)

20

24

0

0

5

15

10
Time (hour)

20

24

Fig. 7.5 Comparison results of (a) zone temperatures and (b) zone mass-ﬂow rates for using PI
control law and mean-ﬁeld control law with r D 60

where the tuned proportional gain Kp D (cid:3)0:00005, the tuned integration gain
Ki D 0:0001, and the temperature tracking error (cid:12)Ti WD T set
i (cid:3) Ti. We next compare
the performance of the mean-ﬁeld control law introduced in this chapter with that
of the PI controller.

The mean-ﬁeld control is implemented based on the stationary nonlinear pol-
icy (7.25). For the four-room building, we only consider the one super-node reduced
model (7.6). The control performance becomes slightly better by adding more super-
nodes into the reduced model. One may expect larger performance improvement by
considering more super-nodes for more complex building topologies.

First, we take r D 10 in the individual cost function (7.9). We take c D 5 for
smooth approximation of sign function in (7.23). We apply stationary local control
law (7.25) and PI control law (7.26) to each zone, respectively. The comparison
results of simulated zone temperatures are depicted in Fig. 7.4a. The comparison
results of mass-ﬂow rates associated with two control laws are depicted in Fig. 7.4b.
We observe that the mean-ﬁeld control has better temperature tracking performance
than that for PI control (see Fig. 7.4a).

The total energy consumption of each zone can be computed based on the
mass-ﬂow rate entering each zone [8]. Here the total energy consumption is the
combination of fan power and the chiller power consumptions. For PI control law,
the total energy consumption (kWh) for each zone is 69:3, 72:5, 45:2, and 55:9,
and the total energy consumption for all four zones is 242:9; For mean-ﬁeld control
law, the total energy consumption for each zone is 59:6, 38:9, 34:0, and 47:7, and
the total energy consumption for all four zones is 179:2. In this case, the mean-ﬁeld
control thus reduces total energy consumption by 25 % over the PI control.

Then, we take r D 60 in the cost function (7.9). The comparison results of
simulated zone temperatures are depicted in Fig. 7.5a. The comparison results of
mass-ﬂow rates associated two control laws are depicted in Fig. 7.5b. For mean-ﬁeld
control law, the total energy consumption (kWh) for each zone is 45:9, 52:1, 30:0,
and 37:7, and the total energy consumption for all four zones is 165:7. We observe

142

S. Li et al.

that the temperature tracking performance for mean-ﬁeld control is slightly worse
than that for PI control (see Fig. 7.5a). But in this case the mean-ﬁeld control reduces
energy consumption by 31 % over the PI control, larger than in the previous case
(compare Fig. 7.4b with Fig. 7.5b). This is due to a larger control penalty parameter
r.

The simulation results for linearized control policy (7.26) are omitted in this
chapter on account of space. In simulations, the linearized policy consumes
more energy while maintaining comparable temperature tracking performance, as
compared to the nonlinear control policy (7.25). These inefﬁciencies may be due to
the unmodeled nonlinearities. We plan to study this in our future work.

7.6 Conclusions and Future Directions

In this chapter, we develop the mean-ﬁeld methodology as a means to mitigate
complexity associated with large-scale control problems in buildings. Rather than
solving the large-scale centralized problem, we explore distributed game-theoretic
solution approaches that work by optimizing with respect to the mean-ﬁeld.
Simulation results show that the proposed mean-ﬁeld scheme achieves compara-
ble temperature tracking performance while reducing energy consumption in the
operation of HVAC systems. Moreover, the tradeoff between tracking performance
and the energy savings can be made by adjusting the control penalty parameter in
the mean-ﬁeld scheme.

To help deal with uncertainty and time variations in building dynamics, we plan
to next develop adaptation schemes for mean-ﬁeld control based on approximate
dynamic programming principles [14, 15]. We also plan to incorporate effects of
humidity and ventilation requirements in computing the optimal controls for the
HVAC system. We are also working on accurate model of convection effects in
building thermal dynamics [18]. By considering the stronger inter-zone interactions
arising from convection, we could probably save even more energy for operating
HVAC systems.
Abstract This chapter presents a uniﬁed pseudospectral computational framework
for accurately and efﬁciently solving optimal control problems (OCPs). Any
continuous-time OCP is converted into a nonlinear programming (NLP) problem
via pseudospectral transformation. Through using pseudospectral method, both
states and controls are approximated by global Lagrange interpolating polynomials
at Legendre–Gauss–Lobatto (LGL) collocation points. The mapping relationship
between the costates of OCP and the KKT multipliers of NLP is derived for
checking the optimality of solutions. Besides, a quasi-Newton iterative algorithm
is integrated to accurately calculate the LGL points for engineering practice, and
a multi-phase preprocessing strategy is proposed to handle non-smooth problems.
We use a general solver called Pseudospectral Optimal control Problem Solver
(POPS), which is developed in Matlab environment to implement the computational
framework. The classic vehicle automation problem, i.e., optimal path planning in
an overtaking scenario, is formulated to demonstrate the effectiveness of POPS.

Keywords Optimal control (cid:129) Nonlinear system (cid:129) Constrained system

8.1 Introduction

Nowadays, road vehicles have continuously developed in terms of automation,
electriﬁcation, and hybridization, driven by the demands on comfort, safety, and
efﬁciency [1]. And now one common question is how to design optimal strategies
to maximally enhance some performances of road vehicles. But there are some
difﬁculties such as the nonlinearity and uncertainty of vehicle dynamics, limited
computing resources of control units, and time-varying road/trafﬁc conditions,
and so on. Because of existing these difﬁculties, this question becomes more
challenging. In automotive engineering, typical optimal control examples include
power management for HEVs/EVs [2], optimal control for active suspensions [3],
trajectory optimization for automated vehicles [4], and fuel optimized eco-driving
assistance [5], etc.

The power management for HEV is to optimize the power distributions between
thermal and electrical paths dynamically to achieve energy-saving for vehicle
driving. Active suspensions are aimed at obtaining optimal performance of ride and
handling through dynamically manipulating stiffness and damping of suspensions
in response to vehicle motions and road conditions. The trajectory planning for
automated vehicles is focused on the real-time optimization of vehicle routes to
achieve the assigned driving tasks [4]. The fuel optimized eco-driving assistance is
to reduce the fuel consumption by dynamically adjusting throttle angle, transmission
gear ratio, and brake pressure in accordance with constraints on trafﬁc conditions,
road conditions, and the ability of vehicles [5].

Essentially, the aforementioned optimal strategies need to structure correspond-
ing optimal control problems (OCPs). That is, it intends to minimize the given
performance index of a dynamic system by manipulating control inputs. The main
methods to obtain optimal strategies for both ICE-based and e-Powertrain-based
road vehicles consist of traditional direct method (TDM), Pontryagin’s minimum
principle, and dynamic programming [6–8].

Pontryagin’s minimum principle falls into the category of indirect methods. It
gives the ﬁrst-order necessary condition in the form of boundary value problems.
But this method is unable to acquire the optimal solutions, when dealing with
nonlinearities and complex constraints [9]. Dynamic programming is widely used in
OCPs that are difﬁcult to get the analytical solution, however this method exists the
curse of dimensionality and has low computational efﬁciency [8]. The TDMs, such
as shooting methods and collocation methods, are also widely applied to address
complex problems in automation, hybridization, and electriﬁcation of road vehicles.
Compared to the TDMs, the pseudospectral (PS) method is more attractive
due to its merits on high accuracy, lower sensitivity to initial value, and faster
convergence [10]. Over the last few years, PS methods, in particular the Legendre
PS method, have been extensively used to solve a broad class of OCPs arising in
the trajectory optimization and real-time control of systems governed by ordinary
differential equations. In 1995, Elnagar et al. ﬁrst introduced the concept of PS
method into optimal control community [11]. Since 2000, Fahroo, Ross, Gong,
Rao et al. intensively studied the PS method, and obtained a series of important
achievements, e.g., the existence of optimal solution, covector mapping theorem,
convergence rate theorem, and principles for choosing the consistency parameter
and the interpolation weight function [12–14]. The PS method is to approximate
state and control variables via a ﬁnite order of global interpolating polynomials
and convert the OCP into a nonlinear programming (NLP) problem at orthogonal
collocation points [10, 11]. The formulated NLP problem has been shown to

8 Pseudospectral Optimal Control of Constrained Nonlinear Systems

147

converge to the original OCP in spectral accuracy. For any inﬁnitely differentiable
function, the spectral accuracy is O .N(cid:3)m/ for every m 2 ZC, where N denotes Nth
order approximation. For any analytic function, the convergence will be faster at the
rate of (cN) for some constant 0 < c < 1 [15].

In recent years, the PS method has been successfully applied to problems in
aerospace engineering. Some PS-based OCP solvers are also commercially, e.g.,
DIDO by Ross et al. [16], GPOPS by Rao et al. [17], PSOPT by Becerra et al.
[18], and PROPT by Tomlab Optimization [19]. There are several commonly used
PS methods: Chebyshev pseudospectral method (CPM), Legendre pseudospectral
method (LPM), Gauss pseudospectral method (GPM), and Radau pseudospectral
method (RPM). The CPM employs Chebyshev–Gauss–Lobatto points to discretize
states/inputs and uses Chebyshev polynomials to approximate the state and control,
and adopts Clenshaw–Curtis quadrature for numerical integration. Other three
methods, i.e., the LPM, GPM, and RPM, use Lagrange interpolating polynomials
to approximate states and control variables and Gaussian integral to calculate cost
functions. The selection process of collocation points is the major difference among
the three methods, but all three kinds of points are calculated based on Legendre
polynomial [11, 20]. According to these studies, we know the performance of
LPM, RPM, and GPM. Gauss and Radau methods have similar computational
accuracy, and they have better costate estimation capabilities than Legendre method.
However, the Legendre method has better performance for OCPs with ﬁxed
boundary conditions, while Gauss and Radau methods may not converge in some
situations [10].

In this chapter, we develop a uniﬁed computational framework and software
package aiming to efﬁciently calculate different types of OCPs arising from
automotive engineering. The computational framework is based on LPM and three
new improvements:

1. Performing the costate estimation for a more general OCP with a Bolza-type

performance index and both equality and inequality constraints;

2. Adopting a quasi-Newton iterative algorithm to efﬁciently calculate collocation

points;

3. Proposing a method to segment and transform non-smooth problems.

8.2 Computational Framework of Legendre

Pseudospectral Method

In automotive engineering, we need to ﬁnd an optimal control law u.t/ 2 RNu to
obtain the minimum designed performance index. For example, we usually choose
the engine torque or acceleration as the control inputs and seek for an optimal
solution to minimize fuel consumption for a speciﬁc driving task in economical
automation systems. Other similar problems include the charging/discharging man-
agement of batteries, energy distributions for HEVs, optimizations of the stiffness
and resistance for active suspensions, and path planning for automated vehicles.

148

S.E. Li et al.

8.2.1 General Bolza-Type OCP

The problem considered here can be expressed as a general Bolza-type OCP with
terminal constraints, equality and inequality path constraints:

J D ¿

min
u.t/

(cid:4)
x

(cid:4)

(cid:5)

tf

; tf

(cid:5)

C

Z

tf

t0

G .x.t/; u.t/; t/dt

subject to

'

(cid:4)

(cid:5)

:
x.t/ D f .x.t/; u.t/; t/ ;
(cid:5)
(cid:4)
x .t0/ ; x
tf
Ceq .x.t/; u.t/; t/ D 0;
Cinq .x.t/; u.t/; t/ (cid:5) 0;

; t0; tf

D 0;

(8.1)

where t 2 R denotes the time, x 2 RNx denotes the state vector, u 2 RNu denotes
the control vector, f((cid:2)) denotes the state space function, ¿ .(cid:2) / denotes the Mayer
performance index, G((cid:2)) denotes the Lagrange performance index, '((cid:2)) denotes
the initial and terminal constraints, and Ceq((cid:2)) and Cinq((cid:2)) denote the equality and
inequality path constraints, respectively.

8.2.1.1 Calculation Steps by LPM

Using the pseudospectral transformation, we approximate both state and control
variables by Lagrange interpolating polynomials at the LGL points. The state space
equations are represented as equality constraints. The integral of cost function is
calculated by the Gauss–Lobatto quadrature rule. Then, the OCP is converted into an
NLP problem, which can be solved by available optimization solvers. The detailed
framework is described below.

Step 1: Time-Domain Transformation

To simplify the problem, we ﬁrst transform the time domain [t0, tf ] to the canonical
interval Œ(cid:3)1; 1(cid:11):

(cid:4)
2t (cid:3) tf (cid:3) t0

(cid:5)

(cid:5)

(cid:4)
tf (cid:3) t0

=

(cid:4) D

; (cid:4) 2 Œ(cid:3)1; 1(cid:11)

(8.2)

Step 2: Collocation and Discretization

For pseudospectral methods, the collocation points often come from the roots
of orthogonal polynomials, which help avoid the Runge phenomenon. Let PN((cid:4))
denote the N-order Legendre polynomials [11], deﬁned as

8 Pseudospectral Optimal Control of Constrained Nonlinear Systems

PN .(cid:4)/ D

(cid:4)

1
2NNŠ

dN
d(cid:4) N

(cid:5)N

(cid:4) 2 (cid:3) 1

(cid:5)

:
The LGL points are deﬁned as (cid:4)0 D (cid:3)1, (cid:4)N D C1, and (cid:4) k being the roots of
PN .(cid:4)/
for k D 1; 2; : : : ; N (cid:3) 1. Clearly, these .N C 1/ LGL points are also the roots of
(cid:4)
1 (cid:3) (cid:4) 2
PPN .(cid:4)/. Accurate calculation of LGL points is important to successfully
implement the pseudospectral transformation. However, there is no explicit formula
to compute the roots of

:
PN .(cid:4)/.

The state vector x((cid:4)) and control vector u((cid:4)) are discretized at points
f(cid:4) 0, (cid:4) 1, : : : , (cid:4) Ng. The discretized state vectors are denoted by fX0, X1, : : : , XNg and
the discretized control vectors are denoted by fU0, U1, : : : , UNg, where Xi D x .(cid:4)i/
and Ui D u .(cid:4)i/. Then we approximate x((cid:4)) and u((cid:4)) by

x .(cid:4)/ (cid:6) X .(cid:4)/ D

Li .(cid:4)/ Xi;

u .(cid:4)/ (cid:6) U .(cid:4)/ D

Li .(cid:4)/ Ui;

NX

iD0
NX

iD0

Li .(cid:4)/ D

NY

(cid:4)

(cid:5)

(cid:5)

(cid:4)
(cid:4)i (cid:3) (cid:4)j

=

(cid:4) (cid:3) (cid:4)j

jD0;j¤i

where Li((cid:4)) denotes the Lagrange interpolating basis function

Step 3: Transformation of State Space Equation

The states are approximated by interpolating polynomials. Then, the differential
operation of states is approximated by the differential operation on Lagrange bases,
denoted as

:
x .(cid:4)k/ (cid:6)

:
X .(cid:4)k/ D

:
Li .(cid:4)k/ Xi D

DkiXi;

(8.6)

NX

iD0

NX

iD0

where k D 0; 1; 2; : : : ; N and D D fDkig 2 R.NC1/(cid:6).NC1/ denote the differentiation
matrix [10], deﬁned as

8
ˆˆˆ<
ˆˆˆ:

PN .(cid:4)k/
PN.(cid:4)i/.(cid:4)k(cid:3)(cid:4)i/ ;
(cid:3)N .N C 1/ =4;
N .N C 1/ =4;
0;

otherwise

i ¤ k
i D k D 0
i D k D N

:

Dki D

149

(8.3)

(8.4)

(8.5)

(8.7)

150

S.E. Li et al.

Then the state space equation can be converted as the following .N C 1/ equality
constraints at LGL points,

NX

iD0

DkiXi (cid:3)

tf (cid:3) t0
2

f ŒXk; Uk; (cid:4)k(cid:11) D 0

(8.8)

Step 4: Transformation of Performance Index

The performance index is transformed using the Gauss–Lobatto quadrature rule,

J D ¿ .XN; (cid:4)N/ C

wkG .Xk; Uk; (cid:4)k/ ;

(8.9)

tf (cid:3) t0
2

NX

kD0

where w denotes the integration weight, deﬁned as

wk D

lk .(cid:4)/d(cid:4) D

Z 1

(cid:3)1

2

N .N C 1/ P2
N

.(cid:4)k/

The Gauss–Lobatto quadrature is critical to the accuracy of transforming the

integral. The residual in Gauss–Lobatto quadrature is [21]

RNC1 D

(cid:3) .N C 1/ N322NC1..N (cid:3) 1/Š/4
.2N C 1/ ..2N/Š/3

G2N .(cid:13)/

Thus, by using .N C 1/ LGL points, the quadrature residual is equal to zero for any
polynomials with order less than .2N (cid:3) 1/.

Step 5: OCP to NLP Problem Conversion

Using the aforementioned steps, we can convert the OCP to the following NLP
problem, i.e.,

J D ¿ .XN; (cid:4)N/ C

min
Xk;Uk

wkG .Xk; Uk; (cid:4)k/ ;

tf (cid:3) t0
2

NX

kD0

subject

(8.10)

(8.11)

(8.12)

(cid:14)
(cid:14)
(cid:14)
(cid:14)
(cid:14)

NX

iD0

DkiXi (cid:3) tf (cid:3)t0
2

f .Xk; Uk; (cid:4)k/

(cid:14)
(cid:14)
(cid:14)
(cid:14)
(cid:14)
1
k' .X0; XN; (cid:4)0; (cid:4)N/k1 (cid:5) ı;
(cid:14)
(cid:14)
(cid:14)Ceq .Xk; Uk; (cid:4)k/
(cid:14)
1 (cid:5) ı;

Cinq .Xk; Uk; (cid:4)k/ (cid:5) 0;

(cid:5) ı;

8 Pseudospectral Optimal Control of Constrained Nonlinear Systems

151

where k; i D 0; : : : ; N. The equality constraints are imposed at all points including
two endpoints. A scalar ı is used to relax the equality constraints to avoid
infeasibility. The scalar ı can be selected as [13]

ı D .N (cid:3) 1/˛(cid:3)m;

(8.13)

where m implies that the optimal state variable has continuous .m (cid:3) 1/ th order
classical derivatives, ˛ is usually set as 3/2 [13]. There are .Nx C Nu/ (cid:4) N variables
to be optimized in the NLP problem Eq. (8.12). For non-ﬁxed terminal time tf , we
can also take tf as an additional variable to be optimized. The converted NLP is a
high-dimensional and sparse problem. Some known sparse NLP solvers can be used
to solve this kind of problem, like SNOPT used here.

8.3 Implementation of Pseudospectral Method

We present the costate estimation with both equality and inequality constraints
for the deﬁned Bolza-type OCP. Because the computation of LGL points has no
explicit expression, here we propose to adopt the quasi-Newton iterative algorithm
to numerically calculate the collocation points. For non-smooth problems, we use
a multi-phase preprocessing strategy to improve the approximation accuracy of the
pseudospectral method. In addition, we build a Matlab environment-based solver,
i.e., Pseudospectral Optimal control Problem Solver (POPS) to solve the problem.

8.3.1 Costate Estimation

The costate of OCPs is important to evaluate the optimality of solutions. But
direct methods cannot provide explicit expressions of costate variables. Ross et al.
suggested that there is a mapping relationship between costate variables of the
original OCP and KKT multipliers of the associated NLP [12]. This mapping
relationship can be used to compute the costate variables indirectly from the KKT
multipliers. In the following, we will derive the mapping relationship for Bolza-type
OCP as shown in Eq. (8.1).

First, we construct the Hamiltonian for the OCP:

H D

tf (cid:3) t0
2

(cid:4)
G C (cid:3)Tf

(cid:5)

C (cid:2)T

eqCeq C (cid:2)T

inqCinq;

(8.14)

eq 2 RNCeq , (cid:2)

where (cid:3) 2 RNx; (cid:2)
inq 2 RNCinq are costate variables of the OCP
corresponding to the state space model, equality path constraints, and inequality
path constraints. According to the ﬁrst-order optimality condition, we have the
following differential equation:

152

:
(cid:3) .(cid:4)k/ D (cid:3)

(cid:8)

(cid:9)

@H
@x

.(cid:4)k/ D 0:

S.E. Li et al.

(8.15)

Since

:
(cid:3) satisﬁes P(cid:3) .(cid:4)k/ D

XN

Dki(cid:3) .(cid:4)i/, then

"

(cid:8)

(cid:9)
T

@G
@x

C

@f
@x

tf (cid:3) t0
2

iD0
#

(cid:8)

(cid:3) .(cid:4)k/

C

(cid:9)
T

@Ceq
@x

(cid:2)

eq C

(cid:9)
T

(cid:8)

@Cinq
@x

(cid:2)

inq D (cid:3)

Dki(cid:3) .(cid:4)i/

NX

iD0

(8.16)

After applying the pseudospectral transformation, the Lagrangian function of

associated NLP is given by

QJ D ¿ C

wiGi C QvT'

tf (cid:3) t0
2

NX

iD0

NX

h

(cid:2)

Q(cid:15)T
i

tf (cid:3) t0
2

fi (cid:3)

(cid:3)

:
Xi

C

iD0

C Q(cid:6)T

eq;iCeq;i C Q(cid:6)T

inq;iCinq;i

(8.17)

i

where Q(cid:3);
inq
conditions for a generic NLP, we have

; Q(cid:2)

Q(cid:2)

eq

; Qv are the KKT multipliers of the NLP. According to the KKT

@QJ
@Xk

D 0;

@QJ
@Uk

D 0;

Ceq;k D 0;

Q(cid:2)T

inq;kCinq;k D 0

(8.18)

The partial derivatives of QJ with respect to Xk are given below for k D 1; : : : ; N (cid:3) 1:
(cid:9)
T

(cid:9)
T

 

!

(cid:8)

(cid:8)

@QJ
@Xk

D

tf (cid:3) t0
2

wk C

Q(cid:3)k

C

@f k
@Xk

@Ceq;k
@Xk

Q(cid:2)

eq;k

(cid:8)

C

@Cinq;k
@Xk

Q(cid:2)

inq;k (cid:3)

@
@Xk

NX

iD0

:
Xi D 0

Q(cid:3)T
i

(8.19)

@Gk
@Xk
(cid:9)
T

Where

 

!

@
@Xk

NX

iD0

:
Xi D

Q(cid:3)T
i

NX

iD0

Q(cid:3)T
i

@
@Xk

NX

nD0

NX

iD0

DinXn

D

Dik Q(cid:3)i

(8.20)

On the other hand, by considering

wiDik D (cid:3)wkDki;
Dik D Dki D 0;

i ¤ k

i D k

(8.21)

8 Pseudospectral Optimal Control of Constrained Nonlinear Systems

153

We have

tf (cid:3) t0
2

"

@Gk
@Xk

C

(cid:8)

(cid:9)

@f k
@Xk

T Q(cid:3)k
wk

#

(cid:8)

C

@Ceq;k
@Xk

(cid:9)

T Q(cid:2)

eq;k
wk

(cid:9)

T Q(cid:2)

(cid:8)

C

@Cinq;k
@Xk

inq;k
wk

D (cid:3)

Dki

NX

iD0

Q(cid:3)i
wi

(8.22)

By comparing Eq. (8.22) with Eq. (8.16), we know that if two equations are
equivalent, we must have

(cid:3) .(cid:4)k/ D

k D 1; (cid:2) (cid:2) (cid:2) ; N (cid:3) 1:

(8.23)

Q(cid:3)k
wk

;

Eq. (8.23) provides the mapping relations between (cid:3)((cid:4) k) and Q(cid:3)k for kD1; : : : ; N(cid:3)1.
For k D 0; N, we need to consider the effects of Mayer function ¿ and constraint
' to derive mapping relations for (cid:3)(t0) and (cid:3)(tN). The partial derivative of QJ with
respect to X0 is given by:
"

#

tf (cid:3) t0
2

@G0
@X0

w0 C

(cid:8)

(cid:9)
T

@f 0
@X0

(cid:9)
T

(cid:8)

@Ceq;0
@X0

Q(cid:2)

eq;0

(cid:9)
T

(cid:8)

C

@Cinq;0
@X0

Q(cid:2)

inq;0 C

Q(cid:3)0

C

(cid:8)

(cid:9)
T

@'
@X0

NX

iD0

Qv (cid:3)

Di0 Q(cid:3)i D 0

(8.24)

Since

Then

wiDi0 D (cid:3)w0D0i
D00 D (cid:3)1= .2w0/

i ¤ 0;
i D 0:

NX

iD0

Di0 Q(cid:3)i D (cid:3)w0

D0i

(cid:3)

NX

iD0

Q(cid:3)i
wi

Q(cid:3)0
w0

Thus, we have

"

(cid:8)

(cid:9)

#

(cid:8)

tf (cid:3) t0
2

@G0
@X0

C

@f 0
@X0

(cid:9)

T Q(cid:2)

(cid:9)

T Q(cid:2)

(cid:8)

@Cinq;0
@X0

inq;0
w0

eq;0
w0

C

T Q(cid:3)0
w0

 

Q(cid:3)0
w0

C

(cid:8)

C

@Ceq;0
@X0
(cid:9)
T

@'
@X0

!

Qv0

D (cid:3)

D0i

(cid:3)

Q(cid:3)i
wi

1

w0

NX

iD0

(8.25)

(8.26)

(8.27)

154

S.E. Li et al.

Similar arguments hold when considering the partial derivative of QJ with respect
to XN:

tf (cid:3) t0
2

"

(cid:8)

(cid:9)

@GN
@XN

C

@f N
@XN

(cid:9)

T Q(cid:2)

#

(cid:8)

C

T Q(cid:3)N
wN

 

@Ceq;N
@XN
(cid:8)

D (cid:3)

DNi

C

Q(cid:3)i
wi

1

wN

Q(cid:3)N
wN

(cid:3)

@¿
@XN

(cid:3)

@'
@XN

NX

iD0

eq;N
wN
(cid:9)
T

C

!

QvN

(cid:9)

T Q(cid:2)

(cid:8)

@Cinq;N
@XN

inq;N
wN

(8.28)

By comparing Eq. (8.27) with Eq. (8.16), we know that if two equations are
equivalent, the term containing (cid:3)(t0) in Eq. (8.16) must be equal to the term
containing Qv0 and Q(cid:3)0 in Eq. (8.27), i.e., (cid:3)(t0) depends on both Qv0 and Q(cid:3)0. Thus,
we cannot establish the mapping relation between (cid:3)(t0) and Q(cid:3)0 without additional
imposed conditions. Similar arguments also hold true for the mapping relation
between (cid:3)(tN) and Q(cid:3)N. However, there is a feasible solution when closure conditions
with feasibility tolerance are added [22]. Here we add a set of closure conditions to
establish the mapping relationship for (cid:3)((cid:4) 0) with respect to Q(cid:3)0; Qv0, and (cid:3)((cid:4) N) with
respect to Q(cid:3)N; Qvf . Equations (8.29) and (8.30) are newly added closure conditions:

Then we obtain the relation mapping for k D 0; N:

Q(cid:3)0
w0

C

(cid:8)

(cid:9)
T

@'
@XN

(cid:8)

Q(cid:3)N
wN

(cid:3)

@¿
@XN

(cid:3)

@'
@XN

Qv0 D 0;

(cid:9)
T

Qvf D 0:

(cid:3) .t0/ D

; (cid:3) .tN/ D

Q(cid:3)0
w0

Q(cid:3)N
wN

(cid:2)
(cid:2)

eq

inq

.tk/ D Q(cid:2)
.tk/ D Q(cid:2)

=wk;
=wk:

eq;k

inq;k

(8.29)

(8.30)

(8.31)

(8.32)

By considering the partial derivatives of QJ with respect to Uk for k D 0; (cid:2) (cid:2) (cid:2) ; N, we
can similarly derive the following conditions:

In summary, Eqs. (8.23), (8.31), and (8.32) establish the mapping relations
between the costate variables of OCP and the KKT multipliers of the associated
NLP, which provides an indirect way to examine the optimality of optimal solutions.

8 Pseudospectral Optimal Control of Constrained Nonlinear Systems

155

8.3.2 Numerical Calculation of Collocation Points

:
PN .(cid:4)/, the accuracy of directly solving
Due to implicit expression for the roots of
PPN .(cid:4)/ through Legendre polynomials is very low. So, here we adopt the quasi-
PPN .(cid:4)/. The quasi-Newton
Newton algorithm to iteratively compute the roots of
method includes two main parts: choosing an initial guess and designing an updating
law. We chose the initial guess for iteration as the poles of N-order Chebyshev
polynomial that has explicit mathematical representation to efﬁciently compute the
roots of (N C 1) order polynomial g .z/ D

(cid:4)
1 (cid:3) z2

(cid:5) :
PN .z/,
o

n

ˇ
ˇ
ˇ (cid:19)k D cos . k=N/

(cid:19)k

z0 D

(8.33)

(8.34)

(8.35)

(8.36)

where k D 0; 1; : : : ; N. The updating law is designed as

znC1 D zn (cid:3) (cid:12)zn

where n denotes the step index, (cid:12)zn is the length of each iteration. The Legendre
polynomial satisﬁes the following recursive relation:

:
PN .zn/ (cid:3)

:
PN(cid:3)1 .zn/ D NPN .zn/

zn

Then, (cid:12)zn can be mathematically expressed as

(cid:12)zn D

znPN .zn/ (cid:3) PN(cid:3)1 .zn/
:
PN(cid:3)1 .zn/
zn

:
PN .zn/ (cid:3)

D

znPN .zn/ (cid:3) PN(cid:3)1 .zn/
NPN .zn/

:

Note that Eq. (8.36) needs to compute the values of PN(zn) and PN(cid:3)1 .zn/, which can
be calculated by the recursive relation of Legendre polynomial [21], i.e.,

PmC1 .zn/ D

znPm .zn/ (cid:3)

Pm(cid:3)1 .zn/ ;

(8.37)

2m C 1
m C 1

m
m C 1

where mD3; 4; : : : ; N. In summary, the computation algorithm for LGL collocation
points is given below:

1. Initial points are determined using Eq. (8.33).
2. For step n,

(a) Recursively compute PN(zn) using Eq. (8.37) with initial conditions

P1 .zn/ D1I
P2 .zn/ D zn;

(b) Use Eq. (8.34) and Eq. (8.36) to iteratively compute znC1.

3. Stop if e D kznC1 (cid:3) znk1

< ".

156

S.E. Li et al.

We run this computation algorithm in [25] with 3.2 GHz CPU, and set " D 10(cid:3)16.
The computing time for choosing 40, 70, or 500 collocation points is 22, 31, or
35 ms, respectively. The solution efﬁciency satisﬁes the common requirements of
computing resources.

The differentiation matrices and integration weights can be calculated by Eq.
(8.7) and Eq. (8.10), respectively, with accurate calculated LGL points z and PN(z).

8.3.3 Multi-Phase Problems

The PS method has high accuracy for solving smooth problem, but it’s weak for
non-smooth problems. With the number of collocation points increasing, the solving
accuracy can be improved to a certain extent, but the computational efﬁciency can
signiﬁcantly reduce. In order to address non-smooth problems, we employ a multi-
phase strategy to apply the PS method. To be speciﬁc, it divides the original problem
into multiple phases and applies the PS method at each phase, respectively. Besides,
we also need to add some additional connectivity between different phases. For the
OCP with known phase-division locations, the multi-phase processing strategy is
straightforward. In particular, we let fT1; T2; : : : ; TP(cid:3)1g denote the phase-division
locations of a problem with P phases. Then the original non-smooth problem is
converted into P-phase smooth OCPs. And we can set different performance indices,
state equations, and path constraints for each phase. The total performance index is
the summation of all phases:

J D ¿ C

f (cid:3) tp
tp
2

0

PX

pD1

NpX

kD0

(cid:4)

(cid:5)

wp
kGp

Xp
k

; Up
k

; (cid:4) p
k

(8.38)

We add the connectivity constraints between two phases based on speciﬁc
requirements. For example of a bang-bang control problem, the state variables
between two phases must be continuous and the control variables are allowed to
have break points. The connectivity constraints can be denoted as

h

i

Cphase

Xi
f

; Ui
f

; ti
f

; Xj

0; Uj

0; tj
0

D 0 1 (cid:5) i; j (cid:5) P:

(8.39)

However, the phase-division locations are usually unknown in advance for
researchers. There are two strategies to deal with such issues. The ﬁrst strategy is to
regard phase-division locations as additional optimization variables. This strategy
increases the computational complexity but is easy to implement. The second
strategy is to obtain initial optimization results ﬁrst by roughly applying the PS
method to the original problem, then ﬁnd out the fast-changing regions of the state
and control inputs, ﬁnally form a multi-phase problem by taking the fast-changing
regions as a new phase. The basic idea is to increase the density of the collocation

8 Pseudospectral Optimal Control of Constrained Nonlinear Systems

157

points in the fast-changing regions, thus increasing the approximation accuracy.
Based on the second strategy, we develop the following algorithm:

1. Obtain initial optimization results by roughly applying the PS method to the

original problem.

2. Compute the changing rate of control input

and initial computation results.

:
U D DU using differentiation matrix

3. Set a threshold vector H for the changing rates. For any j D 1; 2; (cid:2) (cid:2) (cid:2) ; Nu and
:
Uji > Hj, we set time domain Œ(cid:4)m1(cid:3)1; (cid:4)m2C1(cid:11) as a fast-

i 2 Œm1; m2(cid:11) 2 .0; N/, if
changing region and set this region as a new single phase.

4. Increase the number of collocation points in the fast-changing region to improve
the computational accuracy of the constructed multi-phase problem. Properly
decrease the number of collocation points in the smooth region to improve the
computational efﬁciency. Then we can obtain the optimal solution by solving the
constructed multi-phase problem.

In fact, this method chooses different densities of collocation points for different
regions. For a smooth region, good computational efﬁciency can be achieved by
choosing sparse collocation points. For a non-smooth region, we can also choose
dense collocation points to help improve the computational accuracy.

8.3.4 Pseudospectral Optimal Control Problem Solver

We develop a Matlab-environment-based software package, called POPS, to numer-
ically calculate the solution of general OCPs. It includes four modules:

1. User conﬁguration module including the OCP description and solver parameter

setup;

2. Module for converting OCP into NLP;
3. Module to solve NLP;
4. Module for interacting with users, including data saving, ﬁgure drawing, etc.

The POPS is applicable to solve OCPs with:

1. Linear and/or nonlinear functions;
2. Smooth and/or non-smooth functions;
3. Free, ﬁxed, and constrained states (both initial and terminal);
4. Equality and/or inequality constraints; differentiation-typed and/or integration-

typed constraints;

5. Mayer-, Lagrange-, and Bolza-typed performance indices.

The POPS is compatible with other Matlab toolboxes. Users can call POPS in
other Matlab applications. It also provides a large amount of ﬂexibility for users to
conﬁgure their own problems.

158

S.E. Li et al.

8.4 Application to Autonomous Vehicles

This case presents a trajectory planning problem for automated vehicles to overtake
another vehicle under mild conditions, i.e., dry road and non-aggressive driving. As
shown in Fig. 8.1, a vehicle is required to fulﬁll the task of overtaking the vehicle
ahead following the optimal path within the predeﬁned trajectory region, along with
the guarantee to minimize the weighted sum of squares of the steering angle and the
lateral acceleration.

8.4.1 Model for Control

The system state equations can be obtained through the kinematic model and the
lateral dynamic model of vehicles with two degrees of freedom, as shown in Fig. 8.1.
Under the assumption that the lateral tire force is proportional to the slip angle and
the inﬂuence of longitudinal tire force, suspension, and slip angle on slip angle are
ignored [23], the dynamics of vehicles in coordinate system xoy is derived as:

:
v D kf Ckr
v C
mu
:
wr D akf (cid:3)bkr

Izu

(cid:2)

(cid:3)

wr (cid:3) kf
ıw;
mi
Izu wr (cid:3) akf
ıw;

Izi

akf (cid:3)bkr

mu (cid:3) u
v C a2kf Cb2kr
:
' D wr;

(8.40)

where v denotes the lateral velocity, kf and kr denote the cornering stiffness of two
front tires and two rear tires, a and b denote the distances of the front tire and the rear
tire from the center of vehicle gravity, respectively, m denotes the mass of a vehicle,
u denotes the longitudinal velocity, wr denotes yaw rate of vehicle, i denotes the
transmission ratio of steering system, ıw denotes the steering angle, Iz denotes the
yaw moment of inertia of vehicle, and ® denotes yaw angle of vehicle in global axes.

Fig. 8.1 Vehicle model with two degrees of freedom

(8.41)

(8.42)

(8.43)

8 Pseudospectral Optimal Control of Constrained Nonlinear Systems

159

To illustrate the trajectory of a vehicle, an earth coordinate system XOY is
constructed, where the vehicle is located in X, Y. The relationship between moving
trajectory and the states of vehicle can be presented as

During the overtaking task, reducing the steering angle and the lateral acceler-
ation can increase the performance of vehicle ride and handling. The performance
function is designed as:

:
X D u cos ' (cid:3) v sin ';
:
Y D u sin ' C v cos ':

Z

tf

0

J D

k1a2

wdt;

y C k2ı2
:
v;

ay D uwr C

where ay denotes as the lateral acceleration and k1, k2 denote the weighting coefﬁ-
cients of performance index. The region of overtaking trajectory Tv is demonstrated
in Fig. 8.2, following the deﬁnitions:
n

o

y

Tv D
(cid:4)
1 C e(cid:3)k3.x(cid:3)x1/

ˇ
ˇ
ˇ jy (cid:3) Qyj (cid:5) "=2
(cid:3) Ar=

(cid:5)

;

(cid:4)
1 C e(cid:3)k4.x(cid:3)x2/

(cid:5)

;

Qy D Ar=

where ˜y denotes the center line of the designed trajectory region, " denotes the width
of a trajectory region, and Ar, k3, k4, x1, x2 denote the coefﬁcients of the center line.

]
°
e
l
g
n
A
w
a
Y

 

[

 

]
°
l
e
g
n
A
g
n
i
r
e
e
t
S
[

8

4

0

-5

30

15

0

-15

-30

0

50

100

150

200

250

Distance [m]

Fig. 8.2 POPS optimization results

]

m

[
 
t
e
s
f
f

O

4

3

2

1

0

L
a
t
e
r
a
l
 

A
c
c
.
 
[

m
/
s
2
]

0.5

1

0

-0.5

-1

0

50

200

250

100
150
Distance [m]

Designed
Opt
Bound

160

S.E. Li et al.

8.4.2 The Formulation of OCP

The OCP for trajectory optimization is formulated as:

min J D

k1a2

y C k2ı2

wdt;

Z

tf

0

subject to

:
v D kf Ckr
v C
mu
:
wr D akf (cid:3)bkr

wr (cid:3) kf
ıw;
mi
Izu wr (cid:3) akf
ıw;

Izi

(cid:2)

(cid:3)

akf (cid:3)bkr

Izu

mu (cid:3) u
v C a2kf Cb2kr
:
' D wr;
:
x D u cos ' (cid:3) v sin ';
:
y D u sin ' C v cos ';
y (cid:3) Qy (cid:5) "=2;
tf min (cid:5) tf (cid:5) tf max:

(8.44)

The parameters used for simulation are listed in Table 8.1.

8.4.3 Optimization Results

We explicitly use the developed solver POPS to compute the numerical solutions.
The number of collocation points is set to 60. The optimal performance index is
0.0143, and the results are illustrated in Fig. 8.2. As shown in Fig. 8.2, the optimized
trajectory via POPS has a relatively smoother trajectory and satisﬁes the boundary
constraints precisely. We note that the maximum ﬂuctuations of the steering angle
decrease by more than 50 %, no rapid ﬂuctuations in the process, and the lateral
acceleration of the vehicle is signiﬁcantly reduced.

Table 8.1 Simulation
parameters

Parameter
m
a
b
Iz
kf
kr
u
i
tf max
tf min

Value
1450 kg
1.2 m
1.5 m
1550 kg (cid:7) m2
(cid:3)52; 000 N/rad
(cid:3)116; 000 N/rad
12.5 m/s
20
30 s
10 s

Parameter
k1
k2
E
Ar
k3
k4
x1
x2
"

Value
1
0.25
0.8 m
3.5 m
0.12
0.08
70 m
180 m
0.8 m

8 Pseudospectral Optimal Control of Constrained Nonlinear Systems

161

a

]

m

[
 
t
e
s
f
f

O

5

4

3

2

1

0

-1

Designed
Opt
Bound

b

]
2
s
/
m

[
 
.
c
c
A

 
l
a
r
e
t
a
L

0.7

0.5

0

u = 12.5m/s

u = 20m/s

0

40

80
Distance [m]

160

200

240

-0.5

0

40

80
Distance [m]

160

200

240

Fig. 8.3 POPS results for multiple phase problem (a) vehicle trajectory; (b) lateral acceleration

However, if the pre-designed center line of trajectory is not smooth but can only
be described roughly by non-smooth functions, the POPS can still be applied to
solve this problem via the multi-phase preprocessing strategy. The center line of
non-smooth trajectory is described as

8

ˆˆˆˆˆ<
ˆˆˆˆˆ:

Qy D

0;
3:5=40 (cid:12) .x (cid:3) 40/ ;
3:5;
3:5 (cid:3) 3:5=40 (cid:12) .x (cid:3) 160/ ;
0;

x 2 Œ0; 40(cid:11)
x 2 Œ40; 80(cid:11)
x 2 Œ80; 160(cid:11)
x 2 Œ160; 200(cid:11)
x 2 Œ200; 240(cid:11)

;

(8.45)

which consists of ﬁve sections shown in Fig. 8.3a, and " is set to 2 m. The control
variables and state variables are set to be continuous at the break points. The
optimized trajectory is shown in Fig. 8.3a. The optimized lateral acceleration is
shown in Fig. 8.3b, where u is set to 12.5 and 20 m/s. This new example can illustrate
the idea of multi-phase strategy that dividing the original non-smooth problem
into multiple smooth problems. Actually, this kind of trajectory optimization in
overtaking task is highly nonlinear. It will be much more complicated if employing
the strategy to numerically solve the ﬁrst-order optimality conditions.

8.4.4 Comparison with Other Methods

In order to illustrate the advantages of the PS method compared to direct methods,
we also use one TDM to solve the aforementioned problem. The TDM has following
characteristics:

(a) Using equidistant points instead of orthogonal collocation in discretization;
(b) Using composite trapezoidal quadrature rule for the integral of cost function.

Finally, the convergence rate of both LPM and TDM is shown in Fig. 8.4. From

Fig. 8.4, we can see the following things:

162

Fig. 8.4 Comparison of
conversion rate of LPM
and TD

S.E. Li et al.

LPM
TDM

40

30

20

10

 
]

%

[

 
J
 
f
o
 
r
o
r
r
E

0
20 30 40 50 60 70 80 90 100
Number of Nodes

1. The error of performance index compared to theoretical optimal solution.

The error of performance index is less than 1 % of LPM with 60 collocation
points, while the error of TDM with 60 collocation points is greater than 5.5 %.
Actually, other similar comparison of PS method and TDM can reach the same
conclusion that the pseudospectral method is more accurate than the traditional
collocation methods [24].

2. The computional speed and accuracy compared to the theoretical optimal

solution.

The LPM converges faster and possesses higher accuracy than TDM with
the same number of collocation points does. In fact, the computational load is
determined by the number of collocation points, initial values, and the complex-
ity of the OCPs, e.g., the number and types of constraints. This computational
framework and the developed Matlab solver can solve most complex problems
with better accuracy, but it is usually applied for ofﬂine calculation. For example,
the time consumption is 2.69 s and 17.04 s at 20 and 40 collocation points when
initial values are set to be zero vector (in Matlab with 3.2 GHz CPU). Greater
than 95 % of time is consumed to solve the converted NLP problem by a large
number of iterations, which is a common issue for most optimization methods.

8.5 Conclusions and Remarks

In this chapter, we developed a uniﬁed computational framework based on LPM
for the purpose of accurately and efﬁciently calculating optimal control strategies.
The mapping relationship between the costate variables of OCP and the KKT
multipliers of NLP is derived for the sake of checking the optimality of solutions.
For engineering implementation, a quasi-Newton iterative algorithm was designed
to accurately calculate the LGL points and a multi-phase preprocessing strategy
was proposed to handle non-smooth problems. The case study, i.e., optimal path
planning of road vehicle, was used to demonstrate the effectiveness of the developed
solver. The results show that the developed framework can effectively solve complex
vehicle OCPs with linear and/or nonlinear dynamics, complex constraints, and
different typed performance index.

8 Pseudospectral Optimal Control of Constrained Nonlinear Systems
Abstract In this article, we address the problem of energy management control
design in hybrid electric vehicles (HEVs) to achieve minimum fuel consumption
while optimally limiting battery degradation. We use Pontryagin’s minimum prin-
ciple (PMP) to solve the optimal control problem. To the end of controlling battery
aging to guarantee battery performances over 150,000 miles, a battery capacity loss
reference trajectory is deﬁned and a battery aging model is used by the optimizer.
The resulting optimal supervisory control strategy is able to regulate both state of
charge and capacity loss to their reference values. Simulation results conducted
on a pre-transmission HEV show that the battery capacity loss can be regulated
to achieve the long-term objective without sacriﬁcing much fuel economy.

Keywords Electric vehicles (cid:129) Supervisory control (cid:129) Multi-objective

9.1 Introduction

Battery aging plays an important role in hybrid electric vehicles (HEVs) perfor-
mance: if not properly controlled, faster battery degradation leads to lower energy
recovery and lower power output capacity, requiring the battery early replacement
and causing a reduction in the HEV monetary saving. A hybrid vehicle has two
(or more) sources of energy on-board, whose operation is coordinated by an energy
management system (EMS) typically in a way that minimum fuel consumption is
achieved [1–3]. Realistic ﬁgures of achievable improvement in fuel economy in
HEVs range from 10 % for mild hybrids to more than 30 % for highly hybridized
vehicles. This potential can be realized only with a sophisticated control system
that optimizes energy ﬂows within the vehicle. This consideration has spurred a
considerable amount of research in the last 15 years towards model-based optimal
supervisory control techniques moving away from heuristic or rule-based methods.
Systematic model-optimization methods such as dynamic programming (DP) and
Pontryagin’s minimum principle (PMP) have been successfully adopted to design
controllers to improve the energy management in HEVs using meaningful objective
functions [4–9].

These optimal control techniques are referred to as non-causal, in that their
solution relies on a perfect knowledge of the driving cycle, and as such not
implementable in real-time. Nonetheless, they are useful for two reasons: (i) they
can be used to understand how an optimal solution works, from which rules can
be extracted to design real-time implementable control strategies [10], (ii) they can
be used to benchmark realizable strategies. For a more comprehensive overview of
different control methods developed for HEVs, the reader can refer to [5].

Traditionally, the HEV energy management problem was formulated with the
aim of minimizing fuel consumption (or emissions, [11]) while trying to guarantee
a charge-sustaining operation of the battery. No considerations about battery use
(or misuse) were included in the original problem formulation. Only recently,
though, industry has become more concerned about efﬁciently managing the energy
on-board HEVs and, at the same time, monitoring and controlling the battery
degradation. If a model-based optimization approach has to be taken to this regards
in order to systematically include battery deterioration concerns within the problem
formulation, an aging model of the battery is needed. In fact, the study conducted
at Argonne National Laboratory [12] showed that the best monetary savings in
HEVs are obtained when the battery life matches the vehicle life. Battery End Of
Life (EOL) is generally deﬁned as the point in time when battery capacity reduces
to 80 % of its initial value [12]. If the goal is to make the vehicle life (usually
150; 000 mi or 15 years) match the battery life, this translates into achieving a 20 %
capacity degradation over 150; 000 mi, thus avoiding battery early replacement.

Only over the past few years, optimal supervisory control methods have included
aging considerations. One of the ﬁrst works in this vein is [13] that proposes a cost
function that is a convex combination of instantaneous energy (fuel and electricity)
and aging costs (given in terms of solid electrolyte interphase layer growth) and
solves the problem via stochastic dynamic programming (SDP) for plug-in hybrid
electric vehicles (PHEVs). In [14] a PMP-based solution is proposed where a convex
combination of fuel and aging cost is used in the cost function; in this case, the
capacity loss in HEV is being minimized. A weighting coefﬁcient was used in the
cost function to generate a family of Pareto front solutions. A similar approach is
followed in [15], where the cost function proposed by [14] is normalized to simplify
the physical interpretation of the control parameters.

These latter works tried to minimize the battery deterioration without any explicit
goal on battery life duration. The ﬁrst attempt to achieve such an objective is found
in [16]. A battery aging model from [17] is used in the problem formulation, and
a PMP-based solution is presented based on a two-state model (state of charge and
capacity loss). A solution of the PMP problem was not given, rather an approximate
solution based on extending the adaptation law, used in [10], to the two costates was
presented, based on the simplistic assumption that the capacity loss trend over the

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

169

vehicle life span is linear. In [18] an adaptive version of PMP is proposed as well, to
minimize fuel consumption and battery aging, while limiting battery temperature.
Qualitative results were presented for rather limited conditions of operation.

The objective of this paper is to use an experimentally validated battery aging
model into the EMS, to systematically control capacity degradation during the
operational life of the vehicle, with a minimum impact on the vehicle performances.
The problem of fuel consumption minimization and battery degradation limitation
for HEVs is inherently a two-time scale control problem in that nominally the
two objectives have to be reached over two different time horizons: driving cycle
and battery life, respectively. In fact, we normally test vehicles performance over
standard driving cycles while battery life is measured in terms of total ampere-
hours throughput. The proposed optimal supervisory control strategy is able to
reduce the two-time scale problem to a one-time scale problem, by minimizing an
instantaneous cost function and guaranteeing a predeﬁned battery degradation trend
on a short-time horizon, leading to 20 % cumulative capacity loss over 150; 000 mi.
In this manuscript, we ﬁrst use an experimentally validated battery aging model
from [19] to monitor and control degradation within the multi-objective optimal
control framework. We then express the costate dynamics of PMP, including the
dependence of the mass fuel ﬂow rate of the engine from the state of charge of the
battery. Third, we formulate an aging limiting control problem with two states which
requires a capacity loss reference trajectory to be deﬁned. In this way, the multi-
objective supervisory control problem (hereinafter referred to as “aging-limiting
PMP” problem) is solved as a regulation problem on the two states (state of charge
and capacity). The aging-limiting PMP (AL-PMP) problem is ﬁnally solved by
proposing a novel analytic/numerical methodology along with a tuning algorithm.
An analytic comparison between the newly proposed AL-PMP problem and the
optimization presented in [1] is shown, and a new interpretation of the well-known
ECMS strategy, extended to the case with battery aging, is proposed.

The paper is organized as follows: in Sect. 9.2 the adopted aging model is
presented, and the capacity loss reference trajectory is deﬁned; in Sect. 9.3 the
vehicle simulator is presented, and a focus is put on the battery cell and pack
model including aging; in Sect. 9.4 the meaningfulness of the control problem is
explained and two situations are deﬁned; in Sect. 9.5 the aging-limiting optimal
control problem is formulated, and it is solved with AL-PMP in Sect. 9.6; in Sect. 9.7
the novel control strategy is compared with other two different approaches, which
show to be equivalent to AL-PMP, but more problematic in the implementation; in
Sect. 9.8 the penalty function on battery capacity loss is shown and analyzed; in
Sect. 9.9 AL-PMP is optimally tuned and simulation results are shown in Sect. 9.10;
ﬁnally, conclusions are given in Sect. 9.11.

170

S. Marelli and S. Onori

9.2 Battery Aging Model and Capacity Loss

Reference Trajectory

Aging is an irreversible process caused by parasitic chemical reactions that take
place inside the battery. Batteries can undergo two types of aging: calendar aging
[20, 21] and cycle-life aging [17, 19, 22]. In this paper only cycle-life aging is
being addressed, and an empirical capacity degradation model is used in the control
strategy.

The factors responsible for battery aging are usually referred to as severity factors
[23]. In HEV applications, those are typically: state of charge, SOC, C-rate, deﬁned
as Ic D I=Q (where I is the battery current in ŒA(cid:11) and Q is the actual capacity in
ŒAh(cid:11)), and battery internal temperature, (cid:19). The capacity loss model, from [19], is
identiﬁed on real HEV battery data with a complete dependence on severity factors
by means of a severity factor function, (cid:7)funct. The following functional relationship
exists between (cid:7)funct and Qloss:

Qloss.SOC; Ic; (cid:19); Ah/ D (cid:7)funct.SOC; Ic; (cid:19)/ (cid:2) Ahz

(9.1)

where Qloss is the percent capacity loss, deﬁned as Qloss D .1 (cid:3) Q=Q0/ (cid:2) 100, where
Q0 is the initial capacity in ŒAh(cid:11); z is an empirical power exponent; and Ah is the
jIj
3600 d(cid:4). SOC
accumulated ampere-hour throughput of the battery, given by Ah D
is expressed as a fraction, Ic is in Œ1=h(cid:11) and (cid:19) is in ŒıC(cid:11). The severity factor function
assumes the following form:

R
t
0

(cid:7)funct.SOC; Ic; (cid:19)/ D .˛ SOC C ˇ/ (cid:2) exp

(cid:8)

(cid:3)Ea C (cid:8) jIcj
Rg .273:15 C (cid:19)/

(cid:9)

(9.2)

where ˛, ˇ and (cid:8) are model parameters (identiﬁed in [19]), Ea is the activation
energy in ŒJ=mol(cid:11) and Rg is the universal gas constant in ŒJ=mol=K(cid:11).

In this work, the control-oriented severity factor map, (cid:7)map, originally deﬁned in
[14] for PHEVs and then further reﬁned for HEV batteries in [19], is considered.
It is deﬁned as the ratio of the total Ah-throughput under nominal conditions until
EOL is reached (i.e., (cid:21)) to the total Ah-throughput under actual operating conditions
(i.e., (cid:9) ):

(cid:7)map.SOC; Ic; (cid:19)/ D

(cid:21) .SOCnom; Ic;nom; (cid:19)nom/
(cid:9) .SOC; Ic; (cid:19)/
jInomj d(cid:4)
jIj d(cid:4)

R
tEOL
0
R
tEOL
0

D

(9.3)

where SOCnom, Ic;nom, (cid:19)nom, and Inom represent predeﬁned nominal operating
conditions and tEOL is the time at EOL. The severity factor map is a measure of
the relative aging effect on the battery at a given operating condition with respect to

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

171

the nominal operation. It can be used the same way as an engine fuel consumption
map, in that it allows to select the battery operating points in the domain .SOC; Ic; (cid:19)/
to ensure lower capacity degradation. The capacity loss model (9.1), together with
the severity factor function (9.2) is used in the following to capture battery aging
dynamics and estimate the actual capacity, as described in Sect. 9.3.1.3. The severity
factor map, on the other hand, is used in the EMS by the optimizer to select the
optimal battery operating points to limit its aging, as described in Sect. 9.6.

9.2.1 Capacity Loss Reference for Cycle-Life

Since the electrochemical aging processes that take place inside the battery are irre-
versible, the capacity loss is a monotonically increasing function of Ah-throughput,
as it can only increase if the battery is being used (or stay constant if the battery
is not being used). In this paper, we deﬁne a capacity loss reference trajectory,
with the purpose of limiting capacity loss over each day of driving. In particular,
the capacity loss reference is expressed as a function of the driven distance d
(expressed in miles, Œmi(cid:11)), and average severity factor values are used in (cid:7)funct
for (9.1). Simulations performed over US06 and FUDS driving cycles at ambient
temperatures of (cid:19)amb D 20, 30 and 40ıC produce the average values reported in
Table 9.1. In addition, a scaling factor, K, is introduced, resulting in:

Qloss;ref.d/ D K (cid:2) (cid:7)funct

(cid:2)
SOC; Ic; (cid:19)

(cid:3)

(cid:2) dz

where z is from (9.1). K is selected to ensure that 20 % capacity loss is reached after
150; 000 mi, as follows:

(9.4)

(9.5)

K D

Qloss;EOL
(cid:2)
SOC; Ic; (cid:19)

(cid:3)

(cid:7)funct

(cid:2) dz

EOL

where the EOL capacity loss and traveled distance are Qloss;EOL D 20 % and dEOL D
150; 000mi, respectively, resulting in K D 0:6837. Figure 9.1 shows the capacity
loss reference as a function of the driven distance until the distance dEOL is reached.
The two-time scale optimal control problem is reduced to a single time scale
problem by means of breaking up dEOL into intervals of single days of driving, over
which a daily capacity loss reference value is deﬁned. Statistics shows that a typical

Table 9.1 Average severity
factor values used in the
capacity loss reference

Parameter
SOCŒ(cid:3)(cid:11)
IcŒ1=h(cid:11)
(cid:19) ŒıC(cid:11)

Value
0:446
2:43
36:1

172

S. Marelli and S. Onori

50,000

100,000

150,000

d [mi]

Fig. 9.1 Capacity loss reference based on driven distance

20

10

]

%

[

)
d
(
f 
e
r
,
s
s
o
l

Q

0
0

]

h
/
m
k
[
 

h
e
v
v

140

120

100

80

60

40

20

0

0

500

1000

1500

2000

2500

t [s]

Fig. 9.2 Vehicle speed proﬁle resulting from linking 4 US06 driving cycles

daily trip for a US car driver is estimated to be 28:97mi [24]. To account for this
statistics, in this work, one day of driving is deﬁned as the concatenation of four
US06 or four FUDS driving cycles, resulting in a total distance driven in one day of
df D 32:14mi and df D 30:02mi, respectively. The two one-day speed proﬁles are
shown in Figs. 9.2 and 9.3.

The daily Qloss reference is computed from the overall capacity reference
trajectory (9.4), over the daily distance traveled. The target value of capacity loss at
the end of a generic day k (with k 2 N; k (cid:5) kEOL, where kEOL is the last day before
battery EOL is reached) is obtained evaluating Qloss;ref.d/ at d D kdf . Figure 9.4
shows the quantity just deﬁned, for the ﬁrst three days of US06 driving cycles.

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

173

100

80

60

40

20

]

h
/
m
k
[
 

h
e
v
v

0

0

0.4

0.2

]

%

[

)
d
(
 

f
e
r
,
s
s
o
l

Q

0
0

1000

2000

4000

5000

3000

t [s]

Fig. 9.3 Vehicle speed proﬁle resulting from linking 4 FUDS driving cycles

Qloss,ref(2 df )

Qloss,ref(3 df )

Qloss,ref(df )

32.1357

64.2714

96.4071

d [mi]

Fig. 9.4 Daily capacity loss reference points calculated from US06 driving cycles, for which
df D 32:1357mi

9.3 Vehicle Simulator

The vehicle simulator used in this work is an improved version of the one developed
in [15] that models the parallel pre-transmission Hybrid Honda Civic. The main
characteristics of the vehicle are listed in Table 9.2 and its layout is shown in Fig. 9.5.
It comprises an integrated motor assist (IMA) where the electric motor (EM) is
mounted on the same shaft of the internal combustion engine (ICE). A continuous
variable transmission (CVT) allows the vehicle to operate in (i) conventional, (ii)
full-electric, (iii) power-assist, or (iv) recuperation mode. In the ﬁrst mode of
operation, only the ICE is running and supplies all the power requested by the
driver. In the second mode, only the EM is running, and the engine is switched
off. In power-assist mode, the EM and the ICE are running in parallel and the power

174

S. Marelli and S. Onori

Table 9.2 Hybrid Honda
Civic vehicle model
characteristics used in the
simulator

Fig. 9.5 Vehicle layout

Component
Vehicle mass
ICE

EM

CVT

Battery pack

Speciﬁcations
1294kg
1:6l, 85kW
In-line 4-cylinders
Gasoline
Maximum peak power 30kW
Maximum continuous power 15kW
Ratio 0:529–3:172
Final drive 3:94
LiFePO4
Nominal capacity 4:6Ah (803Wh)
Maximum power 20kW

Torque
damper

IMA

ICE

CVT

Battery

Fuel
tank

is split between the two, according to the supervisory control strategy. Finally, in
recuperation mode, the EM is used to send all the braking power into the battery
for energy recuperation; if the saturation limits of the EM or of the battery are
reached, the remaining part of the braking power is transferred to the friction brakes,
according to a series braking control strategy [25]. The CVT allows a smooth
transition between the four modes of operation.

A quasi-static energy-based forward modeling approach is used to simulate the
longitudinal dynamics of the hybrid vehicle [1], whose structure is shown in Fig. 9.6.
A driver model converts the error between the driving cycle desired speed and the
actual vehicle speed into the requested power Preq, which is sent to the Supervisory
controller, along with ICE speed, !ice, EM speed !em, and SOC to generate the
optimal actuators set points used in the Powertrain module. The actual vehicle
velocity is obtained in the Vehicle dynamics block by integration of the longitudinal
vehicle dynamics equation. The vehicle components, ICE and EM are modeled by
means of their efﬁciency maps [15].

The improvements introduced in the simulator for the scope of the present work
are related to the battery model, both in the Powertrain and in the Supervisory
controller modules. Battery aging dynamics are modeled in the Powertrain model,
whereas the formulation of a new instantaneous cost
inside the Supervisory
controller makes use of the severity factor map, as described in Sect. 9.6.

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

175

cycv

reqP

Driver

Supervisory 
controller

Powertrain

F

wheels

vehv

Vehicle 
dynamics

Fig. 9.6 Vehicle simulator block diagram

cellP

SOC

Current 
Computation

I

iceP

emP

w
ice

w
em

SOC

I

Q

I

Electrical
Model

θ

Thermal
Model

θ

Ah

SOC

I

Aging
Model

cellV

SOC

Ah

θ

Q

Fig. 9.7 Battery model layout: electrical, thermal, and aging dynamics and their interconnections

9.3.1 Battery Cell Model

In this work an ANR26650 LiFePO4 battery system from A123 is considered, which
has a nominal capacity of 2:3Ah and a nominal voltage of 3:3V. The battery cell
model is composed of three components: electrical, thermal, and aging, as depicted
in Fig. 9.7. For each of these components, all the dynamics involved and their mutual
effects are analyzed in the following. The battery pack model is then obtained by
scaling up the cell parameters at pack level, according to the topology of the pack
used.

176

S. Marelli and S. Onori

9.3.1.1 Electrical Model

The electrical battery cell behavior is modeled with a 0th-order Randle’s model. The
input to the battery cell is the power, Pcell. The corresponding current is computed
through the non-linear algebraic function [26]:

p

Voc.SOC/ (cid:3)

I D

.SOC/ (cid:3) 4R0.SOC; (cid:19)/Pcell

V 2
oc
2R0.SOC; (cid:19)/

(9.6)

where I is positive in discharge, Voc in ŒV(cid:11) is the cell open circuit voltage, which is
a non-linear function of SOC, and R0, in general a function of SOC and (cid:19), is the
cell internal resistance at the Beginning Of Life BOL. Figure 9.8 shows a typical
trend of the resistance as a function of SOC parameterized for different values of
temperature (cid:19) [27].
The SOC cell dynamics are deﬁned by the equation:

PSOC D (cid:3)

I
3600 Q0.(cid:19)/

(9.7)

where Q0, the BOL capacity, is a function of (cid:19) as shown in Fig. 9.9.

0.02

]

Ω

[

 
0

R

0.015

θ =45º C
θ =40º C
θ =33º C
θ =16º C

0.01

30

2.3

]

h
A

[

 
0

Q

2.2

2.1

2
15

40

50
SOC [%]

60

70

Fig. 9.8 Experimental characterization of R0 as a function of SOC and (cid:19) for A123 ANR26650
battery cell

20

25

30

35

40

45

50

θ [ºC]

Fig. 9.9 Experimental characterization of Q0 as a function of (cid:19) for A123 ANR26650 battery cell

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

177

As the battery is used, it ages. For, Q0 must be updated with its actual value Q during
vehicle operation. The increase in internal resistance due to aging is neglected in this
work, and left as a future work.

The terminal voltage Vcell is given by

Vcell D Voc.SOC/ (cid:3) R0.SOC; (cid:19)/ I

(9.8)

and the cell power input is given by Pcell D Vcell I.

9.3.1.2 Thermal Model

The cell thermal model describes the cell temperature dynamics, taking into account
the internal heat generation due to the current ﬂowing inside the cell and the heat
exchanged with the environment. The dynamics of the cell core temperature (cid:19) are
described by the equation:

P(cid:19) D

1

McCp

(cid:6)
R0.SOC; (cid:19)/ I2 (cid:3)

(cid:7)

(cid:19) (cid:3) (cid:19)amb
Ru

(9.9)

where R0 I2 in ŒW(cid:11) is the thermal power generated by Joule effect, McCp in
ŒJ=ıC(cid:11) is the effective cell heat capacity, considered constant, (cid:19)amb in ŒıC(cid:11) is
the ambient temperature, and Ru is the thermal resistance to model the cell heat
exchange with the environment. The parameter values of the ﬁrst-order model used
to simulate (9.9) are given in [28].

9.3.1.3 Aging Model

In order to deﬁne the capacity loss dynamics, we take the derivative of (9.1) with
respect to time. Since the data used for the model identiﬁcation are collected from
tests conducted under SOC, Ic, and (cid:19) constant conditions, when computing the time
@Ah
derivative of Qloss, (cid:7)funct is considered as a constant. Thus dQloss
@t , which
leads to

dt D @Qloss
@Ah

PQloss D (cid:7)funct.SOC; Ic; (cid:19)/ z (cid:2) Ahz(cid:3)1 (cid:2) PAh

(9.10)

The aging model (9.10) is integrated in the powertrain module to obtain the actual
value of Qloss. This is then used in the EMS to solve the multi-objective optimal
control problem.

178

S. Marelli and S. Onori

9.3.2 Battery Pack Model

The battery pack used in the vehicle is composed of Np D 2 modules in parallel
with Ns D 54 cells in series for each module. The battery pack quantities are
computed, for the sake of simplicity, under the assumption that all the cells are
equal and balanced, leading to a pack current of

a pack open circuit voltage of

and a terminal voltage of

The battery pack power is given by

and the pack resistance by

Ibatt D Np I

Voc;batt D Ns Voc

Vbatt D Ns Vcell

Pbatt D Np Ns Pcell

R0;batt D

R0

Ns
Np

Q0;batt D Np Q0;

Qbatt D Np Q

Moreover, the initial and actual pack capacities are:

respectively.

(9.11)

(9.12)

(9.13)

(9.14)

(9.15)

(9.16)

(9.17)

9.4 Well-Posedness of Multi-Objective Control Problem

The aim of the multi-objective optimal control problem is to obtain minimum
fuel consumption, while guaranteeing charge-sustainability and limited capacity
degradation over a day of driving.

Because of the diverse nature of driving cycles (due to different terrains, drivers,
weather conditions, etc.) the multi-objective optimal control problem is well deﬁned
(and meaningful) only for those cases where the driving conditions (in terms of
severity factors: SOC and Ic) and/or ambient conditions ((cid:19)amb) would lead to a

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

179

2200

2400

0.175
0.17
0.165
0.16
0.155

]

%

[
 

s
s
o
l

Q

0.25

0.2

0.15

0.1

0.05

0

0

Qloss,ref(df )
θamb = 20[˚C]
θamb = 30[˚C]
θamb = 40[˚C]

500

1000

1500

2000

2500

t [s]

Fig. 9.10 Capacity loss over the ﬁrst day (combination of 4 US06) of aggressive cycle for different
ambient temperatures. Simulation results are obtained by controlling fuel consumption only (using
the PMP method): capacity loss always exceeds the Qloss;ref.df / limit. If only fuel is minimized in
the vehicle EMS, the battery will degrade (reaching EOL) prematurely

degradation of the battery beyond the acceptable target Qloss;ref.df /. In this case,
battery aging must be controlled. The US06 is one of such cycle, as shown in
Fig. 9.10. In other cases, driving scenarios are inherently mild from an aging
standpoint, in that they would never lead to a battery degradation close to the daily
target value, as shown in Fig. 9.11 for the case of FUDS. Obviously, in such cases,
battery aging does not have to be controlled, and the traditional fuel minimization
problem can be employed.

Under aggressive cycles the EMS must monitor and limit the aging to meet
the long-term goal of 20 % capacity loss over the vehicle life span to prevent
anticipated battery degradation. Inclusion of a battery aging cost in the optimization
problem is needed, at the price of slightly worsening in fuel economy. Under mild
driving, operating in only fuel consumption minimization mode would be sufﬁcient
to guarantee a capacity loss below the target threshold.

The multi-objective optimal control problem is well-posed if the capacity
degradation resulting from fuel consumption minimization exceeds its daily target
limit. In this case, a multi-objective EMS is needed to optimally weigh fuel economy
and battery aging.

The novel control strategy proposed in this work, referred to as aging-limiting,
has the aim to control (limit) Qloss (along with minimizing fuel consumption) to
its daily target value Qloss;ref.df /. Ideally, in a real-world scenario, a vehicle driving
predictor would be used to interact with EMS. The EMS will then decide whether to
switch to battery saving mode by activating the aging-limiting strategy or stay in the

180

S. Marelli and S. Onori

]

%

[
 

s
s
o
l

Q

0.16

0.14

0.12

0.1

0.08

0.06

0.04

0.02

0

0

Qloss,ref(df )
θamb = 20[◦C]
θamb = 30[◦C]
θamb = 35[◦C]
5000

1000

2000

4000

3000
t [s]

Fig. 9.11 Capacity loss over the ﬁrst day (combination of 4 FUDS) of mild cycle for different
ambient temperatures. Simulation results are obtained by controlling fuel consumption only (using
the PMP method): capacity loss never exceeds the Qloss;ref.df / limit. In this speciﬁc cases, battery
aging control is not needed

default fuel-consumption mode. The actual online strategy implementation is out of
scope and will be investigated in the future.

In this work, we focus on the development of the new aging-limiting approach
using US06 driving cycles as driving scenarios, for which the multi-objective control
problem is well-posed.

9.5 Aging-Limiting Energy Management Problem

Formulation

The aging-limiting control problem is formulated using the integral of the fuel
power as cost function, as follows:

J.u; Preq/ D

Pmf .u; Preq/ Qlhv dt

(9.18)

Z

tf

0

where u is the control input, i.e. the battery power Pbatt D Ibatt Vbatt in ŒW(cid:11) (positive
in discharge); Pmf is the mass fuel ﬂow rate of the engine, in Œg=s(cid:11); Qlhv is the fuel
lower heating value in ŒJ=g(cid:11); and tf is the ﬁnal time instant in Œs(cid:11), i.e. the duration of
the driving day.

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

181

The goal of the aging-limiting supervisory controller is to ﬁnd the optimal control
sequence u(cid:2), that minimizes (9.18) while (i) keeping SOC at the same reference
value SOCref at the beginning and at the end of the driving day (9.19a), (ii) limiting
the SOC excursion between ﬁxed minimum and maximum values, respectively,
SOCmin and SOCmax (9.19b), and (iii) controlling capacity loss to not exceed the
target value (9.19c):

SOC.0/ D SOC.tf / D SOCref

SOCmin (cid:5) SOC (cid:5) SOCmax
0 (cid:5) Qloss (cid:5) Qloss;ref.df /

(9.19a)

(9.19b)

(9.19c)

The use of power-based cost function makes the choice of depletion energy,
Edep in ŒJ(cid:11), to describe the battery dynamics, and the effective energy-throughput,
Eeff in ŒJ(cid:11), to describe battery aging dynamics, more practical as opposed to the
traditionally used SOC and Qloss. These quantities are deﬁned as follows:

1. Depletion energy1:

x1 D Edep D

Z

t

0

D Edep.0/ C

Ibatt.SOC; Pbatt; (cid:19)/ Voc;batt.SOC/ d(cid:4)

(9.20)

This state represents the amount of energy extracted from the battery pack and is
equivalent to SOC in the control problem. Considering a negligible dependence
of Voc;batt on SOC (typical in a charge-sustaining HEV), and a negligible variation
of Qbatt over one day of driving, then the state of charge can be written as a
function of Edep

2:

SOC D SOC.0/ C

Edep.0/ (cid:3) Edep
3600 Qbatt Voc;batt

2. Effective energy-throughput:
Z

t

x2 D Eeff D

(cid:7)map.SOC; Ic; (cid:19)/

0
(cid:2) jIbatt.SOC; Pbatt; (cid:19)/j Voc;batt.SOC/ d(cid:4)

(9.21)

(9.22)

1The dependence on time will be left implicit in this paper, for simplicity.
2Under this assumption, it is possible to write (9.20) as Edep D Edep.0/ C Voc;batt
Pbatt; (cid:19) / d(cid:4) and the state of charge as SOC D SOC.0/ (cid:3)
two equations are then combined into (9.21).

t
0 Ibatt.SOC;
t
0 Ibatt.SOC; Pbatt; (cid:19) / d(cid:4) . These

1
3600 Qbatt

R

R

182

S. Marelli and S. Onori

It is equivalent in terms of energy to the effective Ah-throughput, Aheff, introduced
in [14]. In the control problem this state is equivalent to Qloss, in that it represents
a measure of the degradation of the battery: any loss in capacity registered
through an increase in Qloss corresponds to an increase in Eeff of a commensurate
magnitude.

Owing to the above deﬁnitions of the system states, the variables used in the control
problem are rewritten as follows.

(cid:129) Because SOC is a function of both Edep (i.e., x1) and Qbatt (or x2), from (9.21),

the battery current is also a function of the states x1 and x2:

Ibatt D Ibatt.SOC; Pbatt; (cid:19)/ D Ibatt.x1; x2; u; (cid:19)/

(9.23)

(cid:129) Similarly, the severity factor map is a function of both states:

(cid:7)map.SOC; Ic; (cid:19)/ D (cid:7)map .x1; x2; Ibatt; (cid:19)/

(9.24)

recalling that Ic D Ibatt=Qbatt.

Thus, the state dynamics are as follows:

Px1 D PEdep D Ibatt.x1; x2; u; (cid:19)/ Voc;batt.x1/
Px2 D PEeff D (cid:7)map .x1; x2; Ibatt; (cid:19)/ jIbatt.x1; x2; u; (cid:19)/j Voc;batt.x1/

(9.25)

(9.26)

Finally, the following constraints are imposed to make the powertrain actuators
operate within their physical limits (9.27a,9.27b,9.27c) and meet the total power
request (9.27d):

0 (cid:5) Pice (cid:5) Pice;max.!ice/
Pem;min.!em/ (cid:5) Pem (cid:5) Pem;max.!em/

Pbatt;min (cid:5) Pbatt (cid:5) Pbatt;max

Preq D Pice C Pem

(9.27a)

(9.27b)

(9.27c)

(9.27d)

where Pice;max is the maximum engine power and it depends on !ice (in Œrpm(cid:11));
Pem;min and Pem;max are the minimum and maximum limits for the EM power, Pem,
and they depend on the motor angular speed !em (in Œrpm(cid:11)); Pbatt;min and Pbatt;max are
the constant minimum and maximum limits for the battery power. For the sake of
simplicity, it is assumed that Pem D Pbatt, which implies that the losses between the
battery power output and the EM input are neglected.

Problem 1 (AL-EMP). The aging-limiting energy management problem (AL-EMP)
consists in ﬁnding the optimal control sequence u(cid:2) which minimizes the cost
function (9.18) under the dynamic constraints (9.25) and (9.26) and the global and
local constraints (9.19) and (9.27).

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

183

In the standard energy management problem, battery aging is not accounted for
and fuel consumption is the only cost being minimized; thus the constraint (9.19c)
is not deﬁned, as well as state (9.26) is not considered. The standard energy
management problem is thus reduced to Problem 2.

Problem 2 (S-EMP). The standard energy management problem (S-EMP) con-
sists in ﬁnding the optimal control sequence u(cid:2) which minimizes the cost func-
tion (9.18) under the dynamic constraint (9.25) and the global and local con-
straints (9.19a,9.19b) and (9.27).

9.6 Aging-Limiting Pontryagin’s Minimum Principle

Problem Solution

The Pontryagin’s minimum principle (PMP) is used in this work to solve the AL-
EMP. We refer to the solution of the AL-EMP through PMP as aging-limiting PMP
(AL-PMP). To account for battery aging, an additional state (and, consequently, an
additional costate) is added, as proposed in [16]. The Hamiltonian function for the
AL-PMP is given by

H.u; Preq/ D Pmf .u; Preq/ Qlhv C (cid:15)1 Px1 C (cid:15)2 Px2

(9.28)

where (cid:15)1 is the ﬁrst costate variable, relative to the depletion energy, and (cid:15)2 is
the second costate, relative to the effective energy-throughput; the state dynamics
are deﬁned in (9.25) and (9.26). If u(cid:2) is the optimal control input which mini-
mizes (9.18) under the speciﬁed dynamic and global/local constraints, the following
necessary conditions must hold true:

(cid:129) u(cid:2) must minimize the Hamiltonian function H instantaneously;
the governing equations of the optimal costates are given by
(cid:129)

P(cid:15)(cid:2)

1 D (cid:3)

D (cid:3)

P(cid:15)(cid:2)

2 D (cid:3)

D (cid:3)

@H
@x1
@ Pmf .u(cid:2); Preq/
@x1

@H
@x2
@ Pmf .u(cid:2); Preq/
@x2

Qlhv (cid:3) (cid:15)(cid:2)
1

(cid:3) (cid:15)(cid:2)
2

@Px1
@x1

@Px1
@x2

@Px2
@x1

@Px2
@x2

Qlhv (cid:3) (cid:15)(cid:2)
1

(cid:3) (cid:15)(cid:2)
2

(9.29)

(9.30)

184

S. Marelli and S. Onori

10

0

)
C
O
S
(
p

−10

30

40

50
SOC [%]

60

70

Fig. 9.12 Multiplicative penalty function for SOCref D 50 %, SOCmin D 30 %, SOCmax D 70 %,
a D 10 and b D 9

The Hamiltonian (9.28) is modiﬁed by introducing a penalty function, p.SOC/,
to limit the excursion of SOC during vehicle operation, thus enforcing the local state
constraint (9.19b):

H.u; Preq/ D Pmf .u; Preq/ Qlhv C (cid:15)1 p.SOC/ Px1 C (cid:15)2 Px2

(9.31)

The penalty function on state of charge can be either additive or multiplicative,
[1], and in this work the latter is chosen. Mathematically, a multiplicative penalty
function is expressed as

p.SOC/ D 1 (cid:3) a

(cid:8)

SOC (cid:3) SOCref
.SOCmin (cid:3) SOCmax/ =2

(cid:9)
b

(9.32)

This function acts modifying the cost of battery depletion in H according to the
deviation of SOC from its target value SOCref. For positive a and odd b, p D 1
when SOC D SOCref; when SOC < SOCref, p > 1, resulting in an increase in the
battery depleting cost in H; when SOC > SOCref, p < 1, thus decreasing the battery
depleting cost in H. The penalty function, for the parameters values chosen in this
work of a D 10 and b D 9, is shown in Fig. 9.12.

The choice of the initial costate values is referred to as tuning of the AL-PMP

control strategy, and is discussed in Sect. 9.9.

Because Pmf does not depend (at least in ﬁrst approximation) on the second

state, (9.29) and (9.30) can be expressed as

P(cid:15)(cid:2)

1 D (cid:3)

@ Pmf .Pbatt; Preq/
@Edep

Qlhv (cid:3) (cid:15)(cid:2)
1

@ PEdep
@Edep

(cid:3) (cid:15)(cid:2)
2

@ PEeff
@Edep

P(cid:15)(cid:2)
2 D (cid:3)(cid:15)(cid:2)
1

@ PEdep
@Eeff

(cid:3) (cid:15)(cid:2)
2

@ PEeff
@Eeff

(9.33)

(9.34)

The inﬁnitesimal variation of Edep upon an inﬁnitesimal variation of SOC is obtained
from (9.21). Thus, by means of using the following relations:

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

185

(

@Edep D (cid:3)3600 Qbatt Voc;batt @SOC
@ PEdep D (cid:3)3600 Qbatt Voc;batt @ PSOC

the partial derivatives in (9.33) and (9.34) can be easily calculated from maps
available in the powertrain model.

Thus (9.33) can be written as follows:

Qlhv
3600 Qbatt Voc;batt

(cid:3) (cid:15)(cid:2)
1

@ PSOC
@SOC

P(cid:15)(cid:2)

1 D

@ Pmf .Pbatt; Preq/
@SOC
@ PEeff
@SOC

C (cid:15)(cid:2)
2

1
3600 Qbatt Voc;batt

The term

@ Pmf
@SOC is expressed as

@ Pmf .Pbatt; Preq/
@SOC

D

@ Pmf .Pbatt; Preq/
@Pbatt

@Pbatt.SOC/
@SOC

where the ﬁrst contribution is computed as

@ Pmf .Pbatt; Preq/
@Pbatt

D (cid:3)

@ Pmf .Pice; Preq/
@Pice

since Pbatt D Preq (cid:3) Pice. The term

is the engine map, used in the vehicle

@ Pmf
@Pice

simulator. The term

, on the other hand, is shown in Fig. 9.13.

(9.35)

(9.36)

(9.37)

(9.38)

@ Pmf
@Pbatt

x 10−7

−0.5

−1

−1.5

−2

g J

f

˙m
∂

t
t
a
b
P
∂

−2.5

6000

4000

2000

ωice [rpm]

0

100

50

Tice [Nm]

150

Fig. 9.13 Map depicting

@ Pmf
@Pbatt

on the Tice–!ice plane

S. Marelli and S. Onori

186

From (9.14):

where
Fig. 9.14.
The term @ PSOC

@Pbatt.SOC/
@SOC

D Ns Np

@Pcell.SOC/
@SOC

(9.39)

@Pcell
@SOC is available from the battery model. The resulting

@Pbatt
@SOC map is shown in

@SOC is also extracted from the battery model and is shown in Fig. 9.15.

4
x 10

2

0

]

W

[

t
t
a
b
P
∂

C
O
S
∂

−2

−4
400

200

x 10−4

1s

C
˙O
S
∂

C
O
S
∂

2

0

−2

−4

−6

−8

0

−200

Ibatt [A]

−400

30

50

40

SOC [%]

80

70

60

Fig. 9.14 Map depicting

@Pbatt
@SOC on the SOC–Ibatt plane

−10

70

60

50

40

SOC [%]

30

100

0

Pcell [W]

−100

Fig. 9.15 Map depicting @ PSOC

@SOC on the Pcell-SOC plane

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

187

]

−

[

σ
∂

C
O
S
∂

3

2

1

0
80

60

40

SOC [%]

0

20

10

Ic [1/h]

30

Fig. 9.16 Map depicting

@(cid:7)map
@SOC on the Ic–SOC plane, for (cid:19) D 30ıC

Finally,

@ PEeff
@SOC is computed from (9.26) as

@ PEeff
@SOC

D

(cid:4)

(cid:5)

@(cid:7)map

Edep; Eeff; Ibatt; (cid:19)

@SOC

(cid:2) jIbatt.Edep; Eeff; Pbatt; (cid:19)/j Voc;batt
@jIbatt.Edep; Eeff; Pbatt; (cid:19)/j
@SOC
(cid:4)
Edep; Eeff; Ibatt; (cid:19)

(cid:2) (cid:7)map

Voc;batt

C

(cid:5)

(9.40)

where the terms

@(cid:7)map
@SOC and

@jIbattj
@SOC are shown in Figs. 9.16 and 9.17, respectively.

The dynamics of the ﬁrst costate can be numerically computed from the maps

just shown.

The second costate dynamics, (9.34), can be written (from (9.25) and (9.26)) as

P(cid:15)(cid:2)
2 D (cid:3) (cid:15)(cid:2)
1

@Ibatt.Edep; Eeff; Pbatt; (cid:19)/
@Eeff
Edep; Eeff; Ibatt; (cid:19)

(cid:7)map

@

(cid:4)

(cid:10)

Voc;batt.Edep/
(cid:5) ˇ
ˇIbatt.Edep; Eeff; Pbatt; (cid:19)/

(cid:11)

ˇ
ˇ

(9.41)

(cid:3) (cid:15)(cid:2)
2

(cid:2) Voc;batt.Edep/

@Eeff

188

S. Marelli and S. Onori

8

6

4

2

0

−2

]

A

[

|
I
|
∂

C
O
S
∂

100

0

Pcell [W]

−100

30

40

50
SOC [%]

60

70

80

Fig. 9.17 Map depicting

@jIbattj
@SOC on the SOC–Pcell plane

The partial derivatives in (9.41) are expressed as

@Ibatt.Edep; Eeff; Pbatt; (cid:19)/
@Eeff

D

@Ibatt.SOC; Pbatt; (cid:19)/
@SOC
@SOC.Edep; Eeff/
@Eeff

(cid:2)

and

(cid:10)

@

(cid:7)map.Edep; Eeff; Ibatt; (cid:19)/

ˇ
ˇIbatt.Edep; Eeff; Pbatt; (cid:19)/

ˇ
ˇ

(cid:11)

@Eeff

(cid:6)

D

@

C

@(cid:7)map.Edep; Eeff; Ibatt; (cid:19)/
@SOC
ˇ
ˇIbatt.Edep; Eeff; Pbatt; (cid:19)/
@SOC

ˇ
ˇ

(cid:2)

@SOC.Edep; Eeff/
@Eeff

ˇ
ˇIbatt.Edep; Eeff; Pbatt; (cid:19)/
#

ˇ
ˇ

(cid:7)map.Edep; Eeff; Ibatt; (cid:19)/

(9.42)

(9.43)

respectively. The term @SOC
, appearing in both (9.42) and (9.43), was found to be
@Eeff
negligible in simulation when compared to all the other costates dynamics terms
(order of magnitude 10(cid:3)8), thus leading to the second costate dynamics to be
approximated to P(cid:15)(cid:2)

2 approximately constant:

2 (cid:6) 0, i.e. (cid:15)(cid:2)

2 (cid:6) (cid:15)(cid:2)
(cid:15)(cid:2)

02 D const:

(9.44)

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

189

9.6.1 Comparison with Standard PMP Solution

The standard PMP solution is computed by minimizing the Hamiltonian
function [1]:

H.u; Preq/ D Pmf .u; Preq/ Qlhv C (cid:15) Px

(9.45)

where the state x is the SOC, the costate is indicated with (cid:15) and its dynamics are

P(cid:15)(cid:2) D (cid:3)

D (cid:3)(cid:15)(cid:2)

@H
@x

@Px
@x

When including battery aging consideration, the costate dynamics for the ﬁrst state,
as introduced in the present work, are

(9.46)

(9.47)

P(cid:15)(cid:2) D (cid:3)

@H
@x

D (cid:3)
„

@ Pmf .u(cid:2); Preq/
@x
ƒ‚
(cid:15)a

Qlhv
…

(cid:3) (cid:15)(cid:2)

@Px
@x
„ƒ‚…
(cid:15)b

When comparing (9.46) and (9.47), one can see that the ﬁrst term of (9.47), labeled
as (cid:15)a, is usually neglected in the standard PMP solution [14]. Simulation results
(Fig. 9.18) show that this term gives a contribution to the costate dynamics which
is of the same order of magnitude of the second term, labeled as (cid:15)b. When the

0

500

1000

1500

2000

2500

x 10−3

x 10−3

]
s
/
1
[

 
a
λ

0

−1

−2

−3

0

−1

]
s
/
1
[

 
b
λ

−2

−3

0

t [s]

t [s]

500

1000

1500

2000

2500

Fig. 9.18 Comparison of terms in P(cid:15)(cid:3): (cid:15)a D (cid:3)

@ Pmf
@SOC

Qlhv
Voc;batt Qbatt

(top) and (cid:15)b D (cid:3)(cid:15) @ PSOC

@SOC (bottom)

190

S. Marelli and S. Onori

˙λ* = λa + λb
˙λ* = λb

55

50

45

40

]

%

[

C
O
S

35

0

0.25

0.2

]

%

[

s
s
o
l

Q

0.15

0.1

0.05

0

0

500

1000

1500

2000

2500

t [s]

Fig. 9.19 Comparison of state of charge with and without the term (cid:15)a D (cid:3)

@ Pmf
@SOC

Qlhv
Voc;batt Qbatt

in P(cid:15)(cid:3)

0.225

0.22

0.215

2300

2400

˙λ* = λa + λb
˙λ* = λb

Qloss,
Qloss,
Qloss,ref(df )

500

1000

1500

2000

2500

t 

  [s]

Fig. 9.20 Comparison of capacity loss with and without the term (cid:15)a D (cid:3)

@ Pmf
@SOC

Qlhv
Voc;batt Qbatt

in P(cid:15)(cid:3)

term (cid:15)a is kept in the overall solution, a slightly smaller SOC swing is observed,
from Fig. 9.19, as well as a slight reduction of Qloss, Fig. 9.20. The fuel economy is
also slightly improved, 37:3206 MPG from 37:3048 MPG obtained when (cid:15)a is not
accounted for.

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

191

9.7 Remarks on Multi-Objective Optimal

Control Formulation

In this section we show that the formulation of AL-PMP, as proposed in this paper, is
equivalent to two other optimal control approaches, namely a multi-objective PMP
and ECMS including aging consideration.

9.7.1 Multi-Objective PMP Problem

In this section, we show that the approach proposed in [14], i.e. a multi-objective
optimal control formulation including fuel consumption and battery capacity degra-
dation costs is equivalent to the method proposed in this paper. It is shown, though,
that the AL-PMP gives some substantial advantages in terms of reduced tuning
effort.

In [14] the cost function to be minimized is deﬁned as the convex combination

of two competing costs, i.e. fuel cost and aging cost, as follows:

J D

.1 (cid:3) ˛/ Pmf C

(cid:7)map jIbattj dt

(9.48)

1
3600

˛

ca
(cid:21)

Z

tf

0

where ˛ is a scalar parameter used to weight the two costs, ca is a scalar, measured
in Œg(cid:11), which translates battery wear into equivalent fuel consumption, and (cid:21) D
jIbatt;nomj dt is the total Ah-throughput under nominal cycling conditions.

1
3600
In [14], the dynamics of Aheff are given by

R
EOL
0

PAheff D

(cid:7)map jIbattj

1
3600

(9.49)

and the Hamiltonian is written as

H D .1 (cid:3) ˛/ Pmf C

(cid:7)map jIbattj C (cid:15) PSOC

(9.50)

1
3600

˛

ca
(cid:21)

from which a PMP solution is computed, with dynamic constraints (9.7) and (9.49)
and static constraints (9.19a, 9.19b) and optimal initial value of the costate (cid:15)(cid:2)
0 found
through the shooting method. The challenges with this formulation are that i) the
choice of parameter value ca is arbitrary and not necessarily trivial, and ii) a family
of Pareto solutions is obtained as ˛ is varied between 0 (only fuel consumption is
considered in J) and 1 (only battery aging is considered in J), generating a trade-off
between fuel and aging costs.

192

S. Marelli and S. Onori

If we now normalize (9.50) (by 1 (cid:3)˛ division and Qlhv multiplication), we obtain

NH D

Qlhv
1 (cid:3) ˛

H D Pmf Qlhv C

Qlhv
3600
(cid:8)
(cid:15)
1 (cid:3) ˛

˛
1 (cid:3) ˛

ca
(cid:21)
1
3600 Qbatt

(cid:3)

(cid:7)map jIbattj
(cid:9)

Ibatt

C Qlhv

(9.51)

Deﬁning N(cid:15)1 D Qlhv
rewritten as

(cid:15)
˛(cid:3)1

1
3600 Qbatt

and N(cid:15)2 D Qlhv
3600

˛
1(cid:3)˛

ca
(cid:21) ,

the Hamiltonian is

NH D Pmf Qlhv C N(cid:15)1 Ibatt C N(cid:15)2 (cid:7)map jIbattj

(9.52)

We can consider (9.52) as the Hamiltonian function associated with a control
problem with a single objective cost function:

Z

tf

0

NJ D

Pmf dt

(9.53)

and the state dynamics given by (9.7), to account for battery depleting cost, with
associate costate N(cid:15)1, and (9.49) to account for battery aging with corresponding
costate N(cid:15)2.

Ultimately, the two degrees of freedom given by the choice of ˛ and ca are being

translated into the costates N(cid:15)1 and N(cid:15)2.

The Hamiltonian of the AL-PMP solution, (9.28), can be written expressing

explicitly the states dynamics as

H D Pmf Qlhv C (cid:15)1 Voc;batt Ibatt C (cid:15)2 Voc;batt (cid:7)map jIbattj

(9.54)

Comparing (9.54) and (9.52), one can clearly see the equivalence of the two
problem formulations (same costs, (9.53) and (9.18), equivalent states, Edep and
Eeff and SOC and Aheff, respectively, as discussed in Sect. 9.5). In particular, the
Hamiltonians (9.52) and (9.54) are identical under the conditions:
(

or:

N(cid:15)1 D (cid:15)1 Voc;batt
N(cid:15)2 D (cid:15)2 Voc;batt

8
<

:

(cid:15)1 D
(cid:15)2 D ca Qlhv

Qlhv
3600 Qbatt Voc;batt
˛
1(cid:3)˛

3600 (cid:21) Voc;batt

(cid:15)
˛(cid:3)1

(9.55)

(9.56)

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

193

The advantages of using AL-PMP, though, is in that the challenge of selecting
ca and ˛ is translated into optimally tuning the two costates (cid:15)1, (cid:15)2, which, in turn,
boils down to solving Problem 1 with the AL-PMP algorithm presented in Sect. 9.9.

9.7.2 ECMS with Aging

In [26] it was shown that the PMP solution (of the S-EMP) is equivalent to the one
given by ECMS. In this section, we want to show that a similar equivalence exists
in the case of aging inclusion.
Under system dynamics:

PEbatt D Ibatt.x1; x2; u; (cid:19)/ Vbatt.x1/
PEeff D (cid:7)map .x1; x2; Ibatt; (cid:19)/ jIbatt.x1; x2; u; (cid:19)/j Voc;batt.x1/

(9.57)

(9.58)

we want to instantaneously minimize the equivalent fuel power, Pf ;eqv, given by the
sum of the actual fuel power, Pf , and Pdep and Pagn:

Pf ;eqv D Pf C Pdep C Pagn

(9.59)

where Pdep is the virtual fuel power associated with battery depletion and Pagn is the
virtual fuel power associated with battery aging.

In particular, Pdep is deﬁned as follows:

Pdep D s1 PEbatt

(9.60)

where s1 is the equivalency factor which translates the battery depletion power into
equivalent fuel power.

Usually, a value for s1 when the battery is being charged, s1;chg, and one when

the battery is being discharged, s1;dis are used.

Pagn is deﬁned as follows:

Pagn D s2 PEeff

(9.61)

where s2 is the equivalency factor associated with the battery aging power. This term
introduces an additional equivalent fuel power when the battery is irreversibly aged.
Substituting equations (9.60) and (9.61) into the equivalent fuel power (9.59),

yields to

Pf ;eqv D Pmf Qlhv C s1 Vbatt Ibatt C s2 Voc;batt (cid:7)map jIbattj

(9.62)

194

S. Marelli and S. Onori

The relation between the battery open circuit voltage and terminal voltage is by

means of battery efﬁciency (cid:8)batt:
(

Deﬁning:

hence:

Vbatt D

(cid:8)batt Voc;batt
1
Voc;batt
(cid:8)batt

if Ibatt (cid:8) 0
if Ibatt < 0

(

Ns1 D

Ns1;dis D s1;dis (cid:8)batt
Ns1;chg D s1;chg
(cid:8)batt

if Ibatt (cid:8) 0
if Ibatt < 0

(

(cid:15)1 D Ns1
(cid:15)2 D s2

(

s1 D

(cid:15)1
(cid:8)batt
(cid:15)1 (cid:8)batt

if Ibatt (cid:8) 0
if Ibatt < 0

(9.62) is written as follows:

Pf ;eqv D Pmf Qlhv C Ns1 Voc;batt Ibatt C s2 Voc;batt (cid:7)map jIbattj

(9.65)

which simply shows that ECMS with aging consideration and AL-PMP are
equivalent. In addition,

(9.63)

(9.64)

(9.66)

(9.67)

9.8 Penalty Function on Capacity Loss

A penalty function on capacity loss, q.Qloss; d/, is introduced in the AL-PMP
formulation to guarantee the targeted loss of capacity over each single day of
driving. The Hamiltonian (9.31) becomes as follows:

H.u; Preq/ D Pmf .u; Preq/ Qlhv C (cid:15)1 p.SOC/ Px1 C (cid:15)2 q.Qloss; d/ Px2

(9.68)

where p.SOC/ enforces the local constraint on the state of charge. Contrary to the
state of charge, for which positive and negative variations are allowed, the capacity
loss (or effective energy-throughput) is a monotonically increasing function. To
account for this characteristic, the proposed penalty function, q.Qloss; d/, is a
function of the driven distance.

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

195

Qloss,ref(3 df )

Qloss,ref(2 df )

Qloss,ref(df )

]

%

[

)
d
(
 

f
e
r
,
s
s
o
l

Q

0.4

0.35

0.3

0.25

0.2

0.15

0.1

0.05

0

0

Qloss,ref(d)
Qday
loss,ref(d)

32.1357

64.2714

96.4071

d [mi]

Fig. 9.21 Qloss;ref.d/, Qday
with df D 32:1357mi

loss;ref

.d/, and Qloss;ref.kdf / over the ﬁrst three days of US06 driving cycles,

We indicate as Qday

(cid:10)

loss;ref
.k (cid:3) 1/df ; kdf

(cid:11)

.d/ the reference capacity loss trajectory on a given day,
, in between the capacity loss of the previous day,

d, with d 2
Qloss;ref..k (cid:3) 1/df /, and the following day Qloss;ref.kdf /:

Qday

loss;ref

.d/ D

Qloss;ref.kdf / (cid:3) Qloss;ref..k (cid:3) 1/df /
df

(cid:2) d

(9.69)

In Fig. 9.21, Qday

loss;ref

of US06 driving.

.d/ is shown along with Qloss;ref.d/ for the case of three days

The linear reference Qday

loss;ref represents the maximum achievable capacity loss
trajectory over one day of driving and its purpose is to control fast capacity loss at
the beginning of each the driving day.

For implementation reasons, we deﬁne the maximum daily capacity loss to be
equal to the daily reference loss plus a tolerance value (in the positive direction only,
indicated as QC
loss;tol; this is assumed of the same value as the one used in Sect. 9.9
for the tolerance on (cid:12)Qloss, i.e. ﬁnal state deviation from the daily target, namely
D 0:00324 %):

Qloss;max.d/ D Qday

loss;ref

.d/ C QC

loss;tol

(9.70)

196

S. Marelli and S. Onori

The penalty function assumes then the following expression:

8
ˆˆˆ<
ˆˆˆ:

q.Qloss; d/ D 1 C g

(cid:8)

Qloss(cid:3)Qday
Q

C
loss;tol

loss;ref

.d/

(cid:9)
h

for Qday

loss;ref

.d/ < Qloss (cid:5) Qloss;max.d/
for Qloss (cid:5) Qday
.d/

loss;ref

q.Qloss; d/ D 1

(9.71)

It is worth noting that the q.Qloss; d/ function is asymmetrical with respect to
Qloss. The parameter g is the gain of the penalty function, and increasing its value
will result in an increase of the overall function value, as shown in Fig. 9.22;
the parameter h is the exponent of the penalty function, and its effect is to
change the function shape, as shown in Fig. 9.23. The ultimate effect of this change
in shape is in a delayed intervention of the function (as h increases) on the aging
cost in the instantaneous optimization. For large values of h the aging is weighted
more and more only for large values of Qloss (cid:3) Qday
.d/, whereas smaller values of
h are used when a more conservative approach on the aging is needed. In Fig. 9.24
the three-dimensional shape of the penalty function on capacity loss is presented
when driven distance is included as well.

loss;ref

In the following section, the tuning of AL-PMP is presented, which, ultimately,
02/.

consists in ﬁnding the optimal pair of initial values for the two costates .(cid:15)(cid:2)

01; (cid:15)(cid:2)

g = 1
g = 3
g = 10

)
¯d

,
s
s
o
l

Q

(
q

12

10

8

6

4

2

0

−1

1

0
Qloss (d¯)−Qloss,ref 

day

2
(d¯) [%]

3

x 10−3

Fig. 9.22 Shape of the penalty function on Qloss for different values of g and for a ﬁxed value of
d D Nd. Negative values on the abscissa indicate that the battery can age less than its target daily
value

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

197

h = 0.1
h = 0.5
h = 1
h = 3
h = 9

4.5

3.5

2.5

4

3

2

1

1.5

)
¯d

,
s
s
o
l

Q

(
q

2

1.8

1.6

1.4

1.2

)
d
,
s
s
o
l

Q
(
q

1
30

0.5

−1

0
Qloss( ¯d) − Qday

2
loss,ref( ¯d) [%]

1

3
x 10−3

Fig. 9.23 Shape of the penalty function on Qloss for different values of h, for a ﬁxed value of
d D Nd

20

d [mi]

10

0

−1

3

2

1

0

Qloss(d) − Qday

x 10−3
loss,ref(d) [%]

Fig. 9.24 Shape of the penalty function q.Qloss;d/, as a function of Qloss and d, with g D 1 and
h D 3

9.9 AL-PMP Solution via Map-Based Tuning

In this section, the problem of ﬁnding the optimal pair of values .(cid:15)(cid:2)
02/ in the
AL-PMP strategy, that gives minimum fuel consumption mf in Œkg(cid:11) over the ﬁrst
day of driving with both state of charge and capacity loss regulated to their target
values, is solved.

01; (cid:15)(cid:2)

198

S. Marelli and S. Onori

In the standard PMP solution, shooting method is used to iteratively tune (cid:15)0
in order to obtain charge-sustainability [5]. This is possible given the bijective
relationship between (cid:15)0 and SOC.df /. In the AL-PMP the two costate dynamics are
highly non-linear and coupled with no clear relation among them. For this reason, a
new approach is proposed to tune the optimal supervisory controller.

An initial guess value for both costates is deﬁned through the set ƒ0:

ƒ0 D f.(cid:15)01; (cid:15)02/ j (cid:15)01 2 ƒ01; (cid:15)02 2 ƒ02g

(9.72)

where the vectors ƒ01 and ƒ02 are given by

ƒ01 D Œ(cid:15)01;min W (cid:15)01;incr W (cid:15)01;max(cid:11)
ƒ02 D Œ(cid:15)02;min W (cid:15)02;incr W (cid:15)02;max(cid:11)

(9.73)

where the subscripts max and min are the maximum and minimum value for each
costate and the subscript incr stands for the increment selected for the costates
within that interval. Starting from each pair of initial values within the set ƒ0 AL-
PMP is solved (state and costate dynamics are integrated forward in time) and three
values are stored, namely:

(cid:129) mf ,
(cid:129) (cid:12)SOC D SOC.df / (cid:3) SOCref,
(cid:129) (cid:12)Qloss D Qloss.df / (cid:3) Qloss;ref.df /,
where (cid:12)SOC and (cid:12)Qloss are the deviation of SOC and Qloss from their target values
at the end of the driving horizon, SOCref for the state of charge and Qloss;ref.df / for
the capacity loss, respectively. Three matrices are built registering those ﬁnal values
for each pair of initial costates. These maps are easily plotted as function of (cid:15)01 and
(cid:15)02. From the generation of the three maps the optimal pair of costate is found as

.(cid:15)(cid:2)

01; (cid:15)(cid:2)

02/ D f.(cid:15)01; (cid:15)02/ j (cid:12)SOC D 0 ^ (cid:12)Qloss D 0g

(9.74)

The numerical value is found by means of the tuning algorithm presented next.

9.9.1 Tuning Algorithm Flowchart

The tuning procedure, summarized in the ﬂowchart of Fig. 9.25, is composed of the
following steps.3

3An important aspect of the tuning algorithm concerns the tolerances on the ﬁnal state values. The
approach followed in this work is as follows. Regarding SOC, a tolerance interval SOCtol D ˙1 %
is accepted for the charge-sustainability target. This means that all the values (cid:12)SOC 2 Œ(cid:3)1; 1(cid:11)%
are considered within the tolerance, and as such they are deﬁned sub-optimal values. The optimal
value is only one, i.e. (cid:12)SOC(cid:3) D 0, and it falls inside the tolerance interval. For Qloss a similar

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

199

1

2

3

4

5

6

8

9

Select initial intervals for λ01 and λ02

Solve ALPMP for each value of the 
matrix of pairs (λ01,λ02)

Build the three maps: 

1) mf (λ01,λ02) 
2)
3)

ΔSOC(λ01,λ02)
ΔQloss (λ01,λ02)

Build the contour plots out of the 
three maps

Overlap the contour plots of ΔSOC 
and ΔQloss

Are the two  sub-
optimal regions 
overlapping?

yes

yes

$(λ01,λ02):
ΔSOC=0 && ΔQloss=0

no

no

(λ01,λ02) is the optimal tuning

Fig. 9.25 AL-PMP tuning algorithm ﬂowchart

Update interval  for λ01 and λ02

7

1. The initial intervals for (cid:15)01 and (cid:15)02 are selected, thus vectors ƒ01 and ƒ02 and

2. For each point of the set ƒ0, i.e. pairs .(cid:15)01; (cid:15)02/, Problem 1 is solved.
3. mf , (cid:12)SOC, and (cid:12)Qloss are stored for each pair in ƒ0 and the corresponding maps

set ƒ0 are deﬁned.

are built.

4. The iso-value curves are plotted from the maps obtained in Step 3.
5. The contour plots of (cid:12)SOC and (cid:12)Qloss intersect.

relative tolerance is considered and computed as follows. Given an SOCtol D ˙1 % and a state of
100 D
charge target of SOCref D 50 %, the relative tolerance for SOC is given by SOCrel
˙2 %; the relative tolerance for Qloss is then Qrel
tol D ˙2 %. The target for capacity
loss, as explained in Sect. 9.2.1, for 4 US06 driving cycles (df D 32:14mi) is Qloss;ref.df / D
0:16205 %, which leads to Qloss;tol D 0:16205 %
.˙2 %/ D ˙0:00324 %. The sub-optimal values of
capacity loss deviation are (cid:12)Qloss 2 Œ(cid:3)0:00324; 0:00324(cid:11)% and the optimal value is (cid:12)Q(cid:3)
loss D 0.

loss;tol D SOCrel

˙1Œ%(cid:11)
50 %

tol D

100

200

S. Marelli and S. Onori

6. If the sets where both SOC.df / and Qloss.df / are within the tolerance, i.e.
(cid:12)SOC 2 SOCtol and (cid:12)Qloss 2 Qloss;tol exists, go to Step 8, otherwise go to
Step 7.

7. The solution is not found within the originally deﬁned initial guess values for the

costates, and the vectors ƒ01 and ƒ02 are updated.

8. The subset of ƒ0 for which both SOC.df / and Qloss.df / lie on their respective

target value, i.e. (cid:12)SOC D 0 and (cid:12)Qloss D 0, is found.

9. The point .(cid:15)(cid:2)

01; (cid:15)(cid:2)

02/ in the set ƒ0 such that Step 8 is veriﬁed is the optimal tuning.

9.10 Simulation Results

Simulation results are shown in this section that implements the algorithm of
Fig. 9.25. Four US06 driving cycles are simulated at an external temperature (cid:19)amb D
30ıC, where it is imposed SOCref D 50 %, SOCmin D 30 % and SOCmax D 70 %.

First, the initial intervals for the costates, as deﬁned in (9.73), are chosen (Step 1):

ƒ01 D Œ2:00 W 0:04 W 2:60(cid:11)
ƒ02 D Œ0:080 W 0:004 W 0:140(cid:11)

(9.75)

Note that the values of the initial costates are in general different from each other,
and that the resolutions are selected in order to have vectors of length not more
than 20; in this way ƒ0 contains not more than 400 points and the simulations take
around 2:5h as the most, on a machine with an Intel i7 quad-core processor @2GHz
and 6GB RAM. If better accuracy is required, a narrower and ﬁner interval can
be deﬁned around the optimal point. The AL-PMP is solved for each pair in ƒ0
(Step 2), and the output maps are obtained (Step 3) and depicted in Fig. 9.26.

The contour plots shown in Fig. 9.27 are obtained from the maps of Fig. 9.26
(Step 4). Next, the contour plots relative to (cid:12)SOC and (cid:12)Qloss are intersected
(Step 5) and their intersection is shown in the dark grey area of Fig. 9.28 (Step 6).
Within the shaded region of Fig. 9.28, the optimal tuning (the magenta dot on the
right-hand side of the ﬁgure) of AL-PMP is found (Step 8), and the optimal pair of
initial costates (Step 9) is

(

(cid:15)(cid:2)
01 D 2:3257
02 D 0:113
(cid:15)(cid:2)

(9.76)

When using the proposed tuning to execute the AL-PMP, the variation of the ﬁnal
states from their reference is found to be practically zero: (cid:12)SOC D (cid:3)0:036763 %
and (cid:12)Qloss D (cid:3)0:000046505 %. When applying the standard PMP (nominally,
solving Problem 2), a similar performance is obtained for SOC, as from Fig. 9.29,

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

201

Fig. 9.26 Maps obtained for
4 US06 driving cycles at
(cid:19)amb D 30ıC, with the choice
of initial costates from (9.75).
(a) Fuel consumption. (b)
Final state of charge variation
with respect to target. (c)
Final capacity loss variation
with respect to target

a

]
g
k
[

f

m

2.5

2.49

2.48

2.47

2.46

2.45
0.14

b

]

%

[

C
O
S
Δ

20

10

0

−10
0.14

c

]

%

[

s
s
o
l

Q
Δ

0.02

0.01

0

−0.01

−0.02
0.08

0.12

0.1

λ02

0.08

2

2.2

λ01

2.6

2.4

0.12

0.1

λ02

0.08

2

2.2

λ01

2.6

2.4

0.1

0.12

λ02

0.14

2.6

2.4

λ01

2.2

2

202

S. Marelli and S. Onori

Fig. 9.27 Contour plots
obtained for 4 US06 driving
cycles at (cid:19)amb D 30ıC, with
the choice of initial costates
as in (9.75). (a) Fuel
consumption. (b) Final state
of charge variation with
respect to target. (c) Final
capacity loss variation with
respect to target

a

0.14

0.13

0.12

2
0
λ

0.11

0.1

0.09

2.455

0.08

2

b

0.14

0.13

0.12

2
0
λ

0.11

0.1

0.09

−

5

0.08

2

c

0.14

0.13

2
0
λ

0.11

0.1

0.09

0.02

0.08

2

mf [kg]

2
.
4

6

2.455

2

.

4

8

5

2

.

4

2

.

4

8

7

5

2
.
4

2
.
4

7

6

5

2
.
4

6

2.4

5

5

ΔSOC [%]

5

3

−

1

1

1

5

1

3

9

5

−

3

−

1

1

3

2
.
4

9

5

2
.
4

9

2
.
4

8

5

2
.
4

2
.
4

8

7

5

2
.
4

2
.
4

7

6

5

2
.
4

6

1

5

1

3

9

2.1

2.2

2.4

2.5

2.6

2.3
λ01

2.1

2.2

2.4

2.5

2.6

−

3

−

1

3

1

2.3
λ01

ΔQloss [%]

−

0
.
0

1

−

0
.
0

0

3

2

4

0.0

0

3

2

4

0.0

1

2.3
λ01

−

0
.
0

1

−

0
.
0

0

3

2

4

0.0

0

3

2

4

2.1

2.2

2.4

2.5

2.6

0
.
0

0

3

2

4

0.12

0.0
1

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

203

0.0
1

2
0
λ

0.11

0.14

0.13

0.12

0.1

0.09

0.08

2

-

1

0

1

3

-
0

.0

0

3

2

4

0

0.0

0

3

2

4

ΔSOC ∈ SOCtol
ΔQloss ∈ Qloss,tol
intersection region
ΔSOC [%]
ΔQloss [%]
optimal tuning

0.0

1

2.3
λ01

0.118

0.116

2
0
λ

0.114

0.112

0.11

-
0

.0

0

0.

0

0

3

2

4

3

2

4

0

-
1

0

1

3

2.1

2.2

2.4

2.5

2.6

2.32

2.33

2.34

2.35

0.108

2.3

0.00324
2.31

-1

λ01

Fig. 9.28 Intersection of contour plots of Figs. 9.27b and c (left plot). The optimal solution
(i.e.,, tuning) is found by the intersection of the 0-contour levels of (cid:12)SOC and (cid:12)Qloss (as shown
on the right-hand side plot)

0

0

1

-0.00324

0

PMP
AL-PMP

]

%

[

C
O
S

70

65

60

55

50

45

40

35

30

0

500

1000

1500

2000

2500

t [s]

Fig. 9.29 Comparison of state of charge over the ﬁrst day of driving for PMP and AL-PMP: both
the strategies are able to regulate SOC to its reference value at the end of the day of driving

but Qloss is not limited, as shown in Fig. 9.30: the capacity loss is more than 40 %
higher than the target value (over the ﬁrst day of driving). As a result, the target EOL
will not be met, leading to a prematurely aged battery (when compared to vehicle
life). From a fuel economy standpoint, on the other hand, only a slight difference is
observed between PMP and AL-PMP, with just 0:56 % loss in terms of MPG for the
latter (37:3206 for PMP and 37:1115 for AL-PMP).

Hence, signiﬁcant reduction in battery aging at the price of a little worse fuel

consumption is achieved when applying AL-PMP.

 
204

S. Marelli and S. Onori

]

%

[

s
s
o
 l

Q

0.25

0.2

0.15

0.1

0.05

0

0

Qloss,ref (df )
PMP
AL-PMP

500

1000

1500

2000

2500

t  [s]

Fig. 9.30 Comparison of capacity loss over the ﬁrst day of driving for PMP and AL-PMP: only
AL-PMP is able to regulate Qloss to its reference value at the end of the day of driving

01; (cid:15)(cid:3)

Table 9.3 Comparison of
optimal initial costate pairs
.(cid:15)(cid:3)
02/ in AL-PMP for
different external
temperatures over 4 US06
driving cycles

(cid:4) amb ŒıC(cid:11)
20
25
29
30
31
32

œ(cid:3)
01
3:1964
3:0811
2:565
2:3257
1:8185
1:0068

œ(cid:3)
02
0:005954
0:019333
0:082397
0:113
0:18396
0:30417

In the following, AL-PMP solution is presented for different temperature

scenarios.

9.10.1 Results for Different Ambient Temperatures

Simulation results are presented for different external ambient temperatures, over
four US06 driving cycles. For each value of temperature considered, AL-PMP is
tuned as described in Sect. 9.9. The optimal initial values of the costates are reported
in Table 9.3 and shown in Fig. 9.31.

The optimal initial value of the ﬁrst costate decreases with increasing tempera-
ture, while the optimal second costate is increasing. This can be explained thinking
that higher temperatures represent more harmful conditions for the battery capacity
loss. Given that, the aging term in the Hamiltonian (9.28), multiplied by (cid:15)2, needs

 
9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

205

1
0
*
λ

2

3

1

0.2

2
0
*
λ

0.3

0.1

0

20

22

24

28

30

32

26
T [°C]

20

22

24

28

30

32

26
T [°C]

Fig. 9.31 Graphical representation of optimal initial costate values in AL-PMP for different
external temperatures

to be weighted more in the optimization strategy than the fuel consumption and the
battery charging/discharging term, the latter multiplied by (cid:15)1.

The activation of the aging penalty function on capacity loss is not required when
ambient temperature is below 33ıC. For temperatures equal or above 33ıC, the
penalty function needs to be activated to obtain optimal capacity loss regulation, i.e.
to ﬁnd the optimal pair .(cid:15)(cid:2)

02/ so that both (cid:12)SOC and (cid:12)Qloss are exactly zero.

01; (cid:15)(cid:2)

Nevertheless, simulation study shows that when the aging penalty function is not
used in high temperature conditions, sub-optimal solutions are found. Namely, two
ways are proposed to tune AL-PMP, which are presented in the following.
1. Tuning 1: optimal tuning is done for (cid:12)SOC, and only sub-optimality is guaran-
teed for (cid:12)Qloss; this means that (cid:12)SOC D 0, while (cid:12)Qloss is chosen to be as close
as possible to 0: the ﬁrst condition selects the points on the plane that lie on the
optimal SOC line, which is also within Qloss tolerance.

2. Tuning 2: optimal tuning is done for (cid:12)Qloss, and only sub-optimality is guaran-
teed for (cid:12)SOC; the points lie on the optimal Qloss line, i.e. (cid:12)Qloss D 0, and SOC
is within the allowable tolerance.

The initial costate values found for the simulations performed are

1. Tuning 1:

(

(cid:15)01 D 0:01
(cid:15)02 D 0:4640

(9.77)

206

S. Marelli and S. Onori

0.475

0.47

2
0
λ

0.465

0.46

0.455

0

1

0

0

-1

3

1

0

3

0

2

-0.0

ΔS OC ∈ SOCtol
ΔQloss ∈ Qloss,tol
intersection region
ΔS OC [%]
ΔQloss [%]
tuning 1
tuning 2

4

3

3

0

1

0.02

0.04

0.06

0.08

0.1

0

λ01

Fig. 9.32 Zoom on the intersection region of contour plots for 4 US06 driving cycles at (cid:19)amb D
33ıC: the proposed tunings for AL-PMP are indicated with an orange spot (1—optimal for (cid:12)SOC
only) and a black spot (2—close-to-optimal for (cid:12)Qloss only)

Table 9.4 Results for the proposed tuning 1 and tun-
ing 2 for (cid:19)amb D 33ıC, in terms of relevant quantities:
fuel consumption and ﬁnal SOC and Qloss deviations
from targets

Tuning
1
2

mf Œkg(cid:11) (cid:12)SOC Œ%(cid:11)
2:4844 (cid:3)0.031599
2:4862
0.87247

(cid:12)Qloss Œ%(cid:11)
0:00084542
0:0000053273

2. Tuning 2:

(

(cid:15)01 D 0:01
(cid:15)02 D 0:4687

(9.78)

as also shown in Fig. 9.32. Figures 9.33 and 9.34 show the results of the two tunings
in terms of SOC and capacity loss proﬁles and Table 9.4 reports the numerical values
of simulation outputs.

It is worth noting that the error on the target values for Qloss in the tuning 1 and
the error for SOC in the tuning 2 are very small. On the other hand, the capacity loss
obtained from standard PMP is not even close to Qloss;ref.df /: AL-PMP reduces Qloss
by more than 30 %, at the limited price of an increase of fuel consumption between
1:69 and 1:77 % (mf D 2:4430kg for PMP, see Table 9.4 for AL-PMP).

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

207

52

50

2390

2400

0.163
0.162
0.161
0.16
0.159

2380

2400

]

%

[
 

C
O
S

70

65

60

55

50

45

40

35

30

25

0.25

0.2

0.15

0.1

0.05

]

%

[
 

s
s
o
l

Q

0

0

tuning 1
tuning 2
SOCref

0

500

1000

1500

2000

2500

t [s]

Fig. 9.33 State of charge proﬁle for the proposed tuning 1 and tuning 2 for (cid:19)amb D 33ıC. Note
that SOC is below 30 % for a short time interval around t D 300s; this situation is penalized but
allowed by the penalty function on SOC, which is a soft constraint in the optimization

tuning 1
tuning 2
PMP
Qloss,ref(df )

500

1000

1500

2000

2500

t [s]

Fig. 9.34 Capacity loss proﬁle for the proposed tuning 1 and tuning 2 for (cid:19)amb D 33ıC. PMP
solution is also reported

9.10.2 Results with Penalty Function

If the penalty function on aging dynamics is used, on the other hand, an optimal
solution is found. From simulation results, at (cid:19)amb D 33ıC, when using the

208

S. Marelli and S. Onori

following calibration parameters for the aging penalty function:

the optimal pair for the initial costate values is

(

g D 3
h D 1

(

(cid:15)(cid:2)
01 D 2:5859
(cid:15)(cid:2)
02 D 0:025833

(9.79)

(9.80)

The resulting overlapped contour plots of (cid:12)SOC and (cid:12)Qloss are shown in
Fig. 9.35. In this case a well-deﬁned intersection is obtained, hence the optimal
solution is found.

Figure 9.36 shows the distribution of the operating points of the battery on the
severity factor map contour plot, as a function of state of charge and C-rate, for a
ﬁxed battery temperature, both for PMP and AL-PMP. The distribution of points
indicates that AL-PMP (b), compared to standard PMP (a), is effectively able to
reduce the harshness of the battery operating conditions, since the maximum value
reached in (cid:7)map is less than 20 instead of almost 30, with lower C-rate of operation
and larger state of charge range used. The engine efﬁciency map used by PMP and
AL-PMP is shown in Fig. 9.37.

0.028

0.027

2
0
λ

0.026

0.025

0.024

0.023

1

1

0

0

0

0

-
1

ΔSOC ∈ SOCtol
ΔQloss ∈ Qloss,tol
intersection region
ΔSOC [%]
ΔQloss [%]
optimal tuning

-
1

0

2.55

2.56

2.57

2.58

2.59

2.6

2.61

λ01

Fig. 9.35 Zoom on the intersection region of contour plots for 4 US06 driving cycles at (cid:19)amb D
33ıC: the optimal tuning for AL-PMP with penalty function on Qloss is indicated with a purple
spot

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

209

a

b

Fig. 9.36 Battery operating points on the severity factor map, for 4 US06 driving cycles at
(cid:19)amb D 33ıC: comparison between standard PMP (a) and AL-PMP (b)

Simulation results have shown that for extreme external temperatures combined
with aggressive driving cycles like US06, AL-PMP cannot prevent the battery from
aging more than the ﬁnal daily target, even with the introduction of the penalty
function. As an example, simulation results performed at (cid:19)amb D 40ıC and penalty
function parameters

are shown in Fig. 9.38 sub-optimal initial costates:

(

g D 3
h D 0:1

(

(cid:15)01 D 0:1
(cid:15)02 D 0:077

(9.81)

(9.82)

One can see that both with or without penalty function, AL-PMP is not able to
control capacity loss to its daily target. Nonetheless, the capacity loss is reduced
by approximately 35 % from the PMP solution, and by about 7:5 % with respect to
the AL-PMP solution without penalty function; furthermore, the ﬁnal value of Qloss,
although not equal to Qloss;ref.df /, is quite close to the target value.

210

a

S. Marelli and S. Onori

b

Fig. 9.37 Engine operating points for 4 US06 driving cycles at (cid:19)amb D 33ıC: comparison between
standard PMP (a) and AL-PMP (b)

Table 9.5 Simulation results
for AL-PMP with penalty
function (g D 3; h D 0:1)
at (cid:19)amb D 40ıC; comparison
between discharge and charge
phases

Average Ic Œ1=h(cid:11)
Average (cid:19) ŒıC(cid:11)
Average (cid:7)map Œ(cid:3)(cid:11)
Extracted Ah
Aheff

Total
3:0257
43:3322
4:5368
4:5472
34:9286

Discharge
1:9055
43:2484
3:7351
2:2807
10:1631

Charge
7:4036
43:6600
7:6703
2:2665
24:7655

In Table 9.5, discharge and charge battery events are compared for (cid:19)amb D 40ıC.
When using AL-PMP, only the discharge is being optimized. One can see that the C-
rate in charge is on average almost four times larger than in discharge, with slightly
higher temperature. Thus, on average the severity factor map is more than two times
higher in charge, and so are the Aheff, which are directly related to aging, [14]. This
means that the aging process takes place mostly during the charge phase (braking),
which is not controlled with the present strategy. On the other hand, the extracted Ah
are almost equal, as expected for a charge-sustaining HEV. This analysis emphasizes
the importance to control battery charging, as also shown in Fig. 9.39, where the
capacity loss proﬁle is shown distinguishing between the discharge and charge
phases. When Qloss is controlled (discharge), it stays approximately constant, or
increases at a small rate. When it is not controlled (charge), it undergoes important
upwards steps that prevent to meet the daily target.

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

211

Qday
loss,ref(d)
Qloss,ref(df )
PMP
AL-PMP w/o penalty
AL-PMP w/ penalty

]

%

[

)
d
(
s
s
o
l

Q

0.35

0.3

0.25

0.2

0.15

0.1

0.05

0

0

0.2

0.15

0.13

0.12

0.11

]

%

[
 

s
s
o
l

Q

0.1

0.05

0

0

5

10

15

20

25

30

35

d [mi]

Fig. 9.38 Capacity loss results for (cid:19)amb D 40ıC: comparison between PMP, AL-PMP with and
without penalty function

1000

1200

1400

Qloss  discharge
Qloss  charge

500

1000

1500

2000

2500

t [s]

Fig. 9.39 Capacity loss proﬁle for (cid:19)amb D 40ıC with the discharge and charge phases plotted
separately

Simulations over a week of US06 driving (six days) are shown in Fig. 9.40, with
(cid:19)amb D 30ıC. The capacity loss reference values at the end of each day is tracked
when using AL-PMP. Therefore, if battery degradation is not properly taken into
account by the EMS, ultimately, the situation arises that an early replacement of

212

S. Marelli and S. Onori

]

%

[
 

s
s
o
l

Q

0.3

0.6

0.5

0.4

0.2

0.1

0

0

Qloss PMP
Qloss AL-PMP
Qloss,ref(kdf )

1

2

4

5

6

3
Day #

Fig. 9.40 Capacity loss proﬁle over one week of simulation at (cid:19)amb D 30ıC; comparison between
reference values, results with standard PMP and with AL-PMP

the battery is needed. In Table 9.6 the results relative to the fuel consumption over
the ﬁrst week are shown. AL-PMP does not show a signiﬁcant worsening in fuel
economy when compared to PMP, showing that battery aging is much more sensitive
to the choice of the control parameters than fuel consumption.

9.11 Conclusions

In this paper a new capacity loss model identiﬁed from real HEV data is adopted,
from which a reference capacity loss proﬁle is extracted and used in the multi-
objective optimization strategy, referred to as AL-PMP. The AL-PMP is ﬁrst
formulated, and then solved with a new tuning algorithm. It is shown that both
the state of charge and capacity loss are regulated to their respective reference
values at the end of the ﬁrst day of driving, at the price of a small increase in fuel
consumption. For more severe driving conditions, a penalty function on capacity
loss allows to obtain the same optimal results, but for extreme scenarios aging
control is dominated by the uncontrolled charging phase. The same results obtained
for the ﬁrst day of driving are conﬁrmed by simulations performed over an entire
week of driving: both states are optimally controlled and the fuel consumption
is comparable to that of a standard (i.e., that does not account for aging) control
strategy.

9 Multi-Objective Supervisory Controller for Hybrid Electric Vehicles

213

Table 9.6 Fuel consumption obtained in simulation over the ﬁrst
week of driving at (cid:19)amb D 30ıC: results for standard PMP and AL-
PMP, and increase in fuel consumption of AL-PMP with respect
to PMP

Day #
1
2
3
4
5
6

mf Œkg(cid:11) PMP
2:4471
2:4471
2:4471
2:4470
2:4471
2:4470

mf Œkg(cid:11) AL-PMP
2:4573
2:4696
2:4717
2:4721
2:4724
2:4727

Increase in mf Œ%(cid:11)
0:417
0:922
1:008
1:022
1:036
1:050

As a possible future development of this work, in order to overcome the
limitations of AL-PMP, two paths are proposed, to be integrated within the present
solution:

(cid:129) A simple approach is to apply a rule-based braking strategy, to limit the
maximum braking power when temperature is above a certain safety threshold;
in this way a milder aging effect will be obtained in charging and this will be
sufﬁcient to optimally meet the daily goal Qloss;ref.df /, while maintaining charge-
sustainability.

(cid:129) Series braking, as implemented in this work, could be replaced by a more ad hoc
parallel braking strategy with the purpose of optimizing recuperation as proposed
in [25], and, at the same time, accounting for battery aging.
Abstract The air conditioning system is currently the largest ancillary load in
passenger cars, with a signiﬁcant impact on fuel economy and CO2 emissions.
Considerable energy savings could be attained by simply adopting a supervisory
energy management algorithm that operates the A/C system to reduce power
consumption of the compressor, while maintaining the cabin comfort requirements.
This chapter proposes a model-based approach to the design of a supervisory
energy management strategy for automotive air conditioning systems. Starting from
an energy-based model of the A/C system that captures the complex dynamics of
the refrigerant in the heat exchangers and the compressor power consumption, a
constrained multi-objective optimal control problem is formulated to jointly account
for fuel consumption, cabin comfort, and system durability.

The trade-off between fuel economy, performance, and durability is analyzed
by performing a Pareto analysis of a family of solutions generated using dynamic
programming. A forward-looking optimal compressor clutch policy is then obtained
by developing an original formulation of the Pontryagin’s minimum principle for
hybrid dynamical systems. The simulation results demonstrate that the proposed
control strategy allows for fuel economy improvement while retaining system
performance and driver comfort.

Keywords Automotive air conditioning systems (cid:129) Energy management (cid:129) Optimal
control

10.1 Introduction

In response to the increasing sustainability issues in transportation, the automotive
industry is striving to improve fuel economy. While several improvements have been
made to engines and transmissions for enhanced efﬁciency, considerable beneﬁts
could can be attained at relatively low cost by reducing the energy consumption
caused by the vehicle ancillary loads [1–3].

In particular, the air conditioning (A/C) system is one of the largest ancillary
loads in passenger car, with profound impact on fuel consumption. According to
[4], automotive A/C systems consume 5.5 % of the total annual automotive fuel
demand, corresponding to an average fuel economy drop of about 18 %. Similar
results were shown in [1], where the air conditioning compressor consumes up to
9 % of the engine power available at the crankshaft.

Signiﬁcant research activity has focused on mitigating the energy consumption
of vehicle A/C systems, for instance, by introducing variable displacement compres-
sors, or electrically driven compressors and expansion valves [5, 6]. More recently,
storage evaporators have been introduced to improve the cooling capacity when the
vehicle stops in trafﬁc [7].

Reduction in the energy consumption can also be achieved through the use of
control strategies. This concept was, for instance, explored in [8], where a heuristic
control was proposed to coordinate the compressor clutch engagement strategy with
vehicle coasting and braking operations, hence utilizing vehicle waste energy to
power the compressor. The results proposed show that up to 85 % of compressor
operations could be powered by vehicle brake energy in urban drive conditions.

On the other hand, the design of more formal, model-based supervisory control
strategies for A/C systems is particularly challenging due to the complex and
nonlinear system dynamics determined by the mass and energy storage of the
refrigerant in the heat exchangers, which affects the cooling load of the evaporator
and the power consumption of the compressor. The control design is further
complicated by the strong inﬂuence of the engine speed on the compressor ﬂow rate
and efﬁciency, as well as by the fact that the system typically operates intermittently
by engaging and disengaging the clutch connecting the compressor to the engine
crankshaft.

Few attempts have been made to solve the energy management of A/C systems
as a hybrid optimal control problem (HOCP). For instance, hybrid model predictive
control (HMPC) has been adopted for the optimization of residential and industrial
refrigeration systems [9–11]. However, in industrial refrigeration systems the focus
is on stabilizing the temperature of the storage space, while the short-term pressure
ﬂuctuations of the refrigerant in the evaporator and condenser are neglected. This
represents a signiﬁcant difference in comparison with automotive systems, where
the duty cycle of the compressor clutch is typically quite short, causing rapid
variations in the system pressures [12].

In this scenario, this chapter proposes a systematic approach to the design of a
supervisory energy management strategy for automotive air conditioning systems.
The approach is based on an energy-based, physics-based model of the A/C
system that captures the refrigerant dynamics, heat transfer at the evaporator, and
compressor power consumption caused by the clutch duty cycle and variations in
the boundary conditions (air ﬂow at condenser and evaporator). The model was
validated on experimental data collected from the A/C system of a passenger car.

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

219

The A/C system energy optimization is studied next, focusing on fuel consump-
tion, cooling performance (formulated through the tracking of a desired evaporator
pressure), and clutch durability. This allows one to cast a constrained multi-objective
optimal control problem for a nonlinear dynamical system, which is approached
by applying dynamic programming (DP) to generate a family of solutions that
determine a Pareto-optimal front.

A control strategy for the compressor clutch is then obtained through a novel
approach, which combines the embedding method for hybrid dynamical systems
and the Pontryagin’s minimum principle (PMP), resulting into a control algorithm
in forward-looking form.

The solution approach presented in this chapter for the energy optimization of
the A/C system indicates a general framework for solving optimal hybrid control
problem of vapor compression cycles, and could be extended to different classes of
vehicle ancillary loads (for instance, the vehicle electrical loads, or the powertrain
thermal management system).

This chapter is organized as follows. First, the energy-based A/C model con-
sidered in this study and its validation on vehicle data are described. Next, the
A/C system control problem is qualitatively introduced and formalized as a multi-
objective optimal control problem. The following section illustrates the dynamic
programming solution and Pareto analysis. Then, the methodology followed to
generate a forward-looking control policy is described, and a comparison with
dynamic programming is made.

10.2 Description of the A/C System Model

The air conditioning system of a passenger car is generally based on the simple
vapor compression cycle shown in Fig. 10.1. The compressor is engaged to the
engine crankshaft through a magnetic clutch, determining the mass ﬂow rate of
refrigerant that circulates the system and, ultimately, the heat transfer rate at the

Fig. 10.1 Plant diagram of
the A/C system

220

Q. Zhang et al.

evaporator and condenser. In order to better understand the notation used in the
following sections, Fig. 10.1 indicates the relevant thermodynamic states.

Since the A/C system typically operates in highly transient conditions due to the
on/off clutch control strategy, the thermodynamic states may change signiﬁcantly
[13]. This poses a signiﬁcant modeling challenge due to the different time scales
induced by the mass and energy transport, which become challenging due of the
phase changes.

10.2.1 Compressor Model

The ﬂow and power consumption of the compressor are typically described through
a quasi-static model [14, 15]. When the compressor is clutched to the engine, the
ﬂow rate and enthalpy are modeled based upon the characteristic maps expressed in
terms of volumetric efﬁciency and isentropic efﬁciency [16]:

Pmc D (cid:10) (cid:2) (cid:4)(cid:8)vVd(cid:3)1

Ne
6 (cid:2) 104

;

h2 D h1 C

h2s (cid:3) h1
(cid:8)s

(10.1)

where (cid:10) D Œ0; 1(cid:11) is the compressor clutch command, (cid:4) the pulley ratio, Ne the
engine speed, Vd the compressor displacement (cm3=rev), and h2s the enthalpy
corresponding to the isentropic compression 1 ! 2s.

The volumetric and isentropic efﬁciency are modeled as empirical functions of

the compressor speed and the pressure ratio PRD p2=p1 [15]:

(cid:8)v D

(cid:8)v0 (cid:3) (cid:17).PR1=(cid:9) (cid:3) 1/
1 C C1Z2

(cid:8)s D (cid:8)s0 (cid:3) C2 .PR (cid:3) 1/ (cid:3) Z .C3 (cid:3) C4 .PR (cid:3) 1//

where the Mach index Z is deﬁned as:

Z D

1=3
d

(cid:3)1Nc
V
6 (cid:2) 104p
p1

(10.2)

(10.3)

and in this equation Nc D (cid:4) (cid:2) Ne is the compressor rotational speed, which is scaled
with respect to the engine speed Ne by a constant pulley ratio (cid:4).

The enthalpy rise corresponding to the isentropic compression 1 ! 2s is
expressed as a function of the pressure ratio and thermodynamic condition at the
suction side:

.h2s (cid:3) h1/ D h1 .p1; T1/ (cid:2)

(cid:2)

(cid:9) (cid:2)1

PR

(cid:9) (cid:3) 1

(cid:3)

(10.4)

where (cid:9) is the speciﬁc heat ratio for the refrigerant.

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

221

The power output Pc and torque demand (cid:4)c are computed by combining the

previous equations:

Pc D

Vd(cid:3)1

(cid:8)v
(cid:8)s

(cid:4)c D

1
2(cid:10) (cid:2) 103

Nc
6 (cid:2) 104 h1 .p1; T1/ (cid:2)
(cid:8)v
(cid:8)s

Vd(cid:3)1h1 .p1; T1/ (cid:2)

(cid:2)

(cid:2)

(cid:9) (cid:2)1

PR

(cid:9) (cid:3) 1

(cid:3)

(cid:3)

(cid:9) (cid:2)1

PR

(cid:9) (cid:3) 1

(10.5)

The parameters of the above model, (cid:8)v0; (cid:17); C1; (cid:8)s0; C2; C3; C4 are identiﬁed on
the compressor performance maps provided by the supplier.

Finally, the total torque required at the engine is obtained by adding the
compressor torque load to the baseline engine torque proﬁle acquired from the
experimental data collected on the vehicle:

(cid:4)tot D (cid:4)e C (cid:4)c

(10.6)

The total torque is used with the engine speed to calculate the instantaneous engine
fuel consumption through a look-up table generated from engine experimental data.

10.2.2 Heat Exchangers Models

The energy-based modeling approach proposed in [17] is applied here to obtain
models for the condenser and evaporator heat exchangers. The model is based upon
the following assumptions:

1. Each heat exchanger is modeled as a lumped thermal mass with two control
volumes representing, respectively, the volume occupied by the refrigerant
circulating in the tubes and the metal mass (walls);

2. The compliance effects relative to the variations in mass ﬂow rate in or out
of the heat exchangers are negligible, hence the refrigerant mass ﬂow rate
predicted by the compressor model is uniform throughout the system. This
assumption preserves the low-frequency dynamics, driven mainly by the heat
transfer [18, 19].

3. The refrigerant within each heat exchanger is assumed present only in two-
phase, hence neglecting phase changes. While this represents a drastic simpli-
ﬁcation of the physical behavior, the contribution of superheat or subcooled
regions to the heat transfer is in practice limited [20];

4. The heat transfer dynamics is typically dominated by the ﬂuid with the lowest
convective heat transfer coefﬁcient, namely the external air [21]. Therefore, the
heat transfer from the refrigerant to the walls is assumed inﬁnitely fast [20].

Considering the schematic of a simple cross-ﬂow heat exchanger, for instance,
the one shown in Fig. 10.2, the spatially averaged refrigerant temperature T and
wall temperature Tw are determined by the refrigerant mass ﬂow rate, Pm, inlet

222

Q. Zhang et al.

Fig. 10.2 Schematic of heat exchanger for the energy-based model

enthalpy, hin, and by the air mass ﬂow rate Pma and inlet temperature Ta;in. Under the
above assumptions, an energy balance can be formulated for the refrigerant control
volume:

V

d
dt

.(cid:3)u/ D PQin C Pm .hin (cid:3) hout/

(10.7)

where (cid:3) is the average refrigerant density and u the speciﬁc internal energy.
Similarly, an energy balance applied to the wall thermal mass leads to:

where M is the metal mass of the heat exchanger, and c the speciﬁc heat.

Expressing the internal energy as a function of the average refrigerant enthalpy h,
and applying the deﬁnition of averaged refrigerant property, the following equation
is obtained:

Mwc

dTw
dt

D PQout (cid:3) PQin

u D h (cid:3)

p
(cid:3)

(cid:3)h D .1 (cid:3) N(cid:9) /(cid:3)lhl C N(cid:9) (cid:3)ghg

(10.8)

(10.9)

where (cid:9) represents the mean void fraction of the refrigerant, and (cid:3)g; hg; (cid:3)l; hl are
the refrigerant thermodynamic properties calculated at saturated vapor and saturated
liquid state. All of these properties depend only on the refrigerant pressure [22, 23].

Substituting Eq. (10.9) into the left-hand side of Eq. (10.7):

(cid:6)
.1 (cid:3) N(cid:9) /

D

d.(cid:3)u/
dt

@(cid:3)lhl
@p

C N(cid:9)

@(cid:3)ghg
@p

(cid:4)
(cid:3)ghg (cid:3) (cid:3)lhl

C

(cid:5) @ N(cid:9)
@p

(cid:7)

(cid:3) 1

dp
dt

(10.10)

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

223

where the term Œ (cid:2) (cid:11) is only a function of the refrigerant pressure and can be pre-
computed analytically or through look-up tables from the R134a thermodynamic
tables.

Note that the high thermal conductivity of the heat exchanger walls material
and the high convective heat transfer coefﬁcient of the refrigerant in the two-phase
state typically result into a wall temperature that closely follows the refrigerant
temperature. This makes it possible to introduce a further approximation, namely
lumping the wall thermal mass into the refrigerant thermal mass:

Mwc

(cid:6) Mwc

D PQout (cid:3) PQin

dTw
dt

dT
dt

(10.11)

Since the refrigerant within the heat exchanger is approximated to a two-phase
system, the temperature is equal to the saturation temperature at the refrigerant
pressure, hence:

(cid:8)

(cid:9)

@T
@p

dp
dt

Mwc

D PQout (cid:3) PQin

(10.12)

Substituting to Eq. (10.8), the energy balance equation for the entire heat exchanger
(considering the refrigerant and the wall thermal mass) results:

(cid:6)

V

.1 (cid:3) N(cid:9) /
(cid:8)

C

Mwc
V

@(cid:3)lhl
@p
@T
@p

C N(cid:9)

(cid:9)(cid:7)

dp
dt

@(cid:3)ghg
@p

(cid:4)
(cid:3)ghg (cid:3) (cid:3)lhl

C

(cid:5) @ N(cid:9)
@p

(cid:3) 1

D PQout C Pm .hin (cid:3) hout/

(10.13)

Equation (10.13) is the ﬁnal form of the energy balance for a heat exchanger with
predominant two-phase ﬂow, under the assumptions described above. Applying to
the evaporator and the condenser, Eq. (10.14) is obtained, where the subscripts e and
c indicate the evaporator and condenser heat exchanger, respectively. In obtaining
the equation, the following assumptions are made for simplicity:

1. The condenser inlet enthalpy h2 is given by the compressor model;
2. The evaporator inlet enthalpy h4 is the same as the condenser outlet enthalpy h3,

and approximated as equal to the saturated liquid enthalpy hl .p2/;

3. The temperature at the exit of the evaporator is regulated by the expansion valve,
which is assumed to set a constant superheat temperature (cid:12)TSH D T1(cid:3)Tg .p1/ D
10 ıC;

4. The evaporator outlet enthalpy h1 is calculated assuming that thermodynamic

state 1 is deﬁned by the state .p1; T1;

Ve

.1 (cid:3) N(cid:9)e/

e

C

(cid:3)ghg (cid:3) (cid:3)lhl

(cid:3) 1 C

224

"

dp1
dt
"

dp2
dt

(cid:5)

(cid:5)

(cid:4)

(cid:4)

@ .(cid:3)lhl/
@p1

e

C N(cid:9)1

(cid:4)

@

(cid:3)ghg
@p1

D PQe C Pmc .h4 (cid:3) h1/

@ .(cid:3)lhl/
@p2

c

C N(cid:9)c

(cid:4)

@

(cid:3)ghg
@p2

D (cid:3) PQc C Pmc .h2 (cid:3) h3/

Q. Zhang et al.

(cid:8)

(cid:9)#

Mwece
Ve

@T1
@p1

(cid:8)

(cid:9)#

Mwccc
Vc

@T2
@p2

(cid:5)

e

@ N(cid:9)e
@p1

(cid:5)

c

@ N(cid:9)c
@p2

Vc

.1 (cid:3) N(cid:9)c/

c

C

(cid:3)ghg (cid:3) (cid:3)lhl

(cid:3) 1 C

The heat transfer rates in Eq. (10.14) are relative to the external heat exchange

between the walls and the ambient air, and given by:

PQe D Pma;ecp;a .Ta;in;e (cid:3) Ta;out;e/

PQc D Pma;ccp;a .Ta;out;c (cid:3) Ta;in;c/

Neglecting the thermal mass of the air, the outlet air temperatures can be
calculated in quasi-steady conditions by applying the (cid:17) (cid:3) NTU method [24]. Note
that the model considered in this study assumes two-phase ﬂow within the two
heat exchangers, leading to a special case where the heat exchangers behavior is
independent of the ﬂow arrangement. Therefore the effectiveness is given by:

(cid:17) D 1 (cid:3) exp .(cid:3)NTU/

(10.16)

and applying the deﬁnition of effectiveness:

Ta;out;e D Te C .Ta;in;e (cid:3) Te/ exp .(cid:3)NTUe/
Ta;out;c D Tc C .Ta;in;c (cid:3) Tc/ exp .(cid:3)NTUc/

For compact heat exchangers, the number of transfer units is generally deﬁned

as [21, 25]

NTU D

˛AsŒ1 (cid:3) Fﬁn.1 (cid:3) (cid:8)FA/(cid:11)
Pmacp;a

where ˛ is the air heat transfer coefﬁcient, AS is the heat exchanger external surface
area, Fﬁn is the fraction of air-to-structure surface area on ﬁns, and (cid:8)FA is the air side
ﬁn efﬁciency. The numerical values for the above parameters are typically available
from the heat exchanger manufacturer.

(10.14)

(10.15)

(10.17)

(10.18)

D .x/ Px D f .x; u; v/
y D g .x; u; v/

x .t/ D

(cid:6)

(cid:7)

p1 .t/
p2 .t/

y .t/ D Œ(cid:4)c .t/(cid:11)

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

225

10.2.3 Final Form of the A/C System Model

The energy-based A/C model equations characterize a two-state nonlinear system
that can be expressed in descriptor form:

where the states are the pressures in the evaporator and condenser:

and the output is the torque absorbed by the A/C compressor:

The controlled input to the A/C model is the compressor clutch command:

u .t/ D Œ(cid:10) .t/(cid:11)

s:t: (cid:10) D .0; 1/

(10.22)

and, ﬁnally, the external input is represented by the rotational speed of the
compressor shaft:

v .t/ D ŒNc .t/(cid:11)

(10.23)

Note that, for simplicity, the ﬂow rate and inlet temperature of the air at the
evaporator and condenser are assumed constant and will be treated as parameters.

Based on Eq. (10.14), the system matrix results:
(cid:7)

D .x/ D

(cid:6)
d1;1 0
0 d2;2

where:

(10.19)

(10.20)

(10.21)

(10.24)

(10.25)

"

(cid:4)

"

(cid:4)

d1;1 DVe

.1 (cid:3) N(cid:9)1/

@ .(cid:3)lhl/
@p1

e

(cid:5)

e

@ N(cid:9)1
@p1
@ .(cid:3)lhl/
@p2
(cid:5)

c

@ N(cid:9)2
@p2

c

@

(cid:5)

(cid:4)
(cid:3)ghg
@p1

C N(cid:9)1

e

C

(cid:8)

c

C
(cid:8)

@T1
@p1

@T2
@p2

(cid:9) #

(cid:9) #

Mwece
Ve
(cid:4)
(cid:3)ghg
@p2

(cid:5)

Mwccc
Vc

C

(cid:3)ghg (cid:3) (cid:3)lhl

d2;2 DVc

.1 (cid:3) N(cid:9)2/

(cid:3) 1 C

@

C N(cid:9)2

C

(cid:3)ghg (cid:3) (cid:3)lhl

(cid:3) 1 C

226

Q. Zhang et al.

The resulting D matrix is diagonal, indicating that the refrigerant dynamics in the

two heat exchangers are partially independent.

The coupling between the evaporator and condenser heat exchangers is evident
in the right-hand side of the governing equations, and is due to the refrigerant ﬂow
rate circulating in the A/C loop:

"

f .x; u; v/ D

Pma;ecp;a .Ta;in;e (cid:3) Ta;out;e/ C Pmc .h4 (cid:3) h1/
Pma;ccp;a .Ta;out;c (cid:3) Ta;in;c/ C Pmc .h2 (cid:3) h3/

#

(10.26)

The control input to the A/C model is the compressor clutch command. When
the clutch is connected ((cid:10) D 1), the compressor rotates at a multiple of the engine
speed (the two differ by a constant pulley ratio). The clutch command (cid:10) enters
implicitly in Eq. (10.26), through the dependence of the refrigerant ﬂow rate Pm from
the compressor shaft speed. On the other hand, when the clutch is disconnected, the
A/C system is decoupled from the engine crankshaft and the refrigerant ﬂow rate Pm
is zeros.

10.2.4 Model Calibration and Validation

Most of the parameters of the energy-based model can be easily related to design
and geometric data of the heat exchangers, as well as to the properties of the ﬂuids.
In addition, since the heat transfer coefﬁcients on the refrigerant side have been
neglected due to their high value, only the air side is considered in the model.
The correlations to calculate the heat transfer coefﬁcients adopted in this work are
speciﬁc to cross-ﬂow compact heat exchangers with louvers and ﬁns, and have been
proposed by Chang and Wang [26] and Kim and Bullard [27].

This simpliﬁes the calibration process to identifying two multipliers, k˛e;a and
k˛c;a, which correct the heat transfer correlations for the air side of the two heat
exchangers. The calibration procedure is qualitatively described in Fig. 10.3 [12].

The identiﬁcation was conducted on the complete A/C system model, starting
from experimental data collected from a test vehicle. Experimental tests were
conducted by running the vehicle at constant speed on a chassis dynamometer,
to maintain engine speed values of 700, 1500, and 2500 rpm, respectively. The
boundary conditions at the heat exchangers (air temperature and ﬂow rate) were
monitored but not actively controlled, hence leaving the cabin blower and condenser
fan to operate according to the A/C system settings. The recorded engine speed Ne
and clutch signal (cid:10) are input to the model to calculate the pressure traces in the
condenser and evaporators, which were then compared against the corresponding
measured data.

The heat transfer multipliers were calibrated at a single speed (700 rpm), to
minimize the RMS error on the condenser and evaporator pressure, ultimately

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

227

Fig. 10.3 Calibration procedure for the energy-based A/C model

Table 10.1 RMS error for the calibration and validation

Engine speed
RMS evaporator
RMS condenser

700 rpm
21.47 kPa (3.5 %)
20.19 kPa (3.3 %)

1500 rpm
22.67 kPa (3.7 %)
35.94 kPa (5.9 %)

2500 rpm
25.59 kPa (3.5 %)
75.51 kPa (12.5 %)

ﬁnding k˛e;a D 0:4 and k˛c;a D 0:25. The model was then validated by comparing
the prediction to the experimental data at the other two engine speed conditions.

A summary of the results of the calibration procedure is shown in Table 10.1,
reporting the RMS errors calculated on the condenser and evaporator pressures for
the three cases considered. It is clear that the prediction error on the condenser
pressure p2 increases with the engine speed. This is mainly a consequence of
neglecting the presence of the receiver/dryer shown in Fig. 10.1, whose ﬁlling-and-
emptying dynamics affects the condenser pressure ﬂuctuation amplitude. On the
other hand, the error on the evaporator pressure p1 remains limited for all cases, and
is mainly driven by the simplifying assumptions adopted for deriving the energy-
based model.

If more accuracy is desired, the above discrepancies could be mitigated by
scheduling the heat transfer multipliers based on the engine speed and boundary
conditions at the two heat exchangers.

Finally, a ﬁnal test was conducted to verify the ability of the model to predict
the energy consumption of the A/C system during transients. To this extent, a
comparison was conducted against experimental data collected on the SC03 air
conditioning test cycle.

Figure 10.4a reports the vehicle speed proﬁle and the clutch command to the
compressor. These two signals are inputs to the model, and the simulated evaporator
pressure and fuel consumption are compared to the test data.

228

Q. Zhang et al.

Fig. 10.4 Veriﬁcation of the
energy-based model on the
SC03 driving cycle.
(a) Engine speed and clutch
proﬁles. (b) Evaporator
pressure and cumulative fuel
consumption

a

]
h
p
m

[
 
d
e
e
p
S
 
e
c
h
e
V

l

i

]

−

[
 

d
n
a
m
m
o
C
h
c
t
u
C

 

l

60

50

40

30

20

10

0

1

0.8

0.6

0.4

0.2

b

]
a
P
k
[
 
e
r
u
s
s
e
r
P

]

g

[
 

n
o

i
t

p
m
u
s
n
o
C

 
l

e
u
F

700

600

500

400

300

200

100

500

400

300

200

100

Model
Data
No AC

0

0

100

200

300

400

500

600

Time [s]

Model
Data

0

0

100

200

300

400

500

600

Time [s]

The results in Fig. 10.4b show that the model retains sufﬁcient accuracy in
predicting both outputs. In particular, the RMS error on the evaporator pressure
remains below 5 %, while the model predicts the effects of the A/C system on the
cumulative fuel consumption with less than 1:2 % error.

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

229

10.3 Formulation of the Energy Optimization Problem

The objective of a supervisory controller for the automotive A/C system is to operate
the system in a way that reduces the compressor parasitic load in relation with the
vehicle and engine operations, while maintaining the cabin comfort requirements
and ensuring the reliability of the compressor clutch.

As a preliminary step towards control design, an optimization study is done to
evaluate how to prioritize the aforementioned objectives. The ﬁrst term considered
is the total fuel consumption over a driving proﬁle:

Z

T

0

J1 D

Pmfuel.t/dt

(10.27)

where Pmfuel.t/ is the instantaneous fuel consumption of the engine. This term is
obtained from the steady-state engine fuel consumption map implemented in the
model, as a function of the engine speed and input torque. The effects of the ancillary
loads are accounted for by adding the compressor torque to the engine torque, which
is a time-varying external input dependent on the speciﬁc driving proﬁle.

While optimizing for fuel economy, the controller must also maintain a level of
comfort in the vehicle cabin. Without this objective, the solution of above optimal
control problem would be trivial. Since modeling the thermal dynamics of the cabin,
and the relative forms of heat rejection is overly complex and outside the scope
of this work, the cabin comfort requirement is translated into a target pressure at
the evaporator. This simpliﬁcation is acceptable because the cooling load at the
evaporator is largely a function of the refrigerant pressure (since the refrigerant is
predominantly present in two-phase form). For this reason, a second term of the
objective function represents a tracking error:

J2 D

.p1.t/ (cid:3) p1;0/2dt

(10.28)

where p1 is the actual evaporator pressure and p1;0 is a reference value for the
evaporator pressure. The solution of this optimal control problem will represent a
trade-off between potential fuel savings and the temperature in the vehicle cabin.

Finally, to address both drivability issues and potential durability problems, an
additional cost function is considered to prevent high frequency switching in the
clutch signal:

J3 D

.(cid:10).t/ (cid:3) (cid:10).t (cid:3) (cid:12)t//2dt

(10.29)

where (cid:10).t/ is the current clutch position, (cid:10).t (cid:3) 1/ is the clutch position at the
previous time step, and (cid:12)t is the discretization time.

Z

T

0

Z

T

(cid:12)t

In summary, the objective function for the A/C system optimization problem is

Q. Zhang et al.

230

given by:

J D ˛J1 C ˇJ2 C (cid:9) J3

(10.30)

where ˛, ˇ, and (cid:9) are the weighting factors. Moreover, the evaporator and the
evaporator pressures are subject to state constraints:

p2 (cid:5) p2;max

p1 (cid:8) p1;min

(10.31)

(10.32)

From the above deﬁnition, it is clear that multiple conﬂicting objectives are
present, which lead to the presence of non-dominated optimal solutions dependent
upon the choice of the weighting factors.

10.3.1 Solution and Analysis

The dynamic programming (DP) algorithm is chosen as an off-line optimization
method for solving the optimal control problem formulated above [28]. The plant
model is discretized using the Euler forward scheme and the method developed in
[29] is applied.

In order to remove the inﬂuence of the units and scales, the three objective
functions J1, J2, and J3 are normalized against the total fuel consumption over
the SC03 drive cycle, the maximum RMS error on the evaporator pressure, and a
maximum number of clutch switching events for the SC03 cycle.

Since the energy optimization problem consists of multiple objective functions
with conﬂicting goals, the solution of the optimal control problem for different
weighting factors consists in a set of non-dominated solutions. The Pareto analysis
becomes a useful tool to provide a graphical representation of a trade-off between
at least two performance variables in a system and to investigate how the weighting
factors ˛, ˇ, and (cid:9) affect the A/C system performance in terms of fuel consumption,
evaporator pressure tracking, and clutch on–off operations. A large number of
simulations were conducted to explore the parameter space ˛ (cid:4) ˇ (cid:4) (cid:9) in the range
Œ0

1(cid:11) (cid:4) Œ0
The results of the simulation are represented in Fig. 10.5, in the space deﬁned by
the three objective functions. Since each simulation was generated using dynamic
programming, each solution found corresponds to the result of an optimal clutch
engagement policy for a speciﬁc combination of weights. A clear trade-off behavior
among the three objective functions can be readily observed.

1(cid:11) (cid:4) Œ0

1(cid:11).

In addition to the results from the dynamic programming, the point correspond-
ing to a simulation conducted by imposing the clutch proﬁle measured on the vehicle
for the SC03 cycle is represented. This point will be henceforth indicated as the
Baseline Condition, and will be used as a benchmark for comparing the performance
offered by different optimization solutions.

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

231

Baseline

)
t

n
e
m
e
g
a
g
n
E
 
h
c
t
u
C

l

(
 

3

J

0.25

0.2

0.15

0.1

0.05

0
1.04

1.02

1

0.98

J1 (Fuel Consumption)

0.96

0.94

0.8

0.6
J2 (Tracking Error)

0

0.2

0.4

Fig. 10.5 Pareto-optimal surface resulting from dynamic programming

To better understand the trade-offs between objective functions, the results were
sorted into three different groups, based on similar values of the objective function
J3, and then projected onto a 2D plane in the variables J1 and J2. The results are
summarized in Fig. 10.6. The ﬁgures clearly illustrate the existence of a Pareto front
among the three objective functions. Of particular interest is the trade-off between
J1 and J2, which indicates the complexity of jointly optimize the A/C system for
cabin comfort and for fuel economy.

Moreover, Fig. 10.6 shows that there is an opportunity to jointly optimize all
of the three performance outputs from the baseline condition through optimal
control, as the baseline point is not located on the Pareto-optimal front. In this
case, it is necessary to evaluate which objective function should be prioritized for
the system optimization. In particular, results show that it is possible to achieve a
2 % improvement in the fuel consumption over the SC03 cycle, without penalizing
the tracking performance. This can be obtained by moving horizontally from the
baseline point towards the Pareto front.

To illustrate the effect of the weighting factors on the state evolution and the
control policy, the three scenarios summarized in Table 10.2 have been selected for
comparison against the baseline controller. The values reported below correspond
to the solution obtained with the backward-looking simulator.

The clutch proﬁle and resulting evaporator pressure are shown in Fig. 10.7 for

the baseline case and for the three optimized scenarios.

Scenario 1 represents a case where the target evaporator pressure is prioritized
over the other two objectives. From Table 10.2, this strategy results into the lowest
tracking error, but signiﬁcant chattering of the A/C compressor clutch occurs.
Note that, even in this limit case, the fuel consumption calculated on the SC03

232

Q. Zhang et al.

Fig. 10.6 Pareto-optimal
fronts obtained from the
surface in Fig. 10.5 at three
different values of J3.
(a) Pareto curve for
0:03 (cid:5) J3 (cid:5) 0:4. (b) Pareto
curve for 0:04 (cid:5) J3 (cid:5) 0:05.
(c) Pareto curve for
0:04 (cid:5) J3 (cid:5) 0:05

2

J

0.2

0
0.94

a

)
r
o
r
r

i

E
 
g
n
k
c
a
r
T
(
 

b

)
r
o
r
r

i

 

E
g
n
k
c
a
r
T
(
 

c

)
r
o
r
r

i

E
 
g
n
k
c
a
r
T
(
 

0.6

0.5

0.4

0.3

0.1

0.6

0.5

0.4

0.2

0.1

0.6

0.5

0.4

0.3

0.1

2

J

0.3

2

J

0.2

0
0.94

0.96

0.98

1

1.02

1.04

J1 (Fuel Consumption)

Baseline

0
0.94

0.96

0.98

1

1.02

1.04

J1 (Fuel Consumption)

0.96

0.98

1

1.02

1.04

J1 (Fuel Consumption)

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

233

Table 10.2 Comparison between optimal scenarios and baseline

˛

–

Baseline
Scenario 1
0.1
Scenario 2 (cid:3)1.0
Scenario 3 (cid:3)0.1

ˇ

–
0.8
0.1
0.4

(cid:9)

–
0.1
0.2
0.4

J1
0.9985
0.9579
0.9496
0.9654

J2
0.0702
0.0136
0.110
0.0353

J3
0.0474
0.1920
0.0645
0.1005

Mfuel (g) RMSp (%)
415.9
399.1
395.6
402.2

31 %
14
37
21

nclutch
29
105
37
61

cycle is still lower than in the baseline case. Scenario 2 relaxes the weight on the
evaporator pressure tracking and achieves the best fuel economy, without signiﬁcant
deterioration of the system performance and clutch usage. Finally, Scenario 3
attempts at striking a balance between the previous two scenarios. As Fig. 10.7
shows, this choice of weights leads to a more precise tracking of the pressure target
at the evaporator, when compared to Scenario 2. On the other hand, this is achieved
at the expense of the fuel consumption, which results higher than the other two
scenarios.

For the derivation of the forward-looking energy management strategy, the
weight combinations of Scenario 2 have been selected and will be used in the next
section.

10.4 Control Design for A/C System Energy Management

The analysis conducted above indicates that the A/C system is characterized by a
short-term thermal energy storage capacity, which could be leveraged to save energy
when the vehicle is decelerating or braking and reuse it during acceleration.

To this extent, the PMP is a technique that has been successfully applied in the
past to solve fuel-optimal control problems for hybrid vehicles [30]. While this
method provides only a set of necessary conditions for optimality, in some cases
simple adaptive control schemes can be designed by exploiting information on the
co-state dynamics [31].

On the other hand, the A/C system energy optimization is a considerably different
problem, due to the highly nonlinear dynamics of the system and the presence of a
penalty on switching in the objective function.

To this extent, a novel approach is here adopted, based on the hybrid optimal
control theory. Speciﬁcally, the A/C system energy management, namely an optimal
control problem with switching inputs and cost of switching, is transformed
into a conventional, continuous-time optimal control by embedding the discrete
inputs, then projecting the so-obtained equivalent control into the discrete domain.
The approach adopted in this chapter is based on the work proposed by [32],
presenting a uniﬁed approach to obtain optimal control policies for switching
systems.

234

Q. Zhang et al.

Fig. 10.7 Comparison of
clutch proﬁle and evaporator
pressure during SC03 cycle
for different optimization
scenarios. (a) Baseline
scenario (Production control).
(b) Optimized scenario 1
(Priority on tracking).
(c) Optimized scenario 2
(Priority on fuel economy).
(d) Optimized scenario 3
(Balanced tracking and fuel
economy)

a

]

−

[
 
h
c
t
u
C

l

]
a
P
k
[
 
e
r
u
s
s
e
r
P

b

]

−

[
 

h
c
t

l

u
C

]

a
P
k
[
 

e
r
u
s
s
e
r
P

c

]

−

[
 

h
c
t

l

u
C

]

a
P
k
[
 

e
r
u
s
s
e
r
P

d

]

−

[
 
h
c
t
u
C

l

]
a
P
k
[
 
e
r
u
s
s
e
r
P

1

0.5

0
600

500

400

300

200

100

1

0.5

0
600

500

400

300

200

100

1

0.5

0
600

500

400

300

200

100

1

0.5

0
600

500

400

300

200

100

0

100

200

300

400

500

600

Time [s]

0

100

200

300

400

500

600

Time [s]

0

100

200

300

400

500

600

Time [s]

0

100

200

300

400

500

600

Time [s]

The procedure was originally derived for a general switched system, formulating
sufﬁcient and necessary conditions for the optimality of the solution for a two-
switched system, where the dynamic of the system for x.t/ 2 Rn is described by:

Px.t/ D fs.t/.t; x.t/; u.t//;

x.t0/ D x0

(10.33)

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

235

where at each t (cid:8)0, s.t/ 2 f0; 1g is the switching control, u.t/ 2 (cid:22) (cid:10) Rm is the
constrained control input constraint in the compact set (cid:22), f0; f1 W R(cid:4)Rn(cid:4)Rm (cid:3)! Rn
are real vector-valued functions of class C1.

For ﬁnding the optimal solution, the problem is embedded into a larger family
of systems and the optimal control problem is reformulated for the new system. It
has been demonstrated that the set of optimal trajectories of the switching system
is dense in the set of the optimal trajectories of the embedded system. Therefore,
it is always possible to approximate the solution of the embedded control with an
appropriate switching control [32].

The governing equations for the A/C system model are ﬁrst rewritten as a class

of hybrid systems:

dp1
dt

dp2
dt

D

D

1

d11
1

d22

(cid:2) f (cid:10)

1 .p1; p2; t/

(cid:2) f (cid:10)

2 .p1; p2; t/

(10.34)

where the functions f (cid:10)

1 and f (cid:10)

2 are deﬁned as:

(

(

f (cid:10)
1 .p1; p2; t/ D

(cid:3) PQe C Pmc.h4 (cid:3) h1/
(cid:3) PQe

if (cid:10) D 1
(cid:10) D 0:
if

(10.35)

and

f (cid:10)
2 .p1; p2; t/ D

(cid:3) PQc C (cid:10) Pmc.h2 (cid:3) h3/
(cid:3) PQc

if (cid:10) D 1
(cid:10) D 0:
if

(10.36)

The objective function for this optimization problem is given by:

Z

Tcycle

J D

0

˛

Nm

ˇ

Np

Pmfuel.t/ C

.p1.t/ (cid:3) pe;ref/2dt

(10.37)

and omitting the penalty on the switching.

This switching optimal control problem is solved by applying the PMP to the
embedded system. Given the dynamics of the switching system, the embedded
dynamics for the A/C system is

1

(cid:10)

d Qp1
dt

D

d11

1

(cid:10)

d Qp2
dt

D

d22

(cid:2)

(cid:2)

.1 (cid:3) Qs.t//f 0

1 .p1; p2; t/ C Qs.t/f 1

1 .p1; p2; t/

D (cid:3) PQe C PmQs.t/.h4 (cid:3) h1/

.1 (cid:3) Qs.t//f 0

2 .p1; p2; t/ C Qs.t/f 1

2 .p1; p2; t/

(10.38)

(cid:11)

(cid:11)

D (cid:3) PQc C PmQs.t/.h2 (cid:3) h3/

236

Q. Zhang et al.

where Qs.t/ 2 Œ0; 1(cid:11) is called embedding factor. Accordingly, the two Hamiltonians
for the “clutch-on” and “clutch-off” case are

H(cid:10)D1 D L C (cid:15)1

D L C (cid:15)1

C (cid:15)2

f 1
f 1
1
2
d11
d22
(cid:3) PQe C Pmc.h4 (cid:3) h1/
d11

C (cid:15)2

(cid:3) PQc C Pmc.h2 (cid:3) h3/
d22

H(cid:10)D0 D L C (cid:15)1

C (cid:15)2

f 0
1
d11
(cid:3) PQe
d11

f 1
2
d22
(cid:3) PQc
d22

D L C (cid:15)1

C (cid:15)2

(10.39)

The associated Hamiltonian for the embedded problem is therefore obtained as:

QH D Qs.t/H(cid:10)D1 C .1 (cid:3) Qs.t//H(cid:10)D0

(10.40)

which, after some manipulation and substitutions, becomes

QH.x.t/; Qs.t/; (cid:15)1.t/; (cid:15)2.t/; t/ D L C (cid:15)1

"

#

(cid:3) PQe
d11

C Qs.t/ Pmc
d11

.h4 (cid:3) h1/

"

C (cid:15)2

(cid:3) PQc
d22

C Qs.t/ Pmc
d22

.h3 (cid:3) h2/

#

(10.41)

Finally, the co-state dynamics for the two Lagrange multipliers are deﬁned as:

d(cid:15)1.t/
dt
d(cid:15)2.t/
dt

D (cid:3)

D (cid:3)

@ QH
@Qp1
@QNH
@Qp2

(10.42)

The optimal solution Qs 2 Œ0; 1(cid:11) is found, such that

Qs(cid:2) D argminQs.t/2Œ0;1(cid:11)f QH.x.t/; (cid:15)1.t/; (cid:15)2.t/; Qs; t/g

(10.43)

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

237

10.4.1 Solution of the Embedded Optimal Control Problem

The optimization of the clutch command has been performed on the SCO3 driving
cycle. The solution of the embedded problem is found using the shooting method
to determine the initial condition of the two Lagrange multipliers (cid:15)1 and (cid:15)2.
Figure 10.8 shows the results of the shooting method for the overall performance
index J as well as for J1 that represents the fuel consumption and J2 which evaluate
the tracking performance of the system.

Depending upon the selection of the initial conditions of the co-state dynamics,
different clutch behaviors can be observed. For example, for (cid:15)2;0 D (cid:3)1e(cid:3)4 and any
(cid:15)1;0, the fuel consumption increases dramatically. This indicates that the controller
is aggressive in turning on the A/C. This behavior is extremely sub-optimal, as too
much clutching results in a pressure in the evaporator well below the desired set
point, hence resulting in a worsen J2.

The opposite response can be observed for (cid:15)2;0 D 1e (cid:3) 4. In this case, the fuel
consumption is very low, but the tracking performance is poor. This represents a
case for which the controller prioritizes the fuel savings and neglects the comfort in
the vehicle cabin. The clutch proﬁle, state transition as well as the co-state dynamics
of optimal solution for the selected combination of weight are shown in Fig. 10.9.

By comparing the clutching events with the speed proﬁle of Fig. 10.9, it is clear
that the embedded control inputs attempt at utilizing all the braking events to store
energy in the A/C evaporator. Except for the control decision at the beginning of the
cycle, which is inﬂuenced by the initial condition for the A/C clutch Qs.t D 0/ D 1,
all the control decisions for which Qs.t/ D 1 are coinciding with the deceleration of
the vehicle.

Moreover, the amount of energy that can be stored in the A/C system by clutching
on the compressor when coasting is very limited. A very short period of time—
in the order of a few seconds—is enough to bring the evaporator pressure to its
lower bound, as shown in Fig. 10.9. The faster dynamic of the A/C system compared
to the vehicle acceleration and deceleration transients suggest an intrinsically low
sensitivity of the co-state dynamics to the initial conditions.

To further clarify the impact of the initial condition ((cid:15)10; (cid:15)20) on the optimal
solution, a sensitivity study was performed where the two initial conditions for
the co-state dynamics where increased by a factor of 10. The results are shown
in Fig. 10.10. Results show that, after few seconds, the co-states of the sub-optimal
controller converge to the optimal trajectories and, after that, the two control policies
are the same. This is justiﬁed by the fact that the dynamic of the A/C system is much
faster than the dynamic of the vehicle and that the amount of energy available to be
stored in form of lower pressure in the evaporator is also much smaller thanthe
energy in play for any coasting or breaking events.

In addition to the marginal changes in control sequence and the pressure
dynamics, the sub-optimal initial conditions result only into a marginal degradation
of the overall performance, as reported in Table 10.3. Here, a sub-optimal estimation
of the initial conditions results in a marginal increase of the fuel consumption by
0:01 %, while performing slightly better in the tracking of the desired pressure.

238

Q. Zhang et al.

Fig. 10.8 Results of shooting
method for equivalent
control. (a) Objective
function J1. (b) Objective
function J2. (c) Objective
function J

−4

x 10

0

λ

10

1

−1

0

λ

20

1

−4

x 10

−4

x 10

0

λ

10

1

−1

0

λ

20

1

−4

x 10

0.988

0.986

0.984

0.982
−1

a

1
J

b

2
J

0.07

0.09

0.08

0.06

0.05
−1

c

J

0.992

0.99

0.988

0.986

1

0

λ

10

−1

1

Min

0

λ

20

−1

This result is of particular interest, and could be leveraged for the derivation of
a practical algorithm for the energy management of the A/C system that does not
depend upon the off-line solution of a two-points boundary value problem.

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

239

Fig. 10.9 Simulation results
for optimal equivalent control
(SC03 cycle). (a) Vehicle
speed and optimal clutch
command. (b) Co-states and
A/C system pressures

a

]

h
p
m

[
 

 

d
e
e
p
S
e
c
h
e
V

l

i

]

−

[
 
d
n
a
m
m
o
C
 
h
c
t
u
C

l

60

50

40

30

20

10

0

1

0.8

0.6

0.4

0.2

0

0

8

6

4

2

0

b

r
e

i
l

p
i
t
l
u
M
 
e
g
n
a
r
g
a
L

1200

1000

800

600

400

]
a
P
k
[
 
e
r
u
s
s
e
r
P

200

0

100

200

300

400

500

600

Time [s]

−6

x 10

10

λ
(t)
1
λ
(t)
2

Condenser
Evaporator

100

200

300

400

500

600

Time [s]

10.4.2 Projection Results and Comparison with Dynamic

Programming

Since the solution of the embedded control problem is continuous, the solution of
the original switching control problem is found by projecting the embedded solution
such that (cid:10).t/ 2 f0; 1g [32]. It is clear, however, that the projected solution leads to
a sub-optimal control policy.

240

Q. Zhang et al.

Fig. 10.10 Inﬂuence of
initial conditions on the
co-state dynamics. (a) Vehicle
speed and optimal clutch
command. (b) Co-states and
a/c system pressures

a

]
h
p
m

[
 
d
e
e
p
S
 
e
c
h
e
V

i

l

]

−

[
 
d
n
a
m
m
o
C
 
h
c
t
u
C

l

60

50

40

30

20

10

0

1

0.8

0.6

0.4

0.2

0

0

8

6

4

2

0

b

r
e

i
l

p
i
t
l
u
M
 
e
g
n
a
r
g
a
L

x 10−6

10

λ
0

10*λ

10

1200

1000

800

600

400

]
a
P
k
[
 
e
r
u
s
s
e
r
P

200

0

10*λ

10

100

200

300

400

500

600

Time [s]

Optimal
10*λ

10

λ
(t)
1
λ
(t)
2

Condenser
Evaporator

Table 10.3 Sensitivity of the
optimal solution to initial
conditions of co-state
dynamics

100

200

300

400

500

600

Time [s]

Optimal
Sub-optimal

J1
0:9842
0:9843

J2
0:0537
0:0523

J
0:9868
0:9869

For this application, a solution in the form of a duty cycle command was deﬁned
to approximate a general continuous control input u.:/, as shown in Fig. 10.11.
For each time interval T, which corresponds to the duration of the duty cycle, the
following relation must hold:

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

241

Fig. 10.11 Illustration of the
method for projection of the
equivalent control. (a)
General form and parameters
of duty cycle command. (b)
Determination of duty cycle
command (cid:4)

a

1

0

b

1

0

Z

T

0

π(t)

τ

τ

u(t)

T

T

Z

T

0

Z (cid:4)

0

Z

T

(cid:4)

u.t/dt D

(cid:10).t/dt D

1dt C

0dt D (cid:4)

(10.44)

To determine the duration T of the duty cycle, the DP solution obtained for
the original problem (switched system with cost of switching) was analyzed.
Figure 10.12 shows the distribution of the times between two “clutch-on” events.
The maximum time for the SCO3 cycle has been found to be about 45 s, while
the average time is 35 s. Different duty cycle durations have been tested for the
projection and a good compromise between number of clutching events, tracking
performance, and fuel consumption has been found using the minimum time
between two on.

The results obtained with the equivalent control are shown in Fig. 10.13 com-
pared to the global optimal solution. The projected control presents a similar
behavior compared to the DP in terms of evolution of the evaporator pressure as well
as control actuation, but presents differences in the condenser pressure. The overall
metrics for both, the DP and equivalent controller, are summarized in Table 10.4.

242

Q. Zhang et al.

Fig. 10.12 Statistical
analysis of the clutch
switching frequency
predicted by the DP solution

Fig. 10.13 Simulation
results for the projected
control and comparison with
dynamic programming
solution. (a) Vehicle speed
and clutch command. (b) A/C
condenser and evaporator
pressure

s
e
c
n
e
r
r
u
c
c
O

4

3

2

1

0
15

a

]
h
p
m

[
 
d
e
e
p
S
 
e
c
h
e
V

i

l

]

−

[
 
d
n
a
m
m
o
C
 
h
c
t
u
C

l

60

50

40

30

20

10

0

1

0.8

0.6

0.4

0.2

0

0

b

]

a
P
k
[
 

e
r
u
s
s
e
r
P

 
r
e
s
n
e
d
n
o
C

1200

1100

1000

900

800

700

600

800

600

400

200

]

a
P
k
[
 

e
r
u
s
s
e
r
P

 
r
o
t
a
r
o
p
a
v
E

0

0

20

25

30

35

40

45

50

Time between two "clutch−on" events [s]

Projected Control
DP

100

200

300

400

500

600

Time [s]

Projected Control
DP

100

200

300

400

500

600

Time [s]

10 Energy-Optimal Control of an Automotive Air Conditioning System: : :

243

Table 10.4 Comparison of the projected controller and DP solution

Baseline
DP
Projected Control

J

J3

J2

J1
0:9985 0:0702 0:0474 1:0129 415:9
0:9838 0:1485 0:0278 0:9961 409:9
0:0686 1:0047 410:3
0:9848 0:157

31
25
33

Mfuel (g) RMSp (%) nclutch

29
37
39

The projected controller was successfully design to limit the number of switch-
ings: 39 occurrences against 37, which is the global optimal for the complete control
problem. While the controller is sub-optimal with respect to fuel economy and
tracking performance when compared to the DP result, the performance loss is only
marginal, and still represents a signiﬁcant improvement over the baseline control
strategy.

An online implementation of the proposed controller could be easily achieved

through simple considerations.

First, the sensitivity study on the initial conditions for the co-states could resolve
the issue of solving a two-points boundary value problem, hence facilitating the
implementation as a forward-looking strategy.

Furthermore, the projection required to deﬁne the switched control could be
performed either completely off-line, as presented above, or performed partially
online. For example, the solution of the embedded optimal control problem could
be calculated for the time period T and then projected into an equivalent control by
computing the duty cycle through Eq. (10.44). However, it is clear that this method
would introduce a signiﬁcant time delay in the control loop.

In this sense, model-predictive control could be a more suited approach to solve
the embedded control problem and perform the projection online. This method
appears particularly suited for this system due to its very fast dynamic compared to
the time variation of the exogenous inputs. Moreover, a receding horizon technique
can substantially limit the time delay introduced by the controller. Preliminary
studies [33, 34] have shown promising results when combining the control of hybrid
systems through embedding and the control projection.
Abstract Automotive air conditioning (A/C) system signiﬁcantly affects fuel
consumption and emission. Thus, phase change material (PCM) is exploited in
an innovative storage evaporator to improve the A/C system performance. Due
to hybrid features introduced by mode switching when PCM changes its status
between liquid and solid, the task of control-oriented modeling is particularly
challenging. Upon the energy-based model built, optimal control of an advanced
A/C system with a storage evaporator is formulated as to ﬁnd an optimal clutch
command sequence balancing fuel consumption, cabin comfort, and drivability
constraints. In the scope of vehicle energy management, dynamic programming
(DP) algorithm usually serves as a tool of obtaining benchmark optimal solution
against which results from other optimal algorithms are compared. However, a
direct application of DP algorithm to the optimization problem faces unexpected
difﬁculty, because the discretization of state space is not feasible for an irregular
multi-dimensional subspace formed by the multi-mode model. Alternatively, hybrid
optimal control theory is pursued and a preliminary study is conducted to illustrate
its promising application.

Keywords Air conditioning system (cid:129) Storage evaporator
material (cid:129) Dynamic programming (cid:129) Hybrid optimal control

(cid:129) Phase change

Nomenclature

TP Two Phase
SH Superheated
SC Subcooled

N Compressor Speed
T Temperature
Automotive A/C system has profound effects on the vehicle fuel economy. The
majority of A/C system is still heuristically controlled and operates in an inefﬁcient
way. An analysis conducted in NREL [1] showed that the use of systems is
equivalent to 5.5 % of the domestic light duty vehicle fuel consumption. Two
directions are mainly pursued in order to reduce fuel consumption of A/C system,
namely model-based optimization and control design as well as hardware upgrades.
The mass migration and heat transfer inside refrigerant loop are usually modeled
using energy-based method [2], and its energy management is a typical multi-
objective optimization problem balancing fuel consumption, cooling requirement,
and mechanical weariness [3]. In [4–8], the optimal compressor clutch sequence
is found using online implementable model predictive control (MPC) method.
Recently, storage evaporator [9] is introduced to improve A/C system performance,
because it increases thermal inertia and expands energy storage capability when the
PCM changes its status between liquid and solid.

PCM has been widely applied in industrial areas, such as solar power plants,
electronic devices, and transport [10, 11]. Depending on the speciﬁc application,
different models have been developed to characterize the heat transfer and phase
change dynamics. Generally, these models belong to two model categories, namely
distributed-parameter model and lumped-parameter model. In [12–14], the phase
change material (PCM) is treated as a one dimensional heat transfer model, a
partial differential equation with boundary conditions speciﬁed. In [15], a simpliﬁed
dynamic model is developed for predicting the energy impact due to the addition
of the PCM. Usually, these models are tailored for performance analysis at design
stage, helping the designers determine appropriate geometric parameters or material

11 Modeling Air Conditioning System with Storage Evaporator for Vehicle. . .

249

types. However, little attention has been paid to the optimal operation of the PCM
after the design stage.

This chapter is aimed to apply optimal control theory on automotive A/C system
with storage evaporator. This work is challenging as it requires the modeling
of phase change dynamics and choice of appropriate control methods. The A/C
loop dynamics changes signiﬁcantly over PCM status, such as completely frozen,
freezing/melting, and completely melt. In other words, hybrid system dynamics
exists and should be captured by the control-oriented model developed. The hybrid
feature also affects the optimization process, as optimization algorithms applicable
only in continuous domain might fail. Therefore, hybrid optimal control theory
speciﬁcally developed for hybrid system is pursued herein. Different versions
of hybrid minimum principle (HMP) exist. A general version of the HMP is
presented by Sussmann [16] based on a set of needle variations and a Boltyanski
approximation cone. Two versions of HMPs are introduced by Riedinger et al.
[17, 18] and Shaikh and Caines [19] for hybrid systems with autonomous and
controlled switching. Although the above HMPs have solid theoretical foundation,
it has hardly been applied to a practical problem before, like the energy management
of A/C system. Therefore, this chapter is aimed to illustrate the beneﬁt of storage
evaporator and the potential application of hybrid optimal theory on the A/C system
energy management.

The chapter is organized as follows. Section 11.2 models the A/C system
dynamics using a lumped-parameter approach and resulted system equations are
in descriptor form. Section 11.3 compares the performances between storage
evaporator and conventional evaporator, and identiﬁes the beneﬁts of enhanced
thermal inertia. Section 11.4 ﬁts the problem of optimal control of A/C system
into the ﬁeld of vehicle energy management, and tests two common optimization
algorithms for a speciﬁc driving scenario.

11.2 Modeling A/C System with Storage Evaporator

As shown in Fig. 11.1, the A/C system of a passenger car is generally based on a
simple vapor compression cycle realized through a ﬁxed-displacement rotary piston
compressor, a condenser heat exchanger with a fan, a receiver/drier, an evaporator
with a blower, and a thermal expansion valve. The compressor is clutched on/off
to remove heat from the air ﬂowing through the evaporator and reject heat into the
air ﬂowing through the condenser, determined by the blower and fan rotation speed,
respectively.

In an innovative A/C loop, the conventional evaporator is replaced with a storage
evaporator with PCM added [9]. Physically, PCM in the outer tube is assembled
around an inner tube which the refrigerant ﬂows through. When the compressor is
turned on, the refrigerant evaporates to solidify PCM that further cools down air
ﬂowing ﬁns; when the compressor stops, the PCM starts to melt to prevent the air
temperature rising up quickly until it is completely melted.

250

Q. Zhang and M. Canova

Fig. 11.1 Conventional A/C loop with refrigerant phase change

In addition to the refrigerant phase change between vapor and liquid, another
phase change happens in the storage evaporator is the PCM melting or freezing
between liquid and solid, both of which need to be captured in order to fully char-
acterize the dynamics of the storage evaporator. In order to develop a supervisory
controller, it is necessary to build suitable control-oriented A/C models balancing
model accuracy and simulation time. Therefore, an energy-based model for the
A/C system with storage evaporator is developed herein with major assumptions
introduced sequentially to minimize the model complexity, since the computation
burdens of optimization algorithms later developed strongly rely on the total number
of states within the A/C model.

11.2.1 Lumped-Parameter Modeling Approach

The methodology of building a high-ﬁdelity A/C model is generally classiﬁed
into two categories, namely ﬁnite-volume method and moving-boundary method.
However, the total number of system states in both cases is much more than the level
that can be tolerated by those optimization algorithms commonly adopted in vehicle
energy management. The main drawback of both methods is that the physical prop-
erties are treated as distributed parameters, meaning that a group of thermodynamic
variables are required to characterize the thermo-ﬂuid dynamics inside individual
control volume. Therefore, a lumped-parameter modeling approach is adopted to
facilitate future optimization algorithms development.

Assumption 1. The temperature spatial distribution of refrigerant, wall and PCM
is uniform along the tube length direction.

Hence, the condenser is modeled as a lumped thermal mass with two control vol-
umes representing, respectively, the volume occupied by the refrigerant circulating
in the tubes and the metal mass (walls). Similarly, the evaporator consists of four

11 Modeling Air Conditioning System with Storage Evaporator for Vehicle. . .

251

Fig. 11.2 Schematic of heat exchanger with PCM included (PCM in lower part is not drawn)

control volumes, two of which are closely related to PCM dynamics. Considering
the schematic of a storage evaporator with refrigerant ﬂowing in the inner tube and
PCM stored in the outer tube, as shown in Fig. 11.2, the spatially average PCM
temperature Tpcm and exterior wall temperature Tewo are determined by the heat
transfer rates between refrigerant, PCM, and air.

Following the assumption, an energy balance can be formulated for the PCM

control volume:

d
dt

.V(cid:3)u/ D PQewi;pcm C PQpcm;ewo

(11.1)

where PQewi;pcm is heat transfer rate between the interior tube wall and the PCM, and
PQpcm;ewo is the heat transfer rate between the PCM and the exterior tube wall.

The energy balance equation for the exterior tube wall is

Mewocp;ewo

D (cid:3) PQpcm;ewo (cid:3) PQewo;a

(11.2)

dTewo
dt

where Mewo is the exterior wall mass, cp;ewo is the exterior wall speciﬁc heat, and
PQewo;a is the heat transfer rate between the exterior wall and air.

252

Q. Zhang and M. Canova

The heat transfer rate from the lumped PCM and exterior wall to the air, PQpcm;a,
is deﬁned similar to PQc, and the heat transfer rate from the refrigerant to the lumped
PCM and exterior wall, PQe;pcm, is determined mainly by their temperature difference.

PQpcm;a D Pma;ecp;a .Ta;out;e (cid:3) Ta;in;e/
(cid:4)
Te (cid:3) Tpcm

PQe;pcm D KpcmA

(cid:5)

(11.3)

in which the heat transfer coefﬁcient Kpcm is a piecewise function deﬁned for each
mode [15].

11.2.2 Refrigerant Dynamics

The dynamics on the refrigerant side involves both mass migration and heat transfer.
Since the energy-based A/C model is tailored for vehicle energy management, the
faster mass migration dynamics is simpliﬁed according to

Assumption 2. The compliance effects relative to the variations in mass ﬂow rate in
or out of the heat exchangers are negligible [20, 21].

This assumption preserves the low-frequency dynamics, driven mainly by the
heat transfer process. Hence the refrigerant mass ﬂow rate predicted by the
compressor model is uniform throughout the system. When the clutch is engaged,
the mass ﬂow rate within the A/C loop is equal to the one calculated by the
compressor model; when the clutch is disengaged, the mass ﬂow rate within the
A/C loop is null.

The compressor is treated as an algebraic element that outputs the refrigerant
ﬂow rate and enthalpy at the exit, as function of the thermodynamic conditions at
the inlet, the condenser pressure, and the rotational speed:

Pmc D Vd(cid:3)1!c(cid:8)v;

h2 D h1 C

(11.4)

h2s (cid:3) h1
(cid:8)s

where !c is the compressor rotation speed, Vd the compressor displacement, and h2s
the isentropic enthalpy.

As for the heat transfer process, the pressures inside the evaporator and condenser
are of interest for the high-level controller managing vehicle energy, since the
mechanical power entering the A/C loop through the compressor is stored in
the pressurized refrigerant. In contrast, the variation of refrigerant temperature in
different phase regions is out of scope, because it is only relevant to the low-level
controller that regulates superheat temperature for safety consideration. Therefore,
the refrigerant dynamics can be further simpliﬁed.

Assumption 3. The refrigerant within each heat exchanger is assumed present only
in two-phase.

11 Modeling Air Conditioning System with Storage Evaporator for Vehicle. . .

253

Although this represents a drastic simpliﬁcation of the physical behavior, the
contribution of superheat or subcooled regions to the heat transfer is in practice
limited [22]. Their inﬂuences might be compensated by the calibration parameters in
the energy-based A/C model, namely the tuning factors multiplying the heat transfer
coefﬁcients.

After mathematical derivations detailed in [2], the ﬁnal energy balance equations

for the refrigerant inside both evaporator and condenser are

"

"

Ve

.1 (cid:3) N(cid:9)1/

C

Mwece
Ve

Vc

.1 (cid:3) N(cid:9)2/

C

Mwccc
Vc

@ .(cid:3)lhl/
@p1
(cid:8)

@T1
@p1

@ .(cid:3)lhl/
@p2
(cid:8)

@T2
@p2

e

C N(cid:9)1

(cid:9)#

dp1
dt

c

C N(cid:9)2

(cid:9)#

dp2
dt

@

(cid:5)

(cid:4)
(cid:3)ghg
@p1

(cid:4)
(cid:3)ghg (cid:3) (cid:3)lhl

(cid:5)

e

C

@ N(cid:9)1
@p1

e

(cid:3) 1

D PQe C (cid:10) Pm .h4 (cid:3) h1/

@

(cid:5)

(cid:4)
(cid:3)ghg
@p2

(cid:4)
(cid:3)ghg (cid:3) (cid:3)lhl

(cid:5)

c

C

@ N(cid:9)2
@p2

c

(cid:3) 1

(11.5)

D (cid:3) PQc C (cid:10) Pm .h2 (cid:3) h3/

where the subscripts e and c indicate the evaporator and condenser heat exchanger,
respectively.

Most of the parameters of the energy-based model can be easily related to design
and geometric data of the heat exchangers, as well as to the properties of the ﬂuids.
In the single phase regions, the heat transfer correlation includes two parts [23]. For
evaporation, the correlation proposed in [24] combines the nucleating boiling and
convective boiling effects, ˛tp D S˛nb C F˛sp. For condensation, the correlation
given by Koyama et al. [25] combines the inﬂuences of the forced convection NuF
and gravity controlled convection NuB using an asymptotic expression Nu D .Nu2
F C
Nu2
/1=2. In addition, since the heat transfer coefﬁcients on the refrigerant side have
B
been neglected due to their high value, only the air side is considered in the model.
The correlations to calculate the heat transfer coefﬁcients adopted in this work are
speciﬁc to cross-ﬂow compact heat exchangers with louvers and ﬁns, and have been
proposed by Chang and Wang [26] and Kim and Bullard [27]. This simpliﬁes the
calibration process to identifying two multipliers, k˛e;a and k˛c;a, which correct the
heat transfer correlations for the air side of the two heat exchangers. Its ability to
predict the energy consumption of the A/C system during transients was conducted
against experimental data collected on the SC03 air conditioning test cycle [2].

11.2.3 PCM Mode Switching

The dynamics on PCM side involves only heat transfer. One main assumption
proposed in [15] is adopted to facilitate the derivation of mathematical model for
the PCM.

254

Q. Zhang and M. Canova

Fig. 11.3 Modes and mode switching condition

Assumption 4. The phase change process is slow enough to consider that heat
transfer in the growing phase is in the steady state, and to assume a linear
temperature proﬁle in this phase.

In other words, the sensible heat in the growing phase is negligible compared to
the latent heat involved, which is justiﬁed by the small Stefan number deﬁned as
Ste D cp.Tewo (cid:3) Tpcm/=Lf D 2:59 (cid:4) 3=280 D 0:0267.

The PCM in the storage evaporator undergoes three modes shown in Fig. 11.3
[15], namely freezing/melting mode, frozen mode, and melted mode. Depending on
the modes, the left-hand side of Eq. (11.1) can be expressed in different ways.

At the freezing and melting modes, the PCM temperature Tpcm is ﬁxed, and is
equal to the phase change temperature Tfreezing or Tmelting. The latent heat caused by

11 Modeling Air Conditioning System with Storage Evaporator for Vehicle. . .

255

phase change of the PCM between solid and liquid is used to store net heat transfer,
resulting the solid PCM depth s varying. Hence, its energy balance equation using
the solid PCM depth s as a state variable is written as.

(

ds

(cid:3)(cid:3)pcmLf Ac
Tpcm D Tfreezing D Tmelting

dt D PQe;pcm C PQpcm;ewo

(11.6)

where (cid:3)pcm is almost constant, Lf is the latent heat, and Ac is the cross sectional
area of the PCM. The solid PCM depth s decreases if it absorbs heat and melts, and
increases if it rejects heat and freezes. When the solid PCM depth s comes to zero, it
switches into the completely melted mode; when the solid PCM depth s approaches
the total PCM depth epcm, it switches into the completely frozen mode.

At the completely melted and completely frozen modes, the solid PCM depth
s becomes 0 or epcm, respectively, and the PCM is in pure liquid or solid form.
Its temperature Tpcm is determined by the heat transferred through the interior and
exterior tube walls. The energy balance equations is

(

s D constant
MpcmCs

pcm

dTpcm
dt D PQe;pcm C PQpcm;ewo

(11.7)

where Mpcm is PCM mass, Cs
pcm is PCM speciﬁc heat. At completely melted mode,
when the PCM temperature Tpcm falls down to the freezing temperature Tfreezing, it
switches from melted mode to freezing mode. At completely frozen mode, when the
PCM temperature Tpcm rises up to the melting temperature Tmelting, it switches from
the frozen mode to melting mode.

11.2.4 Descriptor Form

So far, the dynamics of the PCM and the exterior wall are separated. From the
observation that the heat transfer dynamics is typically dominated by the ﬂuid with
the lowest convective heat transfer coefﬁcient (the external air side), we propose the
last assumption

Assumption 5. The heat transfer from the PCM to the walls is assumed inﬁnitely
fast [22].

In order to transform the system into a state space form with minimum number
of states, the exterior wall temperature is eliminated by lumping the wall thermal
capacitance into the PCM side, because the heat transfer coefﬁcient between the
PCM and the exterior wall is much bigger than the one between the exterior wall
and the air.

Mewocp;ewo

(cid:6) Mewocp;ewo

D (cid:3) PQpcm;ewo (cid:3) PQewo;a

(11.8)

dTpcm
dt

dTewo
dt

256

Q. Zhang and M. Canova

When PCM is in melting/freezing mode, the PCM temperature Tpcm is not changed,
indicating the variation of the exterior wall temperature Tewo is negligible; When
PCM is in melted or frozen modes, the PCM temperature Tpcm is changing, meaning
that the thermal capacitance of the exterior wall should be considered.

Substitute Eq. (11.8) into Eq. (11.6), we get the differential equations describing

the variation of PCM depth when it is in freezing and melting modes, as follows:

(

ds

(cid:3)(cid:3)pcmLf Ac
Tpcm D Tfreezing D Tmelting

dt D PQe;pcm (cid:3) PQpcm;a

(11.9)

Substitute Eq. (11.8) into Eq. (11.7), we get the differential equations describing

the variation of PCM temperature when it is melted and frozen modes, as follows:

8
<

:

s D constant
(cid:2)
MpcmCs

(cid:3)

pcm C MewocP;ewo

dTpcm
dt D PQe;pcm (cid:3) PQpcm;a

(11.10)

In order to merge Eqs. (11.9) and (11.10) into one set of differential equations,
logic statement is incorporated into system dynamics as suggested in Eq. (11.11).
The two forms are mathematically equivalent if a logic statement on PCM tem-
perature is incorporated in depth dynamics and a logic statement on PCM depth is
incorporated in temperature dynamics.

(cid:3)(cid:3)pcmLf Apcm

D ŒT 2 .Tm=f (cid:3) (cid:17)l; Tm=f C (cid:17)u/(cid:11) (cid:2) . PQe;pcm (cid:3) PQpcm;a/

(cid:2)
MpcmCs

pcm C Mewocp;ewo

D Œs 62 .0; epcm/(cid:11) (cid:2) . PQe;pcm (cid:3) PQpcm;a/

(cid:3)

ds
dt
dTpcm
dt

The energy-based A/C model with a storage evaporator can be expressed in
descriptor form to facilitate its implementation and its use for control design. Note
that the aforementioned model combining Eqs. (11.5) and (11.11) representative of
a four-state nonlinear system and can be formulated as:

(11.11)

(11.12)

D .x/ Px D f .x; u; v/
y D g .x; u; v/

11.3 On/Off Cycle Evaluation of Storage Evaporator

The above storage evaporator model is implemented in Matlab/StateFlow with
switching conditions labeled in Fig. 11.3. The completely frozen and melt modes
change to each other through an intermediate mode named melting/freezing mode.

11 Modeling Air Conditioning System with Storage Evaporator for Vehicle. . .

257

The condition indicating leaving the intermediate mode is that the solid PCM depth
reach its physical limits, and the condition indicating entering the intermediate mode
is that the PCM temperature Tpcm approaches the ﬁxed phase change temperature
speciﬁed by the PCM property.

Two major beneﬁts exist if the evaporator thermal inertia is increased by adding
PCM. Firstly, the increase of discharge temperature of the storage evaporator,
compared to the standard evaporator, is signiﬁcantly delayed, resulting in prolonged
idle-stop time of the compressor. Secondly, the losses due to the refrigerant displace-
ment during on/off cycles are reduced since the on/off cycle period become much
longer than before. Simulation results supporting the possibility of both beneﬁts are
available using thermophysical properties of a eutectic aqueous solution provided
in [15] and summarized in Table 11.1. Various phase change temperature, PCM
thickness, and thermal loads can affect the simulation results. In current simulation,
all relevant parameters are chosen intentionally so that a complete melting/freezing
process exists when enough on/off time period is provided (Fig. 11.4).

A complete on/off cycle is shown in Fig. 11.5 with refrigerant temperature,
PCM temperature, and discharge air temperature recorded. At the beginning of the
cycle, all three temperatures are set to ambient temperature (here 20 ıC). When

Table 11.1 Thermophysical properties of PCM

Symbol
Lf
(cid:15)s
(cid:15)l
(cid:3)s
(cid:3)l
Cp

Unit
kJ kg(cid:2)1
W m(cid:2)1K(cid:2)1
W m(cid:2)1K(cid:2)1
kg m(cid:2)3
kg m(cid:2)3
J kg(cid:2)1K

(cid:2)1

Value
280
1.8
0.6
1042
1115
2592

Explanation
Latent heat
Solid PCM thermal conductivity
Liquid PCM thermal conductivity
Solid PCM density
Liquid PCM density
Speciﬁc heat

On

Off

]

K

[
 
e
r
u
t
a
r
e
p
m
e
t

25

20

15

10

5

0

−5

−10

0

Ta
Tpcm
Te

50

100

150

250

300

350

400

200
time [sec]

Fig. 11.4 Temperature proﬁles of evaporator with phase change material

258

Q. Zhang and M. Canova

SE Clutch−On

SE Clutch−Off

50

100

150

200

250

300

350

time [sec]

CE One Cycle

conventional evaporator (CE)
storage evaporator (SE)

25

20

15

10

]

K

[
 
e
r
u
t
a
r
e
p
m
e
t

5

0

600

500

400

300

]
a
P
k
[
 
e
r
u
s
s
e
r
p

200

0

50

100

150

200

250

300

350

time [sec]

Fig. 11.5 Evolution of discharge temperature and evaporator pressure with and without PCM

clutch is engaged, refrigerant is propelled by the compressor into condenser and
the evaporator pressure falls down, causing all three temperatures reduced. Since
the melting/freezing temperature is set as 5 ıC, the PCM temperature does not stop
dropping until it reaches this physical limit. As soon as the freezing temperature is
reached, PCM starts to freeze, maintaining the three temperatures ﬁxed for around
40 s. After the PCM is completely frozen, all three temperatures fall down again till
an energy balance is established among refrigerant, PCM and air. A similar analysis
might be conducted duping the clutch disengagement, expect that PCM suppress
the rapid increase of evaporator pressure. From the proﬁle of discharge temperature,
it is obvious that 40 s delay helps impeding fast variation of discharge temperature
and narrowing down its amplitude.

The addition of PCM has also an impact on the on/off periods of the A/C
system. Two complete on/off cycles are presented for an advanced A/C system
with storage evaporator in Fig. 11.5 with discharge air temperature and evaporator
pressure recorded. As a comparison, the on/off period of the clutch command of an
ordinary A/C system without storage evaporator is modulated so that the average
discharge air temperatures of both cases are comparable to each other. Similarly,
the average evaporator pressure of both cases are maintained almost the same. From
simulation results, the periodic variation of conventional evaporator pressure is more
frequent the storage evaporator pressure. The on cycle of the A/C system with PCM
is ﬁve times longer and the off cycle is three time longer than the convectional A/C
system. Hence, the cooling and efﬁciency losses caused temporary charges of the
heat exchangers during on/off cycle is signiﬁcantly reduced, besides compressor
mechanical weariness.

11 Modeling Air Conditioning System with Storage Evaporator for Vehicle. . .

259

11.4 Energy Management Strategy

The objective of a supervisory controller for the automotive A/C system is to operate
the system in a way that reduces the compressor parasitic load in relation with the
vehicle and engine operations, while maintaining the cabin comfort requirements
and ensuring the reliability of the compressor clutch. Therefore the objective
function for optimization problem is given by:

J D ˛J1 C ˇJ2 C (cid:9) J3

(11.13)

where ˛, ˇ, and (cid:9) are the weighting factors.

8
ˆˆ<
J1 D
J2 D
ˆˆ:
J3 D

R
T
0 Pmfuel.t/dt
R
T
0 .T1.t/ (cid:3) T1;0/2dt
R
T
(cid:12)t

.(cid:10).t/ (cid:3) (cid:10).t (cid:3) (cid:4)//2dt

(11.14)

The ﬁrst term considered is the total fuel consumption over a driving proﬁle,
with Pmfuel.t/ the instantaneous fuel consumption of the engine. The cabin comfort
requirement is translated into a discharge temperature at the evaporator. Hence,
a second term of the objective function represents a tracking error, where T1 is
the actual discharge temperature and T1;0 is a reference value for the discharge
temperature. Finally, to address both drivability issues and potential durability
problems, an additional cost function is considered to prevent high frequency
switching in the clutch signal, where (cid:10).t/ is the current clutch position, (cid:10).t (cid:3) (cid:4)/
is the clutch position at the previous time step and (cid:4) is the discretization time.
The control objective is to ﬁnd the optimal trajectories of the compressor clutch
command that minimizes the overall objective function.

11.4.1 Difﬁculties Faced by DP Algorithm

DP is widely used in vehicle energy management. However, DP algorithm imple-
mented in [28, 29] cannot be directly applied to the optimization problem, because
it is impossible to discretize the feasible subspace over a storage evaporator model
in hybrid format as explained below.

From the simulation results, it is found that the possible optimal solution,
if projected from the global space .p1; p2; s; Tpcm/ into a subspace conﬁned by
.s; Tpcm/, always moves along the blue fold line in Fig. 11.6. When the PCM is
completely melted, s D 0 and Tpcm changes between a lower threshold Tl and
the phase changing temperature Tfreezing=melting; when the PCM is either freezing or
melting, T D Tfreezing D Tmelting and s changes between zero and the maximum
depth epcm; when the PCM is completely frozen, s D spcm, and Tpcm changes
between the phase changing temperature Tfreezing=melting and a upper threshold Th.
Hence, any feasible solution cannot move out of the “Z” shape domain.

260

Q. Zhang and M. Canova

Fig. 11.6 DP failure due to discretization difﬁculty

In contrast, DP algorithm assumes that the feasible region is within a rectangular
region outlined by .s; Tpcm/ D Œ0; epcm(cid:11) (cid:4) ŒTl; Tu(cid:11). The numerical DP solver seeks to
discretize the state space evenly, as depicted by the columns of red dots in Fig. 11.6.
Obviously, a PCM during freezing or melting cannot have a temperature different
from phase change temperature Tfreezing=melting, since it is a hard constraint imposed
by its physical property. Therefore, the DP algorithm implemented in [28, 29] fails
at the very ﬁrst step when the irregular subspace .s; Tpcm/ needs gridding.

11.4.2 Hybrid Minimum Principle

Hybrid systems are systems whose dynamics are given by a coupling of continuous
variables and modes in ﬁnite sets. A switched system, as a speciﬁc type of hybrid
system, consists of several subsystems and a switching law, which takes places when
a certain event signal is received. An event signal may be an external signal or an
internal signal generated when an internal condition for the states, inputs, and/or
time evolution is satisﬁed. An autonomous transition occurs if a switch manifold
.x/ D 0 is hit. A controlled transition occurs if there exists a discrete control
mqj(cid:2)1;qj
input (cid:7)qj(cid:2)1;qj 2 †c such that (cid:21).qj(cid:3)1; (cid:7)qj(cid:2)1;qj

.tj// (cid:9) (cid:21).qj(cid:3)1; (cid:7)qj(cid:2)1;qj

/ D qj.

11 Modeling Air Conditioning System with Storage Evaporator for Vehicle. . .

261

Table 11.2 Necessary conditions when objective functions deﬁned with penalty terms

Costate dynamics

Necessary conditions
Autonomous switching
@Hq.x;(cid:15);u/
@x

P(cid:15) D (cid:3)

Controlled switching

Hamiltonian minimization Hq0 .x0; (cid:15)0; u0/ (cid:5) Hq0 .x0; (cid:15)0; v/

Costate continuity

Hamiltonian continuity

(cid:15).t(cid:2)
j

/ D (cid:15).t

C
j

/ C

H.t(cid:2)
j

/ D H.t

C
j

/ C

(cid:2)

(cid:2)

x mj;jC1 C
(cid:2)

x mj;jC1 C

(cid:15).t(cid:2)
j

x c
(cid:2)
t c H.t(cid:2)

j

/ D (cid:15).t

C
j

/ C

/ D H.t

C
j

/ C

(cid:2)

x c
(cid:2)

t c

The energy management of A/C systems with storage evaporator is inherently a
hybrid optimal control problem. The on/off operation sequence of the compressor
clutch command is a controlled transition altering the dynamics of storing/releasing
energy in the pressurized refrigerant. Besides, the mode switches among melted,
melting, frozen, and freezing are triggered by either hitting the physical depth of the
PCM or reaching the melting/freezing temperature. Upon these hybrid features, the
problem is further complicated when the continuous actuators such as evaporator
blower and condenser fan function.

For a hybrid system, its hybrid optimal problem is usually formulated using a

hybrid objective function deﬁned as:

Z

tiC1

†L

iD0

ti

lqi

.xqi

.s/; u.s//ds C g.xqL

.tf // C c.x; t/

(11.15)

where c.x; t/ is a penalty on switching event. Necessary conditions for the above
formulation are proposed in [30] and are summarized in detail in Table 11.2.
Note that the Hamiltonian minimization condition over mode is no longer held.
Instead, while all the continuity conditions are changed with gradients of penalty on
switching events. In other words, switch might occur when the two Hamiltonians
are matched, regardless of their relative values.

11.4.3 Preliminary Application to A/C System

An attempt is made to apply the HMP to the energy-optimal control of the A/C
system. Some approximations are introduced at this point to simplify the mathe-
matical complexity of the problem, with the objective of verifying the feasibility of
the method to the optimal control of the A/C system. Speciﬁcally, the following
assumptions are adopted to reduce the complexity while not causing signiﬁcant
changes to the A/C system dynamics and its hybrid optimal control formulation:

(cid:129) The engine is assumed operating at constant speed and torque;

262

Q. Zhang and M. Canova

(cid:129) The compressor torque is considered constant and independent of the evaporator

and condenser pressure.

Based on the above, an attempt was made to apply the HMP to the energy-optimal
control of the A/C system. If the A/C system model is written in hybrid form, the
optimization problem is now characterized by the presence of two discrete inputs,
namely ON when (cid:10) D 1 and OFF when (cid:10) D 0. In order to determine the mode
selection, only two Hamiltonian functions corresponding to the ON/OFF inputs are
required:

where the Lagrangian function is the same as the one deﬁned above, for the PMP
application.

For simplicity of notation, deﬁne:

H(cid:10)D1 D L C (cid:15)1

C (cid:15)2

H(cid:10)D0 D L C (cid:15)1

C (cid:15)2

f1on
d11
f1off
d11

f2on
d22
f2off
d22

(cid:12)

(cid:12)

f1 D

f2 D

f1on D (cid:3) PQe C Pm .h4 (cid:3) h1/ ; if (cid:10) D 1;
if (cid:10) D 0.
f1off D (cid:3) PQe;

f2on D (cid:3) PQc C Pm .h2 (cid:3) h3/ ; if (cid:10) D 1;
if (cid:10) D 0.
f2off D (cid:3) PQc;

hence, the uniﬁed form of the Hamiltonian is

H D L C (cid:15)1

C (cid:15)2

f1
d11

f2
d22

The costate dynamics is the partial differentiation of the Hamiltonian H over p1

and p2, respectively:

(cid:2)

(cid:2)

d(cid:15)1.t/
dt D (cid:3)

x1 H D (cid:3). @L

@p1 C (cid:15)1

d(cid:15)2.t/
dt D (cid:3)

x2 H D (cid:3). @L

@p2 C (cid:15)1

@F1
@p1 C (cid:15)2
@F1
@p2 C (cid:15)2

@F2
@p1

/

@F2
@p2

/

The differentiation of L is trivial because only the quadratic tracking error
includes two states explicitly. However, the analytical differentiation of Fi (deﬁned
as d(cid:3)1
f ) is not straightforward and involves differentiation of the parameter dii and
ii
of the right-hand side term f , respectively.

@Fi
@pi

D (cid:3)

fi C

1
d2
ii

@dii
@pi

1

dii

@fi
@pi

(11.16)

(11.17)

(11.18)

(11.19)

(11.20)

(11.21)

11 Modeling Air Conditioning System with Storage Evaporator for Vehicle. . .

263

Note that the second order derivatives of the refrigerant properties with respect

to the system pressures is mandatory to solve @dii=@pi analytically:

@dii
@pi

D .1 (cid:3) N(cid:9) / d2(cid:3)lhl
dp2
i

C N(cid:9)

d2(cid:3)ghg
dp2
i

C .(cid:3)ghg (cid:3) (cid:3)lhl/ d2 N(cid:9)i
dp2
i

C

(cid:3)wVwcp;w
VR

d2Ti
dp2
i

(11.22)

On the other hand, @fi=@pi is a piecewise function deﬁned, respectively, for the cases
of clutch engagement and disengagement:

@fi
@pi

D

8
<

:

(cid:3)

(cid:3)

@Qi
@pi
@Qi
@pi

;

C Pm @(cid:12)h
@pi

C (cid:12)h @ Pm
@pi

; (cid:10) D 1;

(cid:10) D 0.

(11.23)

where the calculation of @ Pm=@pi requires analytical differentiation of the compressor
model, including the complex correlations for the isentropic efﬁciency and the
volumetric efﬁciency.

In order to avoid the signiﬁcant complexity of conducting analytical differentia-
tion of the above terms, look-up tables were generated off-line for the function Fi
over different compressor speed, condenser pressure, and evaporator pressure, from

2000

1500

 [kPa]

p
c

1000

800

600

200

400

pe [kPa]

2000

1500

pc [kPa]

1000

200

400

pe [kPa]

800

600

a

f
f
o
1

f

20

10

0

−10
2500

c

n
o
1

f

200

0

−200

−400

2500

b

f
f
o
2

f

100

0

−100

−200

2500

d

n
o
2

f

300

200

100

0

−100

−200

2500

2000

1500

pc [kPa]

1000

800

600

200

400

pe [kPa]

2000

1500
pc [kPa]

1000

800

600

400

200

pe [kPa]

Fig. 11.7 Example of Mapping the Nonlinear Functions of the A/C Model. (a) Function f1;off.
(b) Function f2;off. (c) Function f1;on. (d) Function f2;on

264

Q. Zhang and M. Canova

−3

x 10

−5

x 10

a

i

n
a
n
o
t
l
i

m
a
H

e
t
a
t
s
o
C

2.2

2.1

2

1.9

1.8

1

0

−1

−2

−3

0

λ
1
λ
2

H0
H1

b

]

−

[
 
d
n
a
m
m
o
C
 
h
c
t
u
C

l

1

0.8

0.6

0.4

0.2

0

1200

1000

800

600

400

]
a
P
k
[
 
e
r
u
s
s
e
r
P

200

0

Evaporator
Condenser

10

20

30

40

50

60

70

10

20

30

40

50

60

70

Time [s]

Time [s]

Fig. 11.8 Optimal Solution of the Simpliﬁed A/C System Using HMP-IDP. (a) Hamiltonian and
costate. (b) Clutch command and pressures

which @Fi=@pi are then calculated through numerical differentiation and smoothing
techniques. An example of the surfaces obtained for these functions is given in
Fig. 11.7 for engine speed Ne D 1300 rpm.

In order to apply the hybrid optimal control theory, the shooting method is
required to determine the optimal value for the initial conditions of the Lagrange
multipliers, ((cid:15)10; (cid:15)20). A close observation to the optimal solution is shown in
Fig. 11.8, limited to the ﬁrst 60 s of simulation. The clutch command does not
change the ﬁrst time the two Hamiltonian functions intersect (around 5 s), but
begins switching starting from the following intersection event, until the ﬁnal time
is reached. This is consistent with the HMP stating that the Hamiltonian matching
is only a necessary conditions for the clutch command to switch.

Abstract This chapter studies the fuel-optimal cruising strategies of parallel hybrid
electric vehicles and their underlying mechanisms. We formulate a discontinuous
nonlinear optimal control problem to achieve fuel-optimal operations, and solve
this problem using the Legendre pseudospectral method and knotting technique.
Besides, three optimal cruising strategies in free/ﬁxed-speed cruising scenarios are
proposed: vehicle speed pulse-and-glide strategy (Speed-PnG), SOC pulse-and-
glide strategy (SOC-PnG), and constant speed strategy (CS). Then we compare the
performance and optimal behaviors of their engine and motor operations, and study
their fuel-saving mechanisms. Finally, two principles to compromise between fuel
economy and ride comfort are proposed and studied.

Keywords Electric vehicles (cid:129) Energy management (cid:129) Cruise control

12.1 Introduction

Due to the fuel economy standards and environmental concerns, the automotive
industry needs to be more focused on improving the fuel economy of road vehicles
[1]. Some technologies such as intelligent transportation systems, car body light-
weighting, hybrid powertrains, and clean combustion have been developed and
deployed [2, 3]. Hybrid electric vehicles (HEVs) have been widely used in our daily
life, and many HEVs from Toyota, Ford, Honda, and GM have demonstrated signif-
icant potentials for fuel-savings [4]. HEVs are equipped with an energy buffer such
as a battery or super capacitor [5, 6]. Hybrid powertrains contribute to downsize the
engine, avoid inefﬁcient engine operation, and execute braking energy recuperation,
leading to a better fuel economy compared to conventional vehicles [6].

The fuel economy of HEVs depends on many factors, including its powertrain
conﬁguration, component sizing, and control strategy [5, 6]. Many optimization-
based and rule-based control rules have been developed to improve the fuel economy
of HEVs in diverse riving scenarios and cycles [7]. In this chapter, we focus on
designing fuel-optimal control strategies in cruising scenarios for parallel HEVs
since parallel hybrid powertrains are commonly used in Honda, Hyundai, and many
European hybrid vehicle models.

Cruising, as the most common maneuver, consumes a signiﬁcant portion of the
total energy, 35 % in urban conditions [8], and even higher on the highways. A
survey showed that coach buses spent 65–78 % of their total driving time cruising
on the freeways in Beijing [9]. Therefore, fuel-efﬁcient cruising strategy is important
to save the fuel usage. Speciﬁcally, about 1 % fuel-savings can cut down 20 million
barrels of oil per year over the world in cruising scenarios [10].

In cruising scenarios, the frequently used cruising strategy is the constant speed
(CS) operation, which means operating the engine and transmission at a constant
state and traveling at a ﬁxed speed. Besides, there is another cruising strategy, which
is pulse and glide (PnG) cruising strategy, a strategy widely used in super-mileage
competition vehicles [11]. It has been proven that the PnG strategy can be more
fuel-efﬁcient than the CS operation, with up to 20 % fuel-savings [11, 12]. Lee and
Nelson also validated the fuel-saving performance in experiments.

For non-hybrid vehicles with a continuously variable transmission (CVT), Li
and Peng formulated an optimal control framework and provide analytical optimal
results of how PnG strategy works [11, 12]. The study showed that the vehicle inertia
acts as a kinetic “energy buffer,” which allows the engine to operate efﬁciently and
intermittently. Due to this “energy buffer,” PnG results in a higher average efﬁciency
than the CS operation [11]. In spite of the better fuel economy, riding comfort is
reduced due to the ﬂuctuating speed of the PnG strategy [11, 12]. Parallel HEVs
have two kinds of “energy buffer.” The one is electric “energy buffer” (i.e., battery)
and mechanical “energy buffer” (i.e., vehicle inertia). And the additional energy
buffer enlarges the freedom in power management. More than just “swinging the
vehicle speed high and low,” the battery SOC also can be ﬂuctuated to improve ride
comfort. In fact, both vehicle kinetic energy and battery energy can be rocked back
and forth to obtain optimal fuel economy or better trade-off between fuel economy
and ride comfort. This chapter systematically studies how the dual-energy-storage
system can be used for optimal fuel economy and its trade-off against ride comfort.

12.2 HEV Model and Problem Statement

12.2.1 HEV Model for Control

The parallel HEV we studied includes a mechanical powertrain and an electric
powertrain, and its structure chart is shown in Fig. 12.1. The main components

12 Cruising Control of Hybridized Powertrain for Minimized Fuel Consumption

269

Pb

Pm

Battery

Converter

Motor

Pe

Engine

Clutch

 

T
o
r
q
u
e
C
o
u
p
e
r

l

Pv

(
C
V
T
)
 

Pc

Vehicle

 

C
o
n
t
i
n
u
o
u
s
l
y
V
a
r
i
a
b
e
T
r
a
n
s
m

l

 

i
s
s
i
o
n

Fig. 12.1 Powertrain topology of the parallel HEV

in this parallel HEV are the battery, converter, motor, internal combustion engine
(ICE), clutch, torque coupler, CVT, vehicle, and so on. The power generated by the
engine can be used to propel the car and also can be used to charge the battery. Both
engine and motor can drive the vehicle individually or together.

In order to obtain the optimal control rules of the engine and motor to minimize
fuel consumption, we naturally ﬁt the problem into an optimal control framework,
using the engine power and motor power as control inputs. The performance index,
plant dynamics, and constraints of this fuel-optimal control problem (OCP) are
described below.

For simplicity, the following assumptions are made:

1. The dynamics of the ﬂy-wheel, clutch, CVT, and motor are ignored;
2. The engine always operates on the best brake-speciﬁc-fuel-consumption (BSFC)

line by using the CVT.

12.2.1.1 Vehicle Longitudinal Dynamics

In the parallel HEV, the engine and the motor can drive the vehicle together or
separately. Based on the force balance equations, the distance s and velocity v
satisfy:

Ps D v;
Pv D
Fr.v/ D 0:5CD(cid:3)aAvv2 C Mgf ;

(cid:8)CPeCPm(cid:3)Fr.v/v
Mv

;

(12.1)

where M and g represent the vehicle mass and the gravity constant, (cid:8)C is the
efﬁciency of the CVT, Pe is the engine power, Pm is the motor power, CD is the
aerodynamic drag coefﬁcient, (cid:3)a is the air density, Av is the frontal area of the
vehicle, f is the rolling resistance coefﬁcient, and Fr is aerodynamic drag and rolling
resistance. It’s worth mentioning that if the engine is off, the clutch can be disen-

270

S.E. Li et al.

gaged to avoid engine drag, that is, Pe D 0. And the motor power Pm can be either
negative or positive, corresponding to charge mode or discharge mode, respectively.
The relationship of the speed ratio iC of the CVT, the vehicle speed and the engine

speed can be explained using Eq. (12.2):

iC D werw= .i0v/ ;

(12.2)

where we is the engine speed, rwis the tire radius, and i0 is the speed ratio of the ﬁnal
drive.

The mechanical efﬁciency of the CVT is nonlinear and depends on its speed ratio
and load. For push-belt CVT, under high speed ratio or high power conditions the
efﬁciency is high (about 85–90 %); otherwise it will rapidly deteriorate to about
70 % [13]. For hybrid vehicles, as the engine can eliminate low-power operations,
the CVT can avoid some inefﬁcient operations. Based on this assumption, we
simplify the CVT efﬁciency to a constant (cid:8)C.

12.2.1.2 Battery and Motor Model

In addition to the above vehicle dynamics, the battery dynamic is expressed as [14]
p

:
OC D (cid:3)

S

Voc (cid:3)

oc (cid:3) 4Pb (cid:4) Rint
V 2
2Rint (cid:4) C

;

(12.3)

where SOC denotes the state of charge of battery, Voc is the battery voltage, Rint is
the internal resistance, C is the battery capacity, and Pb is the battery power.

According to the structure chart of HEV (Fig. 12.1), there is the speciﬁc
correlation between the battery power Pb and the motor power Pm. During charging,
the motor is the equation of a generator and charges the battery. In this situation, both
Pb and Pm are negative with the relationship below:

In the discharge mode, Pb and Pm are both positive, and governed by the relation-
ship:

Pb D Pm(cid:8)m; Pm < 0;

Pb D Pm=(cid:8)m; Pm (cid:8) 0;

(12.4)

(12.5)

where (cid:8)m (the efﬁciency of the motor) relies on the motor speed wm and torque Tm,
as shown in Fig. 12.2.

In this powertrain topology, the motor speed wm is related to the vehicle speed,

as shown in below,

wm D imi0v=rw;

(12.6)

12 Cruising Control of Hybridized Powertrain for Minimized Fuel Consumption

271

Fig. 12.2 Motor efﬁciency as
a function of motor speed and
torque

Motor efficiency

Maximum Torque

0.6

0.85

0.8

200

150

100

50

]

m
N

[
 
e
u
q
r
o
T
 
r
o
t
o
M

0.94

0.92

0.9

0.95

0.6

0

0

200

0.8
400

0.9

600

800

1000

1200

Motor Speed 

where im is the gear ratio of the torque coupler. The motor torque Tm is obtained
from:

Tm D Pm=wm:

(12.7)

We assume that the generator efﬁciency map is identical to the motor efﬁciency
map, i.e.,

(cid:8)m .wm; Tm/ D (cid:8)m .wm; (cid:3)Tm/ ;

(12.8)

12.2.2 Performance Index for Fuel Economy

For the purpose of measuring the fuel economy, the index “fuel consumption per
100 km” is proposed, which is deﬁned as
Z

Fedt

;

tf

0
sf

J D

(12.9)

where tf , Fe, and sf denote the terminal time, engine fuel injection rate, and terminal
distance, respectively.

The BSFC map is shown in Fig. 12.3a, where the blue sweet spot is positioned

in maximum efﬁciency (power 18.9 kW, efﬁciency 38.3 %).

The Eco-line, collection of the most efﬁcient points for varying power level, is
shown in Fig. 12.3a. And Fig. 12.3b presents the ﬁtting result of the Eco-line, whose
efﬁciency (cid:8)e is ﬁtted by:

S.E. Li et al.

Eco-line
Fitted line
Sweet spot

(12.10)

(12.11)

272

a

150

]

m
N

[
 
e
u
q
r
o
T
 
e
n
i
g
n
E

100

50

230

220

230

240

220

240

255
300

255

300

460
650
750

200

300

400
Engine speed [rad/s]

500

BSFC map

460
650
750

0
100

b

 
]

%

[
 
y
c
n
e
i
c
i
f
f
e
 
e
n
i
g
n
E

45

35

25

15

5

0

BSFC

Maximum Torque

Sweet spot

Eco-line

10

20

30

40

Engine power [kW]
Efficiency of the best-BSFC line

Fig. 12.3 Engine model. (a) BSFC map. (b) Efﬁciency of the best-BSFC line

(cid:8)e D (cid:8)0 C

ki.Pe (cid:3) P0/1=.2i/;

X3

iD1

where (cid:8)0 and ki are the ﬁtting coefﬁcients, Pe is engine power, and P0 is a constant.
Since the engine always operates on the Eco-line, the engine fuel injection rate Fe
is obtained by

Fe D

Pe
cg (cid:4) (cid:8)e .Pe/

;

where cg is the caloriﬁc value of gasoline. If the engine is shut off, then Fe D 0.

In fact, the energy stored in the battery is derived from the engine, which means
that the battery acts as an energy buffer rather than an original source. The initial and
terminal states of SOC are constrained to be the same in this fuel-optimal cruising
problem to ensure charge sustenance.

12.2.3 Constraints for Inputs and States

Due to the physical limits of the engine, CVT, battery, and motor, there are some
equality and inequality constraints, as follows:

Pe;min (cid:5) Pe (cid:5) Pe;max; iC;min (cid:5) iC (cid:5) iC;max; SOCmin (cid:5) SOC (cid:5) SOCmax;

Tm;min (cid:5) Tm (cid:5) Tm;max; wm;min (cid:5) wm (cid:5) wm;max:

(12.12)

In the cruising problem, the initial velocity v0 and terminal velocity vf are set to be
equal, i.e.,

v0 D vf :

(12.13)

12 Cruising Control of Hybridized Powertrain for Minimized Fuel Consumption

273

Similarly, the initial and terminal states of SOC are also constrained by:

SOC0 D SOCf :

(12.14)

12.2.4 Optimal Control Problem

The OCP for the parallel HEV is formulated as follows:

Z

tf

Fedt

;

0
sf

min J D

:
OC D (cid:3)

; S

Voc(cid:3)

p

V2
oc(cid:3)4Pb(cid:6)Rint
2Rint(cid:6)C

;

Subject to

:
:
s D v;
v D
(

Pb D

(cid:8)CPeCPm(cid:3)Fr.v/v
Mv
Pm (cid:8) 0
Pm(cid:8)m jPm < 0

Pm
(cid:8)m

;

v0 D vf ; SOC0 D SOCf ; Pe;min (cid:5) Pe (cid:5) Pe;max; iC;min (cid:5) iC (cid:5) iC;max;

SOCmin (cid:5) SOC (cid:5) SOCmax; Tm;min (cid:5) Tm (cid:5) Tm;max; wm;min (cid:5) wm (cid:5) wm;max:
(12.15)

In fact, the state vectors are the distance s, velocity v, and SOC, denoted as x D
.s; v; SOC/T . The control inputs consist of the engine power Pe and motor power Pm,
denoted as u D .Pe; Pm/T . Other parameters not mentioned are listed in Table 12.1.
This OCP has strong nonlinearity in dynamics and discontinuity in switching
between charge and discharge modes, so it is really a great challenge to solve. To
address this discontinuous nonlinear problem, we use the Legendre pseudospectral
method and knotting technique to convert the optical control problem (OCP) into a
nonlinear programming (NLP) problem for more accurate numerical computation.

12.3 Legendre Pseudospectral Method and Knotting

Technique

Since we assume the initial and terminal states of SOC must be the same, there are
two possible cases: (a) both the engine and battery are used with no net change in
battery energy, or (b) only the engine is used, which is a special case of (a) with the
battery power always equal to zero. In a long riding, there may be many charge and
discharge events, whose optimal proﬁle is difﬁcult to obtain by this strong nonlinear
and nonconvex OCP.

Therefore, we focus on only one charge/discharge event over a shorter period of

time.

274

S.E. Li et al.

12.3.1 Legendre Pseudospectral Method

The Legendre pseudospectral method (LPM) is a global collocation method for
converting OCP into NLP [15–17]. In order to convert the OCP into an NLP prob-
lem, LPM discretizes the OCP at orthogonal collocation points and then employs
global interpolating polynomials, rather than local interpolating polynomial, to
approximate states and control inputs.

Compared to conventional methods (e.g., shooting method), LPM has higher
accuracy and convergence speed [15]. But LPM is highly accurate only for smooth
problems, which means that LPM is difﬁcult to solve the non-smooth OCP that
involves switching between different modes [16], like Eq. (12.15).

Here, we ﬁrst simplify the switching rule and then apply the knotting technique

to convert the OCP.

12.3.2 Knotting Technique

Under this simpliﬁcation, the knotting technique is then utilized to convert the non-
smooth problem. Its basis is to divide the original OCP into two smooth sub-stages,
corresponding to the charge and discharge modes, and then each of the sub-stages
is converted to an NLP problem by using LPM. Besides, the connection constraints
need to be added between the consecutive stages to ensure continuity of the state
vector (e.g., vehicle speed and SOC), and thus relink the two local trajectories
into an integrated continuous one. Finally, the optimal results are obtained by the
collaborative optimization of the two sub-stages.

Table 12.1 Key parameters of the vehicle dynamics

Parameters
M
CD
Av
(cid:3)a
f
rw
i0
im
(cid:8)C
C
k0, k1, k2

Value
1450 kg
0.28
2.52 m2
1.2 kg/m3
0.015
0.287 m
3.3
2.63
0.88
1.35 kWh
0.0253, (cid:3)2.94922, 8.0482

Parameters
(cid:8)0
P0
Pe,max
Pe,min
iC,max
iC,min
wm,max
wm,min
SOCmax
SOCmin

Value
(cid:3)10.06
3 kW
60 kW
0
0.4
4.2
1200 rad/s
0
80 %
30 %

12 Cruising Control of Hybridized Powertrain for Minimized Fuel Consumption

275

This technique helps us avoid accuracy loss compared with using only one
smoothing function to approximate discontinuous variables. The process of con-
verting the OCP by LPM and the knotting technique is stated as follows. To be
concise, the initial time is denoted as T0, and the terminal time of the two sub-stages
are denoted as T1 and T2.

12.3.2.1 Step1: Conversion of Time Interval

The two stages are transformed into a canonical interval Œ(cid:3)1; 1(cid:11) by

(cid:4)
Tq C Tq(cid:3)1

(cid:5)

2t (cid:3)

;

Tq (cid:3) Tq(cid:3)1

(cid:4) D

(12.16)

where q is 1 or 2.

12.3.2.2 Step2: Collocation Points and Approximation

The LPM employs Legendre–Gauss–Lobatto collocation points, which are the roots
of the derivative of an Nth order Legendre polynomial, together with two end points:
(cid:3)1 and 1. Each phase can have a different number of collocation points, denoted as
Nq C 1. The collocation points at the qth phase are denoted as (cid:4) q,i, where i D
0; 1; (cid:2) (cid:2) (cid:2) ; Nq. The states s, v, and SOC are discretized to
3

2

4

Xq D

Sq;0 Sq;1 (cid:2) (cid:2) (cid:2) Sq;Nq
Vq;0 Vq;1 (cid:2) (cid:2) (cid:2) Vq;Nq
Sq;0 Sq;1 (cid:2) (cid:2) (cid:2) Sq;Nq

5 :

(12.17)

The engine power Pe and motor power Pm are also discretized to Peq,i and Pmq,i.
Note that we only optimize the discretized states and control inputs; the dynamics
xq((cid:4)) and uq((cid:4)) are obtained by Lagrange interpolation at collocations points, i.e.,
XNq
iD0
XNq
iD0

Lq;i .(cid:4)/ Uq;i;

Lq;i .(cid:4)/ Xq;i;

uq .(cid:4)/ (cid:6)

xq .(cid:4)/ (cid:6)

(12.18)

where Lq,i((cid:4)) are the Lagrange basis polynomials.

276

S.E. Li et al.

12.3.2.3 Step3: Conversion of the State Space Equations

The differential state equations can be approximated by the differential operation on
the Lagrange basis polynomials, i.e.,

(cid:5)

(cid:4)
(cid:4)q;k

:
xq

D

XNq
iD0

(cid:5)

(cid:4)

:
Lq;i

(cid:4)q;k

Xq;i D

XNq
iD0

Dq

kiXq;i:

(12.19)

where k D 0; 1; 2; (cid:2) (cid:2) (cid:2) ; Nq, and Dq is the differentiation matrix with explicit
expression [15]. Then the vehicle dynamics Eq. (12.1) and battery dynamics Eq.
(12.3) are converted to a series of equality constraints at the collocation points:

XNq
iD0
XNq
iD0

XNq
iD0
(cid:4)

Dq
ki

Sq;i D (cid:12)Tq (cid:4) Vq;k;

Dq
ki

Vq;i D (cid:12)Tq

Dq
ki

Sq;i D (cid:3)(cid:12)Tq

(cid:8)C Peq;k C Pmq;k (cid:3) Fr

Vq;k

Vq;k

;

(cid:4)

(cid:5)

MVq;k

p

Voc (cid:3)

oc (cid:3) 4 Pbq;k (cid:4) Rint
V 2
2Rint (cid:4) C

;

where (cid:12)Tq D

Tq (cid:3) Tq(cid:3)1

=2.

(cid:5)

12.3.2.4 Step 4: Conversion of the Cost Function

The integral part of the cost function is calculated by Gaussian–Lobatto quadrature,
so the performance index is computed by:

X2

(cid:12)Tq

J D

qD1

XNq
kD0

wq;kFe
S2;N2

(cid:5)

(cid:4)
Peq;k

:

where wq,k are the weighting coefﬁcients of the Gaussian–Lobatto quadrature,
deﬁned as [15]

wq;k D

Lq;k .(cid:4)/ d(cid:4) D

Z 1

(cid:3)1

(cid:4)

2
(cid:5)
Nq C 1

Nq

(cid:5) :

(cid:4)
(cid:4)q;k

P2
Nq

12.3.2.5 Step 5: Connection Constraints

Since the distance, velocity, and SOC are continuous between the two stages, the
following constraints are added:

S1;N1 (cid:3) S2;0 D 0; V1;N1 (cid:3) V2;0 D 0; S1;N1 (cid:3) S2;0 D 0:

(12.23)

(12.20)

(12.21)

(12.22)

12 Cruising Control of Hybridized Powertrain for Minimized Fuel Consumption

277

After these steps, the OCP Eq. (12.15) is converted into the following NLP problem:
XNq
kD0

Peq;k

(cid:12)Tq

X2

(cid:4)

(cid:5)

;

J D

qD1

wq;kFe
S2;N2

Subject to

Dq
ki

Dq
ki

XNq
iD0
XNq
iD0
XNq
iD0

Pbq;k D

Sq;i D (cid:12)Tq (cid:4) Vq;k;

Vq;i D (cid:12)Tq

(cid:8)C Peq;k C Pmq;k (cid:3) Fr

Vq;k

Vq;k

;

(cid:4)

(cid:5)

p

MVq;k
oc (cid:3) 4 Pbq;k (cid:4) Rint
V 2
2Rint (cid:4) C

;

Voc (cid:3)

Dq
Sq;i D (cid:3)(cid:12)Tq
ki
(
Pmq;k
Pmq;k (cid:8) 0
(cid:8)m
Pmq;k(cid:8)m Pmq;k < 0

:

(12.24)

V1;0 D V2;N2;
S1;0 D S2;N2 ;
0 D S1;N1 (cid:3) S2;0;
0 D V1;N1 (cid:3) V2;0;
0 D S1;N1 (cid:3) S2;0;
Pe;min (cid:5) Peq;k (cid:5) Pe;max;
iC;min (cid:5) iC (cid:5) iC;max:

where k; i D 0; 1; 2; (cid:2) (cid:2) (cid:2) ; Nq; q D 1; 2.

The variables to be optimized include the traveling distance Sq;k, vehicle speed
Vq;k, SOC of battery Sq;k, engine power Peq,k, and motor power Pmq,k. In essence,
this NLP is a high-dimensional sparse constrained problem, and is solved by the
sequential quadratic programming (SQP) algorithm [18].

12.4 Optimization Results

12.4.1 Speed-PnG Cruising Operation

12.4.1.1 Setting Conditions

Given that the vehicle is expected to cruise in a constant average speed, we focus on
the general case, in which the vehicle speed is free. In this case, the average speed
v must be equal to the expected speed ve, i.e.,

v D sf =tf D ve:

(12.25)

278

S.E. Li et al.

Pulse

Glide 

6

4

2

0

-2

-4

-6

51

50

49

30

25

20

15

10

]
h
/
m
k
[
 
n
o
i
t
a
u
t
c
u
l
f
 
d
e
e
p
S

 
]

%

[
 

C
O
S

]

W
k
[
 
r
e
w
o
p
 
e
n
i
g
n
E

5

0

0

Engine shutdown

5

10
Time [s]

15

20

= 20 km/h
= 60 km/h
= 120 km/h

Power of sweet spot

Fig. 12.4 Optimization results: Speed-PnG strategy at 20 and 60 km/h and CS strategy at
120 km/h

Both the initial and ﬁnal SOC are set to 50 %, the terminal time is ﬁxed to 20 s.
The number of collocation points in each phase is set to 15. We select the three
cases, in which this car cruises at 20, 60, and 120 km/h, respectively.

12.4.1.2 Solving Results

By using LPM and the knotting technique, their optimal proﬁles of speed ﬂuctua-
tion, SOC, and engine power are obtained and shown in Fig. 12.4. We can see that:

1. In the cases of 20 and 60 km/h,

(a) As shown in Fig. 12.4, the fuel-optimal operation is to accelerate the vehicle
to a higher speed ﬁrst and then coast down to a lower speed. We called this
variation of vehicle speed the speed ﬂuctuation. And the speed ﬂuctuations
of the two cases are ˙26 and ˙9 %, respectively.

(b) In Fig. 12.4, the SOC is constant for the whole duration of the two cases,
which means no energy is converted to the battery and the battery/motor
system is not used.

12 Cruising Control of Hybridized Powertrain for Minimized Fuel Consumption

279

(c) In Fig. 12.4, the engine ﬁrst runs at a high power, which approximately
coincides with the power of the sweet spot, and then switches to shutdown
with zero power output. So we know this optimal strategy is called “Speed-
PnG” operation, consisting of pulse phase and glide phase under the
inﬂuence of the ﬁxed SOC and ﬂuctuating speed, which is the vehicle speed
pulses ﬁrst and then glides.

2. In the case of 120 km/h

From Fig. 12.4, the states, such as the vehicle speed, SOC, and engine
power, keep all constant. In this situation, the optimal operation is to cruise at
a ﬁxed speed driven by the engine only. And this optimal strategy is called “CS”
(constant speed) operation.

In addition, this optimal strategy shows that:

(a) Actually, the optimal result is Speed-PnG operation rather than cruising at a

ﬁxed speed

(b) During cruising at low speeds (e.g., 20 km/h), the battery and motor are not
utilized, and the optimal control rule of engine is to switch between the sweet
spot and shutdown, corresponding to the pulse/glide phases.

12.4.1.3 Explication the Fuel Economy of Speed-PnG

In order to explicit the fuel economy of Speed-PnG, we set the CS operation as the
benchmark. In the cases of 20 and 60 km/h, the fuel consumption of using CS is
4.30 and 3.47 L/100 km, respectively, dropping to 2.03 and 2.97 L/100 km if using
Speed-PnG. Therefore, Speed-PnG achieves a fuel-savings of 52.7 and 14.45 %
compared to CS, with fuel-saving rate (cid:8)F deﬁned as

(cid:8)F D

JCS (cid:3) JPnG
JCS

(cid:4) 100%;

(12.26)

where JCS and JPnG are fuel consumed by CS and PnG.

With expanding the above three examples to various average cruising speeds, the
fuel-saving rate of Speed-PnG and corresponding average optimal engine power to
pulse are shown in Fig. 12.5. When v 2 Œ20; 104(cid:11) km/h, the Speed-PnG strategy
achieves better fuel economy than CS, and the optimal operating engine power
approximately equals the power of the sweet spot.

280

S.E. Li et al.

30

20

10

]

W
k
[
 
r
e
w
o
p
 
.
g
n
E

 
.
t
p
O
 
e
g
a
r
e
v
A

0
20

Speed-PnG to CS

Lose fuel 

benefit

60

50

40

30

20

10

0

F
u
e
l
 
s
a
v
i
n
g
 
r
a
t
e
 
[

%

]

40

60

80

100

120

Average velocity [km/h]

Fuel saving
Opt. power
Power of sweet spot

Fig. 12.5 Optimal fuel-saving rate and average engine power in the pulse phase of Speed-PnG

12.4.2 SOC-PnG Cruising Operation

12.4.2.1 Setting Conditions

In the Speed-PnG operation, the ﬂuctuating speed is less acceptable for human
drivers. So here we change the constraint on vehicle speed into cruising at a ﬁxed
speed; That is to say the vehicle maintains the constant speed rather than PnG:

v (cid:9) ve:

(12.27)

Under the limits, we set the terminal time to 100 s, and the initial and ﬁnal SOC

are set to 50 %. Three cases, cruising at 20, 40, and 60 km/h, are selected.

12.4.2.2 Solving Results

The optimization results are shown in Fig. 12.6, which shows that:

1. In the cases of 20 and 40 km/h, the engine begins to operate at a high power to
maintain the vehicle cruising and charge the battery, with SOC rising; then the
engine is shutdown and only the battery is used to drive the vehicle, with SOC
dropping to initial value. So, the optimal result in this situation is that “SOC-
PnG” operation which means the SOC pulses ﬁrst and then glides, similar to the
Speed-PnG.

2. In addition, we can also see that the optimal engine power in the pulse phase is
12.65 and 11.44 kW at 20 and 40 km/h, respectively. They are not in the position
of the sweet spot (18.9 kW), which is generally considered to be optimal.

3. When cruising at 60 km/h, the SOC is constant (50 %) and the engine keeps
operating at 6.13 kW, indicating that the vehicle is driven by engine only.
Therefore, the optimal operation is CS rather than SOC-PnG.

12 Cruising Control of Hybridized Powertrain for Minimized Fuel Consumption

281

Pulse 

Glide

55

54

53

52

51

50

49

20

15

10

5

0

]

%

[
 

C
O
S

]

W
k
[
 
r
e
w
o
p
 
e
n
i
g
n
E

W
k
6

t
u
o
b
a

Engine shutdown

= 20km/h
= 60 km/h
= 120km/h
Power of sweet 

0

20

80

100

60

40
Time [s]

Fig. 12.6 Optimization results: SOC-PnG strategy at 20 and 40 km/h and CS strategy at 60 km/h

12.4.2.3 Explication the Fuel Economy of SOC-PnG

In the ﬁrst two cases, the fuel consumption using the SOC-PnG strategies is 3.22
and 3.30 L/100 km, rising to 4.30 and 3.45 L/100 km if using CS, respectively.
Thus, SOC-PnG achieves a fuel-savings of 25.1 and 4.3 % compared to CS. With
individually optimizing the problems at different cruising speeds, the fuel-saving
rate and optimal engine power to pulse are shown in Fig. 12.7. When v (cid:5) 48 km/h,
SOC-PnG can save fuel and its optimal engine power is around 12 kW. Therefore,
with the cruising speed increasing, the fuel-saving rate decreases continuously and
eventually CS becomes optimal.

From Fig. 12.7, we can see the optimal engine power straying from the sweet
spot and the fuel-saving rate in the case of keeping the engine operating at the
sweet spot (18.9 kW) to pulse. And the fuel-saving rate drops about 3 percentage
points compared to the SOC-PnG optimum. As a simpliﬁcation, keeping running
the engine at ﬁxed 12 kW only leads to less than 1 percentage reduction. Overall, in
the SOC-PnG operation selecting a proper lower engine power to pulse can achieve
better fuel performance than using the sweet spot.

12.4.3 Comparison Between Speed-PnG and SOC-PnG

As mentioned in the above, we know that both Speed-PnG and SOC-PnG can
save fuel compared to CS in a particular speed interval. According to their optimal

282

S.E. Li et al.

SOC-PnG to CS

20

15

10

5

0

30

20

10

0

]

W
k
[
 
r
e
w
o
P
 
e
n
i
g
n
E

]

%

[
 
e
t
a
r
 
g
n
i
v
a
s
 
l
e
u
F

-10

20

30

40
Velocity [km/h]

50

60

Optimum

Using 12kW to pulse

Using sweet spot to pulse

Fig. 12.7 Optimal average engine power and fuel-saving rate of SOC-PnG at different cruising
speeds

fuel-saving rates in Fig. 12.8a, it’s obvious that the Speed-PnG strategy has better
fuel economy than SOC-PnG. And as the average speed increases, the fuel-saving
capacity of both operations decreases and eventually vanishes.

For the SOC-PnG strategy, if the battery and motor are ideal (i.e., with 100 %
efﬁciency), we call it as SOC-PnG (ideal), then we can operate the engine at the
sweet spot to charge the battery with no conversion losing. So it should have
the highest system efﬁciency, theoretically. In Fig. 12.8a, the fuel-saving rate of
the Speed-PnG strategy is very close to that of SOC-PnG (ideal), which shows that
Speed-PnG is the most efﬁcient mode of operation. Considering riding comfort, the
Speed-PnG strategy is less applicable due to the ﬂuctuating speed.

The average optimal accelerations of Speed-PnG and SOC-PnG at various
average cruising speeds are shown in Fig. 12.8b. In practice, a trade-off between
fuel economy and ride comfort is possible.

12.5 Fuel-Saving Mechanisms

In this section, we study the underlying mechanisms of Speed-PnG and SOC-PnG
by addressing the following questions.

But we need to introduce a key ﬁgure (i.e., Fig. 12.9) for understanding the
mechanisms and answering the questions. In Fig. 12.9, the abscissa is power, the

12 Cruising Control of Hybridized Powertrain for Minimized Fuel Consumption

283

a

]

%

[
 
e
t
a
r
 
g
n
i
v
a
s
 
l
e
u
F

60

50

40

30

20

10

0

Speed-PnG
SOC-PnG (real)
SOC-PnG (ideal)
CS

Speed-PnG
SOC-PnG (real)

pulse

glide

20

40
80
60
Average velocity [km/h]

100

30

40

50

60

70

Average velocity [km/h]

Fig. 12.8 Comparison of Speed-PnG and SOC-PnG (real/ideal). (a) Fuel-saving rate; (b) average
optimal acceleration

b

]
2
s
/
m

[
 
.
c
c
a
 
l
a
m

i
t
p
o
 
e
g
a
r
e
v
A

1.6

1.2

0.8

0.4

0

-0.4

20

S

Efficiency

G

Ev

ESOC

ECS

E

’
Ev

’
ECS

’
E    
SOC

T

Lose fuel benefit

O

Pd

’
Pd

PS

Power

Fig. 12.9 Mechanism of Speed-PnG and SOC-PnG

Eco-line (CS)
SOC-PnG
Speed-PnG
Electric powertrain

ordinate is efﬁciency. If the vehicle cruises at a ﬁxed speed v, the demanded engine
power is recorded as Pd. Since the engine always operates on the Eco-line, point
ECS stands for the corresponding engine efﬁciency of using CS strategy.

Question 1 Why Speed-PnG saves fuel at a certain speed interval and is the most
efﬁcient operation?

Solution For this question, in Speed-PnG, the engine operates at the sweet spot
S with highest efﬁciency (cid:8)S in pulse phase. In the glide phase, the engine is
shutdown and the vehicle coasts, dissipating the stored kinetic energy, which is
generated in the pulse phase with efﬁciency (cid:8)S. Therefore, points S/G stand for the
pulse/glide phases, respectively. Ignoring the tiny difference of total aerodynamic
drag in Speed-PnG and CS, the average engine power of Speed-PnG is equal to Pd,
so point Ev indicates the average efﬁciency of Speed-PnG.

284

S.E. Li et al.

d), the efﬁciency of Speed-PnG (point E’

It is clear that the average efﬁciency (point Ev) of Speed-PnG is higher than that
of CS (point ECS). As the average cruising speed increases (e.g., point Pd moves
to P’
v) remains ﬁxed, while the efﬁciency of
CS (point E’
CS) increases. As a consequence, the fuel-saving rate decreases. When
point Pd moves to PS, the two strategies have the same efﬁciency, at which point
Speed-PnG loses its fuel beneﬁt and CS becomes the optimal operation.

In Speed-PnG, the vehicle body actually plays the role of an energy buffer with
variable kinetic energy, and the kinetic energy can be “charged/discharged” with
100 % efﬁciency, thus making Speed-PnG the most efﬁcient operation.

Question 2 Why SOC-PnG can save fuel and its fuel-saving capacity is lower than
that of Speed-PnG?

Solution In order to answer this question, here we make some assumptions to
simplify the problem, as below:
(a) The motor efﬁciency (cid:8)m, discharge/charge efﬁciency (cid:8)dis/(cid:8)chg/of the battery, are

ﬁxed;

(b) In pulse phase, the engine operates at sweet spot S to charge the battery and

drive the vehicle, though it is not the optimum, as shown in Fig. 12.7.

In glide phase, the engine is shutdown and the motor drives the vehicle using
the stored energy in pulse phase. The motor output energy originates from the
engine with the following conversion steps: engine (cid:8)S ! motor (cid:8)m ! (cid:8)chg battery
(cid:8)dis ! motor (cid:8)m ! vehicle, where (cid:8)# is the efﬁciency. The overall efﬁciency is
recorded as (cid:8)E D (cid:8)S(cid:8)m(cid:8)chg(cid:8)dis(cid:8)m. It is called the efﬁciency of electric powertrain,
as shown in Fig. 12.9.

Here we argue that the efﬁciency of SOC-PnG is on the line ES; the proof is

given below:

Record the duration of pulse phase as tP, the total fuel consumption Fc is

where cg is the caloriﬁc value of gasoline. Energy Eb charged to the battery is

Eb D tP .PS (cid:3) Pd/ (cid:8)m(cid:8)chg:

(12.29)

In glide phase, the stored energy is consumed and the duration tG is

Fc D

tPPS
cg(cid:8)S

;

tG D

Eb(cid:8)dis(cid:8)m
Pd

;

(12.28)

(12.30)

Thus, the average efﬁciency (cid:8)SOC of SOC-PnG is

(cid:8)SOC D

Pd .tP C tG/
cgFc

Pd
PS

D (cid:8)E C

.(cid:8)S (cid:3) (cid:8)E/

(12.31)

12 Cruising Control of Hybridized Powertrain for Minimized Fuel Consumption

285

This formula shows that (cid:8)SOC is a linear function of Pd, with (cid:8)SOC D (cid:8)E when
Pd D 0, and (cid:8)SOC D (cid:8)S when Pd D PS. Point ESOC thus stands for the average
efﬁciency of SOC-PnG when the demanded power is Pd.

In Fig. 12.9, point ESOC is higher than point ECS at low speed, allowing SOC-
PnG to save fuel when v < 48 km/h, as shown in Fig. 12.7. As the demanded power
increases, point ESOC rises linearly and the point ECS increases nonlinearly. At point
T, the two strategies have the same efﬁciency, at where the optimal strategy changes
from SOC-PnG to CS.

In SOC-PnG, the battery acts as the energy buffer to adjust the engine status.
Compared to the vehicle body, the battery suffers an about 10 % conversion loss,
along with the motor. Thus, SOC-PnG has lower fuel economy than Speed-PnG.
If the battery/motor system is ideal with 100 % efﬁciency, point E coincides with G,
and then point ESOC coincides with Ev, which explains the similar fuel economy of
SOC-PnG (ideal) and Speed-PnG (see Fig. 12.8).

Question 3 In Speed-PnG, why the optimal control is to operate the engine between
the sweet spot and shutdown without using the battery/motor system?

Solution For question 3, in Speed-PnG, letting the engine switch only between the
sweet spot and shutdown, we can then obtain the highest average efﬁciency (line GS)
and best fuel economy. To avoid the conversion loss of the battery/motor system, the
extra energy generated in the pulse phase is preferentially transferred to the vehicle
body, thus the battery/motor is not used.

Question 4 In SOC-PnG, why the engine does not operate at the sweet spot to
minimize the fuel consumption?

Solution For the question, if the engine operates at a random point with power P
and efﬁciency (cid:8), Eq. (12.31) can be varied as
(cid:8)

(cid:9)

(cid:8)SOC D (cid:8).P/ (cid:4)

ˇ1 C ˇ2

max
P

Pd
P

;

(12.32)

where ˇ1 D (cid:8)chg(cid:8)m(cid:8)dis(cid:8)m and ˇ2 D 1 (cid:3) ˇ1 are constants. Operating the engine at
point S maximizes the engine efﬁciency (cid:8)(P) but makes the last term 1/P deviate
from the optimal. We can further convert Eq. (12.32) to Eq. (12.33), i.e.,

(cid:8)SOC D (cid:8).P/ (cid:4)

1 (cid:3) ˇ2

max
P

(cid:8)

(cid:9)

;

P (cid:3) Pd
P

(12.33)

where ˇ2 D 1 (cid:3) (cid:8)chg(cid:8)m(cid:8)dis(cid:8)m is the efﬁciency loss, and .P (cid:3) Pd/ is the power
converted to the battery. The last term reﬂects the conversion loss, and the higher
P leads to a greater loss. Therefore, the optimal engine power P is the trade-off
between engine efﬁciency and conversion loss. Note that for the real battery and
motor, ˇ2 is related to Pd and P, the optimal power (see Fig. 12.7) is determined by
a more complex nonlinear optimization problem.

286

S.E. Li et al.

45

40

35

b

]
2
s
/

m

[
 
n
o
i
t
a
r
e
l
e
c
c
A

1.6

1.2

0.8

0.4

0

-0.2

20

a

]
2
s
/

m

[
 
n
o
i
t
a
r
e
l
e
c
c
A

1.6

50

1.2

0.8

0.4

0

-0.2

45

40

35

Fuel saving [%] of rule A
Speed-PnG
CS

Fuel saving [%] of rule B
Speed-PnG
SOC-PnG

Rapidly reduce
to 0 

30

25
10
5

20

15

10
5

10

5

30

25

20

15

30

25

20

15

10

5

0

-5

-10

20

30

40

50

60

70

Average velocity [km/h]

30

40

50

60

70

Average velocity [km/h]

Fig. 12.10 Fuel economy of the two compromise strategies of rule A and rule B. (a) fuel-saving
map of rule A; (b) fuel saving map of rule B

12.6 Compromised Rules and Performance

Even though having the highest fuel-saving rate, the Speed-PnG strategy suffers
from poor ride comfort due to the ﬂuctuating speed, as shown in Fig. 12.8. So in
this section we present the principles to compromise between fuel economy and
ride comfort, that is, to limit the acceleration in the pulse phase by sacriﬁcing
fuel-saving.

Based on Fig. 12.9, two rules are proposed to achieve the goal:

Rule A In the pulse phase, for a given lower acceleration, the battery and motor are
not used; the engine operates at a lower power (lower efﬁciency) to accelerate rather
than at the sweet spot (best efﬁciency), for example, using point T to replace the
sweet spot S, as shown in Fig. 12.9.

Rule B In the pulse phase, for a given lower acceleration, the engine always
operates at the sweet spot, but only part of the power is used to accelerate; the
extra power is absorbed by the battery and later dissipated in the glide phase. In this
case, both vehicle speed and SOC ﬂuctuate periodically.

The fuel-saving rate of Rule A and Rule B at different acceleration and average

speed is shown in Fig. 12.10a, b.

In rule A, the fuel-saving rate drops from the optimum (Speed-PnG) to that of
the CS strategy as the acceleration decreases. Due to the nonlinear engine efﬁciency,
the fuel-saving rate drops slowly at ﬁrst and then quickly descends to zero. It can be
explained by Fig. 12.9: as point S moves left, line GS moves down, and then point
Ev goes down nonlinearly, depending on the proﬁle of the best BSFC line. This rule
can be regarded as a weighted sum of Speed-PnG and CS.

In rule B, as the acceleration decreases, we can gain better ride comfort and a
loss of more fuel beneﬁt. Figure 12.10b shows that the fuel-saving rate drops from
the optimum (Speed-PnG) to that of SOC-PnG, at a roughly linear rate. In effect,

12 Cruising Control of Hybridized Powertrain for Minimized Fuel Consumption

287

Fig. 12.11 Comparison of
rule B and rule A (B minus A)

Difference on fuel saving [%]
rule B minus rule A 

0

-6

-9

]
2
s
/
m

[
 
n
o
i
t
a
r
e
l
e
c
c
A

1.6

1.2

0.8

0.4

0

-0.2

-11

Rule A  better

-9

-6

10

5

0

Rule B better

20

30

40

50

60

70

Average velocity 

the lower the acceleration, the more power converted to the battery, thus leading to
a greater conversion loss. This compromise rule can be regarded as a weighted sum
of Speed-PnG and SOC-PnG. Designers can determine the weights based on their
relative demand for fuel economy and comfort.

We can see the difference of rule B and rule A from Fig. 12.11. Under high speed
and high acceleration, rule A achieves better fuel-saving than rule B. Otherwise,
rule B is more economical. In practice, drivers or the control system can choose
an acceptable acceleration level based on their preference for fuel economy or ride
comfort, and then determine the proper compromising control rule using Fig. 12.11.

12.7 Conclusions and Remarks

In this chapter, we studied the fuel-optimal cruising strategies for parallel HEVs.
And battery-motor system and inertia of vehicle body could form a dual-energy-
storage system. The vehicle inertia has higher energy conversion efﬁciency; its
utilization can further improve the fuel efﬁciency but incur penalty on ride comfort.
Therefore, their coordination enables better trade-off between fuel economy and
ride comfort. The detailed ﬁndings include:

1. Three fuel-optimal cruising strategies are proposed: Speed-PnG with ﬂuctuating
speed and ﬁxed SOC, SOC-PnG with ﬂuctuating SOC and ﬁxed speed, and CS
at a constant speed driven by the engine only.

(a) In free cruising scenarios with a limited average speed, the optimal operation
is Speed-PnG at medium speed, and then changes to CS at high speed. In
Speed-PnG, the optimal control of the engine is to switch between the sweet
spot and shutdown; the battery/motor system is not used to avoid conversion
loss.

288

S.E. Li et al.

(b) In ﬁxed-speed cruising scenarios, the optimal operation changes from SOC-
PnG to CS at increasing speeds. In SOC-PnG, the engine does not operate at
the sweet spot but at a lower power (e.g., about 12 kW for the studied HEV),
which is a trade-off between engine efﬁciency and conversion loss.

2. Speed-PnG is the most efﬁcient operation. It achieves better fuel economy than
SOC-PnG, arising from the fact that vehicle inertia suffers from less conversion
loss than battery. Due to the two energy buffers, the engine can operate at efﬁcient
region intermittently and avoid inefﬁcient operation, thus both Speed-PnG and
SOC-PnG strategies have better fuel economy than CS strategy.

3. In application, using both vehicle inertia and battery simultaneously can
achieve better balance between fuel economy and ride comfort. For a limited
acceleration, “decreasing the engine power without using the battery” is more
efﬁcient than “using the battery to absorb the extra energy with the engine
operating at the sweet spot” under most conditions, except for the low speed
low-acceleration condition.

Generally speaking, Speed-PnG strategy with ﬂuctuating kinetic energy could
only be implemented in sparse trafﬁc ﬂow. To implement the proposed strategies,
more issues such as coordinating with driver operation, executing in car-following
scenarios, and its effect on the fuel economy and smoothness of whole trafﬁc ﬂow
should be further studied.

Abstract This chapter provides solutions to the fault detection and isolation
(FDI) problem when the model describing the system behavior is a deterministic
continuous-variable system and faults can be modeled as additive signals acting
on the process. The solution to this problem leads to a diagnostic system that
consists of two parts: a residual generation module and a residual evaluation module.
The chapter focuses on two FDI approaches: the observer design method and the
nonlinear parity equation method. Illustrative examples on fault diagnosis for a
brake-by-wire system and a battery demonstrate the efﬁcacy of the methods.

Keywords Fault Detection (cid:129) Fault Isolation (cid:129) Automotive

13.1 Introduction to Fault Detection and Isolation

Any complex system or process is subject to the occurrence of faults. These systems
may be mechanical, chemical, electrical, or some combination of these and may or
may not be controlled by a computer. Faults include the complete or partial failure
of actuators, sensors, or other components of the system, or the occurrence of events
external to the system (disturbances) that prevent its normal functioning. The ability
to detect the occurrence of any fault and identify its cause is critical for a number
of reasons. In some cases faults can lead to great loss of life and property (e.g.,
aircraft, nuclear power plants, etc.) [22, 40]. Further, early detection of faults can
allow timely corrective action which in many cases will greatly reduce the incidence
of expensive, unexpected breakdowns (e.g., machinery in factories). Environmental
considerations are also of importance such as systems for monitoring automobile
engine emissions.

One of the simplest methods of fault detection and isolation (FDI) is to utilize
hardware redundancy [4], usually in conjunction with a voting scheme [41]. For
example, a computer may be used to monitor the outputs of a number of sensors
all of which measure the same physical variable. The reading that occurs most often
among the sensors is then taken as the correct one. More sophisticated schemes may
assign different weights to different sensors based upon their reliability and then use
some decision-making scheme to estimate the correct measurement. The hardware
redundancy approach is obviously expensive and is used only in systems where the
higher cost is justiﬁed by the potential beneﬁts in terms of safety and performance.
With the increasing application of computers to the control of systems and
processes, the use of computer-based approaches to FDI, i.e. those that use software
or analytical redundancy, have become feasible [1, 2, 4, 14, 15, 20, 31, 32, 36]. In
these approaches, data gathered from the system are analyzed by the computer in
order to detect the presence of faults. The computer makes use of a priori knowledge
about the system—usually embodied in a knowledge base or physical model—to
make inferences about the presence or absence of faults from the data gathered. The
focus of this discussion will be on model-based approaches to FDI.

Model-based FDI strategies use either a phenomenological model (which may
be linear or nonlinear) or an empirical, input–output data-based model (again linear
or nonlinear) to predict the outputs of the system that is being monitored, from a
knowledge of its inputs. The difference between the measured and predicted output
is called a residual. Under ideal conditions, i.e. when there are no faults, no noise
corrupting the measurements, no uncertainty in the model, all the residuals will be
zero. If a fault is present the residual is non-zero, allowing detection of the fault.
When a fault is detected the residuals are further processed to isolate the location of
the fault in the system.

The software algorithm that generates the residuals is called the residual
generator. In the absence of faults the generator produces zero residuals, while in
the presence of faults the generator is so constructed that the presence of speciﬁc
faults give rises to unique signatures that allow the identiﬁcation of the particular
fault. The ﬁeld of FDI has seen signiﬁcant progress with respect to model-based
algorithmic approaches to residual generation, and in many respects this subject
area can be considered relatively mature [1–4, 15, 20, 23, 31, 32, 36, 39]. Recently,
progress has also been made in the development of hierarchical approaches that
permit the decomposition of a complex diagnostic process into a structure that can
greatly simplify and systematize the development of structured FDI algorithms [33].
Faults that can occur in dynamic systems can almost always be classiﬁed into

one of three types:

Input or actuator faults These are faults that arise due to failures in actuators,
causing the actual inputs acting on a system to be different from the known or
nominal values. Unmeasured disturbances are also most naturally modeled as input
faults though in the FDI literature an artiﬁcial distinction is often made between
disturbances and actuator failures.

Output or sensor faults Output faults arise due to faulty measurements and result
in the measured values of the output variables being different from the true values.
It should be noted that in any measurement system the true value of a variable is
never known because there always is some amount of noise, sensor mis-calibration

13 Fault Detection and Isolation with Applications to Vehicle Systems

295

reference input

Controller

fault

fault

fault

input

Actuators

Plant Dynamics

Sensors

output

Residual
Generation

residual

diagnosis

Decision
Making

Fig. 13.1 General structure of a model-based FDI scheme with faults

and other factors that affect the accuracy of the measurement. However, when
the discrepancies become unacceptably large, a sensor fault is considered to have
occurred [8].

Parameter or component faults These are faults that can be represented as
changes in system parameters, either due to failures in system components or due to
natural changes in the system such as aging and wear. Component faults differ from
input and output faults in an important way—they often enter the system equation
nonlinearly, making it impossible to diagnose using linear diagnostic techniques. In
nonlinear system, practically there is no difference between parameter faults and
input faults, since a parametric fault can be modeled as an unknown input. In the
following, therefore, no explicit distinction is made between parametric and input
faults.

The general representation of a plant with possible faults is shown in Fig. 13.1

13.2 Observer Design Methods for FDI

Observer-based approaches reconstruct the outputs of the system from the input
vector and sensor measurements by using observers [28–30]. Kalman ﬁlters, an
optimal observer technique, can be used to optimize the outputs if sensor and
process noise are considered. The errors between the actual outputs and the
estimated outputs are then used as a residual for fault detection and fault isolation.
If all of the sensors were error free, all of the residuals (the difference between the
actual sensor outputs and the estimated sensor outputs) would be near zero. This
assumes the plant is modeled correctly, there are no disturbances and the noise is
negligible. Clark published several early papers [5–7] using observer-based schemes

296

u

P. Pisu

System 

Observer 2  

Residual 
Generator 

y1
y2

ym

Observer 1  

(1)x

( 2)x

Observer m

(

)mx

Fig. 13.2 General structure of a dedicated observer scheme

for instrument failure detection (IFD). His original work includes the single observer
scheme [7] and the dedicated observer scheme [6].

In the following we are going to consider a dynamic system described by

Px D g.x; u/
y D h.x; u/

(13.1)

(13.2)

where x D Œx1; : : : ; xn(cid:11)T 2 Rn, y D Œy1; : : : ym(cid:11)T 2 Rm, u D Œu1; : : : ; up(cid:11)T 2 Rp,
with g.(cid:2); (cid:2)/
W Rn(cid:6)p ! Rm smooth functions, and
g.0; 0/ D h.0; 0/ D 0.

W Rn(cid:6)p ! Rn; h.(cid:2); (cid:2)/

13.2.1 Dedicated Observer Scheme

The dedicated observer scheme for sensor fault detection is represented in Fig. 13.2.
The scheme utilizes an observer for each sensor measurement to estimate the output
of the system.

Given the system (13.1)–(13.2) observable from each output, consider the set of

observers described by

POx.1/ D g1.Ox.1/; u; y; Oy1/
Oy1 D h1.Ox.1/; u/
:::
:::

POx.m/ D gm.Ox.m/; u; y; Oym/

(13.3)

(13.4)

(13.5)

297

(13.6)

(13.7)

(13.8)

(13.9)

13 Fault Detection and Isolation with Applications to Vehicle Systems

Oym D hm.Ox.m/; u/

where Ox.j/ 2 Rn; hj W Rn(cid:6)p ! R; j D 1; : : : ; m.

In absence of faults the state of each observer will converge to the system state,
i.e., Ox.j/ D x for j D 1 : : : m. If the sensor k is faulty, then Ox.k/ ¤ x, and Ox.j/ D x
for j ¤ k. In the case of single sensor fault, the faulty sensor can be isolated by
comparing Ox.1/; : : : ; Ox.m/. By deﬁning the primary residuals as

Or.1/ D Ox.1/ (cid:3) Ox.2/
Or.2/ D Ox.2/ (cid:3) Ox.3/
:::
POr.m/ D Ox.m/ (cid:3) Ox.1/

:::

and considering a row vector of normalizing weights w.j/ D Œw
1; : : : ; m, secondary residuals ej 2 R can be deﬁned as

.j/
1 ; : : : ; w

.j/
n (cid:11); j D

ej D w.j/ (cid:2) Or.j/; j D 1; : : : ; m

(13.10)

During the decision making or residual evaluation phase, the secondary residuals
are compared with thresholds. Threshold values are selected based on the sensor and
system noise, and unmodeled dynamics to avoid the occurrence of false alarms [21].
A residual mismatch above a threshold value is indicated by a 1, while a residual
below the threshold is indicated by 0. The error signatures in Table 13.1 can
therefore be utilized to detect and isolate the fault.

13.2.2 Generalized Observer Scheme

The generalized observer scheme for sensor fault detection is represented in
Fig. 13.3. Similarly to the previous approach, the scheme utilizes an observer for
each sensor. In this scheme, each observer uses all measurements but the one
corresponding to the sensor to be diagnosed.

Table 13.1 Error signature
for single fault of dedicated
observer scheme

Fault
None
Sensor y1
Sensor y2
:::
Sensor ym(cid:2)1
Sensor ym

e1
0
1
1
:::
0
0

e2
0
0
1
:::
0
0

(cid:7) (cid:7) (cid:7)
(cid:7) (cid:7) (cid:7)
(cid:7) (cid:7) (cid:7)
(cid:7) (cid:7) (cid:7)
:::
(cid:7) (cid:7) (cid:7)
(cid:7) (cid:7) (cid:7)

em(cid:2)1
0
0
0
:::
1
1

em
0
1
0
:::
0
1

298

u

(

y y
,
2
3

,...,

y

)m

Observer 1  

(1)y

( 2)y

System 

( y1, y3,..., ym )

Observer 2  

Residual
Generator 

(

y y
,
1

2

,...,

y

)m

1

(

)my

Observer m

Fig. 13.3 General structure of a generalized observer scheme.

Given the system (13.1)–(13.2) observable from each set of m (cid:3) 1 outputs, deﬁne
y.1/ D Œy2; y3; : : : ; ym(cid:11)T ; y.2/ D Œy1; y3; : : : ; ym(cid:11)T ; : : : ; y.m/ D Œy1; y2; : : : ; ym(cid:3)1(cid:11)T as
vectors in Rm(cid:3)1. Consider the set of observers described by

where Ox.j/ 2 Rn; h.j/ W Rn(cid:6)p ! Rm(cid:3)1; j D 1; : : : ; m.

In absence of faults the state of each observer will converge to the system state,
i.e., Ox.j/ D x for j D 1 : : : m. If the sensor k is faulty, then Ox.k/ D x, and Ox.j/ ¤ x; 8j ¤
k. In the case of single sensor fault, the faulty sensor can be isolated by comparing
Oy.1/; : : : ; Oy.m/ with the corresponding sensor measurements. By deﬁning the primary
residuals as

POx.1/ D Og1.Ox.1/; u; y; Oy.1//
Oy.1/ D h.1/.Ox.1/; u/
:::

:::

POx.m/ D Ogm.Ox.m/; u; y; Oy.m//
Oy.m/ D h.m/.Ox.m/; u/

Or.1/ D y.1/ (cid:3) Oy.1/
Or.2/ D y.2/ (cid:3) Oy.2/
:::
POr.m/ D y.m/ (cid:3) Oy.m/

:::

P. Pisu

(13.11)

(13.12)

(13.13)

(13.14)

(13.15)

(13.16)

(13.17)

13 Fault Detection and Isolation with Applications to Vehicle Systems

299

Table 13.2 Error signature
for single fault of generalized
observer scheme.

Fault
None
Sensor y1
Sensor y2
:::
Sensor ym

e1
0
0
1
:::
1

e2
0
1
0
:::
1

(cid:7) (cid:7) (cid:7)
(cid:7) (cid:7) (cid:7)
(cid:7) (cid:7) (cid:7)
(cid:7) (cid:7) (cid:7)
:::
(cid:7) (cid:7) (cid:7)

em(cid:2)1
0
1
1
:::
1

em
0
1
1
:::
0

and considering a row vector of normalizing weights w.j/ D Œw
1; : : : ; m, secondary residuals ej 2 R can be deﬁned as

.j/
1 ; : : : ; w

.j/
m(cid:3)1(cid:11); j D

ej D w.j/ (cid:2) Or.j/; j D 1; : : : ; m

(13.18)

During the decision making or residual evaluation phase, the secondary residuals
are compared with thresholds. A residual crossing a threshold is indicated by a 1,
while a residual not crossing a threshold is indicated by 0. The error signatures in
Table 13.2 can therefore be utilized to detect and isolate the fault.

13.2.3 Example of FDI for Brake-by-Wire System

In this section, an example of application of the generalized observer scheme to
the problem of fault diagnosis in a brake-by-wire (BBW) system is presented.
BBW refers to the technology in which mechanical and hydraulic components of
traditional braking systems are replaced by electronic sensors and actuators to carry
out the function of braking in a vehicle. BBW is a combination of electronic control
systems coupled with a set of electromechanical actuators and the brake pedal.
Details about the hazard analysis, fault tree analysis, and failure mode effect analysis
can be found in [35], while in [18, 19, 33] different approaches are presented to
deal with the problem of single and multiple fault detection for a BBW system. In
the following, the problem of single fault detection and identiﬁcation in sensors is
obtained by means of observers using Luenberger observer design while converge
can be demonstrated using Lyapunov approach.

A one-wheel brake model is considered here consisting of an electric dc motor,
a ball screw that converts rotary motion into linear motion, and a caliper, which is
modeled as a nonlinear spring. The motor shaft position (cid:19) is controlled by the input
voltage V, which is the output of a controller whose purpose is to make the caliper
force, Fcal, track the desired force uj derived from the measured brake pedal force.

The dynamic equations for the one-wheel brake model are given by

P(cid:19) D !
P! D Ki i (cid:3) Kf Fcal

(13.19)

(13.20)

300

.(cid:3)Ke ! (cid:3) R i C V/

1

D

di
dt
Fcal D f .(cid:19)/

L

where Ki, Kf , R, L, Ke are known parameters, i is the dc motor current, ! is the dc
motor angular velocity, f .(cid:19)/ is convex on the interval I.(cid:19)/ D Œ0; (cid:19)max(cid:11) of interest,
and f 0.(cid:19)/ > (cid:9)0 with (cid:9)0 positive constant.

In the development of the diagnostic scheme the motor current sensor, caliper

force sensor, and motor position sensor faults are considered.

13.2.3.1 Caliper Force Observer Design

To design an observer for the caliper force sensor, it is assumed that the caliper force
Fcal and the motor current i are known but they may be affected by an additive fault.
Since the motor voltage V is not readily available only (13.19)–(13.20) are needed
for the observer design.

Deﬁning state variables as

and the system inputs as u1 D i, u2 D Fcal, the state equations can be written as

x1 D (cid:19)
x2 D Px1 D !

Px1 D x2

Px2 D Ki u1 (cid:3) Kf u2

y1 D u1
y2 D u2 D f .x1/

Notice that this system is a function of the inputs Fcal and i, both coming from
available sensors. Fcal is also an output of the system so it can also be calculated
from x1. The observer for the caliper force is deﬁned by the following equations:

POx1 D Ox2 C l1.y2 (cid:3) OFcal/
POx2 D Ki y1 (cid:3) Kf y2 C l2.y2 (cid:3) OFcal/
OFcal D f .Ox1/

where l1 and l2 are the observer gains. Deﬁning the errors e1 D x1 (cid:3) Ox1 and e2 D
x2 (cid:3) Ox2, in absence of faults the error dynamics are

Pe1 D e2 (cid:3) l1.y2 (cid:3) OFcal/ D e2 (cid:3) l1.f .x1/ (cid:3) f .Ox1//
Pe2 D (cid:3)l2.y2 (cid:3) OFcal/ D (cid:3)l2.f .x1/ (cid:3) f .Ox1//

(13.30)

(13.31)

P. Pisu

(13.21)

(13.22)

(13.23)

(13.24)

(13.25)

(13.26)

(13.27)

(13.28)

(13.29)

13 Fault Detection and Isolation with Applications to Vehicle Systems

301

Deﬁne (cid:13) D

f .x1/ (cid:3) f .Ox1/
e1

, then

Pe1 D e2 (cid:3) l1e1(cid:13).x1; Ox1/
Pe2 D (cid:3)l2e1(cid:13).x1; Ox1/

(13.32)

(13.33)

From f 0.x1/ > (cid:9)0 > 0 and the convexity property of f .x1/, it follows that (cid:13) > (cid:9)0 >
0. It can be shown [33] by Lyapunov analysis that it is possible to determine l1 and
l2 so that the error dynamics (13.32)–(13.33) are exponentially stable at the origin.
The following residual is generated and can be compared to a threshold to signify a
sensor fault

rFcal D y2 (cid:3) OFcal D y2 (cid:3) f .Ox1/

In absence of faults, sensor noise or modeling errors the residual rFcal is zero. It is
easy to verify that the residual will be non-zero in the presence of a sensor fault in
y1 or y2.

13.2.3.2 Motor Position Observer Design

In this case, the motor position (cid:19) and the current i are assumed to be available
through sensors but eventually affected by additive fault. Starting from (13.19)–
(13.20) with u1 D i, the system equations can be written as

Px1 D x2
Px2 D Ki u1 (cid:3) Kf f .x1/

y1 D i

y3 D x1

The observer is deﬁned as

POx1 D Ox2 C l3.y3 (cid:3) Ox1/
POx2 D Ki y1 (cid:3) Kf f .y3/ C l4.y3 (cid:3) Ox1/

The residual in this case is given by

r(cid:19) D y3 (cid:3) Ox1

(13.34)

(13.35)

(13.36)

(13.37)

(13.38)

(13.39)

(13.40)

Convergence of the observer depends on the selection of the gains l3, l4. Analysis of
stability can be conducted via Lyapunov approach [33].

302

Table 13.3 Error signature
for BBW System.

P. Pisu

Fault in sensor
None
Fcal
(cid:19)

i

r(cid:19)
0
0
1
1

rFcal
0
1
0
1

200

150

100

50

]

N

[

k
r
b

F

0

0

150

100

50

0

]
g
e
d
[
 
t
u
p
n
i
 
g
n
i
r
e
e
t
S

-50

0

1

2

5

6

7

3

4

t [sec]

1

2

5

6

7

3

4

t [sec]

Fig. 13.4 Driver inputs.

13.2.3.3 Fault Detection and Isolation

In the case of single faults, the associated residuals fault signature can be generated
as shown in Table 13.3. A non-zero residual above a threshold value, whose
selection depends on the noise and unmodeled dynamics for the system, is indicated
by 1, while a residual within the threshold bounds is indicated by 0.

This signature table can be generated by observing that rFcal does not depend on
the position sensor measurement fault by construction because the observer (13.27)–
(13.29) uses only information from current sensor and caliper force sensor. Simi-
larly, r(cid:19) does not depend on the caliper sensor fault because the observer (13.38)–
(13.39) utilizes only information from the current sensor and the position sensor.

In Fig. 13.5 the residuals for the caliper force and the motor position sensors in
absence of faults are depicted. A braking force and steering angle are applied as
shown in Fig. 13.4, and an initial vehicle speed of 115 Km/h is considered.

The thresholds for residual evaluation must be tuned to have a zero error
signature with healthy conditions and to guarantee a certain robustness to uncertain
dynamics.

13 Fault Detection and Isolation with Applications to Vehicle Systems

303

l

a
c

50

150

100

0

-50

]

N

[
 

F

 
l
a
u
d
s
e
r

i

-100

0

0.5

1

0

-0.5

]

d
a
r
[
 
θ
 
l

a
u
d
s
e
r

i

-1

0

l

a
c

]

N

[
 

F

 
l
a
u
d
s
e
r

i

500

0

-500

-1000

-1500

0

0.5

1

0

-0.5

]

d
a
r
[
 
θ
 
l

a
u
d
s
e
r

i

-1

0

1

2

3

4

5

6

7

t [sec]

1

2

3

4

5

6

7

t [sec]

Fig. 13.5 Residuals in absence of faults.

1

2

3

4

5

6

7

8

9

t [sec]

1

2

3

4

5

6

7

8

9

t [sec]

Fig. 13.6 Residuals with caliper force sensor faulty.

In Fig. 13.6, the residuals and error signature for caliper force and motor position,
in the case of faulty caliper force sensor, are presented. The fault is represented by a
step of -200 N injected in the caliper force sensor at 1.4s. In the second test, a fault
of (cid:10)=5 rad in the motor position sensor is injected at 2s. The measured position is
shown in Fig. 13.7 where the effect of the fault is clearly visible.

304

P. Pisu

100

l

a
c

]

N

[
 

F

 
l
a
u
d
s
e
r

i

50

0

-50

4

3

2

1

0

 
]

d
a
r
[
 
θ
 
l

a
u
d
s
e
r

i

-1

0

0

1

2

5

6

7

3

4

t [sec]

1

2

3

4

5

6

7

8

9

t [sec]

Fig. 13.7 Residuals with motor position sensor faulty.

13.3 NPERG Method

The nonlinear parity equation residual generator (NPERG) method is the most
general approach for fault diagnosis when dealing with nonlinear systems [34]. The
NPERG approach was introduced in 1994 by Krishnaswami and Rizzoni [24, 25]
in the contest of fault diagnosis for internal combustion engines, and then extended
to the general case of continuous time nonlinear systems by Krishnaswami [26] in
1996. Zhirabok extended the approach to the case of discrete time nonlinear systems
[43], while Zhang et al. [42] provided results in the case of systems modeled by
polynomial differential-algebraic equations.

The scheme utilizes input and state observers to provide FDI using nonlinear
dynamic models of a system. The observers are conﬁgured in such a way that sensor
faults are detected and isolated using nonlinear output estimators, while input and
plant parameter faults are isolated using nonlinear input estimators.

The main idea behind the approach resides in the fact that any FDI scheme is
a map that acts upon the measurements obtained from the system under study and
produces an output that is unique for each combination of faults that can occur in
the system. Thus an FDI scheme can be represented as the map W W Rm ! Rq

W.y/ D s

(13.41)

where s 2 Rq is the output vector produced by the FDI scheme. It should be noted
that rank.W/ (cid:5) m. Now, assume

x.t/ D ˚.t; u.t//

(13.42)

13 Fault Detection and Isolation with Applications to Vehicle Systems

305

where ˚.(cid:2); (cid:2)/ is a nonlinear function of the input and time, solution of the dynamic
system (13.1). From (13.2) and (13.42), the measured output in presence of actuator
and sensor faults can be expressed as

y D h.˚.t; u.t/ C (cid:23)u/; u.t/ C (cid:23)u/ C (cid:23)y D H.t; u.t/ C (cid:23)u/ C (cid:23)y

(13.43)

where H W Rp ! Rm, and rank.H/ D m from uniqueness of solution. From (13.43)
the internal form of the residual generator (13.41) can be written as

s D W.H.t; u.t/ C (cid:23)u/ C (cid:23)y/ D Q.f .t//

(13.44)

where Q is the composition of the two maps H and W, and f .t/ D Œ(cid:23)y; (cid:23)u(cid:11)T is the
faults vector.

Deﬁnition 1 (FDI Scheme). An FDI scheme is a function or operator acting on
the system’s measurements to produce a unique output for each combination of
faults that can occur in the system. The scheme is said to be strongly isolating if
the elements of the vector s also track the time histories of the values of the faulty
variables.

13.3.1 Conditions and Capabilities of a Diagnostic System

This section is intended to serves as a compilation of deﬁnitions, theorems, and
basic properties related to diagnosability in nonlinear systems. Detailed description
of these results can be found in [26].

13.3.1.1 Diagnosis of a Single Fault

Let fj represent the jth element of the fault vector f .t/. The jth fault is said to exist if
fj ¤ 0. A fault can be detected if it is observable from the measured outputs of the
system. A fault can be isolated if it has a unique non-zero effect on the available
measurements. The following theorem states this in more precise mathematical
terms.

Theorem 1 (Strong Isolability of a single fault). A fault fj can be strongly isolated
only if

¤ 0.

@y
@fj

Proof. Note that from Deﬁnition 1, fj is strongly isolable for t 2 Œt0; t1(cid:11), if the
following function can be constructed

wj.y.t// D sj.t/ D fj

(13.45)

From (13.43), by deﬁning G.t; f .t// D H.t; u.t/ C (cid:23)u/ C (cid:23)y, it follows

P. Pisu

(13.46)

(13.48)

ut

306

if and only if

y.t/ D G.t; f .t// D G.t; Œf1.t/; f2.t/; : : : ; fj.t/; : : : fmCp.t/(cid:11)/

From the implicit function theorem, local invertibility follows and therefore

@G
@fj

¤ 0 8y.t/; fj.t/; t 2 Œt0; t1(cid:11)

(13.47)

fj D sj.t/ D wj.y.t//

which is the condition for strong isolability.

From Theorem 1 it follows that single output faults are always isolable because
@G
@(cid:23)y D Im(cid:6)m, where Im(cid:6)m is the identity matrix of dimension m.

13.3.1.2 Diagnosis of Multiple Faults

Consider now the case of k simultaneous faults. Indicate with ffaulty a vector that
contains the k non-zero components of f .t/, and with fnofaulty a vector of the
remaining zero components of f .t/. Deﬁning G.t; f .t// D H.t; u.t/ C (cid:23)u/ C (cid:23)y, the
following theorem holds:

Theorem 2. A set of k simultaneously occurring faults can be strongly isolated if
and only if there exists some subset J of k C 1 components of the output vector

y.t/ D G.t; ffaulty.t/; fnofaulty/ D G.t; ffaulty.t/; Œ0; 0; : : : 0(cid:11)/

(13.49)

which taken k at a time and denoted as

yi D G.i/.t; ffaulty.t/; Œ0; 0; : : : 0(cid:11)/;

i D 1; : : : ; k;

yi 2 J

(13.50)

satisﬁes

(cid:8)

(cid:9)

@G.i/
@ffaulty

rank

D k;

i D 1; : : : ; k

(13.51)

Corollary 1 (Maximum Simultaneous multiple faults isolation). Given m avail-
able measurements a maximum of k (cid:5) m (cid:3) 1 multiple faults that occur simultane-
ously can be strongly isolated.

Proof. This follows from Theorem 2 and the fact that since there are m measure-
ments a maximum of m independent equations are available. Hence k C 1 (cid:5) m ,
k (cid:5) m (cid:3) 1.
ut

13 Fault Detection and Isolation with Applications to Vehicle Systems

307

Corollary 2. Multiple simultaneous output faults that satisfy Corollary 1 are
always strongly isolable.

Proof. This may be seen from the fact that if a combination of any k output faults,
k < m is denoted by (cid:23)yi 2 Rk then

@G.i/
@(cid:23)yi

D Ik(cid:6)k

(13.52)

13.3.2 FDI Algorithm Design for Nonlinear Dynamic Systems

The previous section provides necessary and sufﬁcient condition for the existence of
a solution to the FDI problem under the assumption that the output of the systems is
algebraically related to the inputs. Theorems 1 and 2 and their associated corollaries
all depend upon the existence of unique solutions to the system of equations relating
the fault variables to the available measurements. Dynamic systems in which the
inputs can be solved for uniquely from available outputs are said to be invertible.
Thus the requirement of obtaining unique solutions may simply be stated as the
system be invertible with respect to the given set of measurements and faults. This
is deﬁned more precisely by the following Lemma [26].
Lemma 1. Given (cid:26) input faults and r output faults, the total number of occurring
simultaneous faults k D (cid:26)Cr can be strongly isolated if and only if k D (cid:26)Cr (cid:5) m(cid:3)1
and there exists at least k C 1 measurements such that the given set of faults are
invertible with respect to any set of these measurements taken k at a time.

Proof. The proof follows directly from Theorem 2 condition for the existence of
unique solutions to the fault variables and the relationship between invertibility and
ut
unique solvability [16].

This result is extremely signiﬁcant since it allows results from inversion of nonlinear
systems to be utilized for the solution of FDI problems.
Corollary 3. A set of (cid:26) simultaneously occurring input faults can be strongly
isolated if and only if the total number of simultaneous faults satisﬁes k D (cid:26) C r (cid:5)
m (cid:3) 1 and the faulty inputs are invertible with respect to at least some (cid:26) C 1 of the
available non-faulty outputs taken (cid:26) at a time.

Proof. From (13.43) it is seen that output faults enter the measurement equation
algebraically. Therefore these faults are always invertible [16]. Now eliminating
the measurement equations in which the output fault terms appear from the set of
available measurement equations, the remaining equations arise from non-faulty
output measurements and from Lemma 1 the input faults must be invertible with
respect to some (cid:26) C 1 of the available non-faulty outputs taken (cid:26) at a time.
ut

308

P. Pisu

13.3.2.1 The Nonlinear Parity Equation Residual Generation Scheme

For the majority of nonlinear dynamic systems a closed form solution cannot be
derived, therefore the fault variables can only be numerically determined. In this
case, to solve the FDI problem, a design procedure known as the Nonlinear Parity
Equation Residual Generation (NPERG) scheme can be employed [26]. Consider
the system represented by

Px D f .x; u C (cid:23)u/
y D h.x; u C (cid:23)u/ C (cid:23)y

(13.53)

(13.54)

where (cid:26) inputs and r outputs can simultaneously be faulty and (cid:26) C r D k (cid:5) m (cid:3) 1.
Based on Theorem 2 and Lemma 1, the NPERG algorithm can be deﬁned as

follows:

NPERG Algorithm [26]
Step 1 [Estimate faults under faulty set assumption] Assume that r elements
of the output vector and (cid:26) elements of the input vector are faulty. Then the
other m(cid:3)r elements are not faulty. Referring back to Corollary 3 these outputs
can be used to estimate the inputs that are suspected of being faulty. Construct
an inverse model that estimates the (cid:26) input elements, from a suitable set of (cid:26)
elements of the m-r outputs that are assumed to be non-faulty. Now, using
the estimated values of the assumed faulty inputs and the nominal values of
the other inputs construct a forward model to estimate all the other measured
outputs, including the r outputs that are assumed faulty.
Step 2 [Consistency check] If the assumed set of faults and the actual set
of faults match, the measured and the estimated values of the assumed non-
faulty outputs of the forward model should match (within measurement and
modeling errors). In this case faults have been isolated and estimates obtained
in step 1 are also the correct estimates of the faulty variables. If the values do
not match, proceed to step 3.
Step 3 [Correct and repeat] If the consistency check fails it is necessary to
assume a different combination of faulty elements and repeat step 1 and 2.

The consistency check described in step 2 of the above procedure is known in
fault detection literature as residual evaluation and each set of inverse and forward
models from step 1 is referred to as a residual generator. The implementation of
the algorithm leads to constructing estimator and forward model for each possible
combination of faults. Figure 13.8 shows the schematic of the residual generator for
a particular combination of faults. In Fig. 13.8, the subscript nf identiﬁes the set of
variables that are assumed to be without faults for that particular residual generator
and the subscript f indicates the set of variables that are assumed to be faulty.

13 Fault Detection and Isolation with Applications to Vehicle Systems

309

uf

ruf

y

ry

+

y

ynf

Inverse Model 

Forward Model 

+

uf

unf

Fig. 13.8 Single element of an NPERG scheme.

13.4 Inverse Models Using Sliding Modes

The sliding mode approach can be used to design asymptotic observers which are
dynamic systems for estimating all the components of a state vector using the
measured components directly. In addition, using the equivalent control approach
[38], an implicit model inversion can be realized and unknown inputs can be
estimated from the measured outputs [13, 37]. To illustrate the idea, ﬁrst the observer
design using sliding modes is brieﬂy introduced and second the approach for input
fault estimation is presented. For a detailed explanation on sliding mode control
theory the reader should refer to [38].

13.4.1 Design of State Estimator for Linear Systems

Consider a linear time invariant system described in state space as follows

Px D Ax C Bu;
y D Cx;

x 2 Rn;
y 2 Rm;

u 2 Rp
rank.C/ D m < n

(13.55)

(13.56)

It is assumed that the matrices A; B, and C are known, and that the pair .A; C/ is
observable. Since the rank.C/ D m < n the observed vector can be represented as

y D C1x1 C C2x2;

x1 2 Rn(cid:3)m;

x2 2 Rm;

det.C2/ ¤ 0

(13.57)

By solving with respect to x2

By mean of the nonsingular coordinate transformation matrix

x2 D C(cid:3)1

2 .y (cid:3) C1x1/

(cid:6)

(cid:7)

In(cid:3)m 0
C1 C2

T D

(13.58)

(13.59)

P. Pisu

(13.60)

(13.61)

(13.62)

(13.63)

(13.64)

(13.65)

(13.66)

(13.67)

(13.68)

310

where

the system can be rewritten in the new variables x1 and y as

Px1 D A11x1 C A12y C B1u

Py D A21x1 C A22y C B2u

TAT (cid:3)1 D

(cid:6)

(cid:7)

A11 A12
A21 A22

; TB D

(cid:6)

(cid:7)

B1
B2

An observer to estimate x1 and y in the system can be written as

POx1 D A11 Ox1 C A12Oy C B1u (cid:3) L(cid:26) (cid:26)
POy D A21 Ox1 C A22Oy C B2u C (cid:26)
(cid:26) D Msgn.y (cid:3) Oy/

Œsgn.y (cid:3) Oy/(cid:11)T D Œsgn.y1 (cid:3) Oy1/; (cid:2) (cid:2) (cid:2) ; sgn.ym (cid:3) Oym/(cid:11)

where L(cid:26) is the observer gain matrix and the estimation error is deﬁned as ey D y(cid:3) Oy
and e1 D x1 (cid:3) Ox1 . The vector y is measured, hence ey is available. The discontinuous
vector function (cid:26) is chosen such that the sliding mode is enforced in the manifold
ey D y (cid:3) Oy D 0 and the mismatch between y and Oy is reduced to zero. From the
previous equations, the error dynamics can be written as

Pe1 D A11e1 C A12ey C L(cid:26)(cid:26)
Pey D A21e1 C A22ey (cid:3) (cid:26)

For M > jjA21e1 C A22eyjj, after a short transient, sliding motion will begin on
the sliding manifold ey D 0, and the equivalent control becomes (cid:26)eq D A21e1.
Substituting the equivalent control (cid:26)eq into (13.67), the sliding motion equation can
be derived as

Pe1 D .A11 C L(cid:26)A21/e1

(13.69)

which is of order .n(cid:3)m/ and a Luenberger estimator design can be utilized to deﬁne
the dynamics of e1 by selecting the design variable L(cid:26). Note that observability of the
pair .A11; A21/ follows from observability of the pair .A; C/.

13.4.2 Input Fault Estimation

Consider the system described by

Px D Ax C B.u C (cid:23)u/;

x 2 Rn;

u 2 Rp

(13.70)

13 Fault Detection and Isolation with Applications to Vehicle Systems

311

y D Cx;

y 2 Rm;

rank.C/ D m; m (cid:8) p

(13.71)

With the change of coordinates (13.59), the system can be written as

(13.72)

(13.73)

(13.74)

(13.75)

(13.76)

(13.77)

Considering the observer (13.63)–(13.66), the error dynamics become

Px1 D A11x1 C A12y C B1.u C (cid:23)u/
Py D A21x1 C A22y C B2.u C (cid:23)u/

Pe1 D A11e1 C A12ey C B1(cid:23)u C L(cid:26)(cid:26)
Pey D A21e1 C A22ey C B2(cid:23)u (cid:3) (cid:26)

with ey D y (cid:3) Oy and e1 D x1 (cid:3) Ox1. For M > jjA21e1 C A22ey C B2(cid:23)ujj sliding mode
on the manifold ey D 0 is enforced. Applying the equivalent control method

Pe1 D .A11 C L(cid:26) A21/e1 C .B1 C L(cid:26)B2/(cid:23)u
(cid:26)eq D (cid:3).A21e1 C B2(cid:23)u/

So, the equivalent control is function of the input fault. If L(cid:26) can be designed such
that A11 C L(cid:26)A21 is stable and B1 C L(cid:26)B2 D 0, then e1 ! 0 as t ! 1 and
(cid:26)eq D (cid:3)B2(cid:23)u. In this case, if the rank.B2/ D p; it is always possible to rearrange the
rows of (cid:26)eq D (cid:3)B2(cid:23)u such that the last p equations form a system of independent
equations that can be solved with respect to (cid:23)u. The equivalent values (cid:26)eq can be
extracted from the switching signal (cid:26) using a set of ﬁrst order ﬁlters of the form [38]

(cid:4) Pz C z D (cid:26);

z (cid:6) (cid:26)eq

(13.78)

13.5 Fault Diagnosis of Li-Ion Batteries

In the following, we illustrate the NPERG solution to the problem of fault diagnosis
of Li-Ion batteries in the case of single sensor fault utilizing sliding mode observer
design.

13.5.1 Battery Model

Several approaches have been considered in existing literature for modeling the
Li-ion battery cells. The ﬁrst kind of models are derived from electrochemical prin-
ciples [11]. However, these electrochemical models are generally computationally
expensive and too complex for real-time designs. Another type of model, which
is most prevalent in Li-ion battery literature, is the electrical equivalent circuit

312

Fig. 13.9 Battery equivalent
circuit.

P. Pisu

model [12, 17, 27]. The advantage of this model is that it is simple in construction
and suitable for real-time computations. In this study, an electrical circuit model
(Fig. 13.9) and a lumped thermal dynamics model are adopted.

The electrical dynamics of the battery cell can be written using Kirchhoff’s law,

and with a usual deﬁnition of SOC:

PVc D (cid:3)

Vc
R0C0

C

I
C0

PSOC D (cid:3)

I
Q

V D E0 (cid:3) RI (cid:3) Vc

(13.79)

(13.80)

(13.81)

where V is the terminal voltage, I is the input current, R, R0, and C0 are the resistance
and capacitance of the electrical circuit, Vc is the voltage across the capacitor C0, E0
is the open-circuit voltage, and Q is the charge capacity of the battery cell. In this
example, some of these parameters are assumed to follow quadratic dependency on
SOC and linear dependency on core temperature Tc as given by

E0 D ˛0 C ˛1SOC C ˛2SOC2 C ˛3Tc
R D ˇ0 C ˇ1SOC C ˇ2Tc

(13.82)

(13.83)

while R0,C0 are constant.

A radial thermal model similar to the one presented in [10] is chosen for the
cylindrical Li-ion battery cell. It models a heat source at the core of the battery and
two temperature states (the core temperature and the surface temperature ) given as

Cc PTc D

Ts (cid:3) Tc
Rc

C RI2 C

V 2
c
R0

(13.84)

13 Fault Detection and Isolation with Applications to Vehicle Systems

313

Cs PTs D (cid:3)

Ts (cid:3) Tc
Rc

C

Tamb (cid:3) Ts
Ru

(13.85)

where Rc is the thermal resistance between the battery core and battery surface, Ru
is the convective resistance between the battery surface and the surrounding air, Cc
is the heat capacity of internal battery material, Cs is the heat capacity of the battery
material at the surface, and Tamb is the surrounding air temperature.

13.5.2 Diagnostic Problem

In this example, the case of single faults for the battery system is explored. The
possible sensors faults in a Li-ion cell can be current sensor, voltage sensor, and
temperature sensor (surface) faults. In the presence of the sensor faults, the system
outputs can be modeled by

Other faults of interested are thermal runaway fault can be modeled by repre-
senting an additional heat generation term (cid:19)1, whereas a convection coefﬁcient fault
(cooling system fault) can be represented by (cid:19)2

Imeas D I C (cid:23)I
Vmeas D V C (cid:23)V
Tmeas D Ts C (cid:23)T

Cc PTc D

C RI2 C

C (cid:19)1

V 2
c
R0

Ts (cid:3) Tc
Rc
Ts (cid:3) Tc
Rc

Cs PTs D (cid:3)

C

Tamb (cid:3) Ts
Ru

C (cid:19)2

Considering the nominal battery model in (13.79)–(13.85), the state-space

representation can be written as

Px1 D a11x1 C a12x2 C a13x2

3 C b11fR.SOC; x1/u2
1

Px2 D a21x1 C a22x2 C b22u2

Px3 D a33x3 C b33u1

where x1 D Tc, x2 D Ts, x3 D Vc, u1 D I, u2 D Tamb, a11 D (cid:3)a12 D (cid:3) 1
RcCc
a13 D 1
, b22 D 1
(cid:3) 1
RuCs
RcCs
b33 D 1

R0 , a21 D 1
, a22 D (cid:3) 1
RuCs
C0 , fR.SOC; x1/ D R D ˇ0 C ˇ1SOC C ˇ2x1.

R0C0 , b11 D 1

, a33 D (cid:3) 1

RcCs

Cc

From (13.81)–(13.83), the measured voltage of the battery can be written as

,
,

V D ˛0 C ˛1SOC C ˛2SOC2 (cid:3) ˇ0u1 (cid:3) ˇ1SOC u1 C .˛3 (cid:3) ˇ2u1/x1 (cid:3) x3

(13.94)

(13.86)

(13.87)

(13.88)

(13.89)

(13.90)

(13.91)

(13.92)

(13.93)

314

With the available measurements of current and voltage, and assuming that the SOC
is available via Coulomb counting from (13.80), a new output y1 can therefore be
deﬁned as

(cid:4)

(cid:5)

y1 D V (cid:3)

˛0 C ˛1SOC C ˛2SOC2 (cid:3) ˇ0u1 (cid:3) ˇ1SOC u1

D .˛3 (cid:3) ˇ2u1/x1 (cid:3) x3

P. Pisu

(13.95)

while y2 D x2.

13.5.3 Fault Diagnosis Scheme

By considering the occurrence of a single fault, the NPERG method described in
section 13.3.2.1 can be applied to solve the fault diagnosis problem. A schematic
representation of the diagnostic scheme is given in Fig. 13.10. Alternative FDI
scheme can be found in [9]. In the following paragraphs, the elements and the
working of the scheme are described in detail.

13.5.3.1 Core Temperature Estimation

In the development of the diagnostic scheme, the ﬁrst assumption is that the voltage
sensor is faulty, while all other sensors are not faulty. A ﬁrst step is therefore to build
an inverse model utilizing the non-faulty output y2 to estimate the unknown state x1.

D
T

Physical System
Tmeas

Li-ion Cell

Vmeas

D

V

Imeas

D
I

Inverse model
Tc - Observer

Forward model
Vc

Diagnostic Module

Forward model
V

Fault
information

Residual
Evaluation

Ts ,Tc - Observer,

Fig. 13.10 Diagnostic scheme for the battery system.

13 Fault Detection and Isolation with Applications to Vehicle Systems

315

This can be achieved by the sliding mode observer

POx2 D a22Ox2 C b22u2 C L sgn.y2 (cid:3) Ox2/

(13.96)

Indicating with e2 D x2 (cid:3) Ox2 the error between surface temperature and the observer
state, the error dynamics are given by

Pe2 D a21x1 C a22e2 (cid:3) L sgn.e2/

(13.97)

If L is selected such that L > a21x1 C a22e2.0/ > 0, then, by simple Lyapunov
analysis, it is possible to show that e2 ! 0 in ﬁnite time. Therefore, from the
equivalent control method [13, 37], it follows that the equivalent output error
injection #2, which is a continuous approximation of the switching error injection
term L sgn.e2/ in the sliding mode observer, satisﬁes the condition

#2 D a21x1

(13.98)

The equivalent output error injection #2 can be extracted from the L sgn.e2/ by
means of an appropriate low pass ﬁlter [38]

(cid:4) P#2 C #2 D L sgn.e2/

(13.99)

and the estimate of x1

Ox1 D

#2
a21

(13.100)

13.5.3.2 Capacitor Voltage Forward Model

Utilizing the available current input u1, the following forward model reconstructs
the voltage Vc

POx3 D a33 Ox3 C b33u1

(13.101)

From (13.95) a residual can be generated as

r1 D y1 (cid:3) .˛3 (cid:3) ˇ2u1/Ox1 C Ox3

(13.102)

In presence of a voltage sensor fault

r1 D (cid:23)V

(13.103)

316

P. Pisu

13.5.3.3 Temperature Observer

Utilizing u1 and y2, a temperature observer can be designed as follows:

2
2
POx1 D a11 Ox1 C a12 Ox2 C a13 Ox
1 (cid:3) k1L1sgn.y2 (cid:3) Ox2/
3 C b11fR.SOC; Ox1/u

(13.104)

POx2 D a21 Ox1 C a22 Ox2 C b22u2 C L1sgn.y2 (cid:3) Ox2/
POx3 D a33 Ox3 C b33u1 (cid:3) k2L1sgn.y2 (cid:3) Ox2/

Deﬁne Qx1 D x1 (cid:3) Ox1 and Qx2 D x2 (cid:3) Ox2, then the error dynamics are

3 (cid:3) Ox2
PQx1 D a11Qx1 C a12 Qx2 C a13.x2
PQx2 D a21Qx1 C a22 Qx2 (cid:3) L1sgn.Qx2/
PQx3 D a33Qx3 C k2L1sgn.Qx2/

3/ C b11ˇ2 Qx1u2

1 C k1L1sgn.Qx2/ (13.107)

From (13.108), if L1 > a21 Qx1 C a22 Qx2, then Qx2 ! 0 in ﬁnite time and #1 D
ŒL1sgn.Qx2/(cid:11)eq D a21 Qx1. Replacing in (13.107)

PQx1 D .a11 C k1a21/Qx1 C a13 Qx3.x3 C Ox3/ C b11ˇ2 Qx1u2
1
PQx3 D a33 Qx3 C k2a21 Qx1

(13.110)

(13.111)

To analyze the convergence of the observer error, consider the Lyapunov function
candidate

V D

.Qx2

1 C Qx2
3/

1
2

Therefore, the following can be written:

PV D Qx1 PQx1 C Qx3 PQx3

D .a11 C k1a21 C b11ˇ2u2

1/Qx2

1 C a13 Qx1 Qx3.x3 C Ox3/ C a33 Qx2

3 C k2a21 Qx1 Qx3

(13.114)

If k1,k2 can be selected such that a11 C k1a21 C b11ˇ2u2
b11ˇ2u2
residual can be generated from the output error injection #1 as

1 < 0, and a33.a11 C k1a21 C
4 .a13.x3 C Ox3/ C k2a21/2 < 0, then PV < 0 and Qx1; Qx3 ! 0 as t ! 1. A

1/ (cid:3) 1

r2 D #1

(13.115)

In the case of voltage sensor fault this residual will be zero as the voltage does not
affect the observer state estimation. The residual will be non-zero in the presence of
either a current sensor fault or a temperature sensor fault.

Based on the previous analysis, the FDI logic is given by the fault signatures in

Table 13.4.

(13.105)

(13.106)

(13.108)

(13.109)

(13.112)

(13.113)

13 Fault Detection and Isolation with Applications to Vehicle Systems

317

Table 13.4 Fault signature
for battery system.

Table 13.5 Identiﬁed battery
parameters.

Fault in sensor
None
Voltage
Temperature
Current

r1
0
1
0
1

r2
0
0
1
1

Parameter
˛0
˛1
˛2
˛3
ˇ0
ˇ1
ˇ2
Cc
Cs
Rc
Ru

Value
2.28 V
2.2 V
0 V
0.001 V/K
2.205 (cid:22)
0.01 (cid:22)
0.007 (cid:22)/K
18.6 J/K
0.1 J/K
150.6 K/W
200 K/W

13.5.3.4 Simulation Results

A LiCoO2/Graphite Li-ion battery (18650 cylindrical cell) was studied with two
T-type thermocouples installed on it: one on the surface and the other inserted
into the battery core. The core thermocouple was inserted after discharging the
battery and drilling through the center of the positive electrode side. The parameters
of the battery model (13.79)–(13.85) were identiﬁed using nonlinear optimization
technique that ﬁts the two-state thermal model simulated data with the experimental
data. The experimental data was collected in the SOC range of 50–80%, temperature
range of 15–40 ıC, and current range up to 2C. Current proﬁles include constant
currents, pulse discharge, and ramp currents. The parameters identiﬁed are listed in
Table 13.5.

In this section, the simulation studies are presented to show the effectiveness
of the proposed scheme. The current proﬁle is a scaled and modiﬁed urban
dynamometer drive cycle shown in Fig. 13.11, together with the corresponding
temperature and voltage responses under no fault condition.

To test the effectiveness of the diagnostic scheme, three different faults (see
Fig. 13.12) have been injected in three separate cases: (a) a (cid:3)1ıC temperature bias
sensor fault is injected at 200s for 50s; (b) a (cid:3)4A current bias sensor fault is injected
at 500s for 50s; and (c) a (cid:3)3V voltage bias sensor fault is injected at 800s for 50s.
Figure 13.13 illustrates the residuals response to the three types of faults
in presence of noise. The FDI scheme correctly detects and isolates the faults
accordingly to the fault signatures in Table 13.4.

318

P. Pisu

)

K

(
 
e
r
u
t
a
r
e
p
m
e
T
d
e
r
u
s
a
e
M

 

)

V

 

(
 
e
g
a
t
l
o
V
d
e
r
u
s
a
e
M

298

296

294

0

)

A

 

(
 
t
n
e
r
r
u
C
d
e
r
u
s
a
e
M

10

5

0

−5

0

4.5

4

3.5

3

0

t
l
u
a
f
 
e
r
u
t
a
r
e
p
m
e
T

t
l
u
a
f
 
t
n
e
r
r
u
C

t
l
u
a
f
 

e
g
a
t
l
o
V

1

0

5

0

2

0

−1

−2

0

−5

0

−2

−4

0

100

200

300

400

600

700

800

900

1000

500
Time (sec)

100

200

300

400

600

700

800

900

1000

500
Time (sec)

100

200

300

400

600

700

800

900

1000

500
Time (sec)

Fig. 13.11 Voltage, current, and temperature proﬁles in absence of faults.

100

200

300

400

600

700

800

900

1000

500
Time (sec)

100

200

300

400

600

700

800

900

1000

500
Time (sec)

100

200

300

400

600

700

800

900

1000

500
Time (sec)

Fig. 13.12 Injected sensor faults at 200s, 500s, and 800s.

13 Fault Detection and Isolation with Applications to Vehicle Systems

319

l
a
u
d
i
s
e
r
 
d
n
o
c
e
S

l
a
u
d
i
s
e
r
 
t
s
r
i
F

3

2

1

0

-1

-2

-3

0

30

25

20

15

10

5

0

-5

0

100

200

300

400

500

600

700

800

900

1000

Time (sec)

100

200

300

400

500

600

700

800

900

1000

Time (sec)

Fig. 13.13 Residuals response under abrupt faults.
Abstract Although model-based fault detection and isolation (FDI) has become
a common design tool in automotive ﬁelds, its application to automotive air
conditioning (A/C) systems based upon vapor compression cycles is limited due
to the lack of control-oriented models characterizing the refrigerant phase change.
The emergence of moving boundary method (MBM) illuminates a promising way
of assisting FDI scheme development, because common faults in automotive A/C
systems, such as compressor fault, pressure transducer fault, and fouling fault, can
be easily incorporated by the control-oriented model developed. Out of various
observed-based FDI methods, the H1 ﬁlter technique, due to its robustness to model
uncertainties and external disturbances, is chosen for designing FDI scheme over
actuator/sensor/parameter faults. The model and the ﬁlter are connected closed-
loop by an H1 controller gain-scheduled to meet different cooling loads. From
the closed-loop analysis results, the H1 ﬁlter is capable of detecting and isolating
actuator/sensor faults, as well as estimating parameter faults, even if external
disturbances imposed on the air side of the evaporator exist.

Keywords Air Conditioning System (cid:129) H Inﬁnity Filter (cid:129) Moving Boundary
Method (cid:129) Fault Detection and Isolation

Nomenclature

TP Two Phase
SH Superheated
SC Subcooled
N Compressor Speed
Timely detection and isolation of underlying faults is crucial for meeting stringent
safety requirements in industry. Compared to hardware redundancy technique,
model-based FDI method leads to signiﬁcant cost savings. Various approaches have
been applied to the residual generation problem, e.g., parity equation methods,
observer-based methods, or frequency domain methods, [1–4]. In observer-based
FDI methods [5, 6], actuator commands and sensor measurements are exploited to
design ﬁlters for generating residuals that are compared to thresholds. In particular,
H1 ﬁlters attract more interests due to their robustness to model uncertainties
and external disturbances. An optimization problem is formulated to minimize the
inﬂuences of measurement noises, external disturbances, and model uncertainties on
the residuals and to maximize the effects of the faults on the residuals. A standard
framework for the problem formulation and solution was proposed in [7, 8], with
applications to aircraft longitudinal motion [9, 10].

Model-based FDI method has widespread applications in automotive engines,
especially air path systems and fuel path systems [11, 12]. In contrast, its application
to auxiliary loads, such as A/C systems, has not been addressed, with limited publi-
cations available. However, vapor compression cycle (VCC), the thermodynamic
process obeyed by automotive A/C system, is widely applied in many industry
ﬁelds, such as refrigerators, air conditioners, heat pumps, and chillers. Early works
on VCC fault diagnosis heavily relied on simpliﬁed models, resulting into intense
calibration efforts and poor performances during transient [13]. For instance, a
simpliﬁed physical model of a small heat pump system was used to generate

14 Fault Detection and Isolation of Automotive Air Conditioning Systems. . .

325

predictions, whose differences from monitored observations were transformed into
useful statistical quantities to be compared with predetermined thresholds [14].
A statistical rule-based fault detection and diagnostic method for A/C equipment
was developed in [15], and demonstrated in limited testing with a roof-top air
conditioner in [16] together with a fault evaluation method. Steady-state data
representing normal operations were used to develop seven polynominal models
characterizing the A/C performance and determine the statistical thresholds for fault
detection, while transient data with faults were used to evaluate fault diagnosis
performance [17]. However, since they lack control-oriented models describing the
thermoﬂuid dynamics of the phase-changing refrigerant in heat exchangers, it is
difﬁcult to achieve balances between physical accuracy and computation time of the
designed FDI algorithms [18, 19].

A lumped-parameter modeling approach named MBM method of developing
control-oriented models for heat exchangers with phase change changing ﬂuid
was proposed in [20–22], where the refrigerant is lumped according to its phase
status, namely pure vapor, pure liquid, and mixture of vapor and liquid. Differential
equations describing the mass and energy balances of the phase change process were
developed. The MBM A/C model offers the advantage of capturing the transient
behavior of the system, and reducing the simulation time without sacriﬁcing
physical accuracy.

In this chapter, a control-oriented model derived from ﬁrst principles is used
to design an FDI scheme on an automotive A/C system. A brief literature review
is given in Section 14.2. Exemplary actuator/sensor/parameter faults are modeled
and merged into the MBM A/C model in Section 14.3. The closed-loop system
composed of the control-oriented model, the output-tracking controller, and the FDI
ﬁlter is presented in Section 14.4. The closed-loop performances are evaluated over
model uncertainties and external disturbances in Section 14.5, with both abrupt and
incipient faults considered.

14.2 Recent Development of VCC Fault Diagnosis

According to a comprehensive literature in [23, 24], FDI method can be gener-
ally classiﬁed into two approaches, namely data-driven approaches and model-
based approaches (quantitative or qualitative). Data-driven approaches need a large
amount of training data representing both normal and faulty operation, as well as
a thorough understanding of the system and expertise in statistics. The resulted
models are speciﬁc to the system for which they are trained and cannot be
extrapolate beyond the range of the tracing data. In contrast, strengths of FDI
schemes based on quantitative models allow to model both normal and faulty
operation based on ﬁrst principles, such that the transient behavior of the systems is
captured more precisely than any other modeling technique. In other words, they are

326

Q. Zhang and M. Canova

particularly important for capturing faults during transient operation. Model-based
approaches range from empirical models, simpliﬁed models, and physics-based
models. Following the above classiﬁcation criterion, recent developments of FDI
schemes on VCC applications during last decade are presented in the order of model
complexity.

Empirical models are simplest, even sometimes static. In [25, 26], a gray box
modeling approach is adopted to capture the inﬂuence of both operating conditions
and faults on system performance. The steady-state heat exchangers are divided into
regions according to the refrigerant phase, and each region is modeled with (cid:17) (cid:3)NTU
methods under a crossﬂow conﬁguration. The static model describing the input–
output relationship is useful for diagnosing multiple-simultaneous faults in VCC
equipment with decoupling feature exploited and virtual sensor developed [27].

Simpliﬁed models neglect some dynamics under certain assumptions. A four-
state nonlinear model of a supermarket refrigeration system is built using a
lumped-parameter approach in [28]. A bank of extended Kalman ﬁlters (EKFs) is
constructed for isolating two temperature sensor faults in the types of drift, offset,
freeze, and hard-over, and a multi-model adaptive estimation method is employed
to handle parametric fault caused by freeze-over or dirty built up in [29]. However,
the isolation between sensor faults and parametric faults cannot be handled by the
current scheme, and is compensated by a bank of unknown input observers (UIOs)
constructed in [30], where one state variable is treated as a system unknown input.
Unfortunately, the control-oriented model introduced [28] oversimpliﬁed the heat
transfer process between the refrigerant and the air, as the refrigerant loop excluding
the evaporator is not modeled and assumed as known boundary conditions.

The dynamic response of a chiller to the change of working conditions is
captured using a lumped-parameter model is built in [31], in which four ﬁrst-order
differential equations are built to represent the dynamics of thermal storages at
the inlet and outlet of the condenser and evaporator, respectively. A new semi-
physical subcooling model is adopted to represent the condensing region and
subcooling region in the heat exchanger [32]. By analyzing the changing trends of
two proposed performance indexes, namely the normalized heat transfer coefﬁcient
and the ﬁctitious subcooling temperature, the pattern in fault conditions can be
obtained. Similarly, a strategy, in which six physical performance indices are used
to describe the health conditions and thus indicate chiller faults, is validated against
ﬁeld data from a centrifugal chiller in a real building [33]. Although the model
presents the effects of working conation changes on compressor load, it cannot
describe the dynamic performance of chiller operation.

Physics-based models have been recently used for analyzing fault effects. In
[34], the possibility of using more complex moving boundary models for FDI
in subcritical VCC equipment is explored. A linearized form of the model is
used to explore the sensitivity of each output to fault conditions of evaporator
frosting, refrigerant, and valve leakages; however, no practical FDI algorithm is
implemented. The static component-based fault detection method is also tested for
a transcritical refrigeration system for faults such as over/undercharge, evaporator
fouling, gas cooler fouling, and compressor valve leakage [35]. The method is also
applicable to large transient of the refrigerant during start-up or shut-down process

14 Fault Detection and Isolation of Automotive Air Conditioning Systems. . .

327

[36]. However, physics-based models, as far as the authors know, have never been
used for design FDI scheme during transient.

14.3 Fault Modeling Using MBM A/C Model

Commonly observed faults are labeled at corresponding locations in the A/C loop
and incorporated into mathematical models describing thermoﬂuid dynamics.

14.3.1 Overview of A/C System Faults

A basic automotive A/C system is composed of four primary components, namely
evaporator, compressor, condenser, and expansion valve as illustrated in Figure 14.1.
The VCC removes heat from the air ﬂowing to the cabin through the evaporator,
as the refrigerant evaporates from two-phase (TP) status into superheated (SH)
status, and rejects heat to the air ﬂowing through the condenser, as the refrigerant
condenses from superheated (SH) status into subcooled (SC) status through two-
phase (TP) status. The enthalpy, mass ﬂow rate, and pressure, are exchanged by the
four components. Basically, the two heat exchangers set the pressures of the system,
while the compressor and expansion valve determine the mass ﬂow rates at the inlet
and outlet of the evaporator and condenser.

Typical faults occurring in vapor compression systems summarized in [13] are
labeled in Figure 14.1. For instance, compressor faults can be caused by motor
winding failure and unbalanced voltage, or by refrigerant contamination and liquid
slugging. Stepper motor and electronic controller failures could make the expansion
valve malfunction. Fouling and frosting are major concerns on the surface of the
heat exchangers. Refrigeration leak may occur in the pipeline. In addition to system
faults, the pressure transducers and thermocouples for experimental measurement
are also possible fault sources. According to the terminology of the model-based
FDI, the above faults are classiﬁed into three categories, namely actuator faults (e.g.,
compressor fault and valve fault), sensor faults (e.g., pressure transducer fault and
thermocouple fault), and parametric faults (e.g., pipe leakage and fouling). From
a fault observability standpoint, the number of simultaneously detectable faults is
determined by the total number of sensors available. Due to hardware limitations,
the faults of interest include one actuator fault (compressor fault), sensor fault
(pressure transducer fault), as well as one parametric fault (evaporator fouling fault).
An in-depth analysis of the inﬂuences of the faults on the automotive A/C system
performance can be done with a control-oriented model. In a well-established
modeling framework, the compressor and valve are modeled as static components.
The dynamics related to the heat and mass transfer inside the heat exchangers
are described using the MBM method [20, 22], describing the mass and energy
conservation for transient one-dimensional ﬂow. After derivations detailed in [37]

328

Q. Zhang and M. Canova

Fig. 14.1 A/C System Components and Possible Faults

and not included here for brevity, the ﬁnal mathematical equations describing
system dynamics , together with faults, are in the descriptor form,
Z.x; fa/ dx
dt
y D g.x; fa; fp/

D f .x; fa; u; v; fN/

(14.1)

(cid:10)

(cid:11)T

Pmea Tea;in

(cid:10)
Nc ˛
(cid:11)T

The inputs are the compressor rotation speed and expansion valve opening per-
centage, u D
. The boundary conditions are the variables describing the
air side of the heat exchangers, and could be treated as unknown disturbances,
v D
. The state vector describing the evaporator status includes 5
(cid:10)
variables as: xe D
pressure and superheat temperature, y D
, which are only functions of
refrigerant states. The Z matrix and f vector are complex expressions of refrigerant
properties, heat transfer coefﬁcients, and geometric parameters [37].

. Finally, the outputs are the evaporator
(cid:10)

(cid:18)e1 pe he2 Te1w Te2w

pe SH

(cid:11)T

(cid:11)T

14.3.2 Actuator Fault

The compressor fault fN belongs to actuator faults. In compressor, the mass ﬂow rate
Pmc and outlet enthalpy h2 are deﬁned, respectively, as:

14 Fault Detection and Isolation of Automotive Air Conditioning Systems. . .

329

Pmc D (cid:8)vVd(cid:3)1!c;

h2 D

h2s (cid:3) h1
(cid:8)s

C h1

(14.2)

where Vd is the compressor displacement, (cid:3)1; h1 the refrigerant density and enthalpy
at the compressor inlet, !c the compressor speed in rad=sec, and h2s (cid:3) h1 is the
isentropic enthalpy difference. Thus, the mass ﬂow rate and enthalpy change are
mainly determined by the compressor rotation speed !c in rad=s or Nc in rpm. If
the compressor fault fN is modeled as an additive fault, the actual compressor speed
NAC is different from the commanded compressor speed Ncmd from the controller,
NAC D Ncmd C fN. Note that although fN is additive, it acts nonlinearly due to its
inﬂuence on (cid:8)v and (cid:8)s.

14.3.3 Sensor Fault

Two sensors are installed into the evaporator for control purposes, namely one
pressure transducer and one thermocouple. The thermocouple is installed at the
outlet of the evaporator in order to measure the degree of superheated temperature.
Obviously, both faults are closely related to the refrigerant dynamics involving of
pressure and temperature. Hence, the mass balance equation and energy balance
equation for the refrigerant in the superheated region of the evaporator are presented:

d(cid:18)1
dt

C

1
(cid:3)e;SH

@(cid:3)e;SH
@pe

dpe
dt

(cid:2) .1 (cid:3) (cid:18)1/ C

1
(cid:3)e;SH

@(cid:3)e;SH
@he;SH

dhe;SH
dt

(cid:2) .1 (cid:3) (cid:18)1/

(cid:9)

(cid:8)

(cid:3)

(cid:3)e;SH (cid:3) (cid:3)g
(cid:3)e;SH
Pm12
(cid:3)e;SHVe

D

(cid:3)

Pmc
(cid:3)e;SHVe

(cid:4)

(cid:3)g

(cid:3)

(cid:5)

hg (cid:3) he;SH
(cid:3)e;SH

d(cid:18)1
dt

C

D

Pm12
(cid:3)e;SHVe

(cid:4)
hg (cid:3) he;SH

dpe
dt

1
(cid:3)e;TP
(cid:5)

(cid:3)

Pmc
(cid:3)e;SHVe

(cid:2) .1 (cid:3) (cid:18)1/ (cid:3)

(cid:2) .1 (cid:3) (cid:18)1/

dhe;SH
dt

.h1 (cid:3) he;SH/ C

PQSH
(cid:3)e;SHVe

(14.3a)

(14.3b)

where pe is the evaporator pressure, (cid:18)1 the two-phase region normalized tube length,
he;SH the enthalpy of the refrigerant at the tube exit, Pm mass ﬂow rate, PQ heat transfer
rate, (cid:3) density. All these variables have been labeled in Figure 14.1.

A high-level understanding of these differential equations is possible without
diving into the mathematical details. The left-hand side (LHS) represents the
variation of independent states of the refrigerant, (cid:18)1; pe; he;SH, and right-hand side
(RHS) the exchanger of mass and enthalpy at the inlet and outlet of individual phase
region, Pm; h, as well as the heat transfer along the wall of corresponding region
PQ. The terms multiplying the state variations depend on the refrigerant inherent
thermodynamic properties, hence are state-dependent. The mass and energy bal-

330

Q. Zhang and M. Canova

ances for the subcooled, two-phase, and superheated region of the condenser are not
shown here because of their indirect relationships to faults. The pressure transducer
measurement is directly linked to one state of the differential equations, pm D pe if
no fault exists, or pm D pe C fp if a fault emerges.

14.3.4 Parameter Fault

The fouling on the tube exterior surface reduces heat transfer rates as a result of
reduced heat transfer coefﬁcient. The fouling dynamics is closely related to the wall
temperature dynamics of the heat exchangers. A lumped thermal mass approach is
adopted to describe the temperature of the walls separating the refrigerant control
volume from the external air ﬂow:

(cid:6)

L

dTw
dt

(cid:7)

(cid:3)wAwcw

C Tw .vb2 (cid:3) vb1/

C (cid:3)wAwcw .Tw1vb1 (cid:3) Tw2vb2/ D PQin (cid:3) PQout

(14.4)
where Aw is a representative cross-sectional area. The internal and external heat
transfer models assume pure convection occurring between the wall and the ﬂuids
in contact. In case of the external heat transfer (air to wall), the following equation
is used:

PQout D ˛out .(cid:10)DoutL/ .Ta (cid:3) Tw/

(14.5)

where Dout is the hydraulic diameter. The fouling fault is modeled as ˛out;act D
˛out C f˛, where ˛out is a theoretical value computed using heat transfer correlations
for compact heat exchangers, and ˛out;act is the actual heat transfer coefﬁcient of the
heat exchanger.

14.4 Experiment System

Provided that commands to compressor speed Nc and valve position ˛, as well
as measurements of evaporator pressure pe and superheat temperature SH, are
available for the control module and the FDI module, as depicted in Figure 14.2,
the instrumented test vehicle enables accomplishing tasks of

1. modeling and calibrating an MBM A/C model [37, 38];
2. designing an H1 controller for output tracking [37, 38];
3. developing FDI schemes in the closed-loop of plant, controller, and ﬁlter.

When the MBM A/C model is validated, the air mass ﬂow rates and temperatures
on the evaporator side Pmea; Teo and condenser side Pmca; Tco, are either controllable or
measurable. The output signals, such as air temperatures leaving the heat exchangers

14 Fault Detection and Isolation of Automotive Air Conditioning Systems. . .

331

H¥ Controller

Gain Scheduling

Nc

a

тea

Tea

тca

Tca

тv(t), h3(t)

SC

TP

SH

тc(t), h2(t)

a

V
E
T

Condenser

A/C System

Evaporator

Nc

r
o
s
s
e
r
p
m
o
C

тv(t), h4(t)

TP

SH

тc(t), h1(t)

pe

SH

Teo

Tew

Tco

Tcw

Filter  1

Residual

Fault

FDI

Filter  2

Fig. 14.2 Interconnections of Plant, Controller, and FDI

Teo; Tco and tube wall temperatures Tew; Tcs, are predicable using the MBM A/C
model. Since the A/C system dynamics change signiﬁcantly over working points,
the H1 controller dynamics is supposed to be scheduled accordingly. Both the
model validation and control design have been accomplished in [37], and the main
results are summarized for the convenience of the H1 ﬁlter development.

An automotive A/C system in a Minivan is studied. The test vehicle was
instrumented with an ETAS ES1000 system interfaced with the engine control unit
(ECU) to allow for acquisition of engine torque and speed, and to control the radiator
fan and cabin blower. The vehicle was installed on a chassis dynamometer, allowing
for the characterization of the system both at steady-state conditions and during
driving cycles.

Leveraging upon the available experimental setup, the model was calibrated
using the data collected during the tests when vehicle/engine speeds are maintained
at nominal steady state, and veriﬁed with reference to the SC03 air conditioning
cycle whose vehicle speed trace for this regulatory driving cycle. After validation,
the nonlinear A/C model is linearized at three operating conditions, corresponding
to low, medium, and high cooling loads. The system matrices of the LTI A/C model
are provided in [37, 38].

332

Q. Zhang and M. Canova

The robust H1 controller is designed to track prescribed trajectories of two
output variables, namely the evaporator pressure pe and the superheat temperature
SH. Meanwhile, the controller should reject disturbances caused by air mass ﬂow
rate at the evaporator, Pmea. The system matrices of the ﬁnal H1 controller after
model order reduction, together with its derivation process, are given in [37, 38].

The H1 fault diagnosis problem is to ﬁnd a stable ﬁlter F such that 1) the
performance error is minimized under all possible uncertainties (cid:12); 2) the faults
effect on the residuals is maximized with disturbance effect minimized. The second
objective is equivalent to minimization of the error between the residual and the
weighted fault. Hence, a standard performance index can be given as follows:

sup
0<kˆk2<1

kres (cid:3) Tfid f k2
kˆk2

(14.6)

and the matrices Tfid and ˆ vary depending on the type of problems. Please refer to
[7, 8] for theoretical backgrounds and [9, 10] for application examples.

14.5 Results and Analysis

Following the general FDI schemes introduced, two separated H1 ﬁlters, namely an
actuator/sensor FDI ﬁlter and a parameter FDI ﬁlter, will be designed to detect the
compressor fault and the pressure transducer fault, as well as to estimate the fouling
fault using the MBM A/C model.

14.5.1 Actuator and Sensor FDI

For the FDI scheme, the standard H1 synthesis, which requires selecting appro-
priate weighting functions for optimization problem formulation, enables that the
generated residuals to follow the faulty signals dynamically. The reference fault
weights Wfault;act; Wfault;sen and estimation error weights Werr;act; Werr;sen are selected
in order to minimize the error at low frequencies and relax the constraints at
higher frequencies. The H1 ﬁlter calculated based on the augmented plant model is
inherently high-order. From the analysis of the singular values of system matrices
of the H1 ﬁlter, three states dominate the system dynamics. Hence, the H1 ﬁlter
after model order reduction is given below.

14 Fault Detection and Isolation of Automotive Air Conditioning Systems. . .

333

Table 14.1 Fault Signatures
for A/C System

No Fault
Sensor Fault
Actuator Fault
Both Faults

res1
0
0
1
1

res2
0
1
0
1

AF D

BF D

0

@

0

@

(cid:8)

(cid:3)6:24e (cid:3) 6 0:004616 (cid:3)0:0006508
(cid:3)0:004895 (cid:3)0:08784
0:08659
0:0008169 0:08861 (cid:3)0:2091

1

A

(cid:3)4:152e (cid:3) 5 (cid:3)0:001717 0:0001151 (cid:3)0:2094
0:004668 (cid:3)21:91
(cid:3)0:0004144 (cid:3)0:1061
0:2544 (cid:3)0:004444 12:53
(cid:3)0:003091

1

A

(14.7)

CF D

0:1383 (cid:3)21:87 12:43
(cid:3)0:5172 (cid:3)1:187 (cid:3)1:66

(cid:9)

Suitable thresholds are selected to allow for categorizing the fault signatures as
0 (no fault detected) and 1 (fault detected). Table 14.1 summarizes the FDI scenario
for the actuator/sensor faults of the A/C plant. Theoretically, the selection criterion
depends on the probability density function (PDF) of faulty and non-faulty signals.
Because the faulty and non-faulty PDFs may have signiﬁcant overlap, it might result
in a certain probability of error either from false alarm or missed detections. Thus,
an optimal threshold must be determined using hypothesis testing, such that the
probability of error, as an integral of the overlapped region of the PDF, is minimized
[39]. Given a nominal PDF and a maximum allowable probability of error, e.g.,
5%, the minimum level of detectable fault can be calculated, e.g., 10 rpm for
compressor fault and 1 kPa for pressure transducer fault. In order to reduce the
complexity of thresholds selection, the differentiation between faulty and non-faulty
residuals is enlarged intentionally by injecting more signiﬁcant fault, e.g., 50 rpm
for compressor fault and 10 kPa for pressure transducer fault.

14.5.1.1 Performance Evaluation

A test of the performance of the H1 ﬁlter designed is shown in Fig. 14.3, with the
actual sensor measurements .pe; SH/, commands to actuators .Nc; ˛/, and corre-
sponding residuals .res1; res2/ recorded. The robustness of the ﬁlter ensures that the
residual generation process becomes less sensitive to some discrepancies between
the actual A/C plant and the LTI model used during the ﬁlter design process.
Hence, the working point is taken away from the design point corresponding to
the medium cooling load, where inputs are set to Nc D 1000 rpm and ˛ D 40%,
and corresponding outputs are regulated to pe D 250 kPa and SH D 20 0C. The A/C

25

20

]

C

[
 

H
S

15

0

45

]

%

[
 

α

40

2

s
e
r

10

5

0

334

]
a
P
k
[
 
e
P

265

260

255

250

245

1100

1000

]

m
p
r
[
 
c
N

40

20

1

s
e
r

0

0

Q. Zhang and M. Canova

sensor fault incured

working point moving

0

200

800

1000

400

600

Time [sec]

200

400

600

Time [sec]

800

1000

actuator fault incured

900

0

200

800

1000

35

0

200

400

600

Time [sec]

400

600

Time [sec]

800

1000

threshold
residual

threshold
residual

200

400

600

Time [sec]

800

1000

0

200

800

1000

400

600

Time [sec]

Fig. 14.3 Plant Outputs, Inputs, and Filter Residuals for Abrupt Fault

system settles down before T D 400 sec, resulting an increased evaporator pressure
by 5 kpa and a reduced superheat temperature by 2:5 oC.

The actuator fault is a ﬁxed value of positive 50 rpm in the compressor speed
Nc injected at T D 400s and removed at T D 500s. As seen from Fig. 14.3, the
actuator fault causes the ﬁrst residual res1 to cross the threshold, while the second
residual res2 changes negligibly. Because the H1 controller is inherently a passive
fault tolerant controller, the commanded compressor speed Nc sent to the actuator
is reduced by around 50 rpm in order to compensate the actuator fault. The sensor
fault is a ﬁxed value of positive 10 kPa in the pressure transducer pe injected at
T D 700s and removed at T D 800s. As seen from Fig. 14.3, the sensor fault causes
the second residual res2 to cross the threshold, while the ﬁrst residual res1 changes
negligibly. Although the measured evaporator pressure jumps by 10 kPa abruptly,
the robustness of the H1 controller forces the A/C plant to move to another working
point by modulating the two actuators, in order to counteract the inﬂuence of the
pressure transducer misreading and guarantee that it returns to pe D 255 kPa.

Besides the scenario with an abrupt change of an actuator/sensor fault, the H1
ﬁlter is also capable of estimating the faulty actuator/sensor facing an incipient
change. As before, the working point is moved from the one corresponding to the
medium cooling load for the ﬁrst 400 sec. A gradual deteriorated actuator, starting
at healthy status at 400 sec and ending at 5% faulty signal at 1000 sec, is injected to
represent an incipient actuator fault. Similarly, a gradual deteriorated sensor, starting
at healthy status at 700 sec and ending at 4% faulty signal at 1000 sec, is injected to
represent an incipient sensor fault. From ﬁg. 14.4, the ﬁrst residual res1 estimates the

14 Fault Detection and Isolation of Automotive Air Conditioning Systems. . .

335

25

20

]

C

[
 

H
S

]

%

[
 

α

40

15

0

45

35

0

10

5

0

2

s
e
r

]
a
P
k
[
 
e
P

265

260

255

250

245

1100

1000

]

m
p
r
[
 
c
N

900

0

40

20

1

s
e
r

0

0

0

200

400

600

800

1000

200

400

600

800

1000

Time [sec]

Time [sec]

200

400

600

800

1000

200

400

600

800

1000

Time [sec]

Time [sec]

threshold
residual

threshold
residual

200

400

600

800

1000

0

200

400

600

800

1000

Time [sec]

Time [sec]

Fig. 14.4 Plant Outputs, Inputs, and Filter Residuals for Incipient Fault

actuator fault, and the second residual res2 estimates the sensor fault very accurately.
However, for the ﬁxed thresholds speciﬁed, the H1 ﬁlter cannot detect the actuator
fault with a delay of 200 sec, and the sensor fault with a delay of 100 sec. For instant
fault detection, an H1 ﬁlter with an adaptive threshold is expected.

14.5.1.2 Limitations

The designed H1 ﬁlter suffers several limitations, from the forthcoming observa-
tions that the residuals generated are sensitive to boundary conditions and plant
variations. In Figure 14.5, the air velocity through the evaporator deviates from the
nominal value 4 m=sec sinusoidally after 400 sec, while both the actuator and sensor
faults are injected as constant values at the beginning of the test. As expected, the
residuals representing fault occurrences exceed the thresholds when the air velocity
is constant for the ﬁrst phase (t < 400sec). For the second phase (t > 400sec),
however, as the air velocity oscillates, the residuals fall below thresholds despite
that faults exist all the time, indicating that missed detection happens.

The inﬂuences of external disturbances on the residuals may be removed once
additional thermocouples are installed on exterior surfaces of the heat exchangers
in order to provide the wall temperatures at individual phase regions. Note that the
choice of wall temperature signal is targeted for the speciﬁc disturbance coming
from the air side, as the latter is independently observable from the former. Thus
the control-oriented A/C system model for the H1 ﬁlter design has more outputs

336

Q. Zhang and M. Canova

4.5

4

]
s
/
m

[
 

V

a

3.5

0

200

100

0

−100

0

40

20

0

−20

0

1

s
e
r

2

s
e
r

threshold
residual

threshold
residual

100

200

300

400

600

700

800

900

1000

500
Time [sec]

100

200

300

400

600

700

800

900

1000

500
Time [sec]

100

200

300

400

600

700

800

900

1000

500
Time [sec]

Fig. 14.5 Inﬂuence of External Disturbance on Residual Generation

available than before, allowing that the synthesis process has additional authority
of rejecting external disturbances. After the new ﬁlter replaces the original one, the
residuals for both actuator fault and sensor fault change in a similar manner to those
in Figure 14.3, while extra actuator efforts are required to counteract the effects of
external disturbances.

Plant variations also affect the ﬁlter performance, even if the H1 controller is
gain-scheduled to the LTI A/C plants obtained at different linearization points. For
instance, the working point corresponding to the low cooling load is selected, and
the H1 ﬁlter is designed using the same weighing functions used for the medium
cooling load scenario for consistency. As before, the working point is taken away
from the design point, and actuator fault and sensor fault are injected sequentially
in Figure 14.6. From the two ﬁgures in the third row, the two residuals generated
are very noisy, such that false alarms and missing alarms happen frequently with
respect to ﬁxed thresholds, especially for the residual of sensor fault res2. In order
to distinguish residuals from noises, additional ﬁlters modulating the gains and
frequency of the original ﬁlters are added in series of the original to remove noises.
From the two ﬁgures in the fourth row, two residuals after ﬁltering are capable of
detecting and isolating actuator fault injected at 400 sec and sensor fault injected at
700 sec. In other words, the appropriate ﬁlters at low cooling load are a product of
the additional ﬁlter and the original one corresponding to medium cooling load. The
sensitivity of residuals to plant variables is removable if the H1 ﬁlter is designed
using gain-scheduling technique, such as linear parameter varying (LPV) approach
in [40].

14 Fault Detection and Isolation of Automotive Air Conditioning Systems. . .

337

25

20

]

C

[
 

H
S

15

0

30

20

0

]

%

[
 

α

25

2

s
e
r

20

0

−20

2

s
e
r

10

5

0

0

320

310

300

]
a
P
k
[
 
e
P

500

450

]

m
p
r
[
 
c
N

400

0

60

40

20

0

−20

0

1

s
e
r

40

20

1

s
e
r

0

0

0

200

400

600

800

1000

200

400

600

800

1000

Time [sec]

Time [sec]

200

400

600

800

1000

200

400

600

800

1000

Time [sec]

Time [sec]

200

400

600

800

1000

0

200

400

600

800

1000

Time [sec]

Time [sec]

threshold
residual

threshold
filtered

threshold
residual

threshold
filtered

200

400

600

800

1000

200

400

600

800

1000

Time [sec]

Time [sec]

Fig. 14.6 Plant Variation Effect on Residual Generation.

14.5.2 Parametric FDI

In the scheme of the parameter FDI scheme, the standard (cid:6) synthesis, which
requires structuring the uncertainty block for optimization problem formulation,
enables the generated residual has the same amplitude of the parameter fault.
The uncertainty block is constructed by perturbing the nominal system around
equilibrium points. After appropriate weighting functions selected, the H1 ﬁlter
calculated based on plant model with uncertainty block is inherently high-order.
From the analysis of the singular values of the ﬁlter system matrices, three states
dominate the system dynamics. Hence, the H1 ﬁlter after model order reduction is
given below.

Q. Zhang and M. Canova

Working Point
Moving

parameter
fault I

parameter
fault II

Disturbance

200

400

600

800

1000

Time [sec]

14

0

200

400

600

Time [sec]

800

1000

22

20

18

16

44

42

40

]

C

[
 
e
r
u
t
a
r
e
p
m
e
T

]

%

i

[
 
g
n
n
e
p
O
 
e
v
a
V

l

338

260

255

250

]
a
P
k
[
 
e
r
u
s
s
e
r
P

245

0

1050

1000

950

900

0

]

m
p
r
[
 
d
e
e
p
S

 
r
o
s
s
e
r
p
m
o
C

200

400

600

800

1000

Time [sec]

38

0

200

400

600

Time [sec]

800

1000

Fig. 14.7 Plant Output and Inputs for Parameter Fault

AF D

BF D

0

@

0

@

(cid:8)

(cid:3)0:1535 (cid:3)0:3811 0:02074
0:3794 (cid:3)3:514
0:6827
0:02033 (cid:3)0:6843 (cid:3)0:03135

1

A

0:01559 (cid:3)0:08417 0:005109 (cid:3)16:82
(cid:3)0:2407 (cid:3)1:999 (cid:3)0:02167 19:56
(cid:3)0:03282 (cid:3)0:235 (cid:3)0:003236 1:142

1

A

(cid:9)

CF D

16:82

19:65
1:549e (cid:3) 5 (cid:3)5:925e (cid:3) 5 0:0001626

(cid:3)1:162

(14.8)

The above H1 ﬁlter is incorporated into the closed-loop system for evaluating
its performance when the corresponding parameter changes abruptly under external
disturbances. As before, the working point is moved from the one corresponding
to the medium cooling load for the ﬁrst 400 sec. Then parameter faults, whose
amplitudes are 5% and 3% of the nominal value, and time duration are 200 sec, are
injected sequentially to check residual variations. Finally, a sinusoidal disturbance
is added to the air velocity of the evaporator side for the ending 200 sec. The
commands sent to the actuators and measurements from the sensors are recorded
in Fig. 14.7.

In Fig. 14.8, the capability of the H1 ﬁlter is demonstrated by showing whether
the residual res, calculated as the ratio of k Of pk=kOzpk, follows the actual parameter
variation. It is clear that the amplitudes of the changing parameter fault (5% and 3%
sequentially) are captured by the residual signal after transient. Although external
disturbances cause the estimations of fp and zp change sinusoidally, the residual
representing the faulty parameter amplitude is maintained constant after T D 800
sec. Hence, the designed H1 ﬁlter is capable of detecting the parameter fault under
external disturbances.

0

−10

p
f

−20

400

4

2
400

p
z

3

s
e
r

2

0

−2

−4

−6

0

−10

p

f

−20

3.5

4

3

p
z

2.5

400

s
e
r

2

0

−2

−4

−6

14 Fault Detection and Isolation of Automotive Air Conditioning Systems. . .

339

500

600

800

900

1000

700
Time [sec]

Sinusoidal
Disturbance

500

600

800

900

1000

5% Parameter
Fault Incured

700
Time [sec]

3% Parameter
Fault Incured

700
Time [sec]

400

500

600

800

900

1000

Fig. 14.8 Residual Calculation for Abrupt Parameter Fault

400

500

600

800

900

1000

700
Time [sec]

Sinusoidal
Disturbance

500

600

800

900

1000

700
Time [sec]

400

500

600

800

900

1000

parameter fault
3% over 600 sec

700
Time [sec]

Fig. 14.9 Residual Calculation for Incipient Parameter Fault

Besides the scenario with an abrupt change of a parameter fault, the H1 ﬁlter
is also capable of estimating the faulty parameter facing an incipient change. A
gradual deteriorated parameter, starting as unfaulty status at 400 sec and ending as
3% faulty status at 1000 sec, is injected to represent an incipient parameter fault.
From Figure 14.9, the residual estimates the parameter fault very accurately, no

340

Q. Zhang and M. Canova

matter whether the A/C plant is disturbance-free for the ﬁrst 300 sec or affected by
sinusoidal fault for the second 300 sec. Therefore, it is concluded that the H1 ﬁlter
designed is capable of estimating both abrupt and incipient parameter faults.

Abstract Automated fault detection and diagnosis (AFDD) has the potential to
provide early warning of performance degradation faults before they might other-
wise be apparent, and before they cause failure of the system. AFDD approaches
have been developed in many industries, such as aerospace, process control, and
air-conditioning. In air-conditioning applications the cost-sensitivity of the market
requires that there is minimal cost premium for AFDD, so methods typically must
be deployed with very few sensors to provide input and minimal engineering cost. In
addition, because life safety is not a concern, less accurate methods can be tolerated.
In this landscape, there are many methods that don’t perform well, but until recently
there has been no standardized method or metrics to test or describe performance
of AFDD. This chapter describes a new methodology, and a speciﬁc method to test
and characterize the performance of AFDD tools that are applied to air-conditioning
systems, and illustrates the methods with a case study. The widely used AFDD
approach tested in the case study shows poor performance, which underscores the
importance of evaluating AFDD performance.

Keywords Fault detection (cid:129) Fault isolation (cid:129) Air-conditioning system (cid:129) Building

15.1 Introduction

Many automated fault detection and diagnosis (AFDD) approaches have been
developed over the past few decades in applications for process control, aerospace,
and nuclear industries. In these applications there can be a very high cost associated
with sustaining a fault, so early detection is of paramount importance. Consequently,
a relatively high cost of implementation is often acceptable. When high implemen-
tation costs can be tolerated, a large number of sensors can be deployed to give
the AFDD method a large number of redundant results to compare. Fundamentally,
AFDD approaches compare a measured result with an expected result, and infer
potential problems from the discrepancy.
In a competitive commercial industry, costs become more important. The
automotive industry’s OBD II requirements provide a mechanism to promote use
of diagnostics by removing the ﬁrst-cost disadvantage to manufacturers that include
them in their automobiles. A regulated approach can be beneﬁcial when the potential
advantages are not well understood by consumers, and it can also stimulate research
and development efforts to provide improved diagnostic methods.

AFDD for air-conditioning systems has been under development since the 1980s,
but hasn’t been very widely adopted until quite recently. There has been particular
interest in AFDD for air-cooled unitary air-conditioning systems, such as the
systems used to condition residential and light commercial buildings (referred to
as “unitary systems” hereafter). The reasons for the focus on these systems are:
(a) they are very widely adopted; (b) they are typically manufactured at low-
cost due to market forces, and are therefore expected to have greater potential for
developing faults or having manufacturing faults; (c) these systems typically receive
maintenance less frequently and from technicians who have less equipment-speciﬁc
training than other systems, such as large chillers or air-handling units.

The challenge for developers of AFDD for unitary systems is that although
the behavior of real systems deployed in the ﬁeld is quite complex, there is very
little budget available for deploying AFDD tools. The reason is the same as in (b)
above: the market is extremely cost-competitive, so the added cost from additional
sensors will often price a model out of the market. Furthermore, the challenge is
compounded by a marketing difﬁculty: faults and their impacts are not very well
understood, particularly by typical consumers of unitary systems, and marketers
don’t like to tell potential customers that their products are likely to have problems.
If consumers wish to select a higher-end system, they will typically select one with
a higher efﬁciency rating, which is quantiﬁed with a standard test.

To address this challenge, developers of AFDD for unitary systems need to
gain as much diagnostic capability as they can with a minimum of sensor data.
Since the relative cost of microprocessors is low compared to sensors, this means
that more sophisticated algorithms may be used in place of sensors. For example,
one approach is to use the so-called virtual sensors to infer refrigerant pressure
based on temperature measurements, because temperature is less costly to measure
than pressure. Similarly, virtual ﬂow sensors have been developed in place of
airﬂow or refrigerant ﬂow measurements. Another common approach is to bypass
permanently installed sensors and processors, and use a portable device. Although
the increasingly complex algorithms may reduce the monetary cost, they increase
the uncertainly of the results and the robustness of the methods. For example, a
portable device may work well on some models of air-conditioner, but not others;
some methods may work well in one set of operating conditions and fault conditions,
but not in others.

One problem with increasingly complex algorithms that use an increasing
amount of inference is that they sometimes become increasingly likely to give
erroneous results. Compounding this problem is that the complexity also makes
the algorithms harder to test, both for the developer and for a potential adopter of
the AFDD. Finally, this problem becomes still worse if there is no methodology for
measuring the performance of AFDD, or any method for expressing or characteriz-

15 Evaluating the Performance of Automated Fault Detection and Diagnosis Tools

345

ing performance. As Vachtsevanos et al. [1] note, no such methodologies exist for
diagnostics for any military or commercial applications.

Despite the unknown performance of AFDD for unitary systems, many tools and
approaches have been developed by researchers and by commercial entities, and
many are available in the marketplace. These tools have been widely deployed, and
have even been included in codes, such as California’s building energy code, Title
24–2013 [2], which contains a simple diagnostic that is required for residential air-
conditioner installations.

This chapter provides some background on AFDD methods and lays out standard
terminology, then describes the ﬁrst standardized approach for evaluating the
performance of AFDD algorithms in AFDD intended for application to unitary
systems [3, 4].

15.2 AFDD Method Categorization

There are many ways to categorize AFDD methods. Some possible categorizations
are described below. These categorizations are not exclusive; a single method may
fall within several of these categories.

Steady-state or dynamic data inputs. Some methods require a system to be operating
in a quasi-steady-state before the AFDD can be applied. This may require an
automated method to have a steady-state detector, or a more manual method to use
the operator’s judgement to determine whether the system is operating steadily.

Model-based, rule-based, or data-driven. Model-based approaches may use mech-
anistic models or empirical models, or some combination of these (often called
“gray-box models”) to predict values for variables that will be compared to
measured values. Some AFDD approaches use a set of expert rules to determine
whether a variable is within a reasonable operating range. Finally, pure data-driven
methods are gaining in popularity, such as machine learning approaches.

Instantaneous or time series. Instantaneous methods conduct diagnostics based
upon a snapshot of the system’s operation. These methods are necessary for AFDD
tools that are not installed in the system. Time series data conversely compare
performance over time, and trigger fault detection when a signiﬁcant degradation
in performance is sensed while accounting for variations in operating conditions.

On-board, online, or portable. On board AFDD refers to methods that use perma-
nently installed sensors, and has diagnostic algorithms that are processed on site.
Online AFDD methods use sensor data that are conveyed through internet protocol
to a centralized offsite processing facility. Portable AFDD typically consists of
handheld maintenance devices, which include sensors that are temporarily attached
to the system to be diagnosed. Portable devices require more labor input and may
have disadvantages with respect to the speciﬁcity of the internal models, but have
the advantage of not requiring permanently installed sensors.

346

D. Yuill

15.3 AFDD Performance Evaluation Terminology

There are several terms that should be used with a speciﬁc and consistent meaning
when discussing AFDD performance evaluation for vapor compression cycle air-
conditioner diagnostics. The deﬁnitions are mainly taken from Yuill [5], but some
are derived from the literature on AFDD in general, including sources such as Braun
[6], Isermann [7, 8], and Katipamula and Brambley [9].

Fault—A state of the system or equipment that causes a degradation in performance.
Fault Detection—Detection and reporting of a fault, without speciﬁcation of the

Fault Diagnosis—Speciﬁcation of the fault, which consists of two processes: fault

Fault Isolation—The component of fault diagnosis in which the location or type of

Fault Assessment—The fault level expressed with reference to physical measure-

type or severity of the fault.

isolation and fault assessment.

fault is identiﬁed.

ments.

Fault Tolerance—A decision to not address a fault, typically because it is not

considered cost effective to currently address it.

Fault Intensity—The fault level expressed with reference to physical measurements.
Fault Impact Ratio (FIR)—A ratio that quantiﬁes the effect of a fault on system
performance. It is calculated as the capacity or COP divided by the capacity
or COP that the system would give under the same conditions if no fault were
present. FIR is calculated as:

FIRQ D

capacityfaulted
capacityunfaulted

FIRCOP D

COPfaulted
COPunfaulted

AFDD Protocol—An algorithm to conduct the necessary calculations and compar-
isons to generate a diagnosis, and the data type and formatting that must be fed to
the algorithm. An AFDD protocol does not include the hardware (e.g., sensors)
in an AFDD tool.

In addition to these deﬁnitions, Yuill [5] provides a taxonomy for outcomes when

an AFDD algorithm’s performance is evaluated:

1. No Response—The AFDD cannot provide a response with respect to the
presence of a fault, typically either because it can’t be applied for a given set
of conditions, or it has excessive uncertainty about its detection or diagnosis.
2. Correct—The AFDD correctly identiﬁes the state of the system, whether faulted

or unfaulted, and identiﬁes the fault type if a signiﬁcant fault is present.
3. False Alarm—A fault is detected, but no signiﬁcant fault is actually present.
4. Misdiagnosis—A signiﬁcant fault is correctly detected, but the wrong fault type

is diagnosed.

15 Evaluating the Performance of Automated Fault Detection and Diagnosis Tools

347

5. Missed Detection—A signiﬁcant fault is present, but the AFDD does not detect

a fault.

6. No Diagnosis—A signiﬁcant fault is correctly detected, but the AFDD does not

provide a diagnosis of the type of fault.

15.4 AFDD Performance Evaluation Method

The method developed by Yuill and Braun [4] applies to handheld AFDD devices
intended for unitary systems that are operating at steady state. The method addresses
only air-conditioners that have a single fault or no fault; units with multiple
simultaneous faults are not included in the performance test input data, nor are they
considered in the application of the taxonomy provided above.

The approach to the evaluation of AFDD protocols is to feed a set of data to each
protocol and observe the responses, collecting and categorizing them to develop
summary statistics. The data represent typical conditions that an AFDD tool may
encounter:

– Several different systems with different properties, such as conﬁguration, refrig-

erant type, SEER rating, and expansion device type
– A range of ambient and indoor thermal conditions
– Different types of faults, or with no fault
– Different intensities of fault

For each test case (a single combination of the conditions above) the protocol
gives a response. These responses are tallied and organized to give statistics that
reﬂect the overall utility of the protocol. The evaluation process is summarized in
Fig. 15.1.

The following subsections describe the components of the evaluation method in

greater detail.

Input Scenarios

Ref. temperatures & pressures

Fault Types & Intensities
Unitary System(s)
Driving Conditions

Input Data

Air temperatures and humidity
Power (compressor and total)
Superheat & Subcooling

Equipment Specifications

FDD Protocol

Raw Results

No response

Correct
False Alarm
Missed Detection

Misdiagnosis

No Diagnosis

Fig. 15.1 General evaluation method

348

D. Yuill

15.4.1 Faulted and Unfaulted Operation

Faults are conditions that affect performance negatively and they have some level of
severity. We have developed two ways to characterize this level of severity. The ﬁrst
is fault intensity (FI), which is related to measurable quantities. For example, a 20 %
undercharge. The second is FIR, which is related to equipment performance, and
is tied to either capacity or coefﬁcient of performance (COP). For example, when
FIRCOP D 95 %, it says that the equipment is operating at 95 % of its maximum
efﬁciency under a given set of operating conditions.

There is not a direct relationship between FI and FIR. This means that it is
possible to have faults that have some FI, but with no measurable degradation of per-
formance. This raises the question of how do we draw a distinction between faulted
and unfaulted operation. The answer for the Yuill and Braun [4] method is that
we consider FIR, because the equipment performance is generally what equipment
operators and users of AFDD are concerned with. This leads to another question,
which is: how much performance degradation constitutes faulted operation? Our
approach is to leave this as a variable quantity, using FIR thresholds to draw the
distinction between faulted and unfaulted. We evaluate each protocol at several
thresholds so that a user of the results can choose the threshold he or she considers
appropriate. If the FIR threshold is 99 %, it means that test cases with FIR above
this threshold are considered to be unfaulted, regardless of the FI. This threshold
concept is important in the consideration of False Alarms, described below.

15.4.2 Test Case Outcomes

When FDD is applied, there are six possible outcomes with respect to fault isolation,
as listed in the taxonomy above. False Alarms is an important category, and has a
special treatment. Speciﬁcally, a False Alarm is indicated when the protocol gives a
response that a fault is present and:

1. the fault’s impacts on capacity and efﬁciency are both below a given threshold

(i.e., FIRQ and FIRCOP are both above the threshold)

2. the system is not overcharged by 5 % or more
3. the suction superheat is within the range 1–36 ıF

The special requirement in bullet b is included for the following reason. An
overcharged system may have a signiﬁcant fault, but no signiﬁcant impact on
capacity or COP. Consider the example case of a system that is 10 % overcharged,
but has no signiﬁcant degradation of capacity or COP. An equipment operator
may want to know about the overcharge, since it can be associated with reduction
of compressor life, even though it doesn’t impact the current performance of the
equipment. To address this situation, if the refrigerant is overcharged by more than
5 % the system is considered faulted, even if the fault impact is below the given
threshold.

15 Evaluating the Performance of Automated Fault Detection and Diagnosis Tools

349

To evaluate an AFDD protocol using this taxonomy, one feeds it multiple input
scenarios, each of which gives one of these test outcomes. Test outcomes for No
Response, False Alarm, Misdiagnosis, Missed Detection, and No Diagnosis are
gathered and expressed as rates, using percentages. Test outcome 2—Correct—is
implied by the other outcomes.

15.4.3 Test Case Outcome Rate Calculations

In rate calculations, the numerator is the number of test cases that have a given test
outcome (one of the six listed above). The denominator for each test outcome rate is
described below. Each denominator is deﬁned based on determining a meaningful
rate. The denominators include only the cases that could apply to each type of
outcome. For example, a Misdiagnosis can’t be made on a test in which no fault is
present, so only those cases determined to be faulted are included in the denominator
for Misdiagnosis rate. (If a protocol indicates a fault when none is present, this is a
False Alarm, not a Misdiagnosis). Thus, the potential range is from 0 to 100 % for
each outcome rate. The details of the rate calculations are given in Table 15.1.

Table 15.1 Rate calculation method for evaluation outcomes

Rate
No Response

False Alarm

Misdiagnosis

No Diagnosis

Numerator
Number of cases that meet
the “No Response” criteria
Number of cases that meet
the “False Alarm” criteria
described above

Number of cases for which
a fault is present, and the
protocol indicates a
different fault is present

a fault is present, and the
protocol indicates that no
fault is present
Number of cases for which
a fault is present, and the
protocol indicates that no
fault is present

Denominator
Total number of test cases

The number of cases in which the fault
impacts are below a speciﬁed threshold, the
unit is less than 5 % overcharged, the suction
superheat is in the range 1–36 ıF, and for
which the protocol gives a response
The number of cases in which the input data
library indicates the presence and intensity of
a fault, and the protocol indicates that the
system has a fault
The number of cases in which the input data
library indicates the presence and intensity of
a fault, and the protocol gives a response

The number of cases in which the input data
library indicates the presence and intensity of
a fault, and the protocol gives a response

Missed Detection Number of cases for which

350

15.4.4 Fault Types

D. Yuill

The faults that are included in the scope of the AFDD evaluation methodology
were selected based upon the availability of experimental data with faults imposed.
Choosing this set of faults is not arbitrary, because the faults that have been tested
experimentally generally correspond to those faults that have the greatest cost for
system operators. This cost is a function of the likelihood of the fault arising and
the penalty on operating costs that the fault imposes. Furthermore, the AFDD tools
that currently exist also tend to focus on this set of faults. Table 15.2 lists the faults,
describes how they are implemented in laboratory tests, and gives the abbreviations
that refer to each fault type. The descriptions and formal deﬁnitions of fault intensity
are proposed for standard usage by Yuill and Braun [4].

Table 15.2 Description of fault types and their fault intensity deﬁnitions

Abbr. Description
Fault type
Under- or over-charge UCOC A mass of refrigerant charge that is

Fault intensity deﬁnition
FIcharge D mactual (cid:2)mnominal

mnominal

Low-side heat transfer EA

High-side heat transfer CA

Liquid line restriction LL

Non-condensables

NC

FIEA D

:
Vnominal

:
Vactual (cid:2)
:
Vnominal

FICA D

:
Vnominal

:
Vactual (cid:2)
:
Vnominal

FILL D
(cid:12)PLL;faulted (cid:3) (cid:12)PLL;unfaulted
(cid:12)PLL;unfaulted

FINC D

mN2;faulted
mN2;ref

less or more than either (a) the
manufacturer’s recommended
mass, or (b) the mass that gives the
best system performance

Evaporator faults; reduced
evaporator airﬂow is used to
implement this fault in a laboratory

Condenser faults; reduced
condenser airﬂow is used to
implement this fault in a laboratory

Flow restrictions in the liquid line.
FI is pressure drop across
restriction divided by pressure
drop from condenser to evaporator
The presence of non-condensable
gas in the refrigerant. FI is mass of
N2 divided by mass of N2 that
would ﬁll the system at standard
temperature and pressure
Leakage of refrigerant from high
to low pressure regions in the
compressor. Implemented in the
laboratory with a metered hot-gas
bypass

Compressor leakage

VL

FIVL D

:
mfaulted(cid:2)
:
munfaulted

:
munfaulted

15 Evaluating the Performance of Automated Fault Detection and Diagnosis Tools

351

15.4.5 Input Data

The AFDD evaluation method described above requires a large and representative
set of input data to be fed through the AFDD protocol that is being tested. Gathering
such a set of data can be quite difﬁcult. The data need to represent operation in the
range of conditions in which the AFDD might be applied (combinations of indoor
and outdoor temperatures and indoor humidity values), with and without faults of
each fault type, at varying fault intensities for each fault type, and in combinations
of fault and operating condition. Finally, if the AFDD is to be applied generally,
i.e., not intended for a speciﬁc unitary system, then it needs to be tested with a
representative range of systems.

Yuill and Braun [4] used a library of laboratory measurement data that was a
combination of results from multiple experimenters at various laboratories. There
are nine unitary systems represented in the data set. They carefully vetted the data
for accuracy and realism, and compiled them into a standardized format. The library
is summarized in Table 15.3. The table includes conﬁguration (rooftop unit or split
system), rated capacity, refrigerant type, expansion device type (ﬁxed oriﬁce or
thermostatic expansion device), the number of tests for each fault type, and the
range of ambient temperature over which the tests were conducted. The fault types
are described below.

Case studies were carried out using this set of input data on the publicly available
diagnostic protocol described in CEC [10]. The results were presented in Yuill and
Braun [4], and were generally disappointing, including high False Alarm rates. In
the public response to these results a discussion began about whether the conditions
in the laboratory tests were representative of the actual conditions in which an
AFDD tool may be deployed. A model developed by Cheung and Braun [11, 12]
was subsequently used to provide a library of simulation data at a controlled set
of input conditions. This model is a fault-enabled gray-box model that combines
physics-based models wherever possible, and uses the experimental data described
in Table 15.3 to train some portions of the model, such as parameters describing
the heat exchanger performance. Yuill et al. [13] validated the model, and Yuill
et al. [3] described a modiﬁed method of AFDD performance evaluation based upon
simulation data.

Yuill and Braun [14] subsequently compared evaluation results for several AFDD
protocols three different input data libraries. The ﬁrst was the original measurement
data, which were gathered by the original experimenters at an essentially arbitrary
set of conditions; the second was modeled data for the exact same conditions and
unitary systems as the measurement data; and the third library used simulation data
from a set of realistic scenarios, including assumptions about fault prevalence and
typical operating conditions when AFDD protocols are applied. The comparison
showed that any differences in results when comparing the measurement-based
results with simulation-based results are insigniﬁcant compared to the effects of
using a realistic distribution of conditions. Therefore, it can be concluded that

352

D. Yuill

ı

)
F

(

.
x
a
M

ı

)
F

(

.
n
i
M

.
p
m
e
t

t
n
e
i
b
m
A

s
t
s
e
t

f
o

r
e
b
m
u
N

C
N

L
L

A
E

C
U

t
l
u
a
f

o
N

e
c
i
v
e
d

.
p
x
E

)
s
n
o
t
(

y
t
i
c
a
p
a
C

.
o
N

]
4
[

n
u
a
r
B
d
n
a

l
l
i
u
Y
m
o
r
f

y
r
a
r
b
i
l

a
t
a
d

t
u
p
n
i

a
t
a
d

t
n
e
m
e
r
u
s
a
e

M

3
.
5
1

e
l
b
a
T

5
2
1

0
0
1

6
1
1

7
2
1

0
0
1

7
2
1

5
2
1

5
2
1

5
2
1

6
1

5
1

6
1

5
1

7
6

0
6

7
6

2
8

0
7

3
8

2
8

2
8

2
8

L
V

0

3
3

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

0

4
3

A
C

6

6
3

8

0

0

0

0

0

1
2

6
2

9
1

0

1
2

0

0

8

6

C
O

2
1

0

1

2
1

2
1

7

7

0

4

5
2

4
3

5
1

9
2

2
1

0
3

4

8

4

4
2

9
3

7
1

6
1

1

2

4

4

4

9
4

5
1

0
5

5
6

1
0
1

5
5

1
6
1

1
1
1

O
X
F

O
X
F

O
X
F

O
X
F

V
X
T

V
X
T

V
X
T

V
X
T

O
X
F

l
a
t
o
T

.
g
i
r
f
e
R

A
0
1
4
R

2
2
R

C
7
0
4
R

A
0
1
4
R

A
0
1
4
R

A
0
1
4
R

A
0
1
4
R

2
2
R

2
2
R

3

3

5

3

3

3

3

3

5
.
2

e
p
y
T

U
T
R

U
T
R

U
T
R

t
i
l
p
S

t
i
l
p
S

t
i
l
p
S

t
i
l
p
S

t
i
l
p
S

t
i
l
p
S

1

2

3

4

5

6

7

8

9

15 Evaluating the Performance of Automated Fault Detection and Diagnosis Tools

353

meaningful evaluations must be conducted using data generated by reliable models,
unless laboratory testing can be conducted for all combinations of operating and
fault conditions and air-conditioner models of interest.

15.5 Case Study

To illustrate the usage of the protocol, a case study is presented here, showing
the results of evaluating the diagnostic protocol that is part of the California 2013
building energy code [2]. The case study results here are from an evaluation using
the measurement data library as inputs (described in Table 15.3). The protocol is
publicly available, which is why it is presented here. However, it is limited in scope.
It is intended only to check for refrigerant charge faults, although it also requires
direct measurement of evaporator airﬂow. This presents two philosophical questions
with respect to evaluating AFDD performance. The ﬁrst is: how should the airﬂow
measurement requirement be treated? We have assumed that the technician correctly
measures airﬂow prior to applying the AFDD. In a practical sense, this means that
we removed all cases in which there is an evaporator heat transfer fault (which is
implemented in the laboratory as a reduction in evaporator airﬂow). This approach
is conservative; in actual application, which includes the myriad problems with
accurate airﬂow measurement in the ﬁeld, the AFDD may not perform as well as
indicated in this case study.

The second philosophical question is: should an AFDD protocol be tested with
faults other than those faults it is intended to diagnose? Since other faults may be
present when an AFDD protocol is applied, it is reasonable to include other faults in
the input data when any AFDD protocol is tested, regardless of whether it is intended
to diagnose those faults. For example, if an AFDD protocol is intended to diagnose
only the presence of non-condensable gas in the refrigerant, but it ﬂags this fault in
cases in which the condenser is fouled or the system is overcharged, it may not be a
very useful protocol. An effective evaluation of the performance of AFDD protocols
should consider the importance of each fault type. This importance is a combination
of the likelihood of the fault occurring at each fault intensity (a probability density
function, which is referred to as “fault prevalence” in Yuill and Braun [14, 15]), and
the cost of the fault at that intensity for the application of interest.

Clearly, the consideration of fault cost can be quite complex. Yuill and Braun [15]
provide a methodology for calculating this cost and for considering fault prevalence
in the total value calculation for a particular AFDD tool. In their analysis, the
protocol presented in the case study below gives a negative value, overall. This is
primarily driven by the additional service technician costs that are associated with
False Alarms and Misdiagnoses. They found that the cost of Missed Detections
is not very signiﬁcant because many faults do not cause sufﬁcient reductions in
equipment life and efﬁciency to warrant the cost of addressing them.

354

15.6 Results

D. Yuill

In Fig. 15.2 the False Alarm rates for the case study protocol are shown. The way to
interpret these results is as follows. On the left side, the FIR threshold is 100 %. This
means that any test case in which the capacity and COP of the unit are at (or above)
the capacity and COP of the unit at the same conditions is considered unfaulted,
regardless of whether the experimenter imposed a fault (with the exception of
overcharge, as noted above). The rationale is that a fault that has no impact shouldn’t
be considered a fault. If the protocol ﬂags such as case as faulted, it is considered a
False Alarm. The protocol ﬂags about 13 % of these cases as faulted.

Moving rightward the same logic is applied. If a fault is so minor that it reduces
either capacity or COP by a maximum of 2.5 %, for example, it is considered
unfaulted at the 97.5 % FIR threshold. This protocol ﬂags about 40 % of cases that
have no fault sufﬁcient to reduce capacity or COP by 2.5 %. The results in Fig. 15.2
could be considered a set of individual results for which a user can choose the result
that is meaningful to them. A user for whom any fault less than 5 % is considered
insigniﬁcant uses the 95 % FIR threshold result, and ignores the other threshold’s
results.

The results for Misdiagnosis are different than for False Alarms. In a Misdiagno-
sis, there must be a fault present for it to be considered a Misdiagnosis. Therefore,
the threshold concept used for False Alarms doesn’t apply. Instead, we group the
Misdiagnosis cases into bins with respect to the FIR. Since faults affect capacity
and COP differently, some tests may be in different bins depending on whether
capacity or COP is considered. Therefore, two data series are presented: one for the
capacity FIR bins and one for the COP FIR bins (Fig. 15.3).

Fig. 15.2 False Alarm rates
for case study AFDD protocol

100

)

%

 

(
 
e
t
a
R
m
r
a
A
e
s
l
a
F

l

 

90

80

70

60

50

40

30

20

10

0
100.0%

97.5%

95.0%

92.5%
Fault Impact Ratio threshold

90.0%

87.5%

85.0%

15 Evaluating the Performance of Automated Fault Detection and Diagnosis Tools

355

)

%

(
 
e
t
a
R
 
s
i
s
o
n
g
a
d
s
i

i

M

100
90
80
70
60
50
40
30
20
10
0

)

%

 

(
 
e
t
a
R
n
o
i
t
c
e
t
e
D
d
e
s
s
i

 

M

100
90
80
70
60
50
40
30
20
10
0

>105 %

95-105 %

85-95 %

75-85 %

<75 %

Fault Impact Ratio bin

Fig. 15.3 Misdiagnosis results for case study AFDD protocol

Capacity

COP

Capacity

COP

>105 %

95-105 %

85-95 %

75-85 %

<75 %

Fault Impact Ratio bin

Fig. 15.4 Missed Detection results for case study AFDD protocol

Missed Detection results are presented in the same manner as Misdiagnosis
results: the results are grouped into bins by FIR and presented in separate series
for capacity and COP effects (Fig. 15.4).

356

D. Yuill

15.6.1 Discussion of Case Study Results

As noted earlier, the performance of this protocol is disappointing. False Alarms
are a particularly expensive problem for diagnostics to provide in most settings
(automotive, buildings, aerospace, etc.). One might assume that since this protocol
is intended to be applied only to charge faults, it would perform better if all other
faults were eliminated. This is true; the protocol does perform better when it is
only fed inputs that have charge faults or no fault. However, it is difﬁcult to imagine
scenarios in which a charge fault might be present, but no other faults could possibly
be present. In fact the results above probably indicate better performance than
this protocol might see in the ﬁeld because the existing set of measurement data
(described in Table 15.3) has a very large proportion of charge fault data. When the
EA data are removed, 327 of the remaining 506 tests have either a charge fault or
no fault. In fact, Yuill et al. [3] show that this system performs far worse when an
even distribution of faults and conditions is used.

The Misdiagnosis results in Fig. 15.3 show an expected result: the rate of
Misdiagnoses decreases as the fault’s severity increases, with less than 10 % of
the cases being Misdiagnosed from the bin with FIR less than 75 %. However, this
result is caused by a related issue to the discussion regarding a heavy distribution
of charge faults. The faults in a laboratory settings that cause the largest decrease in
capacity and efﬁciency are undercharge faults, which is one that this protocol can
diagnose. When Yuill et al. [3] used an even distribution of faults, the Misdiagnosis
rates showed no clear relation to FIR. A similar result occurs with Missed Detection
results.

One result type that is not presented here is the No Diagnosis results. This result
represents the cases in which a protocol indicates the presence of a fault but cannot
or does not diagnose what type of fault it is. The protocol in this case study always
provides a diagnosis when it detects a fault, so the result would be zero in all ranges.

15.7 Conclusions

AFDD tools have potential to reduce operating costs in air-conditioners by giving
early warning of faults that can degrade performance and reduce equipment life.
However, there has been little scrutiny until recently on the effectiveness of the
AFDD protocols to give accurate results. This is partly because there has been no
metrics by which to describe the performance of AFDD, either in air-conditioners or
in equipment in general. A methodology has now been developed to systematically
evaluate the performance of AFDD tools for unitary air-conditioners. The method-
ology includes a taxonomy of performance outcomes with which performance can
be quantiﬁed and measured. The AFDD evaluation method has been applied to
several air-conditioners, and found that performance is often not as good as might

15 Evaluating the Performance of Automated Fault Detection and Diagnosis Tools

357

be expected. Results from one widely applied AFDD method have been shown in a
case study, to demonstrate how the evaluation methodology is applied.

The results of evaluating existing methods showed that many currently existing
tools don’t perform very well. One conclusion from this result is that AFDD should
be widely tested to ensure that they perform well enough to provide net beneﬁts.
It is hoped that the existence of an evaluation methodology will help developers
of future methods to develop more effective methods. In addition, as methods are
improved and as potential adopters of AFDD and developers of codes and standards
are more able to quantify performance and beneﬁts of AFDD, that it will become
more widely adopted.